var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function a(e){try{c(o.next(e))}catch(t){r(t)}}function s(e){try{c(o["throw"](e))}catch(t){r(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(o){n=[6,o],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Direction={Top:"top",Left:"left",Bottom:"bottom",Right:"right"},GameAction={JoinGame:"join_room",StartGame:"start_game",DealCards:"deal_cards",Flop:"flop",Turn:"turn",River:"river",Switch:"switch_player",Bet:"bet",Call:"call",SB:"small_blind",BB:"big_blind",Raise:"raise",AllIn:"all_in",Fold:"fold",UpdatePots:"update_pots",Check:"check",Showdown:"showdown",EndGame:"end_game",LeaveRoom:"leave_room",Sit:"sit",StandUp:"stand_up",Ready:"ready",ApplyBuyIn:"apply_buy_in",AuditBuyIn:"audit_buy_in"};eui.Image.prototype.loadUrlSource=function(e){var t=this,n=new egret.ImageLoader;n.crossOrigin="anonymous",n.load(e),n.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var n=new egret.Texture;n.bitmapData=e.currentTarget.data,t.source=n}},this)},eui.Image.prototype.renderRoundMask=function(e){var t=new eui.Rect;t.width=this.width,t.height=this.height,t.x=this.x,t.y=this.y,t.ellipseWidth=e,t.ellipseHeight=e,this.parent.addChild(t),this.mask=t};var RaiseSelector=function(e){function t(){var t=e.call(this)||this;return t.skinName="RaiseSelectorSkin",t}return __extends(t,e),t.prototype.updateSliderValue=function(e,t,n){void 0===e&&(e=2),void 0===t&&(t=100),void 0===n&&(n=2),this.dashboardButton.label=t.toString(),this.raiseSlider.minimum=e,this.raiseSlider.maximum=t,this.raiseSlider.snapInterval=n,this.raiseSlider.value=e},t.prototype.show=function(){this.visible=!0},t.prototype.hide=function(){this.visible=!1,this.confirmButton.image.source="btn_raise_confirm_png"},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.dashboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDashboardButtonTouch,this),this.allInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllInButtonTouch,this),this.raiseSlider.addEventListener(egret.Event.CHANGE,this.onValueChange,this)},t.prototype.onBackgroundTouch=function(){this.hide()},t.prototype.onValueChange=function(e){var t=this.raiseSlider.value===this.raiseSlider.maximum;this.confirmButton.image.source=t?"btn_slider_all_in_png":"btn_raise_confirm_png"},t.prototype.onAllInButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.confirmButton.image.source="btn_slider_all_in_png",this.raiseSlider.value=this.raiseSlider.maximum;var e=this.raiseSlider.value,t=new RaiseEvent(RaiseEvent.AllIn);t.data=e,this.dispatchEvent(t),this.hide()},t.prototype.onConfirmButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e,t=this.raiseSlider.value;t===this.raiseSlider.maximum?(this.confirmButton.image.source="btn_raise_confirm_png",e=new RaiseEvent(RaiseEvent.AllIn)):e=new RaiseEvent(RaiseEvent.Raise),e.data=t,this.dispatchEvent(e),this.hide()},t.prototype.onDashboardButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.confirmButton.image.source="btn_slider_all_in_png",this.raiseSlider.value=this.raiseSlider.maximum},t}(eui.Component);__reflect(RaiseSelector.prototype,"RaiseSelector");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function i(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(o,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LoadingComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingComponentSkin",t}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.show=function(e,t){void 0===t&&(t="努力加载中..."),this.labelDisplay.text=t,e.addChild(this),AnimationUtil.loopPlay(this.loadingTween)},t.prototype.updateMessage=function(e){this.labelDisplay.text=e},t.prototype.hide=function(){this.parent&&(this.loadingTween.stop(),this.parent.removeChild(this))},t}(eui.Component);__reflect(LoadingComponent.prototype,"LoadingComponent");var MessageAlert=function(){function e(){}return e.init=function(e){this.container=e},e.show=function(e,t){var n=new MessageAlertComponent;n.setMessage(e),n.addButtons(t),this.container.addChild(n)},e}();__reflect(MessageAlert.prototype,"MessageAlert");var MessageAlertComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageAlertSkin",t}return __extends(t,e),t.prototype.setMessage=function(e){this.messageLabel.text=e},t.prototype.addButtons=function(e){var t=this;e?e.forEach(function(e){t.createButton(e.name,e.action)}):this.createButton("确认")},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.createButton=function(e,t){void 0===e&&(e="确认");var n=new eui.Button;n.skinName="ChatSendButtonSkin",n.labelDisplay.text=e,t&&n.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this),n.addEventListener(egret.TouchEvent.TOUCH_END,this.remove,this),this.buttonGroup.addChild(n)},t.prototype.remove=function(){this.parent.removeChild(this)},t}(eui.Component);__reflect(MessageAlertComponent.prototype,"MessageAlertComponent");var ObjToast=function(e){function t(){var t=e.call(this)||this;return t.content=new eui.Label,t.bg=new eui.Rect,t.bg.fillColor=1973790,t.bg.alpha=.8,t.bg.ellipseWidth=15,t.bg.ellipseHeight=15,t.addChild(t.bg),t.content.fontFamily="Microsoft Yahei",t.content.size=20,t.content.lineSpacing=8,t.content.textAlign=egret.HorizontalAlign.CENTER,t.addChild(t.content),t}return __extends(t,e),Object.defineProperty(t.prototype,"abxca",{set:function(e){this.content&&(this.content.textFlow=(new egret.HtmlTextParser).parser(e)),this.bg.width=this.content.width+50,this.bg.height=this.content.height+20,this.content.x=(this.bg.width-this.content.width)/2,this.content.y=(this.bg.height-this.content.height)/2},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ObjToast.prototype,"ObjToast");var Toast=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.init=function(e){this._cont=e},t.show=function(e,t){var n=this;if(void 0===t&&(t=1200),this._cont){if(!this._group){var o=new eui.VerticalLayout;o.horizontalAlign=egret.HorizontalAlign.CENTER,this._group=new eui.Group,this._group.layout=o,this._group.width=egret.MainContext.instance.stage.stageWidth,this._cont.addChild(this._group),this._group.touchEnabled=!1,this._group.touchChildren=!1}var i=new ObjToast;i.abxca=e;this._group.height/i.height;i.x=(egret.MainContext.instance.stage.stageWidth-i.width)/2,this._group.addChild(i),this._group.y=.5*(egret.MainContext.instance.stage.stageHeight-this._group.height),egret.Tween.get(i).to({alpha:1},800,egret.Ease.quintOut).wait(t).to({alpha:0},800,egret.Ease.quintIn).call(function(){if(n._group){var e=n._group.getChildAt(0);n._group.removeChild(e),e=null,n._group.y+=i.height+6}})}},t}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");var ApiConfig={ApiDomain:"https://2.hk.api.shafayouxi.org",MediaDomain:"https://media.shafayouxi.org",WebSocketDomain:"wss://2.hk.api.shafayouxi.org",Version_1:"v1",Version_2:"v2"},CardSuit;!function(e){e[e.Error=-1]="Error",e[e.Spade=0]="Spade",e[e.Heart=1]="Heart",e[e.Club=2]="Club",e[e.Diamond=3]="Diamond"}(CardSuit||(CardSuit={}));var CardType={HIGH_CARD:"high_card",PAIR:"pair",TWO_PAIRS:"two_pairs",THREE_OF_A_KIND:"three_of_a_kind",STRAIGHT:"straight",FLUSH:"flush",FULL_HOUSE:"full_house",FOUR_OF_A_KIND:"four_of_a_kind",STRAIGHT_FLUSH:"straight_flush",ROYAL_FLUSH:"royal_flush"},CardValue;!function(e){e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.J=11]="J",e[e.Q=12]="Q",e[e.K=13]="K",e[e.A=14]="A",e[e.Error=15]="Error"}(CardValue||(CardValue={}));var Coordinate={bottomPlayer:{x:246,y:1080,direction:Direction.Bottom,seat:1},leftBottomPlayer:{x:30,y:726,direction:Direction.Left,seat:2},leftMiddlePlayer:{x:30,y:482,direction:Direction.Left,seat:3},leftTopPlayer:{x:30,y:236,direction:Direction.Left,seat:4},topLeftPlayer:{x:200,y:70,direction:Direction.Left,seat:5},topRightPlayer:{x:450,y:70,direction:Direction.Right,seat:6},rightTopPlayer:{x:620,y:236,direction:Direction.Right,seat:7},rightMiddlePlayer:{x:620,y:482,direction:Direction.Right,seat:8},rightBottomPlayer:{x:620,y:726,direction:Direction.Right,seat:9}},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?o(i):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){},window.document.addEventListener("message",function(e){var t=JSON.parse(e.data);"query_platform_name"==t.command?Device.sharedInstance().setPlatform(t.payload):"query_screen_size"===t.command&&Device.sharedInstance().setScreenSize(t.payload)});var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),Toast.init(this.stage),MessageAlert.init(this.stage),this.createScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return o.sent(),[4,this.loadTheme()];case 2:return o.sent(),[4,RES.loadGroup("loading")];case 3:return o.sent(),this.queryPlatformInfo(),e=new LoadingScene,this.stage.addChild(e),t=new eui.Label,[4,RES.loadGroup("preload",0,e)];case 4:return o.sent(),this.stage.removeChild(e),[3,6];case 5:return n=o.sent(),console.error(n),[3,6];case 6:return[2]}})})},t.prototype.queryPlatformInfo=function(){window.postMessage(JSON.stringify({command:"query_screen_size"}),"*"),window.postMessage(JSON.stringify({command:"query_platform_name"}),"*")},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createScene=function(){SceneManager.sharedInstance().init(this),SceneManager.sharedInstance().pushScene(new LaunchScene)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var GameState={Waiting:"waiting",Preflop:"preflop",Flop:"flop",Turn:"turn",River:"river",Finish:"finish"},PlayerState={NotInGame:"not_in_game",Betting:"betting",AllIn:"all_in",Folded:"folded"},RequestId={QueryMyRoom:"query_my_room",QueryJoinedRoom:"query_joined_room",LeaveJoinedRoom:"leave_joined_room",JoinRoomByPin:"join_room_by_pin",QueryInitialScore:"query_initial_score",ChangePermit:"change_permit",BuyIn:"buy_in",SitDown:"sit_down",StartGame:"start_game",QueryState:"query_state",Ready:"ready",Call:"call",Raise:"raise",Check:"check",AllIn:"all_in",Fold:"fold",CheckTimeout:"check_timeout",StandUp:"stand_up",Leave:"leave"},RoomStatus={Waiting:"waiting",Gaming:"gaming"},SoundEffectSource={Click:"uiclick_mp3",AddChips:"addchips_mp3",AllIn:"allin_mp3",Bet:"bet_mp3",BetClick:"bet_click_mp3",Check:"check_mp3",ChipToPlayers:"chiptoplayers_mp3",ChipToPool:"chiptopool_mp3",FaPai:"fapai_mp3",FaPai3:"fapai3_mp3",Fold:"fold_mp3",Alarm:"g_alarm_mp3",MoveChips:"movechips_mp3",Notice:"notice_mp3",PlayerEnter:"user_enter_mp3"},StatisticConfig=[{title:"总场数",data:""},{title:"获胜场数",data:""},{title:"获胜率",data:""},{title:"总手数",data:""},{title:"入池率",subtitle:"VPIP",data:""},{title:"入池胜率",data:""},{title:"翻牌前加注率",subtitle:"PRF",description:"Preflop Raise Rate: 即翻牌前加注率,\n指一个玩家翻牌前加注的频率",data:""},{title:"翻牌前再加注率",subtitle:"3Bet",description:"3Bet: 在翻牌前, 当有玩家加注之后, 自己再次加注的频率",data:""},{title:"翻牌后持续下注率",subtitle:"CBet",description:"Countinue Bet: Flop持续下注率,\n是指在翻牌前最后一名加注的玩家, 在翻牌后再次主动下注的频率",data:""},{title:"场均带入",data:""},{title:"场均战绩",data:""},{title:"激进度",subtitle:"AF",description:"Aggressive Factor: 是用来衡量一个玩家在看到翻牌后打牌激进程度的数值,\n方法计算(下注的次数+加注的次数)除以跟注的次数",data:""},{title:"摊牌率",data:""},{title:"All-In胜率",data:""},{title:"赢过最大的池底",data:""}],ActionMessage={Call:"跟注",Check:"让牌",Raise:"加注",AllIn:"全下",Fold:"弃牌"},CentrifugeServerEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.Connected="server_connected",t.Disconnected="server_disconnected",t.ReceivedMessageFromCentrifuge="centrifuge_received_message",t.ConnectionError="connection_error",t}(egret.Event);__reflect(CentrifugeServerEvent.prototype,"CentrifugeServerEvent");var EventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t}(egret.EventDispatcher);__reflect(EventCenter.prototype,"EventCenter");var LaunchEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.LoginSuccess="login_success",t}(egret.Event);__reflect(LaunchEvent.prototype,"LaunchEvent");var SceneEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.LeaveFromGame="leave_from_game",t}(egret.Event);__reflect(SceneEvent.prototype,"SceneEvent");var WebSocketEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.CONNECTED="connected",t.CLOSE="close",t.ERROR="error",t.RECEIVED_MESSAGE_FROM_WS="websocket_received_message",t}(egret.Event);__reflect(WebSocketEvent.prototype,"WebSocketEvent");var GameScene=function(e){function t(){var t=e.call(this)||this;return t.playerViews=[],t.handCards=[],t.seatViews=[],t.touchTimes=0,t.lastTime=0,t.skinName="GameSkin",egret.localStorage.removeItem(ReviewboardModel.CACHE_DATA_KEY),t}return __extends(t,e),t.prototype.init=function(e){this.playerModel=new PlayerModel,this.gameModel=new GameModel,this.roomData=e,this.preFetchLeaderboardData()},t.prototype.preFetchLeaderboardData=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.leaderboardModel=new LeaderboardModel(this.roomData.id),this.leaderboardModel.fetchPlayersScores(),this.leaderboardModel.fetchViewers(),[2]})})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Device.sharedInstance().isIphoneX()&&(this.menuButton.y+=Constants.iPhoneX_TOP_MARGIN,this.reviewboardButton.y+=Constants.iPhoneX_TOP_MARGIN,this.messageAlarm.y+=Constants.iPhoneX_TOP_MARGIN,this.debugView.y+=Constants.iPhoneX_TOP_MARGIN),this.potsList.itemRenderer=PotItemRenderer,this.bottomToolbar.pressLeaderboardButtonHandler=this.showLeaderboard.bind(this),this.cardTypeLabel.text=" ",this.initAnimation(),this.addSeat(),this.chatComponent=new ChatComponent,this.addChild(this.chatComponent),this.communityCardList.itemRenderer=CommunityCardItemRenderer,this.addEventListeners(),this.gameModel.handleRoomData(this.roomData),this.queryRoomState()},t.prototype.addSeat=function(){var e=this;Object.keys(Coordinate).forEach(function(t){var n=new SeatView(Coordinate[t]);n.addEventListener(SeatTouchEvent.TouchSeat,e.onTouchSeat,e),e.seatViews.push(n),e.group.addChild(n)})},t.prototype.showLeaderboard=function(){SceneManager.sharedInstance().pushScene(new LeaderboardScene(this.leaderboardModel))},t.prototype.initAnimation=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,RES.getRes("congratulation_json")];case 1:return e=i.sent(),[4,RES.getRes("congratulation_png")];case 2:return t=i.sent(),n=new egret.MovieClipDataFactory(e,t),this.winnerAnimation=new egret.MovieClip(n.generateMovieClipData("you_win")),this.winnerAnimation.x=253,this.winnerAnimation.y=810,[3,4];case 3:return o=i.sent(),egret.log(o),[3,4];case 4:return[2]}})})},t.prototype.buildGame=function(e){this.hidePlayGameButtonGroup();var t=UserModel.sharedInstance();this.creatorLabel.text=t.clubInfo?"俱乐部: "+t.clubInfo.clubName:e.roomInfo.creatorName,this.pinLabel.text=t.clubInfo?"牌局: "+t.clubInfo.roomName:"房间号: "+this.gameModel.getRoomPin(),this.blindLabel.text="盲注: "+e.roomInfo.smallBlind+"/"+e.roomInfo.bigBlind,this.playGameButtonGroup.setBlind(e.roomInfo.smallBlind,e.roomInfo.bigBlind),this.gameModel.isCreator()&&(this.messageAlarm.visible=!0);var n=e.players;this.restorePlayerView(n),this.restorePlayerHandCard(n),this.adjustSeatView(),e.activePlayer&&this.switchPlayer(e.activePlayer.id,e.activePlayer.legalActions),e.dealer&&this.allotMark(e.dealer.id,e.smallBlind.id,e.bigBlind.id),this.communityCardList.dataProvider=new eui.ArrayCollection(e.cards||[]),this.updateAllPots(e.pots,e.mainPot),e.status===GameState.Waiting&&(this.cardTypeLabel.text=" ")},t.prototype.clearAllPlayerView=function(){var e=this;this.playerViews.forEach(function(t){e.group.removeChild(t)}),this.playerViews=[]},t.prototype.restorePlayerView=function(e){var t=this;this.clearAllPlayerView(),1===e.length?this.promptLabel.text="等待玩家加入":this.promptLabel.text="等待下一局开始",e.forEach(function(e){e.id!==t.gameModel.localPlayerId||t.gameModel.isGaming||(t.promptLabel.visible=!0),t.createNewPlayerView(e)})},t.prototype.adjustSeatView=function(){var e=this,t=this.gameModel.seatDiff;this.seatViews.forEach(function(e){var n=SeatUtil.calculateSeat(e.getSeatNumber(),t,SeatUtil.TOTAL_PLAYER_AMOUNT),o=SeatUtil.findCoordinate(n);e.updatePosition(o)});var n=this.playerViews.findIndex(function(t){return t.isPlayerIdEqualTo(e.gameModel.localPlayerId)});-1===n?this.enableTouchSeat():this.disableTouchSeat()},t.prototype.restorePlayerHandCard=function(e){var t=this;this.clearHandCards(),e.forEach(function(e){t.playerViews.forEach(function(n){n.isPlayerIdEqualTo(e.id)&&n.isPlayerPlaying()&&e.holeCard.forEach(function(e,o){var i=new CardInfo({name:e});0===o?t.createCard(i,n.getCoordinate(),1790,0,!1):t.createCard(i,n.getCoordinate(),1810,10,!1)})})})},t.prototype.handleGameStart=function(e){this.clearTimer(),this.promptLabel.visible=!1,this.infoLabel.text=" ",this.reset(),this.updateMainPot(e.mainPot),this.allotMark(e.dealer.id,e.smallBlind.id,e.bigBlind.id),this.betBlinds(e.smallBlind,e.bigBlind)},t.prototype.handleDealCards=function(e){var t=this;this.clearTimer();var n=e.cards||[];this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByCard(n);var o=1790,i=(this.gameModel.currentPlayerAmount,setTimeout(function(){var e=1790;t.playerViews.forEach(function(o,i){t.createCard(n[0],o.getCoordinate(),e)}),clearTimeout(i),i=void 0},200)),r=setTimeout(function(){o=1810;var e=10;t.playerViews.forEach(function(i,r){t.createCard(n[1],i.getCoordinate(),o,e)}),clearTimeout(r),r=void 0},400)},t.prototype.updateMainPot=function(e){this.mainPotLabel.text="底池: "+MoneyFormatter.addChineseUnit(e)},t.prototype.allotMark=function(e,t,n){this.playerViews.forEach(function(o){return o.isPlayerIdEqualTo(e)?(o.setMark("D"),!0):o.isPlayerIdEqualTo(t)?(o.setMark("SB"),!0):o.isPlayerIdEqualTo(n)?(o.setMark("BB"),!0):void 0})},t.prototype.betBlinds=function(e,t){this.playerViews.forEach(function(n){return n.isPlayerIdEqualTo(e.id)?(n.updateScoreboard(e.amount),n.updateStack(e.stack),!0):n.isPlayerIdEqualTo(t.id)?(n.updateScoreboard(t.amount),n.updateStack(t.stack),!0):void 0})},t.prototype.createCard=function(e,t,n,o,i){void 0===o&&(o=0),void 0===i&&(i=!0);var r=new HandCardImage({coordinate:t,cardName:e?e.name:"",rotation:n,additionX:o,animate:i});this.handCards.push(r),this.group.addChild(r)},t.prototype.handleDraw=function(e){if(this.playerViews.forEach(function(e){e.removeScoreboard(),e.getCurrentStatus()!==GameAction.Fold&&e.removeStatusImage()}),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.FaPai),this.communityCardList.dataProvider=new eui.ArrayCollection(e.cards),this.gameModel.isGaming&&this.gameModel.localPlayerCards.length>0){var t=this.gameModel.localPlayerCards.concat(e.cards);this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByCard(t)}},t.prototype.checkTimeout=function(){this.playerModel.checkTimeout(this.gameModel.gameId)},t.prototype.onPlayerTimerEnd=function(e){var t=this;this.checkTimer=setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return clearTimeout(this.checkTimer),this.checkTimer=void 0,this.checkTimeout(),e.playerId===this.gameModel.localPlayerId&&this.standUp(),[2]})})},3e3)},t.prototype.createNewPlayerView=function(e){var t=new PlayerView;t.bindPlayer(e),t.addEventListener(PlayerViewEvent.TimerEnd,this.onPlayerTimerEnd,this),t.addEventListener(PlayerViewEvent.Touch,this.onPlayerViewTouch,this),this.playerViews.push(t),this.group.addChild(t)},t.prototype.hasNewPlayerJoin=function(e){this.resetTimer||2!==this.gameModel.currentPlayerAmount||this.startGame(),this.promptLabel.text="等待下一局开始",SoundManager.sharedInstance().playEffectSound(SoundEffectSource.PlayerEnter),this.createNewPlayerView(e.newPlayer)},t.prototype.hasPlayerLeave=function(e){var t=this;this.playerViews.forEach(function(n,o){if(n.isPlayerIdEqualTo(e.playerId)){for(var i=n.getCoordinate(),r=t.handCards.length-1;r>=0;r-=1)t.handCards[r].getCoordinate()===i&&(t.group.removeChild(t.handCards[r]),t.handCards.splice(r,1));t.group.removeChild(n),t.playerViews.splice(o,1)}}),this.gameModel.hasLocalPlayer()&&1===this.gameModel.currentPlayerAmount&&(this.promptLabel.text="等待玩家加入",this.promptLabel.visible=!0),e.playerId===this.gameModel.localPlayerId&&(this.cardTypeLabel.text=" ",this.promptLabel.visible=!1,this.enableTouchSeat(),this.hidePlayGameButtonGroup())},t.prototype.switchPlayer=function(e,t){if(this.playerViews.forEach(function(t){t.stopTimer(),t.isPlayerIdEqualTo(e)&&(t.startTimer(),t.removeStatusImage(),t.removeScoreboard())}),e===this.gameModel.localPlayerId){var n=UserModel.sharedInstance().initialScore;this.updateStatusForPlayGameButtonGroup(t,n),this.playGameButtonGroup.showSwitchButtons()}},t.prototype.handleSwitchPlayer=function(e){var t=e.playerId;this.switchPlayer(t,e.legalActions)},t.prototype.updateStatusForPlayGameButtonGroup=function(e,t){if(e){if(!e.mustAllIn&&e.couldRaise){var n=e.raiseAmount.min,o=e.raiseAmount.max,i=this.gameModel.bigBlindAmount;this.raiseSelector.updateSliderValue(n,o,i),this.quickRaiser.updateLimits(n,o)}this.playGameButtonGroup.update(e,this.gameModel.mainPot,t)}},t.prototype.hasPlayerCall=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AddChips),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.Call))})},t.prototype.hasPlayerRaise=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AddChips),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.Raise))})},t.prototype.hasPlayerAllIn=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AllIn),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.AllIn))})},t.prototype.hasPlayerCheck=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Check),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&t.updateStatusImage(GameAction.Check)})},t.prototype.hasPlayerFold=function(e){var t=this;SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Fold),this.playerViews.forEach(function(n){if(n.isPlayerIdEqualTo(e.playerId)){n.showFoldCover(),n.updateStatusImage(GameAction.Fold);for(var o=t.handCards.length-1;o>=0;o-=1){var i=t.handCards[o];i.getCoordinate().direction!==Direction.Bottom&&i.getCoordinate()===n.getCoordinate()&&(t.group.removeChild(t.handCards[o]),t.handCards.splice(o,1))}}}),e.playerId===this.gameModel.localPlayerId&&this.hidePlayGameButtonGroup()},t.prototype.updateAllPots=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=void 0;1===e.length?(n=new eui.VerticalLayout,n.horizontalAlign="center"):(n=new eui.TileLayout,n.columnAlign="justifyUsingWidth",n.rowAlign="top",n.orientation="rows",n.horizontalAlign="contentJustify",n.verticalAlign="contentJustify"),this.potsList.layout=n,this.potsList.dataProvider=new eui.ArrayCollection(e),this.updateMainPot(t)},t.prototype.hasUpdatePots=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ChipToPool),this.updateAllPots(e.pots,e.mainPot)},t.prototype.handleShowdown=function(e){var t=this;this.cardTypeLabel.text=" ";var n=e.showdownPlayers;n.forEach(function(e){t.playerViews.forEach(function(n){if(n.isPlayerIdEqualTo(e.id)){var o=e.hole_card.map(function(e){return new CardInfo({name:e})}),i=PokerAnalyzer.getCardTypeByResult(e.strength);n.displayCardType(i),n.showCard(o)}for(var r=t.handCards.length-1;r>=0;r-=1){var a=t.handCards[r];a.getCoordinate()===n.getCoordinate()&&(t.group.removeChild(a),t.handCards.splice(r,1))}})})},t.prototype.reset=function(){this.playerViews.forEach(function(e){e.reset()}),this.group.contains(this.winnerAnimation)&&this.group.removeChild(this.winnerAnimation),this.clearHandCards(),this.cardTypeLabel.text=" ",this.communityCardList.dataProvider=new eui.ArrayCollection([]),this.potsList.dataProvider=new eui.ArrayCollection([]),this.updateMainPot(0)},t.prototype.ready=function(){this.gameModel.hasLocalPlayer()&&(this.updateInfoLabel("正在请求准备"),this.playerModel.ready())},t.prototype.updateInfoLabel=function(e){this.infoLabel.text=e+", 已准备: "+this.gameModel.hasReadyPlayerAmount+"人, 玩家人数: "+this.gameModel.currentPlayerAmount+"人"},t.prototype.handleGameEnd=function(e){var t=this;this.gameModel.hasLocalPlayer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ChipToPlayers),this.hidePlayGameButtonGroup(),this.playerViews.forEach(function(n){n.stopTimer(),n.isPlayerIdEqualTo(e.winner.id)&&(n.isPlayerIdEqualTo(t.gameModel.localPlayerId)&&(t.group.addChild(t.winnerAnimation),t.winnerAnimation.gotoAndPlay("win",1)),n.playWinnerAnimation())}),e.prize.forEach(function(e){t.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.id)&&t.showPrizeLabel(e.amount)})}),this.leaderboardModel.fetchPlayersScores(),this.leaderboardModel.fetchViewers(),clearTimeout(this.checkTimer),this.checkTimer=void 0;var n=e.playersForStack;setTimeout(function(){n.forEach(function(e){t.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.id)&&t.updateStack(e.stack)})}),t.ready()},3e3),this.resetTimer=setTimeout(function(){t.reset(),clearTimeout(t.resetTimer),t.resetTimer=void 0},4e3),this.startGameTimer=setTimeout(function(){t.startGame(),clearTimeout(t.startGameTimer),t.startGameTimer=void 0},1e4)},t.prototype.hasPlayerReady=function(e){var t=this;this.updateInfoLabel("有玩家准备了"),this.gameModel.currentPlayerAmount>=2&&this.gameModel.hasReadyPlayerAmount>=this.gameModel.currentPlayerAmount&&(setTimeout(function(){t.startGame()},1200),clearTimeout(this.startGameTimer),this.startGameTimer=void 0)},t.prototype.reconnect=function(){var e=this;return CentrifugeServer.sharedInstance().isConnected?void Toast.show("已重新连接"):(LoadingComponent.sharedInstance().show(this,"网络断开中, 正在重连..."),void(this.connectionTimer=setTimeout(function(){CentrifugeServer.sharedInstance().discoonect(),LoadingComponent.sharedInstance().hide();var t=[{name:"离开",action:function(){e.leaveRoom()}},{name:"重连",action:function(){e.reconnect()}}];MessageAlert.show("连接超时, 请检查您的网络设置",t),clearTimeout(e.connectionTimer),e.connectionTimer=void 0},3e4)))},t.prototype.onCentrifugeConnected=function(){this.connectionTimer&&(clearTimeout(this.connectionTimer),this.connectionTimer=void 0),LoadingComponent.sharedInstance().hide(),this.hidePlayGameButtonGroup(),this.queryRoomState()},t.prototype.onCentrifugeDisconnected=function(e){e.data.reconnect&&(this.playerViews.forEach(function(e){e.stopTimer()}),this.reconnect())},t.prototype.queryRoomState=function(){this.playerModel.queryState(this.gameModel.getRoomId())},t.prototype.startGame=function(){this.gameModel.hasLocalPlayer()&&(this.updateInfoLabel("正在请求开始游戏"),this.playerModel.startGame(this.gameModel.getRoomId()))},t.prototype.onTouchFold=function(){clearTimeout(this.checkTimer),this.updateLocalPlayerStatus(GameAction.Fold),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.hidePlayGameButtonGroup(),this.playerModel.fold(this.gameModel.gameId)},t.prototype.onTouchCheck=function(){clearTimeout(this.checkTimer),this.updateLocalPlayerStatus(GameAction.Check),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.playGameButtonGroup.showAutoButtons(),this.playerModel.check(this.gameModel.gameId)},t.prototype.onTouchCall=function(e){clearTimeout(this.checkTimer);var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.Call),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.playGameButtonGroup.showAutoButtons(),this.playerModel.call(this.gameModel.gameId)},t.prototype.onTouchRaise=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.group.setChildIndex(this.raiseSelector,-1),this.raiseSelector.show()},t.prototype.onTouchQuickRaise=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.group.setChildIndex(this.quickRaiser,-1),this.quickRaiser.show()
},t.prototype.onPlayerRaise=function(e){clearTimeout(this.checkTimer);var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.Raise),this.stopLocalPlayerTimer(),this.playGameButtonGroup.showAutoButtons(),this.playerModel.raise(this.gameModel.gameId,t)},t.prototype.onPlayerAllIn=function(e){clearTimeout(this.checkTimer),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.AllIn),this.stopLocalPlayerTimer(),this.hidePlayGameButtonGroup(),this.playerModel.allIn(this.gameModel.gameId,t)},t.prototype.updateLocalPlayerScoreboard=function(e){var t=this;this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(t.gameModel.localPlayerId)&&n.updateScoreboard(e)})},t.prototype.updateLocalPlayerStatus=function(e){var t=this;this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(t.gameModel.localPlayerId)&&n.updateStatusImage(e)})},t.prototype.stopLocalPlayerTimer=function(){var e=this;this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.gameModel.localPlayerId)&&t.stopTimer()})},t.prototype.onPlayerViewTouch=function(e){var t=new PlayerDetailScene(e.playerInfo);SceneManager.sharedInstance().pushScene(t)},t.prototype.onTouchSeat=function(e){this.seatNumber=e.seatNumber;var t=UserModel.sharedInstance().initialScore;if(t<this.gameModel.minBuyIn){var n=this.gameModel.minBuyIn-t;this.showBuyInScene(n)}else this.sitDown()},t.prototype.showBuyInScene=function(e){var t=new BuyInScene(e,this.gameModel.minBuyIn,this.gameModel.maxBuyIn);t.once(BuyInSceneEvent.TouchConfirm,this.onBuyIn,this),SceneManager.sharedInstance().pushScene(t)},t.prototype.onBuyIn=function(e){var t="正在补充记分牌";this.gameModel.localPlayerId!==this.gameModel.creatorId&&this.gameModel.permitBuyIn&&(t="正在向房主发出申请"),LoadingComponent.sharedInstance().show(this,t),this.playerModel.buyIn(this.gameModel.getRoomId(),e.score)},t.prototype.sitDown=function(){LoadingComponent.sharedInstance().show(this,"正在加入游戏..."),this.playerModel.sitDown(this.gameModel.getRoomId(),this.seatNumber)},t.prototype.onMenuButtonTouch=function(){var e=new MenuView;e.once(MenuTouchEvent.TouchItem,this.onMenuItemTouch,this),SceneManager.sharedInstance().pushScene(e)},t.prototype.onReviewboardButtonTouch=function(){SceneManager.sharedInstance().pushScene(new ReviewboardScene(this.gameModel.getRoomId()))},t.prototype.onMenuItemTouch=function(e){switch(e.itemIndex){case 0:this.cardPattern.show();break;case 1:this.touchStandUp();break;case 2:this.leaveRoom();break;case 3:}},t.prototype.touchStandUp=function(){var e=this,t=this.seatViews[0].touchEnabled;if(t)return void Toast.show("您还没有入座");if(this.gameModel.isGaming){var n=[{name:"确定",action:function(){e.standUp()}},{name:"取消"}];MessageAlert.show("您正在游戏中, 离开座位会自动帮您弃牌, 确定要离开吗?",n)}else this.standUp()},t.prototype.standUp=function(){LoadingComponent.sharedInstance().show(this,"正在离开座位..."),this.playerModel.standUp(this.gameModel.getRoomId())},t.prototype.quit=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),SceneManager.sharedInstance().replaceScene(new LaunchScene)},t.prototype.leaveRoom=function(){Device.sharedInstance().isInReactNative()?window.postMessage(JSON.stringify({command:"leave_room",payload:this.gameModel.getRoomId()}),"*"):(LoadingComponent.sharedInstance().show(this,"正在离开房间..."),this.playerModel.leave())},t.prototype.onTalkButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.setChildIndex(this.chatComponent,-1),this.chatComponent.show()},t.prototype.onMicrophoneButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click)},t.prototype.hidePlayGameButtonGroup=function(){this.playGameButtonGroup.hide(),this.raiseSelector.hide(),this.quickRaiser.hide()},t.prototype.disableTouchSeat=function(){this.seatViews.forEach(function(e){e.disableTouch()})},t.prototype.enableTouchSeat=function(){this.seatViews.forEach(function(e){e.enableTouch()})},t.prototype.clearHandCards=function(){var e=this;this.handCards.forEach(function(t){e.group.removeChild(t)}),this.handCards=[]},t.prototype.clearTimer=function(){this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),this.startGameTimer&&(clearTimeout(this.startGameTimer),this.startGameTimer=void 0),this.connectionTimer&&(clearTimeout(this.connectionTimer),this.connectionTimer=void 0)},t.prototype.onTouchCreator=function(){var e=(new Date).getTime();0===this.touchTimes?(this.touchTimes+=1,this.lastTime=e):5===this.touchTimes?(this.touchTimes=0,this.lastTime=0,this.debugView.visible=!this.debugView.visible,this.infoLabel.visible=!this.infoLabel.visible):e-this.lastTime<500?(this.touchTimes+=1,this.lastTime=e):(this.touchTimes=0,this.lastTime=0)},t.prototype.onReceivedGameMessage=function(e){this.debugView.updateLog(e.data)},t.prototype.onMessageAlarmTouch=function(){this.messageAlarm.hideDot();var e=new ApplicationRecordScene(this.gameModel.getRoomId(),this.gameModel.minBuyIn);SceneManager.sharedInstance().pushScene(e)},t.prototype.hasPlayerBuyIn=function(e){var t={applicant:e.applicant,amount:e.amount,minBuyIn:this.gameModel.minBuyIn,roomId:this.gameModel.getRoomId()},n=new BuyInApplicationScene(t);SceneManager.sharedInstance().pushScene(n),this.messageAlarm.showDot()},t.prototype.hasAuditBuyIn=function(e){this.messageAlarm.hideDot(),e.accepted?MessageAlert.show("房主已同意您的带入申请, 您可以选择座位坐下。"):MessageAlert.show("房主拒绝了您的带入申请, 您可以尝试再次申请。")},t.prototype.onConnected=function(){egret.log("重新连接")},t.prototype.onClose=function(){egret.log("连接断开")},t.prototype.onError=function(){egret.log("连接出错")},t.prototype.onReceivedMessage=function(e){var t={action:"ws请求("+e.message.requestId+")",message:JSON.stringify(e.message)};this.debugView.updateLog(t),LoadingComponent.sharedInstance().hide();var n=e.message,o=n.response;if(200!==n.httpStatus)return void MessageAlert.show("服务异常 "+n.requestId+": "+n.httpStatus);if(!o.ok){if("room_in_gaming"===o.errorType)return void egret.log("游戏已经开始了");if("cannot_start_game"===o.errorType)return void egret.log("无法开始游戏");if("game_has_ended"===o.errorType)return void egret.log("游戏已经结束");if("stack_not_enough"===o.errorType){this.standUp();var i=UserModel.sharedInstance().initialScore,r=this.gameModel.minBuyIn-i;return void this.showBuyInScene(r)}return void MessageAlert.show(""+n.response.message)}switch(n.requestId){case RequestId.BuyIn:o.result&&o.result.stack>=this.gameModel.minBuyIn&&(UserModel.sharedInstance().initialScore=o.result.stack,this.sitDown());break;case RequestId.SitDown:this.gameModel.handleRoomData(o.result),this.disableTouchSeat();break;case RequestId.StandUp:this.gameModel.localPlayerCards=[],this.cardTypeLabel.text=" ",this.promptLabel.visible=!1,this.enableTouchSeat();break;case RequestId.Leave:this.quit();break;case RequestId.QueryState:this.gameModel.handleRoomData(o.result)}},t.prototype.addEventListeners=function(){this.creatorLabel.touchEnabled=!0,this.creatorLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCreator,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.messageAlarm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMessageAlarmTouch,this),this.talkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTalkButtonTouch,this),this.microphoneButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.menuButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuButtonTouch,this),this.reviewboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReviewboardButtonTouch,this),this.raiseSelector.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.addEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.quickRaiser.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.quickRaiser.addEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchQuickRaise,this.onTouchQuickRaise,this),this.gameModel.addEventListener(GameEvent.HasPlayerBuyIn,this.hasPlayerBuyIn,this),this.gameModel.addEventListener(GameEvent.HasAuditBuyIn,this.hasAuditBuyIn,this),this.gameModel.addEventListener(GameEvent.ReceivedMessage,this.onReceivedGameMessage,this),this.gameModel.addEventListener(GameEvent.BuildGame,this.buildGame,this),this.gameModel.addEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.addEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.addEventListener(GameEvent.HasNewPlayer,this.hasNewPlayerJoin,this),this.gameModel.addEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.addEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.addEventListener(GameEvent.Call,this.hasPlayerCall,this),this.gameModel.addEventListener(GameEvent.AllIn,this.hasPlayerAllIn,this),this.gameModel.addEventListener(GameEvent.Raise,this.hasPlayerRaise,this),this.gameModel.addEventListener(GameEvent.Check,this.hasPlayerCheck,this),this.gameModel.addEventListener(GameEvent.Fold,this.hasPlayerFold,this),this.gameModel.addEventListener(GameEvent.UpdatePots,this.hasUpdatePots,this),this.gameModel.addEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.addEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.addEventListener(GameEvent.HasPlayerLeave,this.hasPlayerLeave,this),this.gameModel.addEventListener(GameEvent.HasPlayerReady,this.hasPlayerReady,this),this.gameModel.addMessageListener()},t.prototype.onRemovedFromStage=function(){this.clearTimer(),CentrifugeServer.sharedInstance().unsubscribe(),CentrifugeServer.sharedInstance().discoonect(),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.messageAlarm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMessageAlarmTouch,this),this.talkButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTalkButtonTouch,this),this.microphoneButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.menuButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuButtonTouch,this),this.raiseSelector.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.removeEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.quickRaiser.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.quickRaiser.removeEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchQuickRaise,this.onTouchQuickRaise,this),this.gameModel.removeEventListener(GameEvent.HasPlayerBuyIn,this.hasPlayerBuyIn,this),this.gameModel.removeEventListener(GameEvent.HasAuditBuyIn,this.hasAuditBuyIn,this),this.gameModel.removeEventListener(GameEvent.ReceivedMessage,this.onReceivedGameMessage,this),this.gameModel.removeEventListener(GameEvent.BuildGame,this.buildGame,this),this.gameModel.removeEventListener(GameEvent.HasNewPlayer,this.hasNewPlayerJoin,this),this.gameModel.removeEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.removeEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.removeEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.removeEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.removeEventListener(GameEvent.Call,this.hasPlayerCall,this),this.gameModel.removeEventListener(GameEvent.AllIn,this.hasPlayerAllIn,this),this.gameModel.removeEventListener(GameEvent.Raise,this.hasPlayerRaise,this),this.gameModel.removeEventListener(GameEvent.Check,this.hasPlayerCheck,this),this.gameModel.removeEventListener(GameEvent.Fold,this.hasPlayerFold,this),this.gameModel.removeEventListener(GameEvent.UpdatePots,this.hasUpdatePots,this),this.gameModel.removeEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.removeEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.removeEventListener(GameEvent.HasPlayerLeave,this.hasPlayerLeave,this),this.gameModel.removeEventListener(GameEvent.HasPlayerReady,this.hasPlayerReady,this),this.gameModel.removeMessageListener()},t}(eui.Component);__reflect(GameScene.prototype,"GameScene");var LeaderboardScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="LeaderboardSceneSkin",n.model=t,n.background.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onPressed,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.playShowAnimation,n),EventCenter.sharedInstance().addEventListener(LeaderboardUpdatedEvent.PlayersScoreUpdated,n.updatePlayersScore,n),EventCenter.sharedInstance().addEventListener(LeaderboardUpdatedEvent.ViewersUpdated,n.updateViewers,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.removeAllListeners,n),n}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.updatePlayersScore(),this.updateViewers(),this.fetchPlayersScores(),this.fetchViewers()},t.prototype.removeAllListeners=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.playShowAnimation,this),EventCenter.sharedInstance().removeEventListener(LeaderboardUpdatedEvent.PlayersScoreUpdated,this.updatePlayersScore,this),EventCenter.sharedInstance().removeEventListener(LeaderboardUpdatedEvent.ViewersUpdated,this.updateViewers,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeAllListeners,this)},t.prototype.updatePlayersScore=function(){this.leaderboard.setPlayers(this.model.listPlayers())},t.prototype.updateViewers=function(){this.leaderboard.setOnLineViewers(this.model.countOnlineViewers(),this.model.countViewers()),this.leaderboard.setViewPlayers(this.model.listViewers())},t.prototype.fetchPlayersScores=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.model.fetchPlayersScores()];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),this.fetchPlayersScores(),egret.log(e),[3,3];case 3:return[2]}})})},t.prototype.fetchViewers=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.model.fetchViewers()];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),this.fetchViewers(),egret.log(e),[3,3];case 3:return[2]}})})},t.prototype.onPressed=function(){this.hideTweenGroup.addEventListener("complete",this.goBack,this),this.hideTweenGroup.play()},t.prototype.goBack=function(){SceneManager.sharedInstance().popScene()},t.prototype.playShowAnimation=function(){this.showTweenGroup.play()},t}(eui.Component);__reflect(LeaderboardScene.prototype,"LeaderboardScene");var ReviewboardScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="ReviewboardSceneSkin",n.background.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onPressBackground,n),n.reviewboard.fetchGameHistoryRecordsByRoomId(t),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.showTweenGroup.play()},t.prototype.onPressBackground=function(){this.hideTweenGroup.addEventListener("complete",this.goBack,this),this.hideTweenGroup.play()},t.prototype.goBack=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(ReviewboardScene.prototype,"ReviewboardScene");var ButtonGroupEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.TouchFold="touch_fold",t.TouchCheck="touch_check",t.TouchCall="touch_call",t.TouchRaise="touch_raise",t.TouchAllIn="touch_all_in",t.TouchQuickRaise="touch_quick_raise",t}(egret.Event);__reflect(ButtonGroupEvent.prototype,"ButtonGroupEvent");var BuyInSceneEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchConfirm="touch_confirm",t.RecordItemTap="item_tap",t}(egret.Event);__reflect(BuyInSceneEvent.prototype,"BuyInSceneEvent");var GameEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.BuildGame="build_game",t.HasNewPlayer="has_new_player",t.GameStart="game_start",t.DealCards="deal_cards",t.SwitchPlayer="switch_player",t.Call="call",t.AllIn="all_in",t.Fold="fold",t.UpdatePots="update_pots",t.Check="check",t.Raise="raise",t.Showdown="showdown",t.EndGame="end_game",t.HasPlayerLeave="has_player_leave",t.HasPlayerReady="has_player_ready",t.ReceivedMessage="received_message",t.HasPlayerBuyIn="has_player_buy_in",t.HasAuditBuyIn="has_audit_buy_in",t.Flop="flop",t.Turn="turn",t.River="river",t.Draw="draw",t.ShowStartButton="show_start_button",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var LeaderboardUpdatedEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.PlayersScoreUpdated="leaderboard.players.score.updated.event",t.ViewersUpdated="leaderboard.viewers.updated.event",t}(egret.Event);__reflect(LeaderboardUpdatedEvent.prototype,"LeaderboardUpdatedEvent");var MenuTouchEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchItem="touch_item",t}(egret.Event);__reflect(MenuTouchEvent.prototype,"MenuTouchEvent");var PlayerViewEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.TimerEnd="timer_end",t.Touch="touch",t}(egret.Event);__reflect(PlayerViewEvent.prototype,"PlayerViewEvent");var RaiseEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.Raise="raise",t.AllIn="all_in",t}(egret.Event);__reflect(RaiseEvent.prototype,"RaiseEvent");var ReviewboardEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.UPDATE_REVIEWBOARD_HEADER_VALUE="update.reviewboard.header.value.event",t}(egret.Event);__reflect(ReviewboardEvent.prototype,"ReviewboardEvent");var SeatTouchEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchSeat="touch_seat",t}(egret.Event);__reflect(SeatTouchEvent.prototype,"SeatTouchEvent");var ApplicationModel=function(){function e(){this.request=new HttpRequest}return e.prototype.checkBuyIn=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e.roomId+"/check_buy_in",n={chip:e.amount,applicant_id:e.applicantId,accepted:e.accepted},o=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,n,o)},e.prototype.listRecord=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/buy_in_applications",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.get(t,{},n)},e}();__reflect(ApplicationModel.prototype,"ApplicationModel");var DetailModel=function(){function e(){this.request=new HttpRequest}return e.prototype.listStatistic=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/"+e+"/statistic",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.get(t,{},n)},e.prototype.buildStatisticRecord=function(e){var t=StatisticConfig.slice(),n=t.map(function(t,n){var o=t;return 0===n?o.data=e.roundCount:1===n?o.data=e.wonRoundCount:2===n?o.data=e.wonPercentage:4===n?o.data=e.VPIPPercentage:5===n?o.data=e.VPIPWonPercentage:11===n&&(o.data=e.af),o});return n},e.prototype.clearRecord=function(){StatisticConfig.forEach(function(e){e.data=""})},e}();__reflect(DetailModel.prototype,"DetailModel");var GameModel=function(e){function t(){var t=e.call(this)||this;return t.localPlayerCards=[],t.currentPlayerAmount=0,t.hasReadyPlayerAmount=0,t.seatDiff=0,t.isGaming=!1,t.permitBuyIn=!1,t.players=[],t.localPlayerId=UserModel.sharedInstance().loginInfo.user.id,t}return __extends(t,e),t.prototype.handleRoomData=function(e){this.roomData=e,this.minBuyIn=e.min_buy_in,this.maxBuyIn=e.max_buy_in,this.smallBlindAmount=e.small_blind,this.bigBlindAmount=e.big_blind,this.creatorId=e.creator.id,this.permitBuyIn=e.permit_buy_in,this.dispatchBuildGameEvent(e)},t.prototype.isCreator=function(){return this.localPlayerId===this.creatorId},t.prototype.getRoomId=function(){return this.roomData.id},t.prototype.getRoomPin=function(){return this.roomData.pin},t.prototype.hasLocalPlayer=function(){var e=this,t=this.players.findIndex(function(t){return t.id===e.localPlayerId});return t>=0},t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.dispatchBuildGameEvent=function(e){var t=this,n=e.players,o=this.sortPlayerSeat(n),i=o.map(function(e){return t.createNewPlayer(e)}),r=new GameEvent(GameEvent.BuildGame),a={creatorName:e.creator.nickname,smallBlind:e.small_blind,bigBlind:e.big_blind};r.roomInfo=a,r.status=e.status,r.players=i;var s=e.game;if(s){this.gameId=s.id,r.mainPot=s.main_pot,r.pots=s.pots,r.dealer={id:s.dealer_id},r.smallBlind={id:s.small_blind_id},r.bigBlind={id:s.big_blind_id},r.activePlayer=s.active_player?{id:s.active_player.id,legalActions:this.handleLegalActions(s.active_player.legal_actions)}:void 0,r.cards=s.current_shown_cards.map(function(e){return new CardInfo({name:e,isNew:!1})});var c=i.find(function(e){return e.id===t.localPlayerId});if(c){var u=c.state;u!==PlayerState.NotInGame&&u!==PlayerState.Folded&&(this.isGaming=!0)}}this.currentPlayerAmount=i.length,this.dispatchEvent(r)},t.prototype.onReceivedMessage=function(e){if(egret.log("centrifuge消息",e.data),e.data){var t=JSON.parse(JSON.stringify(e.data)),n=t.action,o=t.content,i=new GameEvent(GameEvent.ReceivedMessage),r={action:n,message:JSON.stringify(o)};switch(i.data=r,this.dispatchEvent(i),n){case GameAction.Sit:this.handleHasPlayerSitdown(o);break;case GameAction.StartGame:this.handleGameStart(o);break;case GameAction.DealCards:this.handleDealCards(o);break;case GameAction.Flop:this.handleFlop(o);break;case GameAction.Turn:this.handleTurn(o);break;case GameAction.River:this.handleRiver(o);break;case GameAction.Call:this.handleCall(o);break;case GameAction.Check:this.handleCheck(o);break;case GameAction.Fold:this.handleFold(o);break;case GameAction.Raise:this.handleRaise(o);break;case GameAction.AllIn:this.handleAllIn(o);break;case GameAction.UpdatePots:this.handleUpdatePots(o);break;case GameAction.Switch:this.handleSwitch(o);break;case GameAction.Showdown:this.handleShowdown(o);break;case GameAction.EndGame:this.handleEndGame(o);break;case GameAction.LeaveRoom:this.handleHasPlayerLeave(o);break;case GameAction.StandUp:this.handleHasPlayerLeave(o);break;case GameAction.Ready:this.handleHasPlayerReady(o);break;case GameAction.ApplyBuyIn:this.handleHasPlayerBuyIn(o);break;case GameAction.AuditBuyIn:this.handleHasAuditBuyIn(o)}}},t.prototype.handleHasPlayerBuyIn=function(e){var t=new GameEvent(GameEvent.HasPlayerBuyIn);t.applicant=e.applicant,t.amount=e.chip,this.dispatchEvent(t)},t.prototype.handleHasAuditBuyIn=function(e){e.accepted&&(UserModel.sharedInstance().initialScore=e.stack);var t=new GameEvent(GameEvent.HasAuditBuyIn);t.accepted=e.accepted,t.amount=e.chip,this.dispatchEvent(t)},t.prototype.handleHasPlayerReady=function(e){this.hasReadyPlayerAmount+=1;var t=new GameEvent(GameEvent.HasPlayerReady);t.playerId=e.player_id,this.dispatchEvent(t)},t.prototype.handleGameStart=function(e){this.localPlayerCards=[],this.hasReadyPlayerAmount=0,this.isGaming=!0,this.gameId=e.game_id,this.mainPot=e.main_pot;var t=new GameEvent(GameEvent.GameStart);t.dealer=e.dealer,t.smallBlind=e.small_blind,t.bigBlind=e.big_blind,t.mainPot=e.main_pot,this.dispatchEvent(t)},t.prototype.handleDealCards=function(e){var t=new GameEvent(GameEvent.DealCards),n=e.cards.map(function(e){return new CardInfo({name:e})});this.localPlayerCards=n||[],t.cards=n,this.dispatchEvent(t)},t.prototype.handleFlop=function(e){this.handleDraw(e)},t.prototype.handleTurn=function(e){this.handleDraw(e,3)},t.prototype.handleRiver=function(e){this.handleDraw(e,4)},t.prototype.handleDraw=function(e,t){void 0===t&&(t=0);var n=e.shown_community_cards,o=n.map(function(e){return new CardInfo({isNew:!0,name:e})});o.forEach(function(e,n){t>n&&(e.isNew=!1)});var i=new GameEvent(GameEvent.Draw);i.cards=o,this.dispatchEvent(i)},t.prototype.handleCall=function(e){var t=new GameEvent(GameEvent.Call),n=e.player;this.updateLoaclPlayerStack(n),t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleRaise=function(e){var t=new GameEvent(GameEvent.Raise),n=e.player;this.updateLoaclPlayerStack(n),t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleAllIn=function(e){var t=new GameEvent(GameEvent.AllIn),n=e.player;this.updateLoaclPlayerStack(n),t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleFold=function(e){var t=new GameEvent(GameEvent.Fold),n=e.player;this.updateLoaclPlayerStack(n),n.id===this.localPlayerId&&(this.isGaming=!1),t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleCheck=function(e){var t=new GameEvent(GameEvent.Check),n=e.player;this.updateLoaclPlayerStack(n),t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleUpdatePots=function(e){this.mainPot=e.main_pot;var t=new GameEvent(GameEvent.UpdatePots);t.mainPot=e.main_pot,t.pots=e.pots,this.dispatchEvent(t)},t.prototype.updateLoaclPlayerStack=function(e){e.id===this.localPlayerId&&(UserModel.sharedInstance().initialScore=e.stack)},t.prototype.handleLegalActions=function(e){var t=void 0;if(e){var n=-1,o=-1,i=-1,r=-1,a=void 0,s=void 0;e.forEach(function(e){e.action===GameAction.Check&&(n=1),e.action===GameAction.Call&&(o=1,s=e.amount),e.action===GameAction.Raise&&(i=1,a=e.amount),e.action===GameAction.AllIn&&(r=1,a=e.amount)});var c=-1!==n,u=-1!==o,h=-1!==i,l=-1!==r;t={couldCheck:c,couldCall:u,couldRaise:h,mustAllIn:l,raiseAmount:a,callAmount:s}}return t},t.prototype.handleSwitch=function(e){var t=new GameEvent(GameEvent.SwitchPlayer);t.playerId=e.player_id;var n=e.legal_actions;t.legalActions=this.handleLegalActions(n),this.dispatchEvent(t)},t.prototype.handleShowdown=function(e){var t=new GameEvent(GameEvent.Showdown);t.showdownPlayers=e.showdown_players,this.dispatchEvent(t)},t.prototype.handleEndGame=function(e){var t=this;this.localPlayerCards=[],this.isGaming=!1;var n=new GameEvent(GameEvent.EndGame);n.winner=e.winner,n.prize=e.prize,n.playersForStack=e.players,e.players.forEach(function(e){e.id===t.localPlayerId&&(UserModel.sharedInstance().initialScore=e.stack)}),this.dispatchEvent(n)},t.prototype.handleHasPlayerSitdown=function(e){this.currentPlayerAmount=e.room.players.length;var t=e.player;if(t.id===this.localPlayerId)return void(this.isGaming=!1);var n=SeatUtil.calculateSeat(t.seat,this.seatDiff,SeatUtil.TOTAL_PLAYER_AMOUNT);Object.assign(t,{newSeat:n}),this.handleNewPlayer(t)},t.prototype.createNewPlayer=function(e){var t=SeatUtil.findCoordinate(e.newSeat),n=Object.assign(e,{coordinate:t}),o=new PlayerInfo(n),i=this.players.find(function(t){return t.id===e.id});return i||this.players.push(o),o},t.prototype.handleNewPlayer=function(e){var t=new GameEvent(GameEvent.HasNewPlayer);t.newPlayer=this.createNewPlayer(e),this.dispatchEvent(t)},t.prototype.handleHasPlayerLeave=function(e){var t=this;this.players.forEach(function(n,o){e.player_id===n.id&&t.players.splice(o,1)}),this.currentPlayerAmount=e.room.players.length;var n=new GameEvent(GameEvent.HasPlayerLeave);n.playerId=e.player_id,this.dispatchEvent(n)},t.prototype.sortPlayerSeat=function(e){var t=this,n=JSON.parse(JSON.stringify(e));if(0===e.length)return n;var o=e.find(function(e){return e.id===t.localPlayerId});return n.forEach(function(e){Object.assign(e,{newSeat:e.seat})}),o&&(this.seatDiff=o.seat-1),0===this.seatDiff?n:n=e.map(function(e){var n=e,o=SeatUtil.calculateSeat(n.seat,t.seatDiff,SeatUtil.TOTAL_PLAYER_AMOUNT);return n.newSeat=o,n})},t}(egret.EventDispatcher);__reflect(GameModel.prototype,"GameModel");var LeaderboardModel=function(){function e(e){this.roomId=e,this.players=[],this.viewers=[],this.httpRequest=new HttpRequest}return e.prototype.listPlayers=function(){return this.players},e.prototype.listViewers=function(){return this.viewers},e.prototype.fetchPlayersScores=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,i;return __generator(this,function(r){switch(r.label){case 0:if(this.isFetchingPlayersScores)return[2];r.label=1;case 1:return r.trys.push([1,4,,5]),this.isFetchingPlayersScores=!0,e=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+this.roomId+"/chip",t=this.httpRequest.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken),[4,this.httpRequest.get(e,{},t)];case 2:return n=r.sent(),this.players=this.createPlayers(n.result),[4,this.players.sort(function(e,t){return t.score-e.score})];case 3:return r.sent(),this.isFetchingPlayersScores=!1,o=new LeaderboardUpdatedEvent(LeaderboardUpdatedEvent.PlayersScoreUpdated),EventCenter.sharedInstance().dispatchEvent(o),[3,5];case 4:throw i=r.sent(),this.isFetchingPlayersScores=!1,i;case 5:return[2]}})})},e.prototype.fetchViewers=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,i;return __generator(this,function(r){switch(r.label){case 0:if(this.isFetchingViewers)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),this.isFetchingViewers=!0,e=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+this.roomId+"/spectators",t=this.httpRequest.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken),[4,this.httpRequest.get(e,{},t)];
case 2:return n=r.sent(),this.viewers=this.createViewPlayers(n.result),this.isFetchingViewers=!1,o=new LeaderboardUpdatedEvent(LeaderboardUpdatedEvent.ViewersUpdated),EventCenter.sharedInstance().dispatchEvent(o),[3,4];case 3:throw i=r.sent(),this.isFetchingViewers=!1,i;case 4:return[2]}})})},e.prototype.countOnlineViewers=function(){var e=this.viewers.filter(function(e){return!e.hasLeft});return e.length},e.prototype.countViewers=function(){return this.viewers.length},e.prototype.createPlayers=function(e){return e.map(function(e){return new LeaderboardPlayer(e)})},e.prototype.createViewPlayers=function(e){var t=e.sort(function(e,t){return e.has_left===t.has_left?0:e.has_left?1:t.has_left?-1:void 0});return t.map(function(e){return new LeaderboardViewPlayer(e)})},e}();__reflect(LeaderboardModel.prototype,"LeaderboardModel");var LeaderboardPlayer=function(){function e(e){this._id=e.id,this._nickname=e.nickname,this._stack=e.stack,this._buyIn=e.buy_in,this._score=this._stack-this._buyIn,this._roundAmount=e.round_amount}return Object.defineProperty(e.prototype,"textColor",{get:function(){return this._score>=0?Color.white:Color.gray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return String(this._stack)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buyIn",{get:function(){return String(this._buyIn)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundAmount",{get:function(){return String(this._roundAmount)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreString",{get:function(){return this._score>0?"+"+this._score:String(this._score)},enumerable:!0,configurable:!0}),e}();__reflect(LeaderboardPlayer.prototype,"LeaderboardPlayer");var LeaderboardViewPlayer=function(){function e(e){this._id=e.id,this._username=e.username,this._nickname=e.nickname,this._hasLeft=e.has_left,this._avatarUrl=AvatarURLFactory.makeById(e.id)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasLeft",{get:function(){return this._hasLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._hasLeft?Color.gray:Color.white},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarUrl",{get:function(){return this._avatarUrl},set:function(e){this._avatarUrl=e},enumerable:!0,configurable:!0}),e}();__reflect(LeaderboardViewPlayer.prototype,"LeaderboardViewPlayer");var PlayerModel=function(){function e(){this.request=new HttpRequest}return e.prototype.buyIn=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/room/"+e+"/buy_in",o={chip:t},i={request_id:RequestId.BuyIn,path:n,method:"post",body:o};WebSocketRequest.sharedInstance().sendData(i)},e.prototype.sitDown=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/room/"+e+"/sit",o={seat:t},i={request_id:RequestId.SitDown,path:n,method:"post",body:o};WebSocketRequest.sharedInstance().sendData(i)},e.prototype.startGame=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/start",n={room_id:e},o={request_id:RequestId.StartGame,path:t,method:"post",body:n};WebSocketRequest.sharedInstance().sendData(o)},e.prototype.queryState=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/"+e,n={request_id:RequestId.QueryState,path:t,method:"get",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.ready=function(){var e="/"+ApiConfig.Version_1+"/texas/room/ready",t={request_id:RequestId.Ready,path:e,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(t)},e.prototype.call=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/call",n={request_id:RequestId.Call,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.raise=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/"+e+"/raise",o={amount:t},i={request_id:RequestId.Raise,path:n,method:"post",body:o};WebSocketRequest.sharedInstance().sendData(i)},e.prototype.check=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/check",n={request_id:RequestId.Check,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.allIn=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/"+e+"/all_in",o={amount:t},i={request_id:RequestId.AllIn,path:n,method:"post",body:o};WebSocketRequest.sharedInstance().sendData(i)},e.prototype.fold=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/fold",n={request_id:RequestId.Fold,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.checkTimeout=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/check_timeout",n={request_id:RequestId.CheckTimeout,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.standUp=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/"+e+"/stand_up",n={request_id:RequestId.StandUp,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.leave=function(){var e="/"+ApiConfig.Version_1+"/texas/room/leave",t={request_id:RequestId.Leave,path:e,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(t)},e}();__reflect(PlayerModel.prototype,"PlayerModel");var ApplicationRecordInfo=function(){function e(e){this._applicant=e.applicant,this._auditor=e.auditor,this._chip=e.chip,this._accepted=e.accepted,this._auditedAt=e.audited_at,this._createdAt=e.created_at}return Object.defineProperty(e.prototype,"applicant",{get:function(){return this._applicant},set:function(e){this._applicant=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auditor",{get:function(){return this._auditor},set:function(e){this._auditor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chip",{get:function(){return this._chip},set:function(e){this._chip=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accepted",{get:function(){return this._accepted},set:function(e){this._accepted=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auditedAt",{get:function(){return this._auditedAt},set:function(e){this._auditedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),e}();__reflect(ApplicationRecordInfo.prototype,"ApplicationRecordInfo");var CardInfo=function(){function e(e){this._name=e.name,this._isNew=e.isNew,this.decodeValue(e.name),this.decodeSuit(e.name)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},set:function(e){this._isNew=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suit",{get:function(){return this._suit},set:function(e){this._suit=e},enumerable:!0,configurable:!0}),e.prototype.decodeValue=function(e){var t=e.charAt(0);switch(t){case"2":this._value=CardValue.Two;break;case"3":this._value=CardValue.Three;break;case"4":this._value=CardValue.Four;break;case"5":this._value=CardValue.Five;break;case"6":this._value=CardValue.Six;break;case"7":this._value=CardValue.Seven;break;case"8":this._value=CardValue.Eight;break;case"9":this._value=CardValue.Nine;break;case"t":this._value=CardValue.Ten;break;case"j":this._value=CardValue.J;break;case"q":this._value=CardValue.Q;break;case"k":this._value=CardValue.K;break;case"a":this._value=CardValue.A;break;default:this._value=CardValue.Error}},e.prototype.decodeSuit=function(e){var t=e.slice(-1);switch(t){case"s":this._suit=CardSuit.Spade;break;case"h":this._suit=CardSuit.Heart;break;case"c":this._suit=CardSuit.Club;break;case"d":this._suit=CardSuit.Diamond;break;default:this._suit=CardSuit.Error}},e}();__reflect(CardInfo.prototype,"CardInfo");var PlayerInfo=function(){function e(e){this._coordinate=e.coordinate,this._id=e.id,this._seat=e.seat,this._newSeat=e.newSeat,this._stack=e.stack||0,this._avatarUrl=AvatarURLFactory.makeById(e.id),this._username=e.username,this._nickname=e.nickname,this._amount=e.amount,this._state=e.state,this._roundAction=e.round_action,this._holeCard=e.hole_card||["",""],this._bio=e.bio||"还没有签名",this._buyIn=e.buy_in}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seat",{get:function(){return this._seat},set:function(e){this._seat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newSeat",{get:function(){return this._newSeat},set:function(e){this._newSeat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return this._stack},set:function(e){this._stack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bio",{get:function(){return this._bio},set:function(e){this._bio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarUrl",{get:function(){return this._avatarUrl},set:function(e){this._avatarUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this._coordinate},set:function(e){this._coordinate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buyIn",{get:function(){return this._buyIn},set:function(e){this._buyIn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundAction",{get:function(){return this._roundAction},set:function(e){this._roundAction=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holeCard",{get:function(){return this._holeCard},set:function(e){this._holeCard=e},enumerable:!0,configurable:!0}),e}();__reflect(PlayerInfo.prototype,"PlayerInfo");var StatisticInfo=function(){function e(e){this._id=e.id,this._af=e.af,this._roundCount=e.round_count,this._VPIPPercentage=e.vpip_percentage,this._VPIPWonPercentage=e.vpip_won_percentage,this._wonPercentage=e.won_percentage,this._wonRoundCount=e.won_round_count}return Object.defineProperty(e.prototype,"af",{get:function(){return this._af},set:function(e){this._af=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundCount",{get:function(){return this._roundCount},set:function(e){this._roundCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VPIPPercentage",{get:function(){return this._VPIPPercentage},set:function(e){this._VPIPPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VPIPWonPercentage",{get:function(){return this._VPIPWonPercentage},set:function(e){this._VPIPWonPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wonPercentage",{get:function(){return this._wonPercentage},set:function(e){this._wonPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wonRoundCount",{get:function(){return this._wonRoundCount},set:function(e){this._wonRoundCount=e},enumerable:!0,configurable:!0}),e}();__reflect(StatisticInfo.prototype,"StatisticInfo");var EmptyAction=function(){function e(){this.backgroundColor=0,this.abbreviationSymbol=""}return e}();__reflect(EmptyAction.prototype,"EmptyAction",["IPlayerAction"]);var SmallBlind=function(){function e(){this.backgroundColor=11252402,this.abbreviationSymbol="SB"}return e}();__reflect(SmallBlind.prototype,"SmallBlind",["IPlayerAction"]);var BigBlind=function(){function e(){this.backgroundColor=11252402,this.abbreviationSymbol="BB"}return e}();__reflect(BigBlind.prototype,"BigBlind",["IPlayerAction"]);var AllIn=function(){function e(){this.backgroundColor=16537889,this.abbreviationSymbol="A"}return e}();__reflect(AllIn.prototype,"AllIn",["IPlayerAction"]);var Bet=function(){function e(){this.backgroundColor=16008262,this.abbreviationSymbol="B"}return e}();__reflect(Bet.prototype,"Bet",["IPlayerAction"]);var Call=function(){function e(){this.backgroundColor=2803253,this.abbreviationSymbol="C"}return e}();__reflect(Call.prototype,"Call",["IPlayerAction"]);var Check=function(){function e(){this.backgroundColor=7077885,this.abbreviationSymbol="X"}return e}();__reflect(Check.prototype,"Check",["IPlayerAction"]);var Fold=function(){function e(){this.backgroundColor=8158846,this.abbreviationSymbol="F"}return e}();__reflect(Fold.prototype,"Fold",["IPlayerAction"]);var Raise=function(){function e(){this.backgroundColor=16008262,this.abbreviationSymbol="R"}return e}();__reflect(Raise.prototype,"Raise",["IPlayerAction"]);var PlayerActionFactory=function(){function e(){}return e.makeByTypeName=function(e){switch(e){case GameAction.SB:return new SmallBlind;case GameAction.BB:return new BigBlind;case GameAction.AllIn:return new AllIn;case GameAction.Bet:return new Bet;case GameAction.Call:return new Call;case GameAction.Check:return new Check;case GameAction.Fold:return new Fold;case GameAction.Raise:return new Raise;default:return new EmptyAction}},e}();__reflect(PlayerActionFactory.prototype,"PlayerActionFactory");var ReviewboardAction=function(){function e(e){this._playerPosition=e.player_position,this._playerNickname=e.player_nickname,this._playerAction=PlayerActionFactory.makeByTypeName(e.player_action),this._playerActionValue=e.player_action_value||0,this._playerStack=e.player_stack}return Object.defineProperty(e.prototype,"playerPosition",{get:function(){return this._playerPosition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerNickname",{get:function(){return this._playerNickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerAction",{get:function(){return this._playerAction},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerActionValue",{get:function(){return this._playerActionValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerStack",{get:function(){return this._playerStack},enumerable:!0,configurable:!0}),e}();__reflect(ReviewboardAction.prototype,"ReviewboardAction");var ReviewboardGameRound=function(){function e(e){this._cnName=e.cn_name,this._enName=e.en_name,this._pot=e.pot||0,this._actions=e.actions.map(function(e){return new ReviewboardAction(e)}),this._communityPokers=e.community_pokers||[]}return Object.defineProperty(e.prototype,"chineseName",{get:function(){return this._cnName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"englishName",{get:function(){return this._enName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pot",{get:function(){return this._pot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communityPokers",{get:function(){return this._communityPokers},enumerable:!0,configurable:!0}),e}();__reflect(ReviewboardGameRound.prototype,"ReviewboardGameRound");var ReviewboardModel=function(){function e(){this.httpRequest=new HttpRequest,this._pages=[]}return Object.defineProperty(e.prototype,"isFetching",{get:function(){return this._isFetching},enumerable:!0,configurable:!0}),e.prototype.loadCachedData=function(){var t=egret.localStorage.getItem(e.CACHE_DATA_KEY);if(t){var n=JSON.parse(t);this.createPages(n)}},e.prototype.fetchGameHistoryRecordByRoomId=function(t){return __awaiter(this,void 0,void 0,function(){var n,o,i,r,a,s;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),this._isFetching=!0,n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+t+"/records",o=this.httpRequest.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken),[4,this.httpRequest.get(n,{},o)];case 1:return i=c.sent(),r=i.result,a=JSON.stringify(r),egret.localStorage.setItem(e.CACHE_DATA_KEY,a),this.createPages(r),this._isFetching=!1,[3,3];case 2:throw s=c.sent(),console.log("fetchGameHistoryRecord error + "+s.message),this._isFetching=!1,s;case 3:return[2]}})})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pot",{get:function(){return this._pot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startAtString",{get:function(){return this._startAtString},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPageIndex",{get:function(){return this._currentPageIndex},set:function(e){this._currentPageIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageAmount",{get:function(){return this._pageAmount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameRounds",{get:function(){return this._gameRounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settlements",{get:function(){return this._settlements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){if(this._pages&&0!==this._pages.length){var e=this._currentPageIndex-1;return 0>e&&(e=0),this._pages[e]}},enumerable:!0,configurable:!0}),e.prototype.setup=function(e){var t=this;this._pot=e.pot;var n=new Date(Date.parse(e.start_at)),o=n.getMonth()+1,i=n.getDate(),r=n.getHours(),a=n.getMinutes(),s=String(a);10>a&&(s="0"+s),this._startAtString=o+"月"+i+"日 "+r+":"+s,this._communityPokers=e.community_cards,this._gameRounds=[],this._gameRounds.push(this.createDefaultRound(e)),this._gameRounds.push(this.createPreflopRound(e)),0!==e.flop_actions.length&&this._gameRounds.push(this.createFlopRound(e)),0!==e.turn_actions.length&&this._gameRounds.push(this.createTurnRound(e)),0!==e.river_actions.length&&this._gameRounds.push(this.createRiverRound(e));var c=e.players_info;this._settlements=Object.keys(c).map(function(e){var n=c[e],o={player_name:n.nickname,player_id:e,player_seat:n.seat,player_position:n.position,is_folded:n.is_folded,player_hole_poker:n.hole_card,community_pokers:t._communityPokers,player_settlement:n.settlement};return new Settlement(o)})},e.prototype.createDefaultRound=function(e){var t={cn_name:"押注圈",en_name:"Betting",pot:0,community_pokers:[],actions:this.createActions(e.default_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createPreflopRound=function(e){var t={cn_name:"翻牌前",en_name:"Pre-Flop",pot:e.pot_before_preflop,community_pokers:[],actions:this.createActions(e.preflop_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createFlopRound=function(e){var t={cn_name:"翻牌圈",en_name:"Flop",pot:e.pot_before_flop,community_pokers:e.community_cards.slice(0,3),actions:this.createActions(e.flop_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createTurnRound=function(e){var t={cn_name:"转牌圈",en_name:"Turn",pot:e.pot_before_turn,community_pokers:e.community_cards.slice(0,4),actions:this.createActions(e.turn_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createRiverRound=function(e){var t={cn_name:"河牌圈",en_name:"River",pot:e.pot_before_river,community_pokers:e.community_cards,actions:this.createActions(e.river_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createActions=function(e,t){for(var n=[],o=0;o<e.length;o+=1){var i=e[o],r=i.player_id,a=t[r];a&&n.push({player_position:a.position,player_nickname:a.nickname,player_action:i.action,player_action_value:i.amount,player_stack:i.stack})}return n},e.prototype.createPages=function(t){this._pages=t.map(function(t){var n=new e;return n.setup(t),n}),this._pageAmount=this._pages.length,this._currentPageIndex=this._pageAmount},e.CACHE_DATA_KEY="reviewboard.model.cache.game.history.data.key",e}();__reflect(ReviewboardModel.prototype,"ReviewboardModel",["IPageCounter"]);var Settlement=function(){function e(e){this._playerName=e.player_name,this._playerId=e.player_id,this._playerSeat=e.player_seat,this._playerPosition=e.player_position,this._isFolded=e.is_folded,this._playerAvatar="需要拼接",this._holePokers=e.player_hole_poker||[],this._communityPokers=e.community_pokers,this._playerSettlement=e.player_settlement,this._isShowdowned=!!e.showdown_strength,this._showdownStrength=e.showdown_strength}return Object.defineProperty(e.prototype,"playerName",{get:function(){return this._playerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerAvatar",{get:function(){return this._playerAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFolded",{get:function(){return this._isFolded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holePokers",{get:function(){return 0===this._holePokers.length?["back","back"]:this._holePokers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"foldInfoText",{get:function(){return this._isFolded?"(弃牌)":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communityPokers",{get:function(){return this._isShowdowned?this._communityPokers:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlement",{get:function(){return this._playerSettlement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlementString",{get:function(){return this._playerSettlement>0?"+"+this._playerSettlement:String(this._playerSettlement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlementTextColor",{get:function(){return this._playerSettlement>0?16008262:0===this._playerSettlement?12108480:5366165},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShowdowned",{get:function(){return this._isShowdowned},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showdownStrength",{get:function(){return this._showdownStrength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerPosition",{get:function(){return this._playerPosition},enumerable:!0,configurable:!0}),e}();__reflect(Settlement.prototype,"Settlement");var terminologySpecificDatas=[{name:GameAction.BB,description:"大盲注"},{name:GameAction.SB,description:"小盲注"},{name:GameAction.AllIn,description:"全押"},{name:GameAction.Bet,description:"下注"},{name:GameAction.Call,description:"跟注"},{name:GameAction.Check,description:"过"},{name:GameAction.Fold,description:"弃牌"},{name:GameAction.Raise,description:"加注"}],TerminologySpecificModel=function(){function e(){}return e.listTerminologySpecifics=function(){return terminologySpecificDatas.map(function(e){return new TexasTermiology(e)})},e}();__reflect(TerminologySpecificModel.prototype,"TerminologySpecificModel");var TexasTermiology=function(){function e(e){this.action=PlayerActionFactory.makeByTypeName(e.name),this.description=e.description}return e}();__reflect(TexasTermiology.prototype,"TexasTermiology");var BottomToolbar=function(e){function t(){var t=e.call(this)||this;return t.skinName="BottomToolbarSkin",t.leaderboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressLeaderboardButton,t),t}return __extends(t,e),t.prototype.onPressLeaderboardButton=function(){this.pressLeaderboardButtonHandler()},t}(eui.Component);__reflect(BottomToolbar.prototype,"BottomToolbar");var CardPattern=function(e){function t(){var t=e.call(this)||this;return t.skinName="CardPatternSkin",t}return __extends(t,e),t.prototype.show=function(){this.visible=!0,egret.Tween.get(this.patternImage).to({x:0},200)},t.prototype.hide=function(){var e=this;egret.Tween.get(this.patternImage).to({x:-620},200).call(function(){e.visible=!1})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.patternImage.x=-620,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},t.prototype.onTouch=function(){this.hide()},t}(eui.Component);__reflect(CardPattern.prototype,"CardPattern");var ChatComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatSkin",t.x=-750,t}return __extends(t,e),t.prototype.show=function(){egret.Tween.get(this).to({x:0},500,egret.Ease.sineInOut)},t.prototype.hide=function(){egret.Tween.get(this).to({x:-750},500,egret.Ease.sineInOut)},t.prototype.updateMessage=function(e){this.messageList.dataProvider=new eui.ArrayCollection(e);var t=this.scroller.viewport.contentHeight,n=this.scroller.viewport.height-20;this.scroller.validateNow(),t>=n&&(this.scroller.viewport.scrollV=t-n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.messageList.itemRenderer=ChatItemRenderer,this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this)},t.prototype.onBackgroundTouch=function(){this.hide()},t}(eui.Component);__reflect(ChatComponent.prototype,"ChatComponent");var ChatItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.message=new eui.Label,this.message.width=600,this.message.height+=50,this.addChild(this.message)},t.prototype.dataChanged=function(){this.message.text=""+this.data},t}(eui.ItemRenderer);__reflect(ChatItemRenderer.prototype,"ChatItemRenderer");var CommunityCardItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="CardItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this;this.data.isNew?egret.Tween.get(this.cardImage).to({scaleX:0},100).call(function(){e.cardImage.source="poker_"+e.data.name+"_png",egret.Tween.get(e.cardImage).to({scaleX:1},100)}):this.cardImage.source="poker_"+this.data.name+"_png"},t}(eui.ItemRenderer);__reflect(CommunityCardItemRenderer.prototype,"CommunityCardItemRenderer");var HandCardImage=function(e){function t(t){var n=e.call(this)||this;return n.width=65,n.height=97,n.anchorOffsetX=32.5,n.anchorOffsetY=48.5,n.x=375.5,n.y=667.5,n.source="poker_back_png",n.config=t,n}return __extends(t,e),t.prototype.getCoordinate=function(){return this.config.coordinate},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.config.animate?(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.FaPai3),this.createCardWithAnimation()):this.createCard()},t.prototype.createCard=function(){var e=this.config.coordinate.direction;if(e===Direction.Bottom){var t=0===this.config.additionX?395.5:466.5;this.x=t,this.y=1158.5,this.rotation=1800;var n=this.config.cardName||"back";this.source="poker_"+n+"_png"}else{var t=this.config.coordinate.x+this.config.additionX,o=this.config.coordinate.y+110;e===Direction.Right&&(t=this.config.coordinate.x+100+this.config.additionX);var i=this.config.rotation;this.x=t,this.y=o,this.rotation=i,this.scaleX=.4,this.scaleY=.4}},t.prototype.createCardWithAnimation=function(){var e=this,t=this.config.coordinate.direction;if(t===Direction.Bottom){var n=0===this.config.additionX?395.5:466.5;egret.Tween.get(this).wait(100*this.config.index).to({x:n,y:1158.5,rotation:1800},500,egret.Ease.quadOut).call(function(){e.config.cardName&&egret.Tween.get(e).to({scaleX:0},100).call(function(){var t=e.config.cardName||"back";e.source="poker_"+t+"_png",egret.Tween.get(e).to({scaleX:1},100)})})}else{var n=this.config.coordinate.x+this.config.additionX,o=this.config.coordinate.y+110;t===Direction.Right&&(n=this.config.coordinate.x+100+this.config.additionX);var i=this.config.rotation;egret.Tween.get(this).wait(100*this.config.index).to({x:n,y:o,rotation:i,scaleX:.4,scaleY:.4},300,egret.Ease.quadOut)}},t}(eui.Image);__reflect(HandCardImage.prototype,"HandCardImage");var MarkView=function(e){function t(t,n){var o=e.call(this)||this;return o.skinName="MarkSkin",o.signLabel.text=t,o.initialCoordinate(n),o}return __extends(t,e),t.prototype.initialCoordinate=function(e){var t=e.direction;t===Direction.Left?this.x=110:t===Direction.Right?this.x=-40:this.x=-40,this.y=120},t}(eui.Component);__reflect(MarkView.prototype,"MarkView");var MenuView=function(e){function t(){var t=e.call(this)||this;return t.skinName="MenuViewSkin",Device.sharedInstance().isIphoneX()?t.menuList.y=50:t.menuList.y=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.menuList).to({x:0},200),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTouch,this)},t.prototype.onItemTouch=function(e){var t=new MenuTouchEvent(MenuTouchEvent.TouchItem);t.itemIndex=e.itemIndex,this.dispatchEvent(t),this.remove()},t.prototype.remove=function(){egret.Tween.get(this.menuList).to({x:-240},200).call(function(){SceneManager.sharedInstance().popScene()})},t}(eui.Component);__reflect(MenuView.prototype,"MenuView");var PlayerView=function(e){function t(){var t=e.call(this)||this;return t.angle=0,t.radius=0,t.skinName="PlayerSkin",t}return __extends(t,e),t.prototype.bindPlayer=function(e){this.playerInfo=e,this.nameLabel.text=e.nickname.substr(0,8),this.stack=e.stack,this.scoreLabel.text=""+MoneyFormatter.addChineseUnit(e.stack),this.avatarImage.loadUrlSource(e.avatarUrl),this.avatarImage.renderRoundMask(10),this.coordinate?egret.Tween.get(this).to({x:e.coordinate.x,y:e.coordinate.y},500):(this.x=e.coordinate.x,this.y=e.coordinate.y),this.coordinate=e.coordinate,e.roundAction&&this.updateStatusImage(e.roundAction),e.roundAction===GameAction.Fold&&this.showFoldCover(),e.amount>0&&this.updateScoreboard(e.amount)},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.isPlayerPlaying=function(){var e=this.playerInfo.state;return e!==PlayerState.NotInGame&&e!==PlayerState.Folded},t.prototype.isPlayerIdEqualTo=function(e){return this.playerInfo.id===e},t.prototype.setMark=function(e){this.mark=new MarkView(e,this.coordinate),this.addChild(this.mark)},t.prototype.updateScoreboard=function(e){void 0===e&&(e=0),this.scoreboard||(this.scoreboard=new ScoreboardView(this.coordinate),this.addChild(this.scoreboard)),this.scoreboard.updateAmount(e)},t.prototype.removeScoreboard=function(){this.scoreboard&&(this.removeChild(this.scoreboard),this.scoreboard=void 0)},t.prototype.updateStack=function(e){void 0===e&&(e=0),this.stack=e,this.scoreLabel.text=""+MoneyFormatter.addChineseUnit(e)},t.prototype.getCurrentStatus=function(){return this.currentStatus},t.prototype.updateStatusImage=function(e){this.currentStatus=e,this.statusImage||(this.statusImage=new StatusImage(this.coordinate),this.addChild(this.statusImage)),ActionUtil.updateSource(this.statusImage,e)},t.prototype.removeStatusImage=function(){this.statusImage&&(this.removeChild(this.statusImage),this.statusImage=void 0)
},t.prototype.startTimer=function(){var e=this;this.showCountdownCover(),this.timerLabel.visible=!0,this.countdown=setInterval(function(){var t=Number(e.timerLabel.text);t>10?e.timerLabel.textColor=8843792:t>5&&10>=t?e.timerLabel.textColor=15915527:e.timerLabel.textColor=16336135;var n=t-1;e.timerLabel.text=""+(0>n?0:n)},1e3),this.progressBorder.visible=!0,this.progressTimer.start()},t.prototype.stopTimer=function(){this.hideCountdownCover(),clearInterval(this.countdown),this.countdown=void 0,this.timerLabel.text="15",this.timerLabel.textColor=8843792,this.timerLabel.visible=!1,this.progressBorder.visible=!1,this.angle=0,this.progressTimer.reset()},t.prototype.showFoldCover=function(){this.foldCover.visible=!0},t.prototype.hideFoldCover=function(){this.foldCover.visible=!1},t.prototype.showCard=function(e){var t=this;e.forEach(function(e,n){var o=new eui.Image;o.width=76,o.height=112,o.y=27.5,o.x=76*n-24,o.source="poker_back_png",t.addChild(o),egret.Tween.get(o).to({x:-24},200).call(function(){o.source="poker_"+e.name+"_png",egret.Tween.get(o).to({x:76*n-24},200).wait(3e3).call(function(){t.removeChild(o)})})})},t.prototype.displayCardType=function(e){this.scoreLabel.text=e},t.prototype.playWinnerAnimation=function(){this.coinParticle.start(1e3),this.winnerAnimation.play(0)},t.prototype.showPrizeLabel=function(e){var t=this,n=new eui.Label;n.y=20,n.size=30,n.width=200,n.horizontalCenter=0,n.textColor=15915527,n.textAlign="center",n.text="+"+MoneyFormatter.addChineseUnit(e),this.addChild(n);var o=-40;egret.Tween.get(n).to({y:o},1e3).wait(1200).call(function(){t.removeChild(n)})},t.prototype.reset=function(){this.mark&&(this.removeChild(this.mark),this.mark=void 0),this.currentStatus=void 0,this.removeScoreboard(),this.removeStatusImage(),this.hideFoldCover()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlayerView,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.radius=Math.max(this.progressBorder.width,this.progressBorder.height)/2*3,this.maskShape=new egret.Shape,this.maskShape.rotation=-90,this.maskShape.x=this.progressBorder.width/2,this.maskShape.y=this.progressBorder.height/2,this.progressBorder.mask=this.maskShape,this.addChild(this.maskShape),this.progressTimer=new egret.Timer(150,100),this.progressTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.progressTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this);var t=RES.getRes("coin_particle_png"),n=RES.getRes("coin_particle_json");this.coinParticle=new particle.GravityParticleSystem(t,n),this.addChild(this.coinParticle)},t.prototype.onTouchPlayerView=function(){var e=new PlayerViewEvent(PlayerViewEvent.Touch);e.playerInfo=this.playerInfo,this.dispatchEvent(e)},t.prototype.initAnimation=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,i;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,RES.getRes("allin_json")];case 1:return e=r.sent(),[4,RES.getRes("allin_png")];case 2:return t=r.sent(),n=new egret.MovieClipDataFactory(e,t),o=new egret.MovieClip(n.generateMovieClipData("allin")),o.x=0,o.y=0,o.gotoAndPlay("run",-1),this.addChild(o),[3,4];case 3:return i=r.sent(),egret.log(i),[3,4];case 4:return[2]}})})},t.prototype.onTimer=function(){this.angle+=3.6,this.changeGraphics(this.angle),this.angle=this.angle%360},t.prototype.onTimerComplete=function(){this.stopTimer();var e=new PlayerViewEvent(PlayerViewEvent.TimerEnd);e.playerId=this.playerInfo.id,this.dispatchEvent(e)},t.prototype.changeGraphics=function(e){this.maskShape.graphics.clear(),this.maskShape.graphics.beginFill(52224,1),this.maskShape.graphics.lineTo(this.radius,0),this.maskShape.graphics.drawArc(0,0,this.radius,0,e*Math.PI/180,!0),this.maskShape.graphics.lineTo(0,0),this.maskShape.graphics.endFill()},t.prototype.showCountdownCover=function(){this.countdownCover.visible=!0},t.prototype.hideCountdownCover=function(){this.countdownCover.visible=!1},t.prototype.onRemoveFromStage=function(){this.progressTimer.reset(),clearInterval(this.countdown)},t}(eui.Component);__reflect(PlayerView.prototype,"PlayerView");var PotItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="PotItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.amountLabel.text=""+MoneyFormatter.addChineseUnit(this.data.amount)},t}(eui.ItemRenderer);__reflect(PotItemRenderer.prototype,"PotItemRenderer");var LoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingSkin",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.loadingLabel.text="游戏加载中... "+Math.floor(e/t*100)+"%",this.progressBar.value=Math.floor(e/t*100)},t}(eui.Component);__reflect(LoadingScene.prototype,"LoadingScene",["RES.PromiseTaskReporter"]);var RaiseSlider=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),this.setDashboardValue(t),this.setProgressValue(t)},t.prototype.setDashboardValue=function(e){this.dashboardLabel.text=e.toString()},t.prototype.setProgressValue=function(e){this.progressLabel.text=e.toString()},t}(eui.VSlider);__reflect(RaiseSlider.prototype,"RaiseSlider");var ScoreboardView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="ScoreboardSkin",n.initialCoordinate(t),n}return __extends(t,e),t.prototype.updateAmount=function(e){this.chipLabel.text=""+MoneyFormatter.addChineseUnit(e)},t.prototype.initialCoordinate=function(e){var t=e.direction;t===Direction.Left?(this.x=80,this.y=81):t===Direction.Right?(this.x=-80,this.y=81,this.icon.x=74,this.chipLabel.x=9):(this.x=136,this.y=0)},t}(eui.Component);__reflect(ScoreboardView.prototype,"ScoreboardView");var SeatView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="SeatViewSkin",n.seatNumber=t.seat,n.coordinate=t,n.initCoordinate(t),n}return __extends(t,e),t.prototype.getSeatNumber=function(){return this.seatNumber},t.prototype.updatePosition=function(e){egret.Tween.get(this).to({x:e.x+10,y:e.y+51},500)},t.prototype.enableTouch=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.icon.visible=!0,AnimationUtil.loopPlay(this.bounce),this.labelDisplay.text="坐下",this.touchEnabled=!0},t.prototype.disableTouch=function(){this.bounce.stop(),this.icon.visible=!1,this.labelDisplay.text="空位",this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},t.prototype.initCoordinate=function(e){this.x=e.x+10,this.y=e.y+51},t.prototype.onTouch=function(){var e=new SeatTouchEvent(SeatTouchEvent.TouchSeat);e.seatNumber=this.seatNumber,this.dispatchEvent(e)},t}(eui.Component);__reflect(SeatView.prototype,"SeatView");var StatusImage=function(e){function t(t){var n=e.call(this)||this;return n.width=78,n.height=46,n.initCoordinate(t),n}return __extends(t,e),t.prototype.updateSource=function(e){this.source=e},t.prototype.initCoordinate=function(e){var t=e.direction;t===Direction.Left?this.x=80:t===Direction.Right?this.x=-58:this.x=-58,this.y=35},t}(eui.Image);__reflect(StatusImage.prototype,"StatusImage");var BuyInScene=function(e){function t(t,n,o){var i=e.call(this)||this;return i.skinName="BuyInSkin",i.maxBuyIn=o,i.minBuyIn=n,i.scoreSlider.minimum=t,i.scoreSlider.maximum=o,i.scoreSlider.value=t,i.scoreLabel.text=MoneyFormatter.addChineseUnit(t),i.scoreSlider.snapInterval=n/10,i.score=t,i.minBuyLabel.text="* 该房间最低带入为 "+MoneyFormatter.addChineseUnit(n),i.balanceLabel.text="当前拥有记分牌: "+MoneyFormatter.addChineseUnit(n-t),i.group.scaleX=.7,i.group.scaleY=.7,i}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.scoreSlider.addEventListener(egret.Event.CHANGE,this.onSelectSlider,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.onSelectSlider=function(){this.score=this.scoreSlider.value,this.scoreLabel.text=""+MoneyFormatter.addChineseUnit(this.scoreSlider.value),this.score===this.scoreSlider.minimum?(this.minBuyLabel.text="* 该房间最低带入为 "+MoneyFormatter.addChineseUnit(this.minBuyIn),this.minBuyLabel.visible=!0):this.score===this.scoreSlider.maximum?(this.minBuyLabel.text="* 该房间最高带入为 "+MoneyFormatter.addChineseUnit(this.maxBuyIn),this.minBuyLabel.visible=!0):this.minBuyLabel.visible=!1},t.prototype.onConfirmButtonTouch=function(){var e=new BuyInSceneEvent(BuyInSceneEvent.TouchConfirm);e.score=this.score,this.dispatchEvent(e),this.remove()},t}(eui.Component);__reflect(BuyInScene.prototype,"BuyInScene");var ApplicationRecordItemRenerer=function(e){function t(){var t=e.call(this)||this;return t.skinName="ApplicationRecordItemSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.agreeLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeTouch,this),this.rejectLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectTouch,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.auditedAt?(this.operationGroup.visible=!1,this.statusLabel.visible=!0,this.statusLabel.text=this.data.accepted?"已同意":"已拒绝"):(this.operationGroup.visible=!0,this.statusLabel.visible=!1),this.nicknameLabel.text=this.data.applicant.nickname;var t="申请带入记分牌 <font color=0x6bfffd>"+MoneyFormatter.addChineseUnit(this.data.chip)+"</font>";this.scoreLabel.textFlow=(new egret.HtmlTextParser).parse(t),this.minLabel.text="* 该房间最低带入记分牌为 "+MoneyFormatter.addChineseUnit(this.data.minBuyIn)},t.prototype.onAgreeTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已同意",this.statusLabel.visible=!0;var e=new BuyInSceneEvent(BuyInSceneEvent.RecordItemTap);e.data=this.data,e.accepted=!0,this.parent.dispatchEvent(e)},t.prototype.onRejectTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已拒绝",this.statusLabel.visible=!0;var e=new BuyInSceneEvent(BuyInSceneEvent.RecordItemTap);e.data=this.data,e.accepted=!1,this.parent.dispatchEvent(e)},t}(eui.ItemRenderer);__reflect(ApplicationRecordItemRenerer.prototype,"ApplicationRecordItemRenerer");var ApplicationRecordScene=function(e){function t(t,n){var o=e.call(this)||this;return o.roomId=t,o.minBuyIn=n,o.skinName="ApplicationRecordSkin",o.group.scaleX=.7,o.group.scaleY=.7,o.applicationModel=new ApplicationModel,o}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.recordList.itemRenderer=ApplicationRecordItemRenerer,this.recordList.addEventListener(BuyInSceneEvent.RecordItemTap,this.onItemtap,this),this.listRecord()},t.prototype.listRecord=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o=this;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.applicationModel.listRecord(this.roomId)];case 1:return e=i.sent(),e.result.length>0?(t=e.result.map(function(e){var t=new ApplicationRecordInfo(e);return Object.assign(t,{minBuyIn:o.minBuyIn}),t}),this.recordList.dataProvider=new eui.ArrayCollection(t),this.promptLabel.text=" "):this.promptLabel.text="还没有收到任何消息",[3,3];case 2:return n=i.sent(),this.promptLabel.text=n.message,[3,3];case 3:return[2]}})})},t.prototype.onItemtap=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:t={roomId:this.roomId,amount:e.data.chip,applicantId:e.data.applicant.id,accepted:e.accepted},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.applicationModel.checkBuyIn(t)];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),egret.log(n.message),[3,4];case 4:return[2]}})})},t}(eui.Component);__reflect(ApplicationRecordScene.prototype,"ApplicationRecordScene");var BuyInApplicationScene=function(e){function t(t){var n=e.call(this)||this;n.skinName="BuyInApplicationSkin",n.group.scaleX=.7,n.group.scaleY=.7,n.content=t,n.nicknameLabel.text=t.applicant.nickname;var o="申请带入记分牌 <font color=0x6bfffd>"+MoneyFormatter.addChineseUnit(t.amount)+"</font>";return n.scoreLabel.textFlow=(new egret.HtmlTextParser).parse(o),n.minScoreLabel.text="* 该房间最低带入记分牌为 "+MoneyFormatter.addChineseUnit(t.minBuyIn),n.applicationModel=new ApplicationModel,n}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.agreeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeButtonTouch,this),this.rejectButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectButtonTouch,this)},t.prototype.onAgreeButtonTouch=function(){this.checkBuyIn(!0),this.remove()},t.prototype.onRejectButtonTouch=function(){this.checkBuyIn(!1),this.remove()},t.prototype.checkBuyIn=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:t={roomId:this.content.roomId,amount:this.content.amount,applicantId:this.content.applicant.id,accepted:e},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.applicationModel.checkBuyIn(t)];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),egret.log(n.message),[3,4];case 4:return[2]}})})},t}(eui.Component);__reflect(BuyInApplicationScene.prototype,"BuyInApplicationScene");var MessageAlarm=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageAlarmSkin",t}return __extends(t,e),t.prototype.showDot=function(){this.dot.visible=!0},t.prototype.hideDot=function(){this.dot.visible=!1},t}(eui.Component);__reflect(MessageAlarm.prototype,"MessageAlarm");var DebugLogItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t="<font color=0x13f720>"+this.data.action+"</font>: "+this.data.message;this.label.textFlow=(new egret.HtmlTextParser).parse(t)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.label=new eui.Label,this.label.width=560,this.addChild(this.label)},t}(eui.ItemRenderer);__reflect(DebugLogItemRenderer.prototype,"DebugLogItemRenderer");var DebugView=function(e){function t(){var t=e.call(this)||this;return t.logs=[],t.skinName="DebugViewSkin",t}return __extends(t,e),t.prototype.updateLog=function(e){this.logs.push(e),this.logList.dataProvider=new eui.ArrayCollection(this.logs)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.domainLabel.text=""+ApiConfig.ApiDomain,this.logList.itemRenderer=DebugLogItemRenderer},t}(eui.Component);__reflect(DebugView.prototype,"DebugView");var InsuranceView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InsuranceSkin",t.group.scaleX=.7,t.group.scaleY=.7,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut)},t}(eui.Component);__reflect(InsuranceView.prototype,"InsuranceView");var Leaderboard=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardSkin",t}return __extends(t,e),t.prototype.setPlayers=function(e){this.playerList.dataProvider=new eui.ArrayCollection(e)},t.prototype.setViewPlayers=function(e){this.viewerList.dataProvider=new eui.ArrayCollection(e)},t.prototype.setOnLineViewers=function(e,t){this.viewerHeader.setViewPlayersAmount("（"+e+"/"+t+"）")},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playerList.itemRenderer=LeaderboardListItem,this.viewerList.itemRenderer=LeaderboardViewer,this.viewerList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onViewerListItemTapped,this),Device.sharedInstance().isIphoneX()&&(this.headerGroup.height+=Constants.iPhoneX_TOP_MARGIN,this.contentScroller.height-=Constants.iPhoneX_TOP_MARGIN)},t.prototype.onViewerListItemTapped=function(e){var t=new PlayerInfo({id:this.viewerList.selectedItem.id,nickname:this.viewerList.selectedItem.nickname,username:this.viewerList.selectedItem.username});SceneManager.sharedInstance().popScene(),SceneManager.sharedInstance().pushScene(new PlayerDetailScene(t))},t}(eui.Component);__reflect(Leaderboard.prototype,"Leaderboard");var LeaderboardListItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardListItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.nicknameLabel.textColor=this.data.textColor,this.buyInLabel.textColor=this.data.textColor,this.roundAmountLabel.textColor=this.data.textColor,this.scoreLabel.textColor=this.data.textColor},t}(eui.ItemRenderer);__reflect(LeaderboardListItem.prototype,"LeaderboardListItem");var LeaderboardPlayerInfoHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardPlayerInfoHeaderSkin",t}return __extends(t,e),t}(eui.Component);__reflect(LeaderboardPlayerInfoHeader.prototype,"LeaderboardPlayerInfoHeader");var LeaderboardViewer=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardViewerSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.avatar.loadUrlSource(this.data.avatarUrl),this.leftAvatarCover.visible=this.data.hasLeft,this.nameLabel.textColor=this.data.color},t}(eui.ItemRenderer);__reflect(LeaderboardViewer.prototype,"LeaderboardViewer");var LeaderboardViewerHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardViewerHeaderSkin",t}return __extends(t,e),t.prototype.setViewPlayersAmount=function(e){this.viewPlayersAmountLabel.text=e},t}(eui.Component);__reflect(LeaderboardViewerHeader.prototype,"LeaderboardViewerHeader");var NumericKeyboardScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="NumericKeyboardSkin",t}return __extends(t,e),t.prototype.updateLimits=function(e,t){this.minimum=e,this.maximum=t},t.prototype.show=function(){this.initComponent(),this.visible=!0},t.prototype.hide=function(){this.visible=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.number="",this.minimum=2,this.maximum=1e3,this.initComponent(),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.buttonList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTouch,this),this.deleteButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDeleteButtonTouch,this),this.zeroButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZeroButtonTouch,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.initComponent=function(){this.number="",this.displayLabel.textColor=16777215,this.displayLabel.text="最小加注额为"+this.minimum,this.confirmButton.background.fillColor=15582515,this.deleteButton.background.fillColor=8421529,this.confirmButton.labelDisplay.textColor=0,this.confirmButton.label="确定"},t.prototype.onItemTouch=function(e){var t=this.number+(""+e.item.number);this.updateNumber(t)},t.prototype.onDeleteButtonTouch=function(){var e=this.number.slice(0,this.number.length-1);this.updateNumber(e)},t.prototype.onZeroButtonTouch=function(){var e=this.number+"0";this.updateNumber(e)},t.prototype.updateNumber=function(e){return this.displayLabel.textColor=16777215,this.confirmButton.background.fillColor=15582515,this.confirmButton.label="确定",parseInt(e)>this.maximum?(this.number=""+this.maximum,this.displayLabel.textColor=16711680,this.confirmButton.background.fillColor=16537889,this.confirmButton.label="全下"):this.number=e,this.number?void(this.displayLabel.text=""+this.number):void(this.displayLabel.text="最小加注额为"+this.minimum)},t.prototype.onConfirmButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e=parseInt(this.number)||this.minimum;if(e<this.minimum)return e=this.minimum,this.number="",void(this.displayLabel.text="最小加注额为"+this.minimum);var t;t=new RaiseEvent(e===this.maximum?RaiseEvent.AllIn:RaiseEvent.Raise),t.data=e,this.dispatchEvent(t),this.hide()},t}(eui.Component);__reflect(NumericKeyboardScene.prototype,"NumericKeyboardScene");var PlayGameButtonGroup=function(e){function t(){var t=e.call(this)||this;return t.ANIMATION_DURATION=150,t.couldAuto=!1,t.isAutoCheck=!1,t.isAutoCheckOrFold=!1,t.skinName="PlayGameButtonGroupSkin",t}return __extends(t,e),t.prototype.setBlind=function(e,t){this.smallBlind=e,this.bigBlind=t},t.prototype.reset=function(){this.isAutoCheck=!1,this.isAutoCheckOrFold=!1,this.autoCheckButton.selected=!1,this.autoCheckOrFoldButton.selected=!1},t.prototype.showSwitchButtons=function(){var e=this;return this.couldAuto?void(this.couldAuto=!1):(this.visible=!0,this.switchGroup.scaleX=0,this.switchGroup.scaleY=0,void egret.Tween.get(this.autoGroup).to({scaleX:0,scaleY:0},this.ANIMATION_DURATION).call(function(){e.autoGroup.visible=!1,e.switchGroup.visible=!0,egret.Tween.get(e.switchGroup).to({scaleX:1,scaleY:1},e.ANIMATION_DURATION)}))},t.prototype.showAutoButtons=function(){var e=this;this.visible=!0,this.autoGroup.scaleX=0,this.autoGroup.scaleY=0,egret.Tween.get(this.switchGroup).to({scaleX:0,scaleY:0},this.ANIMATION_DURATION).call(function(){e.switchGroup.visible=!1,e.autoGroup.visible=!0,egret.Tween.get(e.autoGroup).to({scaleX:1,scaleY:1},e.ANIMATION_DURATION)})},t.prototype.hide=function(){this.visible=!1,this.reset()},t.prototype.update=function(e,t,n){this.callButton.visible=e.couldCall,this.checkButton.visible=e.couldCheck,this.allInButton.visible=e.mustAllIn,this.raiseButton.visible=e.couldRaise,this.quickRaiseButton.visible=e.couldRaise,this.raiseAmount=e.raiseAmount,this.shortcutGroup.visible=e.couldRaise;var o=0;e.couldCall&&(o=e.callAmount),e.couldRaise&&this.updateShortcutButtons(t,o,n),e.couldCall&&(this.callButton.label=""+MoneyFormatter.addChineseUnit(e.callAmount),this.callAmount=e.callAmount),e.mustAllIn&&(this.allInButton.label=""+MoneyFormatter.addChineseUnit(e.raiseAmount)),this.isAutoCheck&&e.couldCheck&&(this.couldAuto=!0,this.onCheckButtonTouch()),this.isAutoCheckOrFold&&(this.couldAuto=!0,e.couldCheck?this.onCheckButtonTouch():this.onFoldButtonTouch()),this.reset()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.foldButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldButtonTouch,this),this.checkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckButtonTouch,this),this.callButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCallButtonTouch,this),this.raiseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaiseButtonTouch,this),this.allInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllInButtonTouch,this),this.quickRaiseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuickRaiseButtonTouch,this),this.firstShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFirstShortcutButtonTouch,this),this.secondShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSecondShortcutButtonTouch,this),this.thirdShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onThirdShortcutButtonTouch,this),this.fourthShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFourthShortcutButtonTouch,this),this.autoCheckButton.addEventListener(egret.Event.CHANGE,this.onAutoCheckButtonTouch,this),this.autoCheckOrFoldButton.addEventListener(egret.Event.CHANGE,this.onAutoCheckOrFoldButtonTouch,this)},t.prototype.updateShortcutButtons=function(e,t,n){var o=this.smallBlind+this.bigBlind,i="",r="",a="",s="",c=0,u=0,h=0,l=0;o===e?(i="2倍大盲",c=Math.ceil(2*this.bigBlind),r="3倍大盲",u=Math.ceil(3*this.bigBlind),a="4倍大盲",h=Math.ceil(4*this.bigBlind),s="5倍大盲",l=Math.ceil(5*this.bigBlind)):(i="1/2底池",c=Math.ceil((e+t)/2)+t,r="2/3底池",u=2*Math.ceil((e+t)/3)+t,a="一倍底池",h=Math.ceil(e+t)+t,s="最低加注",l=Math.ceil(this.raiseAmount.min)),this.firstShortcutButton.label=i,this.firstShortcutButton.score=c,this.firstShortcutButton.amount=""+MoneyFormatter.addChineseUnit(c),this.firstShortcutButton.enabled=n>=c,c<this.raiseAmount.min&&(this.firstShortcutButton.enabled=!1),this.secondShortcutButton.label=r,this.secondShortcutButton.score=u,this.secondShortcutButton.amount=""+MoneyFormatter.addChineseUnit(u),this.secondShortcutButton.enabled=n>=u,this.thirdShortcutButton.label=a,this.thirdShortcutButton.score=h,this.thirdShortcutButton.amount=""+MoneyFormatter.addChineseUnit(h),this.thirdShortcutButton.enabled=n>=h,this.fourthShortcutButton.label=s,this.fourthShortcutButton.score=l,this.fourthShortcutButton.amount=""+MoneyFormatter.addChineseUnit(l),this.fourthShortcutButton.enabled=n>=l},t.prototype.onFoldButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchFold);this.dispatchEvent(e)},t.prototype.onCheckButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCheck);this.dispatchEvent(e)},t.prototype.onCallButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCall);e.data=this.callAmount,this.dispatchEvent(e)},t.prototype.onRaiseButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchRaise);this.dispatchEvent(e)},t.prototype.onAllInButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchAllIn);e.data=this.raiseAmount,this.dispatchEvent(e)},t.prototype.onQuickRaiseButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchQuickRaise);this.dispatchEvent(e)},t.prototype.onAutoCheckButtonTouch=function(){var e=this.autoCheckButton.selected;this.isAutoCheck=e,e&&(this.isAutoCheckOrFold=!1,this.autoCheckOrFoldButton.selected=!1)},t.prototype.onAutoCheckOrFoldButtonTouch=function(){var e=this.autoCheckOrFoldButton.selected;this.isAutoCheckOrFold=e,e&&(this.isAutoCheck=!1,this.autoCheckButton.selected=!1)},t.prototype.onFirstShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.firstShortcutButton.score,this.dispatchEvent(e)},t.prototype.onSecondShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.secondShortcutButton.score,this.dispatchEvent(e)},t.prototype.onThirdShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.thirdShortcutButton.score,this.dispatchEvent(e)},t.prototype.onFourthShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.fourthShortcutButton.score,this.dispatchEvent(e)},t}(eui.Component);__reflect(PlayGameButtonGroup.prototype,"PlayGameButtonGroup");var ShortcutRaiseButton=function(e){function t(){var t=e.call(this)||this;return t.skinName="ShortcutRaiseButtonSkin",t}return __extends(t,e),t}(eui.Button);__reflect(ShortcutRaiseButton.prototype,"ShortcutRaiseButton");var PlayerDetailScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="PlayerDetailSkin",n.detailModel=new DetailModel,n.playerInfo=t,n.initPlayerInfo(t),n.group.scaleX=.7,n.group.scaleY=.7,n}return __extends(t,e),t.prototype.remove=function(){this.detailModel.clearRecord(),SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.statisticList.itemRenderer=StatisticItemRenderer,this.statisticList.dataProvider=new eui.ArrayCollection(StatisticConfig),this.statisticList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.listStatistic()},t.prototype.listStatistic=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.detailModel.listStatistic(this.playerInfo.id)];case 1:return e=i.sent(),t=new StatisticInfo(e.result),n=this.detailModel.buildStatisticRecord(t),this.statisticList.dataProvider=new eui.ArrayCollection(n),[3,3];case 2:return o=i.sent(),egret.log(o.message),[3,3];case 3:return[2]}})})},t.prototype.initPlayerInfo=function(e){this.nicknameLabel.text=e.nickname,this.avatarImage.loadUrlSource(e.avatarUrl),this.bioLabel.text=e.bio},t.prototype.onItemTouch=function(e){e.item.description&&Toast.show(e.item.description,1e3)},t}(eui.Component);__reflect(PlayerDetailScene.prototype,"PlayerDetailScene");var StatisticItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="StatisticItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data.subtitle?"<font color=0x3bffde>("+this.data.subtitle+")</font>":" ",t=""+this.data.title+e;this.titleLabel.textFlow=(new egret.HtmlTextParser).parser(t);var n=this.data.data||"-";this.dataLabel.text=n},t}(eui.ItemRenderer);__reflect(StatisticItemRenderer.prototype,"StatisticItemRenderer");var Reviewboard=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSkin",t.reviewboardModel=new ReviewboardModel,t.reviewboardModel.loadCachedData(),t}return __extends(t,e),t.prototype.fetchGameHistoryRecordsByRoomId=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.reviewboardModel.fetchGameHistoryRecordByRoomId(e)];case 1:return n.sent(),this.updateGameHistoryAndSettlementHistory(),[3,3];case 2:return t=n.sent(),console.log("Reviewboard fetchGameHistoryRecordsByRoomId failed "),console.log(t),console.log("-----------------------\n"),[3,3];case 3:return[2]}})})},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.contentTabbar.itemRenderer=ReviewboardTabbarItem,this.contentTabbar.dataProvider=this.contentViewStack,this.contentTabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onContentTabbarTap,this),this.contentTabbar.selectedIndex=1,this.updateGameHistoryAndSettlementHistory(),this.footer.pagePicker=this.gameHistoryView,Device.sharedInstance().isIphoneX()&&(this.header.height+=Constants.iPhoneX_TOP_MARGIN,this.footer.height+=Constants.iPhoneX_BOTTOM_MARGIN,this.contentViewStack.height-=Constants.iPhoneX_TOP_MARGIN+Constants.iPhoneX_BOTTOM_MARGIN)},t.prototype.updateGameHistoryAndSettlementHistory=function(){this.gameHistoryView.setup(this.reviewboardModel),this.settlementHistoryView.setup(this.reviewboardModel),this.footer.setPageCounter(this.reviewboardModel),this.reviewboardModel.isFetching&&this.reviewboardModel.isEmpty?(this.loadingLabel.text="数据加载中...",this.loadingLabel.visible=!0):this.reviewboardModel.isEmpty?(this.loadingLabel.text="房间还未有过牌局",this.loadingLabel.visible=!0):this.loadingLabel.visible=!1},t.prototype.onContentTabbarTap=function(e){this.footer.setPageCounter(this.reviewboardModel),0===e.itemIndex?this.footer.pagePicker=this.settlementHistoryView:this.footer.pagePicker=this.gameHistoryView,this.updateGameHistoryAndSettlementHistory()},t}(eui.Component);__reflect(Reviewboard.prototype,"Reviewboard");var ReviewboardFooter=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardFooterSkin",t.pageSlider.minimum=1,t.pageSlider.addEventListener(eui.UIEvent.CHANGE,t.onPageSliderChanged,t),t.previousButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressPreviousButton,t),t.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onPressNextButton,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"pagePicker",{set:function(e){this._pagePicker=e},enumerable:!0,configurable:!0}),t.prototype.setPageCounter=function(e){this._pageCounter=e,this.pageSlider.maximum=this._pageCounter.pageAmount,this.setPageSliderValue(this._pageCounter.currentPageIndex)
},t.prototype.onPageSliderChanged=function(e){this.setPageSliderValue(this.pageSlider.value),this.pickPage(this.pageSlider.value)},t.prototype.onPressPreviousButton=function(){this.addPageValue(-1)},t.prototype.onPressNextButton=function(){this.addPageValue(1)},t.prototype.addPageValue=function(e){var t=this.pageSlider.value;t+=e,1>t||t>this.pageSlider.maximum||(this.setPageSliderValue(t),this.pickPage(t))},t.prototype.setPageSliderValue=function(e){this.pageSlider.value=e,this.pageLabel.text=this.pageSlider.value+"/"+this.pageSlider.maximum},t.prototype.pickPage=function(e){this._pagePicker.pickPageAtIndex(e),this._pageCounter.currentPageIndex=e},t}(eui.Component);__reflect(ReviewboardFooter.prototype,"ReviewboardFooter");var ReviewboardHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardHeaderSkin",EventCenter.sharedInstance().addEventListener(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE,t.updateContent,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.removeAllListeners,t),t}return __extends(t,e),t.prototype.setPotLabelText=function(e){this.potLabel.text=e},t.prototype.updateContent=function(e){this.potLabel.text=e.potValue.toString(),this.dateLabel.text=e.dateString},t.prototype.removeAllListeners=function(){EventCenter.sharedInstance().removeEventListener(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE,this.updateContent,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeAllListeners,this)},t}(eui.Component);__reflect(ReviewboardHeader.prototype,"ReviewboardHeader");var ReviewboardPokerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPokerSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.image.source="poker_"+this.data+"_png"},t}(eui.ItemRenderer);__reflect(ReviewboardPokerView.prototype,"ReviewboardPokerView");var ReviewboardTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTabbarItemSkin",t}return __extends(t,e),t}(eui.ItemRenderer);__reflect(ReviewboardTabbarItem.prototype,"ReviewboardTabbarItem");var ReviewboardBlindingBetHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardBlindingBetHeaderSkin",t}return __extends(t,e),t}(eui.Component);__reflect(ReviewboardBlindingBetHeader.prototype,"ReviewboardBlindingBetHeader");var ReviewboardGameHistorySettlementItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardGameHistorySettlementItemSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.handPokersList.itemRenderer=ReviewboardPokerView,this.boardPokersList.itemRenderer=ReviewboardPokerView},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.playerPositionIcon.positionName=this.data.playerPosition,this.playerNameLabel.text=this.data.playerName,this.playerStateLabel.text=this.data.foldInfoText,this.playerSettlementLabel.text=this.data.playerSettlementString,this.playerSettlementLabel.textColor=this.data.playerSettlementTextColor,this.handPokersList.dataProvider=new eui.ArrayCollection(this.data.holePokers),this.boardPokersList.dataProvider=new eui.ArrayCollection(this.data.communityPokers)},t}(eui.ItemRenderer);__reflect(ReviewboardGameHistorySettlementItem.prototype,"ReviewboardGameHistorySettlementItem");var ReviewboardGameHistoryView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardGameHistorySkin",t}return __extends(t,e),t.prototype.setup=function(e){this.reviewboardModel=e,this.showingPage=e.currentPage,this.updateContent()},t.prototype.pickPageAtIndex=function(e){this.reviewboardModel.currentPageIndex=e,this.showingPage=this.reviewboardModel.currentPage,this.updateContent()},t.prototype.updateContent=function(){if(this.showingPage){this.scrollerGroup.removeChildren(),this.createGameRounds(),this.createSettlementContent(),this.createTerminologySpecificContent(),this.contentScroller.viewport.scrollV=0;var e=new ReviewboardEvent(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE);e.potValue=this.showingPage.pot,e.dateString=this.showingPage.startAtString,EventCenter.sharedInstance().dispatchEvent(e)}},t.prototype.createGameRounds=function(){for(var e=0;e<this.showingPage.gameRounds.length;e+=1){var t=this.showingPage.gameRounds[e];if(e>0){var n=new ReviewboardGameSectionHeader;n.chineseName=t.chineseName,n.englishName=t.englishName,n.pot=t.pot,n.communityPokers=t.communityPokers,this.scrollerGroup.addChild(n)}var o=new eui.List;o.width=this.width,o.itemRenderer=ReviewboardPlayerActionView,o.dataProvider=new eui.ArrayCollection(t.actions),this.scrollerGroup.addChild(o)}},t.prototype.createSettlementContent=function(){var e=new ReviewboardGameSectionHeader;e.chineseName="结算",e.englishName="Settlement",e.pot=0,this.scrollerGroup.addChild(e);var t=new eui.List;t.width=this.width,t.itemRenderer=ReviewboardGameHistorySettlementItem,t.dataProvider=new eui.ArrayCollection(this.showingPage.settlements),this.scrollerGroup.addChild(t)},t.prototype.createTerminologySpecificContent=function(){var e=new ReviewboardGameSectionHeader;e.chineseName="符号备注",e.englishName="Symbol Memo",e.pot=0,this.scrollerGroup.addChild(e);var t=new ReviewboardTerminologySpecificView;t.setTerminologySpecifics(TerminologySpecificModel.listTerminologySpecifics()),this.scrollerGroup.addChild(t)},t}(eui.Component);__reflect(ReviewboardGameHistoryView.prototype,"ReviewboardGameHistoryView",["IPagePicker"]);var ReviewboardGameSectionHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardGameSectionHeaderSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"chineseName",{set:function(e){this.chineseNameLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"englishName",{set:function(e){this.englishNameLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pot",{set:function(e){return 0===e?void(this.potStackLabel.visible=!1):void(this.potStackLabel.text=String(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"communityPokers",{set:function(e){this.boardPokerList.dataProvider=new eui.ArrayCollection(e)},enumerable:!0,configurable:!0}),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.boardPokerList.itemRenderer=ReviewboardPokerView},t}(eui.Component);__reflect(ReviewboardGameSectionHeader.prototype,"ReviewboardGameSectionHeader");var ReviewboardPlayerActionIcon=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerActionIconSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"backgroundColor",{set:function(e){this.background.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionAbbrSymbol",{set:function(e){this.actionAbbrSymbolLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionValue",{set:function(e){return 0===e?void(this.actionValueLabel.visible=!1):void(this.actionValueLabel.text=String(e))},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ReviewboardPlayerActionIcon.prototype,"ReviewboardPlayerActionIcon");var ReviewboardPlayerActionView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerActionViewSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.setup(this.data)},t.prototype.setup=function(e){this.positionIcon.positionName=e.playerPosition,this.nameLabel.text=e.playerNickname,this.actionIcon.backgroundColor=e.playerAction.backgroundColor,this.actionIcon.actionAbbrSymbol=e.playerAction.abbreviationSymbol,this.actionIcon.actionValue=e.playerActionValue,this.stackLabel.text=String(e.playerStack)},t}(eui.ItemRenderer);__reflect(ReviewboardPlayerActionView.prototype,"ReviewboardPlayerActionView");var ReviewboardPlayerPositionIcon=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerPositionIconSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"positionName",{set:function(e){this.positionLabel.text=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ReviewboardPlayerPositionIcon.prototype,"ReviewboardPlayerPositionIcon");var ReviewboardTerminologySpecificItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTerminologySpecificItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.actionIcon.backgroundColor=this.data.action.backgroundColor,this.actionIcon.actionAbbrSymbol=this.data.action.abbreviationSymbol,this.actionIcon.actionValue=0,this.descriptionLabel.text=this.data.description},t}(eui.ItemRenderer);__reflect(ReviewboardTerminologySpecificItem.prototype,"ReviewboardTerminologySpecificItem");var ReviewboardTerminologySpecificView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTerminologySpecificSkin",t}return __extends(t,e),t.prototype.setTerminologySpecifics=function(e){this.terminologySpecificList.itemRenderer=ReviewboardTerminologySpecificItem,this.terminologySpecificList.dataProvider=new eui.ArrayCollection(e)},t}(eui.Component);__reflect(ReviewboardTerminologySpecificView.prototype,"ReviewboardTerminologySpecificView");var ReviewboardSettlementHistoryView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSettlementHistorySkin",t}return __extends(t,e),t.prototype.setup=function(e){this.reviewboardModel=e,this.showingPage=e.currentPage,this.updateContent()},t.prototype.pickPageAtIndex=function(e){this.reviewboardModel.currentPageIndex=e,this.showingPage=this.reviewboardModel.currentPage,this.updateContent()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.settlementList.itemRenderer=ReviewboardSettlementItem},t.prototype.updateContent=function(){if(this.showingPage){this.settlementList.dataProvider=new eui.ArrayCollection(this.showingPage.settlements);var e=new ReviewboardEvent(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE);e.potValue=this.showingPage.pot,e.dateString=this.showingPage.startAtString,EventCenter.sharedInstance().dispatchEvent(e)}},t}(eui.Component);__reflect(ReviewboardSettlementHistoryView.prototype,"ReviewboardSettlementHistoryView",["IPagePicker"]);var ReviewboardSettlementItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSettlementItemSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.holePokerList.itemRenderer=ReviewboardPokerView,this.communityPokerList.itemRenderer=ReviewboardPokerView},t.prototype.dataChanged=function(){this.playerNameLabel.text=this.data.playerName,this.playerFoldLabel.text=this.data.foldInfoText,this.holePokerList.dataProvider=new eui.ArrayCollection(this.data.holePokers),this.communityPokerList.dataProvider=new eui.ArrayCollection(this.data.communityPokers),this.playerAvatarImage.loadUrlSource(AvatarURLFactory.makeById(this.data.playerId)),this.playerSettlementLabel.text=this.data.playerSettlementString,this.playerSettlementLabel.textColor=this.data.playerSettlementTextColor},t.prototype.setPlayerAvatarUrl=function(e){},t}(eui.ItemRenderer);__reflect(ReviewboardSettlementItem.prototype,"ReviewboardSettlementItem");var LaunchScene=function(e){function t(){var t=e.call(this)||this;return t.isJoinMyRoom=!1,t.skinName="LaunchSkin",t.userModel=UserModel.sharedInstance(),t.addNativeMessageListener(),t.postMessageToNative(),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Device.sharedInstance().isInReactNative()&&(this.buttonGroup.visible=!1,this.displayLabel.y=1e3),this.loginButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLoginButtonTouch,this),this.visitorButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onVisitorButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),EventCenter.sharedInstance().addEventListener(SceneEvent.LeaveFromGame,this.onLeaveFromGame,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this)},t.prototype.connectWebSocket=function(){var e="Authorization=Bearer "+this.userModel.loginInfo.auth.accessToken,t=ApiConfig.WebSocketDomain+"/"+ApiConfig.Version_1+"/websocket/?"+e;WebSocketRequest.sharedInstance().connect(t)},t.prototype.addNativeMessageListener=function(){var e=this;window.document.addEventListener("message",function(t){var n=JSON.parse(t.data);if("query_user_data"===n.command){var o=JSON.parse(n.payload);e.userModel.loginInfo=new LoginInfo(o),e.connectWebSocket()}else"query_pin"===n.command?n.payload.pin?(e.pin=n.payload.pin,e.isJoinMyRoom=!1):e.isJoinMyRoom=!0:"query_club_info"===n.command&&(e.userModel.clubInfo=new ClubInfo(n.payload))})},t.prototype.postMessageToNative=function(){window.postMessage(JSON.stringify({command:"query_user_data"}),"*"),window.postMessage(JSON.stringify({command:"query_pin"}),"*"),window.postMessage(JSON.stringify({command:"query_club_info"}),"*")},t.prototype.onLeaveFromGame=function(){MessageAlert.show("您已离开房间")},t.prototype.onLoginButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e=new InputPhoneNumberView;SceneManager.sharedInstance().pushScene(e),e.addEventListener(InputViewEvent.InputComplete,this.onPhoneNumberInputComplete,this)},t.prototype.onVisitorButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.loginByVisitor()},t.prototype.loginByVisitor=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:LoadingComponent.sharedInstance().show(this,"游客登录中..."),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.userModel.loginByVisitor()];case 2:return e=n.sent(),this.userModel.loginInfo=new LoginInfo(e.result),this.connectWebSocket(),[3,4];case 3:return t=n.sent(),LoadingComponent.sharedInstance().hide(),MessageAlert.show(t.message),[3,4];case 4:return[2]}})})},t.prototype.onPhoneNumberInputComplete=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:this.userModel.phoneNumber=e.data,LoadingComponent.sharedInstance().show(this,"请稍后, 正在发送验证码..."),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber)];case 2:return t=o.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(t.result),this.showInputVerificationcodeView(e.data),[3,5];case 3:return n=o.sent(),MessageAlert.show(n.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.showInputVerificationcodeView=function(e){var t=new InputVerificationCodeView;t.setPhoneNumber(e),t.addEventListener(InputViewEvent.InputComplete,this.onVerficationCodeInputComplete,this),t.addEventListener(InputViewEvent.Regain,this.requestVerificationCode,this),SceneManager.sharedInstance().pushScene(t)},t.prototype.onVerficationCodeInputComplete=function(e){var t=e.data;this.login(t)},t.prototype.login=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(i){switch(i.label){case 0:LoadingComponent.sharedInstance().show(this,"正在登录中..."),t={phoneNumber:this.userModel.phoneNumber,verificationCode:e,hashDigest:this.userModel.verificationInfo.hashDigest,expireISOTime:this.userModel.verificationInfo.expireISOTime},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.userModel.login(t)];case 2:return n=i.sent(),this.userModel.loginInfo=new LoginInfo(n.result),this.connectWebSocket(),[3,4];case 3:return o=i.sent(),LoadingComponent.sharedInstance().hide(),MessageAlert.show(o.message),[3,4];case 4:return[2]}})})},t.prototype.requestVerificationCode=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber)];case 1:return e=n.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(e.result),[3,3];case 2:return t=n.sent(),MessageAlert.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.showInputPinView=function(){var e=new InputPinView;SceneManager.sharedInstance().pushScene(e),e.addEventListener(JoinGameEvent.JoinRoom,this.onTouchJoinButton,this),e.addEventListener(JoinGameEvent.JoinMyRoom,this.onTouchMine,this)},t.prototype.connectCentrifuge=function(){this.displayLabel.visible=!0,this.displayLabel.text="正在进入房间..",EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this);var e={url:""+ApiConfig.ApiDomain,info:this.userModel.loginInfo.websocketToken.info,timestamp:this.userModel.loginInfo.websocketToken.timestamp,token:this.userModel.loginInfo.websocketToken.token,user:this.userModel.loginInfo.websocketToken.user,accessToken:this.userModel.loginInfo.auth.accessToken,version:ApiConfig.Version_1};CentrifugeServer.sharedInstance().connect(e);var t="texas#"+this.userModel.loginInfo.user.id;CentrifugeServer.sharedInstance().subscribe(t)},t.prototype.onCentrifugeConnected=function(){this.isJoinMyRoom?this.joinMyRoom():this.joinGameByPin(this.pin)},t.prototype.onCentrifugeConnectionFailed=function(){this.displayLabel.visible=!1,MessageAlert.show("与服务器的连接失败")},t.prototype.joinMyRoom=function(){this.displayLabel.visible=!0,this.displayLabel.text="正在进入房间...",this.userModel.queryMyRoom()},t.prototype.joinGameByPin=function(e){this.userModel.joinRoomByPin(e)},t.prototype.queryInitialScore=function(e){this.userModel.queryInitialScore(e)},t.prototype.handleAlreadyJoinAnotherRoom=function(){this.leaveAndToNewGame()},t.prototype.leaveAndToNewGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.displayLabel.visible=!0,this.displayLabel.text="正在进入房间...",this.userModel.leaveJoinedRoom(),[2]})})},t.prototype.onTouchMine=function(){this.isJoinMyRoom=!0,this.connectCentrifuge()},t.prototype.onTouchJoinButton=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.isJoinMyRoom=!1,this.pin=e.pin,this.connectCentrifuge(),[2]})})},t.prototype.toGameScene=function(e){window.postMessage(JSON.stringify({command:"stop_animation"}),"*");var t=new GameScene;t.init(e),SceneManager.sharedInstance().replaceScene(t)},t.prototype.onConnected=function(){LoadingComponent.sharedInstance().hide(),Device.sharedInstance().isInReactNative()?this.connectCentrifuge():this.showInputPinView()},t.prototype.onClose=function(){LoadingComponent.sharedInstance().show(this,"网络异常, 正在尝试重新连接")},t.prototype.onError=function(){MessageAlert.show("服务器异常, 请稍后重试")},t.prototype.onReceivedMessage=function(e){var t=e.message,n=t.response;if(200!==t.httpStatus)return this.displayLabel.visible=!1,void MessageAlert.show("服务器异常 "+t.requestId+": "+t.httpStatus);if(!n.ok)return this.displayLabel.visible=!1,void(t.requestId===RequestId.JoinRoomByPin&&"already_join_another_room"===n.errorType?this.leaveAndToNewGame():MessageAlert.show(""+t.response.message));switch(t.requestId){case RequestId.LeaveJoinedRoom:this.joinGameByPin(this.pin);break;case RequestId.QueryMyRoom:this.roomData=n.result,this.joinGameByPin(this.roomData.pin);break;case RequestId.JoinRoomByPin:this.roomData=n.result,this.queryInitialScore(this.roomData.id);break;case RequestId.QueryInitialScore:this.userModel.initialScore=n.result.stack||0,this.toGameScene(this.roomData)}},t.prototype.onRemovedFromStage=function(){EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().removeEventListener(SceneEvent.LeaveFromGame,this.onLeaveFromGame,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this)},t}(eui.Component);__reflect(LaunchScene.prototype,"LaunchScene");var JoinGameEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.JoinMyRoom="join_my_room",t.JoinRoom="join_room",t}(egret.Event);__reflect(JoinGameEvent.prototype,"JoinGameEvent");var InputPinView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPinSkin",t}return __extends(t,e),t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.createButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateButtonTouch,this),this.joinButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJoinButtonTouch,this)},t.prototype.onCreateButtonTouch=function(){var e=new JoinGameEvent(JoinGameEvent.JoinMyRoom);this.dispatchEvent(e),this.close()},t.prototype.onJoinButtonTouch=function(){var e=this.pinInput.text;if(e&&9===e.length){var t=new JoinGameEvent(JoinGameEvent.JoinRoom);t.pin=e,this.dispatchEvent(t),this.close()}},t.prototype.onBackgroundTouch=function(){this.parent.removeChild(this)},t}(eui.Component);__reflect(InputPinView.prototype,"InputPinView");var InputPhoneNumberView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPhoneNumberSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t.prototype.onNextButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.phoneNumberInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.phoneNumberInput.text,this.dispatchEvent(e),this.close()}},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(InputPhoneNumberView.prototype,"InputPhoneNumberView");var InputVerificationCodeView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputVerificationCodeSkin",t}return __extends(t,e),t.prototype.setPhoneNumber=function(e){this.phoneNumberLabel.text=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.times=60,this.timer=new egret.Timer(1e3,60),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.start(),this.regainButton.label="60s",this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.regainButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegainButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this)},t.prototype.onConfirmButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.codeInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.codeInput.text,this.dispatchEvent(e),this.close()}},t.prototype.onRegainButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e=new InputViewEvent(InputViewEvent.Regain);this.dispatchEvent(e),this.timer.start(),this.regainButton.label="60s"},t.prototype.onTimer=function(){this.times-=1,this.regainButton.label=this.times+"s",this.regainButton.touchEnabled=!1},t.prototype.onTimerComplete=function(){this.times=60,this.regainButton.touchEnabled=!0,this.regainButton.label="重新获取",this.timer.reset()},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.onRemovedFromStage=function(){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer=void 0},t}(eui.Component);__reflect(InputVerificationCodeView.prototype,"InputVerificationCodeView");var InputViewEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.InputComplete="input_complete",t.Regain="regain",t}(egret.Event);__reflect(InputViewEvent.prototype,"InputViewEvent");var UserModel=function(){function e(){this.request=new HttpRequest}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.requestVerificationCode=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/sms/code",n={application:"laiwan",country_code:"86",phone_number:e};return this.request.post(t,n)},e.prototype.login=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/user/login/web",n={country_code:"86",phone_number:e.phoneNumber,verification_code:e.verificationCode,hash_digest:e.hashDigest,expire_iso_time:e.expireISOTime};return this.request.post(t,n)},e.prototype.loginByVisitor=function(){var e=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/user/register/anonymous";return this.request.post(e)},e.prototype.queryMyRoom=function(){var e="/"+ApiConfig.Version_1+"/texas/room/mine",t={request_id:RequestId.QueryMyRoom,path:e,method:"get",body:null};WebSocketRequest.sharedInstance().sendData(t)},e.prototype.queryJoinedRoom=function(){var e="/"+ApiConfig.Version_1+"/texas/room/joined",t={request_id:RequestId.QueryJoinedRoom,path:e,method:"get",body:null};WebSocketRequest.sharedInstance().sendData(t)},e.prototype.leaveJoinedRoom=function(){var e="/"+ApiConfig.Version_1+"/texas/room/leave",t={request_id:RequestId.LeaveJoinedRoom,path:e,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(t)},e.prototype.joinRoomByPin=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/spectate",n={pin:e},o={request_id:RequestId.JoinRoomByPin,path:t,method:"post",body:n};WebSocketRequest.sharedInstance().sendData(o)},e.prototype.changeRoomPermit=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/change_permit_buy_in",n={request_id:RequestId.ChangePermit,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.queryInitialScore=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/"+e+"/my_chip",n={request_id:RequestId.QueryInitialScore,path:t,method:"get",body:null};WebSocketRequest.sharedInstance().sendData(n)},Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verificationInfo",{get:function(){return this._verificationInfo},set:function(e){this._verificationInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loginInfo",{get:function(){return this._loginInfo},set:function(e){this._loginInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clubInfo",{get:function(){return this._clubInfo},set:function(e){this._clubInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initialScore",{get:function(){return this._initialScore},set:function(e){this._initialScore=e},enumerable:!0,configurable:!0}),e}();__reflect(UserModel.prototype,"UserModel");var AuthInfo=function(){function e(e){this._accessToken=e.access_token,this._expiresIn=e.expires_in,this._refreshToken=e.refresh_token,this._tokenType=e.token_type}return Object.defineProperty(e.prototype,"accessToken",{get:function(){return this._accessToken},set:function(e){this._accessToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiresIn",{get:function(){return this._expiresIn},set:function(e){this._expiresIn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},set:function(e){this._refreshToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenType",{get:function(){return this._tokenType},set:function(e){this._tokenType=e},enumerable:!0,configurable:!0}),e}();__reflect(AuthInfo.prototype,"AuthInfo");var ClubInfo=function(){function e(e){this._clubName=e.club_name,this._roomName=e.room_name}return Object.defineProperty(e.prototype,"clubName",{get:function(){return this._clubName},set:function(e){this._clubName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomName",{get:function(){return this._roomName},set:function(e){this._roomName=e},enumerable:!0,configurable:!0}),e}();__reflect(ClubInfo.prototype,"ClubInfo");var LoginInfo=function(){function e(e){this._user=new UserInfo(e.user),this._auth=new AuthInfo(e.auth),this._websocketToken=new WebsocketTokenInfo(e.websocket_token)}return Object.defineProperty(e.prototype,"user",{get:function(){return this._user},set:function(e){this._user=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auth",{get:function(){return this._auth},set:function(e){this._auth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"websocketToken",{get:function(){return this._websocketToken},set:function(e){this._websocketToken=e},enumerable:!0,configurable:!0}),e}();__reflect(LoginInfo.prototype,"LoginInfo");var MessageInfo=function(){function e(e){this._requestId=e.request_id,this._httpStatus=e.http_status,this._response=new ResponseInfo(e.response)}return Object.defineProperty(e.prototype,"requestId",{get:function(){return this._requestId},set:function(e){this._requestId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpStatus",{get:function(){return this._httpStatus},set:function(e){this._httpStatus=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._response},set:function(e){this._response=e},enumerable:!0,configurable:!0}),e}();__reflect(MessageInfo.prototype,"MessageInfo");var ResponseInfo=function(){function e(e){egret.log(e),this._ok=e.ok,this._message=e.message||e.error_type||e.errors&&e.errors[0].message,this._result=e.result,this._errorType=e.error_type}return Object.defineProperty(e.prototype,"ok",{get:function(){return this._ok},set:function(e){this._ok=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this._result},set:function(e){this._result=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorType",{get:function(){return this._errorType},set:function(e){this._errorType=e},enumerable:!0,configurable:!0}),e}();__reflect(ResponseInfo.prototype,"ResponseInfo");var UserInfo=function(){function e(e){this._id=e.id,this._serviceId=e.service_id,this._nickname=e.nickname,this._gender=e.gender,this._phoneNumber=e.phone_number,this._application=e.application,this._username=e.username}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceId",{get:function(){return this._serviceId
},set:function(e){this._serviceId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gender",{get:function(){return this._gender},set:function(e){this._gender=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._application},set:function(e){this._application=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),e}();__reflect(UserInfo.prototype,"UserInfo");var VerificationCodeInfo=function(){function e(e){this._hashDigest=e.hash_digest,this._expireISOTime=e.expire_iso_time}return Object.defineProperty(e.prototype,"hashDigest",{get:function(){return this._hashDigest},set:function(e){this._hashDigest=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expireISOTime",{get:function(){return this._expireISOTime},set:function(e){this._expireISOTime=e},enumerable:!0,configurable:!0}),e}();__reflect(VerificationCodeInfo.prototype,"VerificationCodeInfo");var WebsocketTokenInfo=function(){function e(e){this._user=e.user,this._timestamp=e.timestamp,this._info=e.info,this._token=e.token,this._userChannel=e.user_channel}return Object.defineProperty(e.prototype,"user",{get:function(){return this._user},set:function(e){this._user=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){this._timestamp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return this._info},set:function(e){this._info=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this._token},set:function(e){this._token=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userChannel",{get:function(){return this._userChannel},set:function(e){this._userChannel=e},enumerable:!0,configurable:!0}),e}();__reflect(WebsocketTokenInfo.prototype,"WebsocketTokenInfo");var CentrifugeServer=function(){function e(){this.isConnected=!1,this.centrifuge=void 0,this.subscription=void 0}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connect=function(e){var t=this;this.centrifuge=new Centrifuge(e),this.centrifuge.on("connect",function(e){t.isConnected=!0;var n=new CentrifugeServerEvent(CentrifugeServerEvent.Connected);EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.on("disconnect",function(e){console.log("on disconnect",e),t.isConnected=!1;var n=new CentrifugeServerEvent(CentrifugeServerEvent.Disconnected);n.data=e,EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.on("error",function(e){console.log("on error",e),t.isConnected=!1;var n=new CentrifugeServerEvent(CentrifugeServerEvent.ConnectionError);EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.connect()},e.prototype.subscribe=function(e){var t={message:function(e){console.log("centrifuge.message"),egret.log(e);var t=new CentrifugeServerEvent(CentrifugeServerEvent.ReceivedMessageFromCentrifuge);t.data=e.data.payload,EventCenter.sharedInstance().dispatchEvent(t)},subscribe:function(e){console.log("centrifuge.subscribe",e)},error:function(e){console.log("centrifuge.error",e)},unsubscribe:function(e){console.log("centrifuge.unsubscribe",e)}};this.subscription=this.centrifuge.subscribe(e,t)},e.prototype.unsubscribe=function(){this.subscription.unsubscribe()},e.prototype.discoonect=function(){this.isConnected=!1,this.centrifuge.disconnect()},e}();__reflect(CentrifugeServer.prototype,"CentrifugeServer");var ActionUtil=function(){function e(){}return e.getActionMessage=function(e){var t="";switch(e){case GameAction.Fold:t=ActionMessage.Fold;break;case GameAction.Check:t=ActionMessage.Check;break;case GameAction.Call:t=ActionMessage.Call;break;case GameAction.Raise:t=ActionMessage.Raise;break;case GameAction.AllIn:t=ActionMessage.AllIn}return t},e.updateSource=function(e,t){var n="icon_player_"+t+"_png";e.updateSource(n)},e}();__reflect(ActionUtil.prototype,"ActionUtil");var AnimationUtil=function(){function e(){}return e.loopPlay=function(e,t){if(void 0===t&&(t=!0),t)for(var n in e.items)e.items[n]&&(e.items[n].props={loop:!0});e.play()},e}();__reflect(AnimationUtil.prototype,"AnimationUtil");var AvatarURLFactory=function(){function e(){}return e.makeById=function(e){return ApiConfig.MediaDomain+"/avatar/user/"+e+".jpg"},e}();__reflect(AvatarURLFactory.prototype,"AvatarURLFactory");var Color=function(){function e(){}return e.white=16777215,e.gray=10663861,e}();__reflect(Color.prototype,"Color");var Constants=function(){function e(){}return e.iPhoneX_TOP_MARGIN=44,e.iPhoneX_BOTTOM_MARGIN=34,e}();__reflect(Constants.prototype,"Constants");var Device=function(){function e(){}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.isInReactNative=function(){return this.platform?"react_native"===this.platform:!1},e.prototype.isIphoneX=function(){return this.screenSize?this.screenSize.height>800:!1},e.prototype.getScreenWidth=function(){return this.screenSize.width},e.prototype.getScreenHeight=function(){return this.screenSize.height},e.prototype.setPlatform=function(e){this._platform=e},e.prototype.setScreenSize=function(e){this._screenSize=e},Object.defineProperty(e.prototype,"platform",{get:function(){return this._platform},set:function(e){this._platform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenSize",{get:function(){return this._screenSize},set:function(e){this._screenSize=e},enumerable:!0,configurable:!0}),e}();__reflect(Device.prototype,"Device");var HttpRequest=function(){function e(){}return e.prototype.get=function(e,t,n){var o=this;return new Promise(function(i,r){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT;var s=t?o.buildParams(t):"",c=""+e+s;a.open(c,egret.HttpMethod.GET);for(var u in n)n[u]&&a.setRequestHeader(u,n[u]);a.send(),a.once(egret.Event.COMPLETE,function(e){var t=JSON.parse(e.currentTarget.response),n=new ResponseInfo(t);n.ok?i(n):r(n)},o),a.once(egret.IOErrorEvent.IO_ERROR,function(e){r(new Error("服务器异常, 请稍后再试"))},o)})},e.prototype.post=function(e,t,n){var o=this;return new Promise(function(i,r){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT;var s=t?o.buildBody(t):"{}";a.open(e,egret.HttpMethod.POST);for(var c in n)n[c]&&a.setRequestHeader(c,n[c]);a.send(s),a.once(egret.Event.COMPLETE,function(e){var t=JSON.parse(e.currentTarget.response),n=new ResponseInfo(t);n.ok?i(n):r(n)},o),a.once(egret.IOErrorEvent.IO_ERROR,function(e){r(new Error("服务器异常, 请稍后再试"))},o)})},e.prototype.buildHeaderWithToken=function(e){var t={Authorization:"Bearer "+e};return t},e.prototype.buildParams=function(e){var t="?";for(var n in e)e[n]&&(t+=n+"="+e[n]+"&");return t.length>0&&(t=t.substring(0,t.length-1)),t},e.prototype.buildBody=function(e){var t=JSON.stringify(e);return t},e}();__reflect(HttpRequest.prototype,"HttpRequest");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var MoneyFormatter=function(){function e(){}return e.addChineseUnit=function(e){var t="",n=1e4;if(n>e)t=""+e;else{var o=new Decimal(e),i=o.div(n).toNumber();t=Math.round(100*i)/100+"万"}return t},e.removeChineseUnit=function(e){var t=0,n=e.indexOf("万"),o=0;if(n>o){var i=new Decimal(e.substring(0,n));t=i.times(1e4).toNumber()}else t=parseInt(e,0);return t},e}();__reflect(MoneyFormatter.prototype,"MoneyFormatter");var PokerAnalyzer=function(){function e(){}return e.getCardTypeByResult=function(e){var t="高牌";switch(e){case CardType.ROYAL_FLUSH:t="皇家同花顺";break;case CardType.STRAIGHT_FLUSH:t="同花顺";break;case CardType.FOUR_OF_A_KIND:t="四条";break;case CardType.FLUSH:t="同花";break;case CardType.FULL_HOUSE:t="葫芦";break;case CardType.STRAIGHT:t="顺子";break;case CardType.THREE_OF_A_KIND:t="三条";break;case CardType.TWO_PAIRS:t="两对";break;case CardType.PAIR:t="一对";break;case CardType.HIGH_CARD:t="高牌"}return t},e.getCardTypeByCard=function(t){var n=e.analyze(t);return this.getCardTypeByResult(n)},e.analyze=function(e){var t=e.sort(function(e,t){return e.value-t.value});return this.isRoyalFlush(t)?CardType.ROYAL_FLUSH:this.isStraightFlush(t)?CardType.STRAIGHT_FLUSH:this.isFourOfAKind(t)?CardType.FOUR_OF_A_KIND:this.isFlush(t)?CardType.FLUSH:this.isFullHouse(t)?CardType.FULL_HOUSE:this.isThreeOfAKind(t)?CardType.THREE_OF_A_KIND:this.isStraight(t)?CardType.STRAIGHT:this.isTwoPair(t)?CardType.TWO_PAIRS:this.isPair(t)?CardType.PAIR:CardType.HIGH_CARD},e.isPair=function(e){for(var t=0;t<e.length-1;t+=1)if(e[t].value===e[t+1].value)return!0;return!1},e.isTwoPair=function(e){for(var t=!1,n=0;n<e.length-1;n+=1)if(e[n].value===e[n+1].value){if(t)return!0;n++,t=!0}},e.isThreeOfAKind=function(e){for(var t=0;t<e.length-2;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value)return!0;return!1},e.isFourOfAKind=function(e){for(var t=0;t<e.length-3;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value&&e[t+2].value===e[t+3].value)return!0;return!1},e.isFullHouse=function(e){for(var t=0;t<e.length-2;t++)if(e[t].value==e[t+1].value&&e[t].value==e[t+2].value)for(var n=0;n<e.length-1;n++)if(e[t].value!=e[n].value&&e[n].value==e[n+1].value)return!0;return!1},e.isStraight=function(e){for(var t=0,n=[e[t]];t<e.length&&n.length<5;){for(var o=t+1;o<e.length&&e[t].value===e[o].value;)o+=1;if(o>=e.length)return!1;e[t].value+1===e[o].value?n.push(e[o]):n=[e[o]],t=o}return n.length>=5},e.isFlush=function(e){for(var t=[0,0,0,0],n=0;n<e.length;n+=1)t[e[n].suit]+=1;for(var o=0;o<t.length;o+=1)if(t[o]>=5)return!0;return!1},e.isStraightFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.isRoyalFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value===CardValue.Ten&&t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.getFlushCards=function(e){for(var t=[],n=[0,0,0,0],o=0;o<e.length;o+=1)n[e[o].suit]+=1;for(var i=CardSuit.Error,r=0;r<n.length;r+=1)if(n[r]>=5){i=r;break}if(i===CardSuit.Error)return t;for(var o=0;o<e.length;o+=1)e[o].suit===i&&t.push(e[o]);return t},e}();__reflect(PokerAnalyzer.prototype,"PokerAnalyzer");var SceneManager=function(){function e(){this.sceneStack=[]}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.init=function(e){this.baseScene||(this.baseScene=e)},e.prototype.replaceScene=function(e){this.baseScene&&(this.baseScene.removeChildren(),this.baseScene.addChild(e))},e.prototype.pushScene=function(e){this.baseScene&&(this.baseScene.addChild(e),this.sceneStack.push(e))},e.prototype.popScene=function(){if(this.baseScene){var e=this.sceneStack.length;if(e>0){var t=this.sceneStack[e-1];t.parent===this.baseScene&&(this.baseScene.removeChild(t),this.sceneStack.splice(e-1,1))}}},e}();__reflect(SceneManager.prototype,"SceneManager");var SeatUtil=function(){function e(){}return e.calculateSeat=function(e,t,n){var o=(e-t+n)%n;return o=0!==o?o:n},e.findCoordinate=function(e){void 0===e&&(e=0);var t=e-1,n=Object.keys(Coordinate)[t],o=Coordinate[n];return o},e.TOTAL_PLAYER_AMOUNT=9,e}();__reflect(SeatUtil.prototype,"SeatUtil");var SoundManager=function(){function e(){this.IS_PLAY_BACKGROUN_SOUND_KEY="isPlayBackgroundSound",this.IS_PLAY_EFFECT_SOUND_KEY="isPlayEffectSound",this.BACKGROUND_SOUND_VOLUME_KEY="backgroundSoundVolume",this.EFFECT_SOUND_VOLUME_KEY="effectSoundVolume",this.DEFAULT_VOLUME="1",this.MUSIC_START_TIME=0,this.backgroundSounds={},this.backgroundSoundChannels={},this.effectSounds={},this.effectSoundChannels={}}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.setIsPlayBackgroundSound=function(e){egret.localStorage.setItem(this.IS_PLAY_BACKGROUN_SOUND_KEY,e.toString()),e?this.playBackgroundSound(this.currentSoundFileSource):this.stopPlayBackgroundSound()},e.prototype.isPlayBackgroundSound=function(){var e=egret.localStorage.getItem(this.IS_PLAY_BACKGROUN_SOUND_KEY);return e?"true"===e:!0},e.prototype.setIsPlayEffectSound=function(e){egret.localStorage.setItem(this.IS_PLAY_EFFECT_SOUND_KEY,e.toString())},e.prototype.isPlayEffectSound=function(){var e=egret.localStorage.getItem(this.IS_PLAY_EFFECT_SOUND_KEY);return e?"true"===e:!0},e.prototype.setBgSoundVolume=function(e){var t=new Decimal(e).div(100);for(var n in this.backgroundSoundChannels)this.backgroundSoundChannels[n]&&(this.backgroundSoundChannels[n].volume=t);egret.localStorage.setItem(this.BACKGROUND_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedBgSoundVolume=function(){var e=egret.localStorage.getItem(this.BACKGROUND_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return new Decimal(e)},e.prototype.setEffectSoundVolume=function(e){var t=new Decimal(e).div(100);egret.localStorage.setItem(this.EFFECT_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedEffectSoundVolume=function(){var e=egret.localStorage.getItem(this.EFFECT_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return new Decimal(e)},e.prototype.playBackgroundSound=function(e,t){void 0===t&&(t=0),this.currentSoundFileSource=e;var n=1===Object.keys(this.backgroundSounds).length;if(this.isPlayBackgroundSound()&&!n){var o=RES.getRes(e);this.backgroundSounds[e]=o;var i=o.play(this.MUSIC_START_TIME,t);i.volume=this.getCachedBgSoundVolume(),this.backgroundSoundChannels[o.hashCode.toString()]=i}},e.prototype.stopPlayBackgroundSound=function(){for(var e in this.backgroundSoundChannels)this.backgroundSoundChannels[e]&&(this.backgroundSoundChannels[e].stop(),delete this.backgroundSoundChannels[e]);for(var t in this.backgroundSounds)this.backgroundSounds[t]&&delete this.backgroundSounds[t]},e.prototype.playEffectSound=function(e,t){if(void 0===t&&(t=1),this.isPlayEffectSound()){var n=RES.getRes(e);this.effectSounds[e]=n;var o=n.play(this.MUSIC_START_TIME,t);o.volume=this.getCachedEffectSoundVolume(),this.effectSoundChannels[n.hashCode.toString()]=o}},e.prototype.stopPlayEffectSound=function(e){var t=this.effectSounds[e];if(t){var n=this.effectSoundChannels[t.hashCode.toString()];n.stop(),delete this.effectSounds[e],delete this.effectSoundChannels[t.hashCode.toString()]}},e.prototype.getPlayingSoundFileSource=function(){return this.currentSoundFileSource},e}();__reflect(SoundManager.prototype,"SoundManager");var WebSocketRequest=function(){function e(){}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connect=function(e){this.url=e,this.socket=new egret.WebSocket,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceivedMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connectByUrl(e)},e.prototype.sendData=function(e){this.socket.writeUTF(JSON.stringify(e))},e.prototype.isDataValid=function(e){return void 0!==e.http_status&&void 0!==e.request_id?!0:!1},e.prototype.onReceivedMessage=function(){var e=this.socket.readUTF();egret.log("websocket消息",e);var t=JSON.parse(e);if(this.isDataValid(t)){var n=new MessageInfo(t),o=new WebSocketEvent(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS);o.message=n,EventCenter.sharedInstance().dispatchEvent(o)}},e.prototype.onConnect=function(){egret.log("连接成功");var e=new WebSocketEvent(WebSocketEvent.CONNECTED);EventCenter.sharedInstance().dispatchEvent(e)},e.prototype.onClose=function(){egret.log("连接关闭"),this.socket.connectByUrl(this.url);var e=new WebSocketEvent(WebSocketEvent.CLOSE);EventCenter.sharedInstance().dispatchEvent(e)},e.prototype.onSocketError=function(){egret.log("连接出错");var e=new WebSocketEvent(WebSocketEvent.ERROR);EventCenter.sharedInstance().dispatchEvent(e)},e}();__reflect(WebSocketRequest.prototype,"WebSocketRequest");