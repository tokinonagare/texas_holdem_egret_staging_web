var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o["throw"](e))}catch(t){i(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(o){n=[6,o],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Direction={Top:"top",Left:"left",Bottom:"bottom",Right:"right",LeftTop:"left_top",LeftBottom:"left_bottom",RightTop:"right_top",RightBottom:"right_bottom"},ResponseInfo=function(){function e(e){egret.log(e),this._ok=e.ok,this._message=e.message||e.error_type||e.errors&&e.errors[0].message,this._result=e.result}return Object.defineProperty(e.prototype,"ok",{get:function(){return this._ok},set:function(e){this._ok=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this._result},set:function(e){this._result=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e},enumerable:!0,configurable:!0}),e}();__reflect(ResponseInfo.prototype,"ResponseInfo");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),MessageAlert.init(this),this.createScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("loading")];case 3:return n.sent(),e=new LoadingScene,this.stage.addChild(e),[4,RES.loadGroup("preload",0,e)];case 4:return n.sent(),this.stage.removeChild(e),[3,6];case 5:return t=n.sent(),console.error(t),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.onCentrifugeConnected=function(){LoadingComponent.sharedInstance().hide()},t.prototype.onCentrifugeDisconnected=function(){LoadingComponent.sharedInstance().show(this,"网络异常, 正在努力重连中...")},t.prototype.createScene=function(){SceneManager.sharedInstance().init(this),SceneManager.sharedInstance().pushScene(new LaunchScene),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function r(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(o,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LoadingComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingComponentSkin",t}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.show=function(e,t){void 0===t&&(t="努力加载中..."),this.labelDisplay.text=t,e.addChild(this),AnimationUtil.loopPlay(this.loadingTween)},t.prototype.updateMessage=function(e){this.labelDisplay.text=e},t.prototype.hide=function(){this.parent&&(this.loadingTween.stop(),this.parent.removeChild(this))},t}(eui.Component);__reflect(LoadingComponent.prototype,"LoadingComponent");var MessageAlert=function(){function e(){}return e.init=function(e){this.container=e},e.show=function(e){var t=new MessageAlertComponent;t.setMessage(e),this.container.addChild(t)},e}();__reflect(MessageAlert.prototype,"MessageAlert");var MessageAlertComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageAlertSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.setMessage=function(e){this.messageLabel.text=e},t.prototype.onConfirmButtonTouch=function(){this.parent.removeChild(this)},t}(eui.Component);__reflect(MessageAlertComponent.prototype,"MessageAlertComponent");var ApiConfig={Domain:"https://api.shafayouxi.org",Version_1:"v1"},CardSuit;!function(e){e[e.Error=-1]="Error",e[e.Spade=0]="Spade",e[e.Heart=1]="Heart",e[e.Club=2]="Club",e[e.Diamond=3]="Diamond"}(CardSuit||(CardSuit={}));var CardType={HIGH_CARD:"high_card",PAIR:"pair",TWO_PAIRS:"two_pairs",THREE_OF_A_KIND:"three_of_a_kind",STRAIGHT:"straight",FLUSH:"flush",FULL_HOUSE:"full_house",FOUR_OF_A_KIND:"four_of_a_kind",STRAIGHT_FLUSH:"straight_flush",ROYAL_FLUSH:"royal_flush"},CardValue;!function(e){e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.J=11]="J",e[e.Q=12]="Q",e[e.K=13]="K",e[e.A=14]="A",e[e.Error=15]="Error"}(CardValue||(CardValue={}));var Coordinate={bottomPlayer:{x:305,y:950,direction:Direction.Bottom,seat:1},leftBottomPlayer:{x:12,y:382,direction:Direction.LeftBottom,seat:2},leftTopPlayer:{x:12,y:116,direction:Direction.LeftTop,seat:3},topPlayer:{x:305,y:25,direction:Direction.Top,seat:4},rightTopPlayer:{x:600,y:116,direction:Direction.RightTop,seat:5},rightBottomPlayer:{x:600,y:382,direction:Direction.RightBottom,seat:6}},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameState={Waiting:"waiting",Preflop:"preflop",Flop:"flop",Turn:"turn",River:"river",Finish:"finish"},RoomStatus={Waiting:"waiting",Gaming:"gaming"},SoundEffectSource={Click:"uiclick_mp3",AddChips:"addchips_mp3",AllIn:"allin_mp3",Bet:"bet_mp3",BetClick:"bet_click_mp3",Check:"check_mp3",ChipToPlayers:"chiptoplayers_mp3",ChipToPool:"chiptopool_mp3",FaPai:"fapai_mp3",FaPai3:"fapai3_mp3",Fold:"fold_mp3",Alarm:"g_alarm_mp3",MoveChips:"movechips_mp3",Notice:"notice_mp3",PlayerEnter:"user_enter_mp3"},ActionMessage={Call:"跟注",Check:"让牌",Raise:"加注",AllIn:"全下",Fold:"弃牌"},CentrifugeServerEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.Connected="server_connected",t.Disconnected="server_disconnected",t.ReceivedMessage="received_message",t.ConnectionError="connection_error",t}(egret.Event);__reflect(CentrifugeServerEvent.prototype,"CentrifugeServerEvent");var EventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t}(egret.EventDispatcher);__reflect(EventCenter.prototype,"EventCenter");var LaunchEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.LoginSuccess="login_success",t}(egret.Event);__reflect(LaunchEvent.prototype,"LaunchEvent");var SceneEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.LeaveFromGame="leave_from_game",t}(egret.Event);__reflect(SceneEvent.prototype,"SceneEvent");var GameScene=function(e){function t(){var t=e.call(this)||this;return t.playerViews=[],t.handCards=[],t.skinName="GameSkin",t}return __extends(t,e),t.prototype.init=function(e){this.playerModel=new PlayerModel,this.gameModel=new GameModel,this.gameData=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Device.sharedInstance().isIphoneX()&&(this.closeButton.y+=20),this.chatComponent=new ChatComponent,this.addChild(this.chatComponent),this.communityCardList.itemRenderer=CommunityCardItemRenderer,this.addEventListeners(),this.gameModel.handleRoomData(this.gameData),this.pinLabel.text="房间号: "+this.gameModel.getRoomPin(),this.cardTypeLabel.text=" "},t.prototype.buildGame=function(e){var t=this,n=e.players;n.forEach(function(e){var n=t.playerViews.findIndex(function(t){return t.isPlayerIdEqualTo(e.id)});-1!==n?t.playerViews[n].bindPlayer(e):t.createNewPlayerView(e)}),e.activePlayer&&this.switchPlayer(e.activePlayer.id,e.activePlayer.legalActions),e.dealer&&this.allotMark(e.dealer.id,e.smallBlind.id,e.bigBlind.id),this.updateAllPots(e.pots,e.mainPot),this.communityCardList.dataProvider=new eui.ArrayCollection(e.cards),e.status===RoomStatus.Waiting&&this.gameModel.localPlayerId===this.gameModel.creatorId&&this.gameModel.currentPlayerAmount>1&&this.showStartButton()},t.prototype.handleGameStart=function(e){this.touchChildren=!1,this.updateMainPot(e.mainPot),this.allotMark(e.dealer.id,e.smallBlind.id,e.bigBlind.id),this.betBlinds(e.smallBlind,e.bigBlind)},t.prototype.handleDealCards=function(e){var t=this,n=e.cards||[];this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByCard(n),this.startGameButton.visible=!1;var o=1790;this.dealCard(n[0],o);var r=new egret.Timer(100*this.playerViews.length,1);r.addEventListener(egret.TimerEvent.TIMER,function(){o=1810;var e=10;t.dealCard(n[1],o,e)},this),r.start(),r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){t.touchChildren=!0},this)},t.prototype.updateMainPot=function(e){this.mainPotLabel.text="底池: "+e},t.prototype.allotMark=function(e,t,n){this.playerViews.forEach(function(o){return o.isPlayerIdEqualTo(e)?(o.setMark("D"),!0):o.isPlayerIdEqualTo(t)?(o.setMark("SB"),!0):o.isPlayerIdEqualTo(n)?(o.setMark("BB"),!0):void 0})},t.prototype.betBlinds=function(e,t){this.playerViews.forEach(function(n){return n.isPlayerIdEqualTo(e.id)?(n.updateScoreboard(e.amount),n.updateStack(e.stack),!0):n.isPlayerIdEqualTo(t.id)?(n.updateScoreboard(t.amount),n.updateStack(t.stack),!0):void 0})},t.prototype.dealCard=function(e,t,n){var o=this;void 0===n&&(n=0),this.playerViews.forEach(function(r,i){var a=new HandCardImage({coordinate:r.getCoordinate(),cardName:e?e.name:"",rotation:t,additionX:n});o.handCards.push(a),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.FaPai3),o.addChild(a)})},t.prototype.showStartButton=function(){this.startGameButton.visible=!0},t.prototype.handleDraw=function(e){this.playerViews.forEach(function(e){e.removeScoreboard(),e.removeStatusLabel()}),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.FaPai);var t=this.gameModel.localPlayerCards.concat(e.cards);this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByCard(t),this.communityCardList.dataProvider=new eui.ArrayCollection(e.cards)},t.prototype.checkTimeout=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.playerModel.checkTimeout(this.gameModel.gameId)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),egret.log(e.message),[3,3];case 3:return[2]}})})},t.prototype.onPlayerTimerEnd=function(e){var t=this;setTimeout(function(){t.checkTimeout()},3e3)},t.prototype.createNewPlayerView=function(e){var t=new PlayerView;t.bindPlayer(e),t.addEventListener(PlayerViewEvent.TimerEnd,this.onPlayerTimerEnd,this),this.playerViews.push(t),this.addChild(t)},t.prototype.hasNewPlayerJoin=function(e){this.gameModel.currentPlayerAmount>1&&this.gameModel.localPlayerId===this.gameModel.creatorId&&this.showStartButton(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.PlayerEnter),this.createNewPlayerView(e.newPlayer)},t.prototype.hasPlayerLeave=function(e){var t=this;if(e.playerId!==this.gameModel.localPlayerId)this.playerViews.forEach(function(n,o){n.isPlayerIdEqualTo(e.playerId)&&(t.handCards.forEach(function(e,o){e.getCoordinate().direction!==Direction.Bottom&&e.getCoordinate()===n.getCoordinate()&&(t.removeChild(e),t.handCards.splice(o,1))}),t.removeChild(n),t.playerViews.splice(o,1))}),this.gameModel.currentPlayerAmount<2&&(this.startGameButton.visible=!1);else if(Device.sharedInstance().isInReactNative())window.postMessage(JSON.stringify({command:"close_webview"}),"*");else{SceneManager.sharedInstance().replaceScene(new LaunchScene);var n=new SceneEvent(SceneEvent.LeaveFromGame);EventCenter.sharedInstance().dispatchEvent(n)}},t.prototype.switchPlayer=function(e,t){var n=this;this.playerViews.forEach(function(o){o.stopTimer(),o.isPlayerIdEqualTo(e)&&(e===n.gameModel.localPlayerId?(o.removeScoreboard(),o.removeStatusLabel(),n.playGameButtonGroup.show(),n.updateStatusForPlayGameButtonGroup(t)):n.hidePlayGameButtonGroup(),o.startTimer())})},t.prototype.handleSwitchPlayer=function(e){var t=e.playerId;this.switchPlayer(t,e.legalActions)},t.prototype.updateStatusForPlayGameButtonGroup=function(e){e&&(!e.mustAllIn&&e.couldRaise&&this.raiseSelector.updateSliderValue(e.raiseAmount.min,e.raiseAmount.max),this.playGameButtonGroup.updateStatus(e))},t.prototype.hasPlayerCall=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AddChips),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusLabel(ActionMessage.Call))})},t.prototype.hasPlayerRaise=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AddChips),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusLabel(ActionMessage.Raise))})},t.prototype.hasPlayerAllIn=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.AllIn),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusLabel(ActionMessage.AllIn))})},t.prototype.hasPlayerCheck=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Check),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&t.updateStatusLabel(ActionMessage.Check)})},t.prototype.hasPlayerFold=function(e){var t=this;SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Fold),this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(e.playerId)&&(n.showCover(),n.updateStatusLabel(ActionMessage.Fold),t.hidePlayGameButtonGroup(),t.handCards.forEach(function(e,o){e.getCoordinate().direction!==Direction.Bottom&&e.getCoordinate()===n.getCoordinate()&&(t.removeChild(e),t.handCards.splice(o,1))}))})},t.prototype.updateAllPots=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0),this.potsList.dataProvider=new eui.ArrayCollection(e),this.updateMainPot(t)},t.prototype.hasUpdatePots=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ChipToPool),this.updateAllPots(e.pots,e.mainPot)},t.prototype.handleShowdown=function(e){var t=this,n=e.showdownPlayers;n.forEach(function(e){t.playerViews.forEach(function(t){if(t.isPlayerIdEqualTo(e.id)){var n=e.hole_card.map(function(e){return new CardInfo({name:e})}),o=PokerAnalyzer.getCardTypeByResult(e.strength);t.updateStatusLabel(o),t.showCard(n)}})})},t.prototype.reset=function(){var e=this;this.handCards.forEach(function(t){e.removeChild(t)}),this.handCards=[],this.cardTypeLabel.text=" ",this.playerViews.forEach(function(e){e.reset()}),this.communityCardList.dataProvider=new eui.ArrayCollection([]),this.potsList.dataProvider=new eui.ArrayCollection([]),this.hidePlayGameButtonGroup(),this.updateMainPot(0)},t.prototype.ready=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.playerModel.ready()];case 1:return t.sent(),[4,this.playerModel.startGame(this.gameModel.getRoomId())];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),egret.log(e),[3,4];case 4:return[2]}})})},t.prototype.handleGameEnd=function(e){var t=this;SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ChipToPlayers),this.playerViews.forEach(function(t){t.stopTimer(),t.isPlayerIdEqualTo(e.winner.id)&&t.playWinnerAnimation()}),e.playersForStack.forEach(function(e){t.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.id)&&t.updateStack(e.stack)})}),this.resetTimer=setTimeout(function(){t.reset(),t.ready()},3e3)},t.prototype.onCentrifugeConnected=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.playerModel.queryState(this.gameModel.getRoomId())];case 1:return e=n.sent(),this.gameModel.handleRoomData(e.result),[3,3];case 2:return t=n.sent(),MessageAlert.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.onTouchStartButton=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),LoadingComponent.sharedInstance().show(this,"正在请求开始游戏..."),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.playerModel.startGame(this.gameModel.getRoomId())];case 2:return t.sent(),this.startGameButton.visible=!1,[3,5];case 3:return e=t.sent(),MessageAlert.show(e.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.onTouchFold=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.hidePlayGameButtonGroup(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.playerModel.fold(this.gameModel.gameId)];case 2:return e=n.sent(),egret.log("弃牌操作的返回结果"),egret.log(e),[3,4];case 3:return t=n.sent(),egret.log(t),this.playGameButtonGroup.show(),[3,4];case 4:return[2]}})})},t.prototype.onTouchCheck=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.hidePlayGameButtonGroup(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.playerModel.check(this.gameModel.gameId)];case 2:return e=n.sent(),egret.log("过牌操作的返回结果"),egret.log(e),[3,4];case 3:return t=n.sent(),egret.log(t),this.playGameButtonGroup.show(),[3,4];case 4:return[2]}})})},t.prototype.onTouchCall=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.hidePlayGameButtonGroup(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.playerModel.call(this.gameModel.gameId)];case 2:return e=n.sent(),egret.log("跟注操作的返回结果"),egret.log(e),[3,4];case 3:return t=n.sent(),egret.log(t),this.playGameButtonGroup.show(),[3,4];case 4:return[2]}})})},t.prototype.onTouchRaise=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.setChildIndex(this.raiseSelector,-1),this.raiseSelector.show()},t.prototype.onPlayerRaise=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(r){switch(r.label){case 0:this.stopLocalPlayerTimer(),this.hidePlayGameButtonGroup(),r.label=1;case 1:return r.trys.push([1,3,,4]),t=e.data,[4,this.playerModel.raise(this.gameModel.gameId,t)];case 2:return n=r.sent(),egret.log("加注操作的返回结果"),egret.log(n),[3,4];case 3:return o=r.sent(),egret.log(o),this.playGameButtonGroup.show(),[3,4];case 4:return[2]}})})},t.prototype.onPlayerAllIn=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(r){switch(r.label){case 0:SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.stopLocalPlayerTimer(),this.hidePlayGameButtonGroup(),r.label=1;case 1:return r.trys.push([1,3,,4]),t=e.data,[4,this.playerModel.allIn(this.gameModel.gameId,t)];case 2:return n=r.sent(),egret.log("全押操作的返回结果"),egret.log(n),[3,4];case 3:return o=r.sent(),egret.log(o),this.playGameButtonGroup.show(),[3,4];case 4:return egret.log("all in筹码数",e.data),[2]}})})},t.prototype.stopLocalPlayerTimer=function(){var e=this;this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.gameModel.localPlayerId)&&t.stopTimer()})},t.prototype.onTouchCloseButton=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:LoadingComponent.sharedInstance().show(this,"正在离开游戏房间..."),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.playerModel.leave(this.gameModel.localPlayerId)];case 2:return t.sent(),Device.sharedInstance().isInReactNative()?window.postMessage(JSON.stringify({command:"close_webview"}),"*"):(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),SceneManager.sharedInstance().replaceScene(new LaunchScene)),[3,5];case 3:return e=t.sent(),MessageAlert.show(e.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.onTalkButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.setChildIndex(this.chatComponent,-1),this.chatComponent.show()},t.prototype.onMicrophoneButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click)},t.prototype.hidePlayGameButtonGroup=function(){this.playGameButtonGroup.hide(),this.raiseSelector.hide()},t.prototype.addEventListeners=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.talkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTalkButtonTouch,this),this.microphoneButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCloseButton,this),this.startGameButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchStartButton,this),this.raiseSelector.addEventListener(RaiseSelectorEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.addEventListener(RaiseSelectorEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.gameModel.addEventListener(GameEvent.BuildGame,this.buildGame,this),this.gameModel.addEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.addEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.addEventListener(GameEvent.HasNewPlayer,this.hasNewPlayerJoin,this),this.gameModel.addEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.addEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.addEventListener(GameEvent.Call,this.hasPlayerCall,this),this.gameModel.addEventListener(GameEvent.AllIn,this.hasPlayerAllIn,this),this.gameModel.addEventListener(GameEvent.Raise,this.hasPlayerRaise,this),this.gameModel.addEventListener(GameEvent.Check,this.hasPlayerCheck,this),this.gameModel.addEventListener(GameEvent.Fold,this.hasPlayerFold,this),this.gameModel.addEventListener(GameEvent.UpdatePots,this.hasUpdatePots,this),this.gameModel.addEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.addEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.addEventListener(GameEvent.HasPlayerLeave,this.hasPlayerLeave,this),this.gameModel.addMessageListener()},t.prototype.onRemovedFromStage=function(){this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),CentrifugeServer.sharedInstance().unsubscribe(),CentrifugeServer.sharedInstance().discoonect(),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.talkButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTalkButtonTouch,this),this.microphoneButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.closeButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCloseButton,this),this.startGameButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchStartButton,this),this.raiseSelector.removeEventListener(RaiseSelectorEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.removeEventListener(RaiseSelectorEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.gameModel.removeEventListener(GameEvent.BuildGame,this.buildGame,this),this.gameModel.removeEventListener(GameEvent.HasNewPlayer,this.hasNewPlayerJoin,this),this.gameModel.removeEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.removeEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.removeEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.removeEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.removeEventListener(GameEvent.Call,this.hasPlayerCall,this),this.gameModel.removeEventListener(GameEvent.AllIn,this.hasPlayerAllIn,this),this.gameModel.removeEventListener(GameEvent.Raise,this.hasPlayerRaise,this),this.gameModel.removeEventListener(GameEvent.Check,this.hasPlayerCheck,this),this.gameModel.removeEventListener(GameEvent.Fold,this.hasPlayerFold,this),this.gameModel.removeEventListener(GameEvent.UpdatePots,this.hasUpdatePots,this),this.gameModel.removeEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.removeEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.removeEventListener(GameEvent.HasPlayerLeave,this.hasPlayerLeave,this),this.gameModel.removeMessageListener()},t}(eui.Component);__reflect(GameScene.prototype,"GameScene");var GameAction={JoinGame:"join_room",StartGame:"start_game",DealCards:"deal_cards",Flop:"flop",Turn:"turn",River:"river",Switch:"switch_player",Call:"call",Raise:"raise",AllIn:"all_in",Fold:"fold",UpdatePots:"update_pots",Check:"check",Showdown:"showdown",EndGame:"end_game",LeaveRoom:"leave_room"},ButtonGroupEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.TouchFold="touch_fold",t.TouchCheck="touch_check",t.TouchCall="touch_call",t.TouchRaise="touch_raise",t.TouchAllIn="touch_all_in",t}(egret.Event);__reflect(ButtonGroupEvent.prototype,"ButtonGroupEvent");var GameEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.BuildGame="build_game",t.HasNewPlayer="has_new_player",t.GameStart="game_start",t.DealCards="deal_cards",t.SwitchPlayer="switch_player",t.Call="call",t.AllIn="all_in",t.Fold="fold",t.UpdatePots="update_pots",t.Check="check",t.Raise="raise",t.Showdown="showdown",t.EndGame="end_game",t.HasPlayerLeave="has_player_leave",t.Flop="flop",t.Turn="turn",t.River="river",t.Draw="draw",t.ShowStartButton="show_start_button",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var PlayerViewEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.TimerEnd="timer_end",t}(egret.Event);__reflect(PlayerViewEvent.prototype,"PlayerViewEvent");var RaiseSelectorEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.Raise="raise",t.AllIn="all_in",t}(egret.Event);__reflect(RaiseSelectorEvent.prototype,"RaiseSelectorEvent");var GameModel=function(e){function t(){var t=e.call(this)||this;return t.localPlayerCards=[],t.TOTAL_PLAYER_AMOUNT=6,t.seatDiff=0,t.players=[],t.communityCards=[],t.localPlayerId=UserModel.sharedInstance().loginInfo.user.id,t}return __extends(t,e),t.prototype.handleRoomData=function(e){var t=this;egret.log("游戏数据"),egret.log(e),this.roomData=e;var n=e.players,o=this.sortPlayerSeat(n),r=o.map(function(e){return t.createNewPlayer(e)}),i=new GameEvent(GameEvent.BuildGame);this.creatorId=e.creator.id,i.status=e.status,i.players=r;var a=e.game;a&&(this.gameId=a.id,i.mainPot=a.main_pot,i.pots=a.pots,i.dealer={id:a.dealer_id},i.smallBlind={id:a.small_blind_id},i.bigBlind={id:a.big_blind_id},i.activePlayer=a.active_player?{id:a.active_player.id,legalActions:this.handleLegalActions(a.active_player.legal_actions)}:void 0,i.cards=a.current_shown_cards.map(function(e){return new CardInfo({name:e,isNew:!1})
})),this.currentPlayerAmount=n.length,this.dispatchEvent(i)},t.prototype.getRoomId=function(){return this.roomData.id},t.prototype.getRoomPin=function(){return this.roomData.pin},t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessage,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessage,this.onReceivedMessage,this)},t.prototype.onReceivedMessage=function(e){var t=JSON.parse(JSON.stringify(e.data)),n=t.action,o=t.content;switch(n){case GameAction.JoinGame:this.handleHasPlayerJoinGame(o);break;case GameAction.StartGame:this.handleGameStart(o);break;case GameAction.DealCards:this.handleDealCards(o);break;case GameAction.Flop:this.handleFlop(o);break;case GameAction.Turn:this.handleTurn(o);break;case GameAction.River:this.handleRiver(o);break;case GameAction.Call:this.handleCall(o);break;case GameAction.Check:this.handleCheck(o);break;case GameAction.Fold:this.handleFold(o);break;case GameAction.Raise:this.handleRaise(o);break;case GameAction.AllIn:this.handleAllIn(o);break;case GameAction.UpdatePots:this.handleUpdatePots(o);break;case GameAction.Switch:this.handleSwitch(o);break;case GameAction.Showdown:this.handleShowdown(o);break;case GameAction.EndGame:this.handleEndGame(o);break;case GameAction.LeaveRoom:this.handleHasPlayerLeaveRoom(o)}},t.prototype.handleGameStart=function(e){this.gameId=e.game_id;var t=new GameEvent(GameEvent.GameStart);t.dealer=e.dealer,t.smallBlind=e.small_blind,t.bigBlind=e.big_blind,t.mainPot=e.main_pot,this.dispatchEvent(t)},t.prototype.handleDealCards=function(e){var t=new GameEvent(GameEvent.DealCards),n=e.cards.map(function(e){return new CardInfo({name:e})});this.localPlayerCards=n,t.cards=n,this.dispatchEvent(t)},t.prototype.handleFlop=function(e){this.handleDraw(e)},t.prototype.handleTurn=function(e){this.handleDraw(e,3)},t.prototype.handleRiver=function(e){this.handleDraw(e,4)},t.prototype.handleDraw=function(e,t){void 0===t&&(t=0);var n=e.shown_community_cards;this.communityCards=n.map(function(e){return new CardInfo({isNew:!0,name:e})});for(var o=0;t>o;o+=1)this.communityCards[o].isNew=!1;var r=new GameEvent(GameEvent.Draw);r.cards=this.communityCards,this.dispatchEvent(r)},t.prototype.handleCall=function(e){var t=new GameEvent(GameEvent.Call),n=e.player;t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleRaise=function(e){var t=new GameEvent(GameEvent.Raise),n=e.player;t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleAllIn=function(e){var t=new GameEvent(GameEvent.AllIn),n=e.player;t.amount=n.amount,t.playerId=n.id,t.stack=n.stack,this.dispatchEvent(t)},t.prototype.handleFold=function(e){var t=new GameEvent(GameEvent.Fold),n=e.player;t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleCheck=function(e){var t=new GameEvent(GameEvent.Check),n=e.player;t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleUpdatePots=function(e){var t=new GameEvent(GameEvent.UpdatePots);t.mainPot=e.main_pot,t.pots=e.pots,this.dispatchEvent(t)},t.prototype.handleLegalActions=function(e){var t=void 0;if(e){var n=-1,o=-1,r=-1,i=-1,a=void 0,s=void 0;e.forEach(function(e){e.action===GameAction.Check&&(n=1),e.action===GameAction.Call&&(o=1,s=e.amount),e.action===GameAction.Raise&&(r=1,a=e.amount),e.action===GameAction.AllIn&&(i=1,a=e.amount)});var c=-1!==n,u=-1!==o,h=-1!==r,l=-1!==i;t={couldCheck:c,couldCall:u,couldRaise:h,mustAllIn:l,raiseAmount:a,callAmount:s}}return t},t.prototype.handleSwitch=function(e){var t=new GameEvent(GameEvent.SwitchPlayer);t.playerId=e.player_id;var n=e.legal_actions;t.legalActions=this.handleLegalActions(n),this.dispatchEvent(t)},t.prototype.handleShowdown=function(e){var t=new GameEvent(GameEvent.Showdown);t.showdownPlayers=e.showdown_players,this.dispatchEvent(t)},t.prototype.handleEndGame=function(e){this.communityCards.splice(0,this.communityCards.length);var t=new GameEvent(GameEvent.EndGame);t.winner=e.winner,t.prize=e.prize,t.playersForStack=e.players,this.dispatchEvent(t)},t.prototype.handleHasPlayerJoinGame=function(e){var t=e.player;if(t.id!==this.localPlayerId){var n=this.calculateSeat(t.seat,this.seatDiff,this.TOTAL_PLAYER_AMOUNT);t.seat=n,this.handleNewPlayer(t)}},t.prototype.createNewPlayer=function(e){var t=e.seat-1,n=Object.keys(Coordinate)[t],o=Coordinate[n],r=Object.assign(e,{coordinate:o}),i=new PlayerInfo(r);return this.players.push(i),i},t.prototype.handleNewPlayer=function(e){this.currentPlayerAmount+=1;var t=new GameEvent(GameEvent.HasNewPlayer);t.newPlayer=this.createNewPlayer(e),this.dispatchEvent(t)},t.prototype.handleHasPlayerLeaveRoom=function(e){var t=this;this.currentPlayerAmount-=1,this.players.forEach(function(n,o){e.player_id===n.id&&t.players.splice(o,1)});var n=new GameEvent(GameEvent.HasPlayerLeave);n.playerId=e.player_id,this.dispatchEvent(n)},t.prototype.sortPlayerSeat=function(e){var t=this,n=JSON.parse(JSON.stringify(e)),o=e.find(function(e){return e.id===t.localPlayerId});return o?(this.seatDiff=o.seat-1,0===this.seatDiff?n:n=e.map(function(e){var n=e,o=t.calculateSeat(n.seat,t.seatDiff,t.TOTAL_PLAYER_AMOUNT);return n.seat=o,n})):n},t.prototype.calculateSeat=function(e,t,n){var o=(e-t+n)%n;return o=0!==o?o:n},t}(egret.EventDispatcher);__reflect(GameModel.prototype,"GameModel");var PlayerModel=function(){function e(){this.request=new HttpRequest}return e.prototype.startGame=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room/start",n={room_id:e},o=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,n,o)},e.prototype.queryState=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room/"+e,n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.get(t,{},n)},e.prototype.ready=function(){var e=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room/ready",t=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(e,{},t)},e.prototype.call=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/call",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,{},n)},e.prototype.raise=function(e,t){var n=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/raise",o={amount:t},r=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(n,o,r)},e.prototype.check=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/check",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,{},n)},e.prototype.allIn=function(e,t){var n=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/all_in",o={amount:t},r=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(n,o,r)},e.prototype.fold=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/fold",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,{},n)},e.prototype.checkTimeout=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/"+e+"/check_timeout",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,{},n)},e.prototype.leave=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room/leave",n=this.request.buildHeaderWithToken(UserModel.sharedInstance().loginInfo.auth.accessToken);return this.request.post(t,{},n)},e}();__reflect(PlayerModel.prototype,"PlayerModel");var CardInfo=function(){function e(e){this._name=e.name,this._isNew=e.isNew,this.decodeValue(e.name),this.decodeSuit(e.name)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},set:function(e){this._isNew=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suit",{get:function(){return this._suit},set:function(e){this._suit=e},enumerable:!0,configurable:!0}),e.prototype.decodeValue=function(e){var t=e.charAt(0);switch(t){case"2":this._value=CardValue.Two;break;case"3":this._value=CardValue.Three;break;case"4":this._value=CardValue.Four;break;case"5":this._value=CardValue.Five;break;case"6":this._value=CardValue.Six;break;case"7":this._value=CardValue.Seven;break;case"8":this._value=CardValue.Eight;break;case"9":this._value=CardValue.Nine;break;case"t":this._value=CardValue.Ten;break;case"j":this._value=CardValue.J;break;case"q":this._value=CardValue.Q;break;case"k":this._value=CardValue.K;break;case"a":this._value=CardValue.A;break;default:this._value=CardValue.Error}},e.prototype.decodeSuit=function(e){var t=e.slice(-1);switch(t){case"s":this._suit=CardSuit.Spade;break;case"h":this._suit=CardSuit.Heart;break;case"c":this._suit=CardSuit.Club;break;case"d":this._suit=CardSuit.Diamond;break;default:this._suit=CardSuit.Error}},e}();__reflect(CardInfo.prototype,"CardInfo");var PlayerInfo=function(){function e(e){this._coordinate=e.coordinate,this._id=e.id,this._seat=e.seat,this._stack=e.stack||0,this._username=e.username,this._nickname=e.nickname,this._amount=e.amount,this._state=e.state,this._roundAction=e.round_action,this.holeCard=e.hole_card||[]}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seat",{get:function(){return this._seat},set:function(e){this._seat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return this._stack},set:function(e){this._stack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this._coordinate},set:function(e){this._coordinate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundAction",{get:function(){return this._roundAction},set:function(e){this._roundAction=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holeCard",{get:function(){return this._holeCard},set:function(e){this._holeCard=e},enumerable:!0,configurable:!0}),e}();__reflect(PlayerInfo.prototype,"PlayerInfo");var LoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingSkin",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.loadingLabel.text="游戏加载中... "+Math.floor(e/t*100)+"%",this.progressBar.value=Math.floor(e/t*100)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),window.document.addEventListener("message",function(e){var t=JSON.parse(e.data);"query_platform_name"==t.command?Device.sharedInstance().setPlatform(t.payload):"query_screen_size"===t.command&&Device.sharedInstance().setScreenSize(t.payload)}),window.postMessage(JSON.stringify({command:"query_screen_size"}),"*"),window.postMessage(JSON.stringify({command:"query_platform_name"}),"*")},t}(eui.Component);__reflect(LoadingScene.prototype,"LoadingScene",["RES.PromiseTaskReporter"]);var ChatComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatSkin",t.x=-750,t}return __extends(t,e),t.prototype.show=function(){egret.Tween.get(this).to({x:0},500,egret.Ease.sineInOut)},t.prototype.hide=function(){egret.Tween.get(this).to({x:-750},500,egret.Ease.sineInOut)},t.prototype.updateMessage=function(e,t){this.messageList.dataProvider=new eui.ArrayCollection(e);var n=this.scroller.viewport.contentHeight,o=this.scroller.viewport.height-20;this.scroller.validateNow(),n>=o&&(this.scroller.viewport.scrollV=n-o)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.messageList.itemRenderer=ChatItemRenderer,this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this)},t.prototype.onBackgroundTouch=function(){this.hide()},t}(eui.Component);__reflect(ChatComponent.prototype,"ChatComponent");var ChatItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.message=new eui.Label,this.message.width=600,this.message.height+=50,this.addChild(this.message)},t.prototype.dataChanged=function(){this.message.text=""+this.data},t}(eui.ItemRenderer);__reflect(ChatItemRenderer.prototype,"ChatItemRenderer");var CommunityCardItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="CardItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this;this.data.isNew?egret.Tween.get(this.cardImage).to({scaleX:0},100).call(function(){e.cardImage.source="poker_"+e.data.name+"_png",egret.Tween.get(e.cardImage).to({scaleX:1},100)}):this.cardImage.source="poker_"+this.data.name+"_png"},t}(eui.ItemRenderer);__reflect(CommunityCardItemRenderer.prototype,"CommunityCardItemRenderer");var HandCardImage=function(e){function t(t){var n=e.call(this)||this;return n.source="poker_back_png",n.config=t,n}return __extends(t,e),t.prototype.getCoordinate=function(){return this.config.coordinate},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.x=375,this.y=665,this.width=90,this.height=130,this.anchorOffsetX=45,this.anchorOffsetY=65;var n=this.config.coordinate.direction;if(n===Direction.Bottom){var o=0===this.config.additionX?325:425;egret.Tween.get(this).wait(100*this.config.index).to({x:o,y:1220,rotation:1800},500,egret.Ease.quadOut).call(function(){t.config.cardName&&egret.Tween.get(t).to({scaleX:0},100).call(function(){t.source="poker_"+t.config.cardName+"_png",egret.Tween.get(t).to({scaleX:1},100)})})}else{var o=this.config.coordinate.x+130+this.config.additionX,r=this.config.coordinate.y+130;(n===Direction.RightTop||n===Direction.RightBottom)&&(o=this.config.coordinate.x+this.config.additionX);var i=this.config.rotation;egret.Tween.get(this).wait(100*this.config.index).to({x:o,y:r,rotation:i,scaleX:.5,scaleY:.5},300,egret.Ease.quadOut)}},t}(eui.Image);__reflect(HandCardImage.prototype,"HandCardImage");var MarkView=function(e){function t(t,n){var o=e.call(this)||this;return o.skinName="MarkSkin",o.signLabel.text=t,o.initialCoordinate(n),o}return __extends(t,e),t.prototype.initialCoordinate=function(e){var t=e.direction;t===Direction.RightTop?(this.x=-30,this.y=10):t===Direction.RightBottom?(this.x=-30,this.y=160):t===Direction.LeftTop?(this.x=140,this.y=10):(this.x=140,this.y=160)},t}(eui.Component);__reflect(MarkView.prototype,"MarkView");var PlayGameButtonGroup=function(e){function t(){var t=e.call(this)||this;return t.skinName="PlayGameButtonGroupSkin",t}return __extends(t,e),t.prototype.show=function(){this.visible=!0},t.prototype.hide=function(){this.visible=!1},t.prototype.updateStatus=function(e){this.callButton.visible=e.couldCall,this.checkButton.visible=e.couldCheck,this.allInButton.visible=!!e.mustAllIn,this.raiseButton.visible=!e.mustAllIn,this.raiseAmount=e.raiseAmount},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.foldButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldButtonTouch,this),this.checkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckButtonTouch,this),this.callButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCallButtonTouch,this),this.raiseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaiseButtonTouch,this),this.allInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllInButtonTouch,this)},t.prototype.onFoldButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchFold);this.dispatchEvent(e)},t.prototype.onCheckButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCheck);this.dispatchEvent(e)},t.prototype.onCallButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCall);this.dispatchEvent(e)},t.prototype.onRaiseButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchRaise);this.dispatchEvent(e)},t.prototype.onAllInButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchAllIn);e.data=this.raiseAmount,this.dispatchEvent(e)},t}(eui.Component);__reflect(PlayGameButtonGroup.prototype,"PlayGameButtonGroup");var PlayerView=function(e){function t(){var t=e.call(this)||this;return t.angle=0,t.radius=0,t.skinName="PlayerSkin",t}return __extends(t,e),t.prototype.bindPlayer=function(e){this.x=e.coordinate.x,this.y=e.coordinate.y,this.coordinate=e.coordinate,this.playerInfo=e,this.nameLabel.text=e.nickname.substr(0,8),this.scoreLabel.text=""+e.stack,e.roundAction&&this.updateStatusLabel(ActionUtil.getActionMessage(e.roundAction)),e.amount>0&&this.updateScoreboard(e.amount)},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.isPlayerIdEqualTo=function(e){return this.playerInfo.id===e},t.prototype.setMark=function(e){this.mark=new MarkView(e,this.coordinate),this.addChild(this.mark)},t.prototype.updateScoreboard=function(e){void 0===e&&(e=0),this.scoreboard||(this.scoreboard=new ScoreboardView(this.coordinate),this.addChild(this.scoreboard)),this.scoreboard.updateAmount(e)},t.prototype.removeScoreboard=function(){this.scoreboard&&(this.removeChild(this.scoreboard),this.scoreboard=void 0)},t.prototype.updateStack=function(e){void 0===e&&(e=0),this.scoreLabel.text=""+e},t.prototype.updateStatusLabel=function(e){this.statusLabel||(this.statusLabel=new StatusLabel(this.coordinate),this.addChild(this.statusLabel)),ActionUtil.updateColor(this.statusLabel,e),this.statusLabel.updateStatus(e)},t.prototype.removeStatusLabel=function(){this.statusLabel&&(this.removeChild(this.statusLabel),this.statusLabel=void 0)},t.prototype.showCover=function(){this.cover.visible=!0},t.prototype.startTimer=function(){this.progressBorder.visible=!0,this.progressTimer.start()},t.prototype.stopTimer=function(){this.progressBorder.visible=!1,this.angle=0,this.progressTimer.reset()},t.prototype.showCard=function(e){var t=this;e.forEach(function(e,n){var o=new eui.Image;o.width=76,o.height=112,o.y=44,o.x=32*n+16,o.source="poker_back_png",t.addChild(o),egret.Tween.get(o).to({x:16},250).call(function(){o.source="poker_"+e.name+"_png",egret.Tween.get(o).to({x:32*n+16},250).wait(2e3).call(function(){t.removeChild(o)})})})},t.prototype.playWinnerAnimation=function(){this.winnerAnimation.play(0)},t.prototype.reset=function(){this.mark&&(this.removeChild(this.mark),this.mark=void 0),this.removeScoreboard(),this.removeStatusLabel(),this.cover.visible=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.radius=Math.max(this.progressBorder.width,this.progressBorder.height)/2*1.5,this.maskShape=new egret.Shape,this.maskShape.rotation=-90,this.maskShape.x=this.progressBorder.width/2,this.maskShape.y=this.progressBorder.height/2,this.progressBorder.mask=this.maskShape,this.addChild(this.maskShape),this.progressTimer=new egret.Timer(150,100),this.progressTimer.addEventListener(egret.TimerEvent.TIMER,this.drawBoder,this),this.progressTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this)},t.prototype.drawBoder=function(){this.angle+=3.6,this.changeGraphics(this.angle),this.angle=this.angle%360},t.prototype.onTimerComplete=function(){this.progressBorder.visible=!1,this.progressTimer.reset();var e=new PlayerViewEvent(PlayerViewEvent.TimerEnd);e.playerId=this.playerInfo.id,this.dispatchEvent(e)},t.prototype.changeGraphics=function(e){this.maskShape.graphics.clear(),this.maskShape.graphics.beginFill(52224,1),this.maskShape.graphics.lineTo(this.radius,0),this.maskShape.graphics.drawArc(0,0,this.radius,0,e*Math.PI/180,!0),this.maskShape.graphics.lineTo(0,0),this.maskShape.graphics.endFill()},t}(eui.Component);__reflect(PlayerView.prototype,"PlayerView");var RaiseSelector=function(e){function t(){var t=e.call(this)||this;return t.skinName="RaiseSelectorSkin",t}return __extends(t,e),t.prototype.updateSliderValue=function(e,t){this.dashboardButton.label=t.toString(),this.raiseSlider.minimum=e,this.raiseSlider.maximum=t,this.raiseSlider.value=e},t.prototype.show=function(){this.visible=!0},t.prototype.hide=function(){this.visible=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.dashboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDashboardButtonTouch,this)},t.prototype.onBackgroundTouch=function(){this.hide()},t.prototype.onConfirmButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e,t=this.raiseSlider.value;e=new RaiseSelectorEvent(t===this.raiseSlider.maximum?RaiseSelectorEvent.AllIn:RaiseSelectorEvent.Raise),e.data=t,this.dispatchEvent(e),this.hide()},t.prototype.onDashboardButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.raiseSlider.value=1e3},t}(eui.Component);__reflect(RaiseSelector.prototype,"RaiseSelector");var RaiseSlider=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),this.setDashboardValue(t)},t.prototype.setDashboardValue=function(e){this.dashboardLabel.text=e.toString()},t}(eui.VSlider);__reflect(RaiseSlider.prototype,"RaiseSlider");var ScoreboardView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="ScoreboardSkin",n.initialCoordinate(t),n}return __extends(t,e),t.prototype.updateAmount=function(e){this.chipLabel.text=""+e},t.prototype.initialCoordinate=function(e){e.direction===Direction.Top?(this.horizontalCenter=0,this.y=200):e.direction===Direction.LeftTop?(this.x=154,this.y=160):e.direction===Direction.LeftBottom?(this.x=154,this.y=10):e.direction===Direction.RightTop?(this.x=-120,this.y=160):e.direction===Direction.RightBottom?(this.x=-120,this.y=10):e.direction===Direction.Bottom&&(this.horizontalCenter=0,this.y=-40)},t}(eui.Component);__reflect(ScoreboardView.prototype,"ScoreboardView");var StatusLabel=function(e){function t(t){var n=e.call(this)||this;return n.width=100,n.height=30,n.textAlign="center",n.initCoordinate(t),n}return __extends(t,e),t.prototype.updateStatus=function(e){this.text=e},t.prototype.initCoordinate=function(e){e.direction===Direction.Top?(this.horizontalCenter=0,this.y=230):e.direction===Direction.LeftTop?(this.x=154,this.y=120):e.direction===Direction.LeftBottom?(this.x=154,this.y=50):e.direction===Direction.RightTop?(this.x=-120,this.y=120):e.direction===Direction.RightBottom?(this.x=-120,this.y=50):e.direction===Direction.Bottom&&(this.horizontalCenter=0,this.y=-70)},t}(eui.Label);__reflect(StatusLabel.prototype,"StatusLabel");var LaunchScene=function(e){function t(){var t=e.call(this)||this;return t.isCreateGame=!1,t.skinName="LaunchSkin",t.userModel=UserModel.sharedInstance(),t.addNativeMessageListener(),t.postMessageToNative(),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Device.sharedInstance().isInReactNative()&&(this.loginButton.visible=!1,this.visitorButton.visible=!1,this.closeButton.visible=!0),Device.sharedInstance().isIphoneX()&&(this.closeButton.y+=20),this.loginButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLoginButtonTouch,this),this.visitorButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onVisitorButtonTouch,this),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),EventCenter.sharedInstance().addEventListener(SceneEvent.LeaveFromGame,this.onLeaveFromGame,this)},t.prototype.addNativeMessageListener=function(){var e=this;window.document.addEventListener("message",function(t){var n=JSON.parse(t.data);if("query_user_data"===n.command){var o=JSON.parse(n.payload);e.userModel.loginInfo=new LoginInfo(o)}else"query_pin"===n.command&&(n.payload.pin?(e.pin=n.payload.pin,e.isCreateGame=!1):e.isCreateGame=!0,e.connectCentrifuge())})},t.prototype.postMessageToNative=function(){window.postMessage(JSON.stringify({command:"query_user_data"}),"*"),window.postMessage(JSON.stringify({command:"query_pin"}),"*")},t.prototype.onCloseButtonTouch=function(){window.postMessage(JSON.stringify({command:"close_webview"}),"*")},t.prototype.onLeaveFromGame=function(){MessageAlert.show("您已离开游戏房间")},t.prototype.onLoginButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e=new InputPhoneNumberView;SceneManager.sharedInstance().pushScene(e),e.addEventListener(InputViewEvent.InputComplete,this.onPhoneNumberInputComplete,this)},t.prototype.onVisitorButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.loginByVisitor()},t.prototype.loginByVisitor=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:LoadingComponent.sharedInstance().show(this,"游客登录中..."),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this.userModel.loginByVisitor()];case 2:return e=n.sent(),this.userModel.loginInfo=new LoginInfo(e.result),this.showInputPinView(),[3,5];case 3:return t=n.sent(),MessageAlert.show(t.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.onPhoneNumberInputComplete=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:this.userModel.phoneNumber=e.data,LoadingComponent.sharedInstance().show(this,"请稍后, 正在发送验证码..."),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber)];case 2:return t=o.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(t.result),this.showInputVerificationcodeView(e.data),[3,5];case 3:return n=o.sent(),MessageAlert.show(n.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.showInputVerificationcodeView=function(e){var t=new InputVerificationCodeView;t.setPhoneNumber(e),t.addEventListener(InputViewEvent.InputComplete,this.onVerficationCodeInputComplete,this),t.addEventListener(InputViewEvent.Regain,this.requestVerificationCode,this),SceneManager.sharedInstance().pushScene(t)},t.prototype.onVerficationCodeInputComplete=function(e){var t=e.data;this.login(t)},t.prototype.login=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(r){switch(r.label){case 0:LoadingComponent.sharedInstance().show(this,"正在登录中..."),t={phoneNumber:this.userModel.phoneNumber,verificationCode:e,hashDigest:this.userModel.verificationInfo.hashDigest,expireISOTime:this.userModel.verificationInfo.expireISOTime},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.userModel.login(t)];case 2:return n=r.sent(),this.userModel.loginInfo=new LoginInfo(n.result),this.showInputPinView(),[3,5];case 3:return o=r.sent(),MessageAlert.show(o.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.requestVerificationCode=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber)];case 1:return e=n.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(e.result),[3,3];case 2:return t=n.sent(),MessageAlert.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.showInputPinView=function(){var e=new InputPinView;SceneManager.sharedInstance().pushScene(e),e.addEventListener(JoinGameEvent.JoinGame,this.onTouchJoinButton,this),e.addEventListener(JoinGameEvent.CreateGame,this.onTouchCreateButton,this)},t.prototype.connectCentrifuge=function(){LoadingComponent.sharedInstance().show(this,"正在连接游戏服务器..."),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this);var e={url:""+ApiConfig.Domain,info:this.userModel.loginInfo.websocketToken.info,timestamp:this.userModel.loginInfo.websocketToken.timestamp,token:this.userModel.loginInfo.websocketToken.token,user:this.userModel.loginInfo.websocketToken.user,accessToken:this.userModel.loginInfo.auth.accessToken,vversion:ApiConfig.Version_1};CentrifugeServer.sharedInstance().connect(e);var t="user#"+this.userModel.loginInfo.user.id;CentrifugeServer.sharedInstance().subscribe(t)},t.prototype.onCentrifugeConnected=function(){this.isCreateGame?this.createGame():this.joinGameByPin(this.pin)},t.prototype.onCentrifugeConnectionFailed=function(){LoadingComponent.sharedInstance().hide(),MessageAlert.show("与服务器的连接失败")},t.prototype.createGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(o){switch(o.label){case 0:LoadingComponent.sharedInstance().show(this,"正在创建游戏..."),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.userModel.createRoom()];case 2:return e=o.sent(),t=e.result,this.toGameScene(t),[3,5];case 3:return n=o.sent(),MessageAlert.show(n.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.joinGameByPin=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(r){switch(r.label){case 0:LoadingComponent.sharedInstance().show(this,"正在加入游戏..."),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.userModel.joinRoomByPin(e)];case 2:return t=r.sent(),n=t.result,this.toGameScene(n),[3,5];case 3:return o=r.sent(),MessageAlert.show(o.message),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),[7];case 5:return[2]}})})},t.prototype.onTouchCreateButton=function(){this.isCreateGame=!0,this.connectCentrifuge()},t.prototype.onTouchJoinButton=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.isCreateGame=!1,this.pin=e.pin,this.connectCentrifuge(),[2]})})},t.prototype.toGameScene=function(e){var t=new GameScene;t.init(e),SceneManager.sharedInstance().replaceScene(t)},t.prototype.onRemovedFromStage=function(){EventCenter.sharedInstance().removeEventListener(SceneEvent.LeaveFromGame,this.onLeaveFromGame,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this)},t}(eui.Component);__reflect(LaunchScene.prototype,"LaunchScene");var JoinGameEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.CreateGame="create_game",t.JoinGame="join_game",t}(egret.Event);__reflect(JoinGameEvent.prototype,"JoinGameEvent");var InputPinView=function(e){function t(){var t=e.call(this)||this;
return t.skinName="InputPinSkin",t}return __extends(t,e),t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.createButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateButtonTouch,this),this.joinButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJoinButtonTouch,this)},t.prototype.onCreateButtonTouch=function(){var e=new JoinGameEvent(JoinGameEvent.CreateGame);this.dispatchEvent(e),this.close()},t.prototype.onJoinButtonTouch=function(){var e=this.pinInput.text;if(e&&9===e.length){var t=new JoinGameEvent(JoinGameEvent.JoinGame);t.pin=e,this.dispatchEvent(t),this.close()}},t.prototype.onBackgroundTouch=function(){},t}(eui.Component);__reflect(InputPinView.prototype,"InputPinView");var InputPhoneNumberView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPhoneNumberSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t.prototype.onNextButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.phoneNumberInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.phoneNumberInput.text,this.dispatchEvent(e),this.close()}},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(InputPhoneNumberView.prototype,"InputPhoneNumberView");var InputVerificationCodeView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputVerificationCodeSkin",t}return __extends(t,e),t.prototype.setPhoneNumber=function(e){this.phoneNumberLabel.text=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.times=60,this.timer=new egret.Timer(1e3,60),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.start(),this.regainButton.label="60s",this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.regainButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegainButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this)},t.prototype.onConfirmButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click),this.codeInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.codeInput.text,this.dispatchEvent(e),this.close()}},t.prototype.onRegainButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.Click);var e=new InputViewEvent(InputViewEvent.Regain);this.dispatchEvent(e),this.timer.start(),this.regainButton.label="60s"},t.prototype.onTimer=function(){this.times-=1,this.regainButton.label=this.times+"s",this.regainButton.touchEnabled=!1},t.prototype.onTimerComplete=function(){this.times=60,this.regainButton.touchEnabled=!0,this.regainButton.label="重新获取",this.timer.reset()},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.onRemovedFromStage=function(){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer=void 0},t}(eui.Component);__reflect(InputVerificationCodeView.prototype,"InputVerificationCodeView");var InputViewEvent=function(e){function t(t,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!1),e.call(this,t,n,o)||this}return __extends(t,e),t.InputComplete="input_complete",t.Regain="regain",t}(egret.Event);__reflect(InputViewEvent.prototype,"InputViewEvent");var UserModel=function(){function e(){this.request=new HttpRequest}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.requestVerificationCode=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/sms/code",n={application:"laiwan",country_code:"86",phone_number:e};return this.request.post(t,n)},e.prototype.login=function(e){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/user/login/web",n={country_code:"86",phone_number:e.phoneNumber,verification_code:e.verificationCode,hash_digest:e.hashDigest,expire_iso_time:e.expireISOTime};return this.request.post(t,n)},e.prototype.loginByVisitor=function(){var e=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/user/register/anonymous";return this.request.post(e)},e.prototype.createRoom=function(){var t=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room",n=this.request.buildHeaderWithToken(e.sharedInstance().loginInfo.auth.accessToken),o={chip:1e3};return this.request.post(t,o,n)},e.prototype.joinRoomByPin=function(t){var n=ApiConfig.Domain+"/"+ApiConfig.Version_1+"/texas/room/join",o={pin:t},r=this.request.buildHeaderWithToken(e.sharedInstance().loginInfo.auth.accessToken);return this.request.post(n,o,r)},Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verificationInfo",{get:function(){return this._verificationInfo},set:function(e){this._verificationInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loginInfo",{get:function(){return this._loginInfo},set:function(e){this._loginInfo=e},enumerable:!0,configurable:!0}),e}();__reflect(UserModel.prototype,"UserModel");var AuthInfo=function(){function e(e){this._accessToken=e.access_token,this._expiresIn=e.expires_in,this._refreshToken=e.refresh_token,this._tokenType=e.token_type}return Object.defineProperty(e.prototype,"accessToken",{get:function(){return this._accessToken},set:function(e){this._accessToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiresIn",{get:function(){return this._expiresIn},set:function(e){this._expiresIn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},set:function(e){this._refreshToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenType",{get:function(){return this._tokenType},set:function(e){this._tokenType=e},enumerable:!0,configurable:!0}),e}();__reflect(AuthInfo.prototype,"AuthInfo");var LoginInfo=function(){function e(e){this._user=new UserInfo(e.user),this._auth=new AuthInfo(e.auth),this._websocketToken=new WebsocketTokenInfo(e.websocket_token)}return Object.defineProperty(e.prototype,"user",{get:function(){return this._user},set:function(e){this._user=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auth",{get:function(){return this._auth},set:function(e){this._auth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"websocketToken",{get:function(){return this._websocketToken},set:function(e){this._websocketToken=e},enumerable:!0,configurable:!0}),e}();__reflect(LoginInfo.prototype,"LoginInfo");var UserInfo=function(){function e(e){this._id=e.id,this._serviceId=e.service_id,this._nickname=e.nickname,this._gender=e.gender,this._phoneNumber=e.phone_number,this._application=e.application,this._username=e.username}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceId",{get:function(){return this._serviceId},set:function(e){this._serviceId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gender",{get:function(){return this._gender},set:function(e){this._gender=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._application},set:function(e){this._application=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),e}();__reflect(UserInfo.prototype,"UserInfo");var VerificationCodeInfo=function(){function e(e){this._hashDigest=e.hash_digest,this._expireISOTime=e.expire_iso_time}return Object.defineProperty(e.prototype,"hashDigest",{get:function(){return this._hashDigest},set:function(e){this._hashDigest=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expireISOTime",{get:function(){return this._expireISOTime},set:function(e){this._expireISOTime=e},enumerable:!0,configurable:!0}),e}();__reflect(VerificationCodeInfo.prototype,"VerificationCodeInfo");var WebsocketTokenInfo=function(){function e(e){this._user=e.user,this._timestamp=e.timestamp,this._info=e.info,this._token=e.token,this._userChannel=e.user_channel}return Object.defineProperty(e.prototype,"user",{get:function(){return this._user},set:function(e){this._user=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){this._timestamp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return this._info},set:function(e){this._info=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this._token},set:function(e){this._token=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userChannel",{get:function(){return this._userChannel},set:function(e){this._userChannel=e},enumerable:!0,configurable:!0}),e}();__reflect(WebsocketTokenInfo.prototype,"WebsocketTokenInfo");var CentrifugeServer=function(){function e(){this.isReconnect=!1,this.centrifuge=void 0,this.subscription=void 0}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connect=function(e){var t=this;this.centrifuge=new Centrifuge(e),this.centrifuge.on("connect",function(e){console.log("on connect",e),t.isReconnect=!0;var n=new CentrifugeServerEvent(CentrifugeServerEvent.Connected);EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.on("disconnect",function(e){console.log("on disconnect",e);var t=new CentrifugeServerEvent(CentrifugeServerEvent.Disconnected);EventCenter.sharedInstance().dispatchEvent(t)}),this.centrifuge.on("error",function(e){console.log("on error",e);var t=new CentrifugeServerEvent(CentrifugeServerEvent.ConnectionError);EventCenter.sharedInstance().dispatchEvent(t)}),this.centrifuge.connect()},e.prototype.subscribe=function(e){var t={message:function(e){console.log("centrifuge.message"),console.log(e.data.payload);var t=new CentrifugeServerEvent(CentrifugeServerEvent.ReceivedMessage);t.data=e.data.payload,EventCenter.sharedInstance().dispatchEvent(t)},subscribe:function(e){console.log("centrifuge.subscribe",e)},error:function(e){console.log("centrifuge.error",e)},unsubscribe:function(e){console.log("centrifuge.unsubscribe",e)}};this.subscription=this.centrifuge.subscribe(e,t)},e.prototype.unsubscribe=function(){this.subscription.unsubscribe()},e.prototype.discoonect=function(){this.isReconnect=!1,this.centrifuge.disconnect()},e}();__reflect(CentrifugeServer.prototype,"CentrifugeServer");var ActionUtil=function(){function e(){}return e.getActionMessage=function(e){var t="";switch(e){case GameAction.Fold:t=ActionMessage.Fold;break;case GameAction.Check:t=ActionMessage.Check;break;case GameAction.Call:t=ActionMessage.Call;break;case GameAction.Raise:t=ActionMessage.Raise;break;case GameAction.AllIn:t=ActionMessage.AllIn}return t},e.updateColor=function(e,t){var n=16777215;switch(t){case ActionMessage.Fold:n=15353928;break;case ActionMessage.Check:n=7332863;break;case ActionMessage.Call:n=10551167;break;case ActionMessage.Raise:n=16773538;break;case ActionMessage.AllIn:n=15317268}e.textColor=n},e}();__reflect(ActionUtil.prototype,"ActionUtil");var AnimationUtil=function(){function e(){}return e.loopPlay=function(e,t){if(void 0===t&&(t=!0),t)for(var n in e.items)e.items[n]&&(e.items[n].props={loop:!0});e.play()},e}();__reflect(AnimationUtil.prototype,"AnimationUtil");var Device=function(){function e(){}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.isInReactNative=function(){return this.platform?"react_native"===this.platform:!1},e.prototype.isIphoneX=function(){return this.screenSize?this.screenSize.height>800:!1},e.prototype.getScreenWidth=function(){return this.screenSize.width},e.prototype.getScreenHeight=function(){return this.screenSize.height},e.prototype.setPlatform=function(e){this._platform=e},e.prototype.setScreenSize=function(e){this._screenSize=e},Object.defineProperty(e.prototype,"platform",{get:function(){return this._platform},set:function(e){this._platform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenSize",{get:function(){return this._screenSize},set:function(e){this._screenSize=e},enumerable:!0,configurable:!0}),e}();__reflect(Device.prototype,"Device");var HttpRequest=function(){function e(){}return e.prototype.get=function(e,t,n){var o=this;return new Promise(function(r,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT;var s=t?o.buildParams(t):"",c=""+e+s;a.open(c,egret.HttpMethod.GET);for(var u in n)n[u]&&a.setRequestHeader(u,n[u]);a.send(),a.addEventListener(egret.Event.COMPLETE,function(e){var t=JSON.parse(e.currentTarget.response),n=new ResponseInfo(t);n.ok?r(n):i(n)},o),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){i(new Error("服务器异常, 请稍后再试"))},o)})},e.prototype.post=function(e,t,n){var o=this;return new Promise(function(r,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT;var s=t?o.buildBody(t):"{}";a.open(e,egret.HttpMethod.POST);for(var c in n)n[c]&&a.setRequestHeader(c,n[c]);a.send(s),a.addEventListener(egret.Event.COMPLETE,function(e){var t=JSON.parse(e.currentTarget.response),n=new ResponseInfo(t);n.ok?r(n):i(n)},o),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){i(new Error("服务器异常, 请稍后再试"))},o)})},e.prototype.buildHeaderWithToken=function(e){var t={Authorization:"Bearer "+e};return t},e.prototype.buildParams=function(e){var t="?";for(var n in e)e[n]&&(t+=n+"="+e[n]+"&");return t.length>0&&(t=t.substring(0,t.length-1)),t},e.prototype.buildBody=function(e){var t=JSON.stringify(e);return t},e}();__reflect(HttpRequest.prototype,"HttpRequest");var PokerAnalyzer=function(){function e(){}return e.getCardTypeByResult=function(e){var t="高牌";switch(e){case CardType.ROYAL_FLUSH:t="皇家同花顺";break;case CardType.STRAIGHT_FLUSH:t="同花顺";break;case CardType.FOUR_OF_A_KIND:t="四条";break;case CardType.FLUSH:t="同花";break;case CardType.FULL_HOUSE:t="葫芦";break;case CardType.STRAIGHT:t="顺子";break;case CardType.THREE_OF_A_KIND:t="三条";break;case CardType.TWO_PAIRS:t="两对";break;case CardType.PAIR:t="一对";break;case CardType.HIGH_CARD:t="高牌"}return t},e.getCardTypeByCard=function(t){var n=e.analyze(t);return this.getCardTypeByResult(n)},e.analyze=function(e){var t=e.sort(function(e,t){return e.value-t.value});return this.isRoyalFlush(t)?CardType.ROYAL_FLUSH:this.isStraightFlush(t)?CardType.STRAIGHT_FLUSH:this.isFourOfAKind(t)?CardType.FOUR_OF_A_KIND:this.isFlush(t)?CardType.FLUSH:this.isFullHouse(t)?CardType.FULL_HOUSE:this.isThreeOfAKind(t)?CardType.THREE_OF_A_KIND:this.isStraight(t)?CardType.STRAIGHT:this.isTwoPair(t)?CardType.TWO_PAIRS:this.isPair(t)?CardType.PAIR:CardType.HIGH_CARD},e.isPair=function(e){for(var t=0;t<e.length-1;t+=1)if(e[t].value===e[t+1].value)return!0;return!1},e.isTwoPair=function(e){for(var t=!1,n=0;n<e.length-1;n+=1)if(e[n].value===e[n+1].value){if(t)return!0;n++,t=!0}},e.isThreeOfAKind=function(e){for(var t=0;t<e.length-2;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value)return!0;return!1},e.isFourOfAKind=function(e){for(var t=0;t<e.length-3;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value&&e[t+2].value===e[t+3].value)return!0;return!1},e.isFullHouse=function(e){for(var t=0;t<e.length-2;t++)if(e[t].value==e[t+1].value&&e[t].value==e[t+2].value)for(var n=0;n<e.length-1;n++)if(e[t].value!=e[n].value&&e[n].value==e[n+1].value)return!0;return!1},e.isStraight=function(e){for(var t=0,n=[e[t]];t<e.length&&n.length<5;){for(var o=t+1;o<e.length&&e[t].value===e[o].value;)o+=1;if(o>=e.length)return!1;e[t].value+1===e[o].value?n.push(e[o]):n=[e[o]],t=o}return n.length>=5},e.isFlush=function(e){for(var t=[0,0,0,0],n=0;n<e.length;n+=1)t[e[n].suit]+=1;for(var o=0;o<t.length;o+=1)if(t[o]>=5)return!0;return!1},e.isStraightFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.isRoyalFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value===CardValue.Ten&&t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.getFlushCards=function(e){for(var t=[],n=[0,0,0,0],o=0;o<e.length;o+=1)n[e[o].suit]+=1;for(var r=CardSuit.Error,i=0;i<n.length;i+=1)if(n[i]>=5){r=i;break}if(r===CardSuit.Error)return t;for(var o=0;o<e.length;o+=1)e[o].suit===r&&t.push(e[o]);return t},e}();__reflect(PokerAnalyzer.prototype,"PokerAnalyzer");var SceneManager=function(){function e(){this.sceneStack=[]}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.init=function(e){this.baseScene||(this.baseScene=e)},e.prototype.replaceScene=function(e){this.baseScene&&(this.baseScene.removeChildren(),this.baseScene.addChild(e))},e.prototype.pushScene=function(e){this.baseScene&&(this.baseScene.addChild(e),this.sceneStack.push(e))},e.prototype.popScene=function(){if(this.baseScene){var e=this.sceneStack.length;if(e>0){egret.log(this.sceneStack);var t=this.sceneStack[e-1];t.parent===this.baseScene&&(this.baseScene.removeChild(t),this.sceneStack.splice(e-1,1))}}},e}();__reflect(SceneManager.prototype,"SceneManager");var SoundManager=function(){function e(){this.IS_PLAY_BACKGROUN_SOUND_KEY="isPlayBackgroundSound",this.IS_PLAY_EFFECT_SOUND_KEY="isPlayEffectSound",this.BACKGROUND_SOUND_VOLUME_KEY="backgroundSoundVolume",this.EFFECT_SOUND_VOLUME_KEY="effectSoundVolume",this.DEFAULT_VOLUME="1",this.MUSIC_START_TIME=0,this.backgroundSounds={},this.backgroundSoundChannels={},this.effectSounds={},this.effectSoundChannels={}}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.setIsPlayBackgroundSound=function(e){egret.localStorage.setItem(this.IS_PLAY_BACKGROUN_SOUND_KEY,e.toString()),e?this.playBackgroundSound(this.currentSoundFileSource):this.stopPlayBackgroundSound()},e.prototype.isPlayBackgroundSound=function(){var e=egret.localStorage.getItem(this.IS_PLAY_BACKGROUN_SOUND_KEY);return e?"true"===e:!0},e.prototype.setIsPlayEffectSound=function(e){egret.localStorage.setItem(this.IS_PLAY_EFFECT_SOUND_KEY,e.toString())},e.prototype.isPlayEffectSound=function(){var e=egret.localStorage.getItem(this.IS_PLAY_EFFECT_SOUND_KEY);return e?"true"===e:!0},e.prototype.setBgSoundVolume=function(e){var t=new Decimal(e).div(100);for(var n in this.backgroundSoundChannels)this.backgroundSoundChannels[n]&&(this.backgroundSoundChannels[n].volume=t);egret.localStorage.setItem(this.BACKGROUND_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedBgSoundVolume=function(){var e=egret.localStorage.getItem(this.BACKGROUND_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return new Decimal(e)},e.prototype.setEffectSoundVolume=function(e){var t=new Decimal(e).div(100);egret.localStorage.setItem(this.EFFECT_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedEffectSoundVolume=function(){var e=egret.localStorage.getItem(this.EFFECT_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return new Decimal(e)},e.prototype.playBackgroundSound=function(e,t){void 0===t&&(t=0),this.currentSoundFileSource=e;var n=1===Object.keys(this.backgroundSounds).length;if(this.isPlayBackgroundSound()&&!n){var o=RES.getRes(e);this.backgroundSounds[e]=o;var r=o.play(this.MUSIC_START_TIME,t);r.volume=this.getCachedBgSoundVolume(),this.backgroundSoundChannels[o.hashCode.toString()]=r}},e.prototype.stopPlayBackgroundSound=function(){for(var e in this.backgroundSoundChannels)this.backgroundSoundChannels[e]&&(this.backgroundSoundChannels[e].stop(),delete this.backgroundSoundChannels[e]);for(var t in this.backgroundSounds)this.backgroundSounds[t]&&delete this.backgroundSounds[t]},e.prototype.playEffectSound=function(e,t){if(void 0===t&&(t=1),this.isPlayEffectSound()){var n=RES.getRes(e);this.effectSounds[e]=n;var o=n.play(this.MUSIC_START_TIME,t);o.volume=this.getCachedEffectSoundVolume(),this.effectSoundChannels[n.hashCode.toString()]=o}},e.prototype.stopPlayEffectSound=function(e){var t=this.effectSounds[e];if(t){var n=this.effectSoundChannels[t.hashCode.toString()];n.stop(),delete this.effectSounds[e],delete this.effectSoundChannels[t.hashCode.toString()]}},e.prototype.getPlayingSoundFileSource=function(){return this.currentSoundFileSource},e}();__reflect(SoundManager.prototype,"SoundManager");