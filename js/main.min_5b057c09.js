var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{c(i.next(e))}catch(t){r(t)}}function s(e){try{c(i["throw"](e))}catch(t){r(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Direction={Top:"top",Left:"left",Bottom:"bottom",Right:"right"},GameAction={JoinGame:"join_room",StartGame:"start_game",DealCards:"deal_cards",HoleCard:"hole_card",UpdateStrength:"update_strength",Flop:"flop",Turn:"turn",River:"river",SwitchPlayer:"switch_player",Bet:"bet",Call:"call",SB:"small_blind",BB:"big_blind",Raise:"raise",AllIn:"all_in",Fold:"fold",UpdatePots:"update_pots",Check:"check",Showdown:"showdown",EndGame:"end_game",LeaveRoom:"leave_room",SitDown:"sit",StandUp:"stand_up"},RaiseSelector=function(e){function t(){var t=e.call(this)||this;return t.skinName="RaiseSelectorSkin",t}return __extends(t,e),t.prototype.updateSliderValue=function(e,t,n){void 0===e&&(e=2),void 0===t&&(t=100),void 0===n&&(n=2),this.dashboardButton.label=""+MoneyFormatter.addChineseUnit(t),this.raiseSlider.minimum=e,this.raiseSlider.maximum=t,this.raiseSlider.snapInterval=n,this.raiseSlider.value=e},t.prototype.show=function(){this.visible=!0},t.prototype.hide=function(){this.visible=!1,this.confirmButton.image.source="btn_raise_confirm_png"},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.dashboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDashboardButtonTouch,this),this.allInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllInButtonTouch,this),this.raiseSlider.addEventListener(egret.Event.CHANGE,this.onValueChange,this)},t.prototype.onValueChange=function(e){var t=this.raiseSlider.value===this.raiseSlider.maximum;this.confirmButton.image.source=t?"btn_slider_all_in_png":"btn_raise_confirm_png"},t.prototype.onAllInButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.confirmButton.image.source="btn_slider_all_in_png",this.raiseSlider.value=this.raiseSlider.maximum;var e=this.raiseSlider.value,t=new RaiseEvent(RaiseEvent.AllIn);t.data=e,this.dispatchEvent(t),this.hide()},t.prototype.onConfirmButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e,t=this.raiseSlider.value;t===this.raiseSlider.maximum?(this.confirmButton.image.source="btn_raise_confirm_png",e=new RaiseEvent(RaiseEvent.AllIn)):e=new RaiseEvent(RaiseEvent.Raise),e.data=t,this.dispatchEvent(e),this.hide()},t.prototype.onDashboardButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.confirmButton.image.source="btn_slider_all_in_png",this.raiseSlider.value=this.raiseSlider.maximum},t}(eui.Component);__reflect(RaiseSelector.prototype,"RaiseSelector");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){function o(e){t.call(i,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(i,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var DisconnectComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="DisconnectViewSkin",t.top=t.bottom=t.left=t.right=0,t.proxyModel=new ProxyModel,t}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.show=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,r,a,s,c=this;return __generator(this,function(u){switch(u.label){case 0:if(n=this.proxyModel.getApiDomain(),this.domainLabel.text=this.getNumberByDomain(n),this.parent)return[2];u.label=1;case 1:return u.trys.push([1,5,,6]),e.addChild(this),this.disconnectionAnimation?[3,4]:[4,RES.getRes("disconnection_animation_json")];case 2:return i=u.sent(),[4,RES.getRes("disconnection_animation_png")];case 3:o=u.sent(),r=new egret.MovieClipDataFactory(i,o),this.disconnectionAnimation=new egret.MovieClip(r.generateMovieClipData("disconnection")),u.label=4;case 4:return this.animationGroup.addChild(this.disconnectionAnimation),this.disconnectionAnimation.gotoAndPlay("disconnection",-1),t&&(this.promptLabel.text=t),a=0,this.timer=setInterval(function(){c.timerLabel.text=""+(a+=1)},1e3),[3,6];case 5:return s=u.sent(),MessageAlert.show(s),[3,6];case 6:return[2]}})})},t.prototype.updateMessage=function(e){this.promptLabel.text=e},t.prototype.hide=function(){this.parent&&(this.disconnectionAnimation&&(this.disconnectionAnimation.stop(),this.animationGroup.removeChild(this.disconnectionAnimation)),this.timerLabel.text="0",clearInterval(this.timer),this.parent.removeChild(this))},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.getNumberByDomain=function(e){var t=8,n=e.indexOf("."),i=e.slice(t,n);return i},t}(eui.Component);__reflect(DisconnectComponent.prototype,"DisconnectComponent");var LoadingCircle=function(e){function t(){var t=e.call(this)||this;return t.proxyModel=new ProxyModel,t.skinName="LoadingCircleSkin",t.top=t.bottom=t.left=t.right=0,t}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.show=function(e,t){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:if(this.proxyLabel.text=this.proxyModel.getProxyCode(),this.parent)return[2];r.label=1;case 1:return r.trys.push([1,5,,6]),e.addChild(this),this.loadingAnimation?[3,4]:[4,RES.getRes("loading_circle_json")];case 2:return t=r.sent(),[4,RES.getRes("loading_circle_png")];case 3:n=r.sent(),i=new egret.MovieClipDataFactory(t,n),this.loadingAnimation=new egret.MovieClip(i.generateMovieClipData("circle")),r.label=4;case 4:return this.group.addChild(this.loadingAnimation),this.loadingAnimation.gotoAndPlay("rotate",-1),[3,6];case 5:return o=r.sent(),Toast.show(JSON.stringify(o)),[3,6];case 6:return[2]}})})},t.prototype.hide=function(){this.parent&&(this.loadingAnimation&&(this.loadingAnimation.stop(),this.group.removeChild(this.loadingAnimation)),this.parent.removeChild(this))},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(LoadingCircle.prototype,"LoadingCircle");var LoadingComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingComponentSkin",t.top=t.bottom=t.left=t.right=0,t}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.show=function(e,t){void 0===t&&(t="努力加载中..."),this.labelDisplay.text=t,e.contains(this)||(e.addChild(this),AnimationUtil.loopPlay(this.loadingTween))},t.prototype.updateMessage=function(e){this.labelDisplay.text=e},t.prototype.hide=function(){this.parent&&(this.loadingTween.stop(),this.parent.removeChild(this))},t}(eui.Component);__reflect(LoadingComponent.prototype,"LoadingComponent");var MessageAlert=function(){function e(){}return e.init=function(e){this.container=e},e.show=function(e,t,n){var i=new MessageAlertComponent;i.setMessage(e),i.addButtons(n),i.setPrompt(t),this.container.addChild(i)},e}();__reflect(MessageAlert.prototype,"MessageAlert");var MessageAlertComponent=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageAlertSkin",t}return __extends(t,e),t.prototype.setMessage=function(e){this.messageLabel.text=e},t.prototype.addButtons=function(e){var t=this;void 0===e&&(e=[]),e.length>0?e.forEach(function(e){t.createButton(e.name,e.action)}):this.createButton("确认")},t.prototype.setPrompt=function(e){void 0===e&&(e=" "),this.promptLabel.text=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0},t.prototype.createButton=function(e,t){void 0===e&&(e="确认");var n=new eui.Button;n.skinName="ChatSendButtonSkin",n.width=160,n.labelDisplay.text=e,t&&n.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this),n.addEventListener(egret.TouchEvent.TOUCH_END,this.remove,this),this.buttonGroup.addChild(n)},t.prototype.remove=function(){this.parent.removeChild(this)},t}(eui.Component);__reflect(MessageAlertComponent.prototype,"MessageAlertComponent");var ObjToast=function(e){function t(){var t=e.call(this)||this;return t.content=new eui.Label,t.bg=new eui.Rect,t.bg.fillColor=1973790,t.bg.alpha=.8,t.bg.ellipseWidth=15,t.bg.ellipseHeight=15,t.addChild(t.bg),t.content.fontFamily="Microsoft Yahei",t.content.size=20,t.content.lineSpacing=8,t.content.textAlign=egret.HorizontalAlign.CENTER,t.addChild(t.content),t}return __extends(t,e),Object.defineProperty(t.prototype,"abxca",{set:function(e){this.content&&(this.content.textFlow=(new egret.HtmlTextParser).parser(e)),this.bg.width=this.content.width+50,this.bg.height=this.content.height+20,this.content.x=(this.bg.width-this.content.width)/2,this.content.y=(this.bg.height-this.content.height)/2},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ObjToast.prototype,"ObjToast");var Toast=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.init=function(e){this._cont=e},t.show=function(e,t){var n=this;if(void 0===t&&(t=1200),this._cont){if(!this._group){var i=new eui.VerticalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,this._group=new eui.Group,this._group.layout=i,this._group.width=egret.MainContext.instance.stage.stageWidth,this._cont.addChild(this._group),this._group.touchEnabled=!1,this._group.touchChildren=!1}this._cont.contains(this._group)||this._cont.addChild(this._group),this._cont.setChildIndex(this._group,-1);var o=new ObjToast;o.abxca=e;this._group.height/o.height;o.x=(egret.MainContext.instance.stage.stageWidth-o.width)/2,this._group.addChild(o),this._group.y=.5*(egret.MainContext.instance.stage.stageHeight-this._group.height),egret.Tween.get(o).to({alpha:1},800,egret.Ease.quintOut).wait(t).to({alpha:0},800,egret.Ease.quintIn).call(function(){if(n._group){var e=n._group.getChildAt(0);n._group.removeChild(e),e=null,n._group.y+=o.height+6}})}},t}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");var JWTSecret=function(){function e(){}return e.SMS_SECRET="J2dfYmXuPgtF-1KhMk01MpT3pneSAUutp5fNNT9vPrdyJN1TD9",e.MISSION_SECRET="Q2dfGmXuPgtFJ5KhMkX1MpT3MneSAUuTF9fNNT7vPrdQJNHTD1",e}();__reflect(JWTSecret.prototype,"JWTSecret");var ApiProxies=["https://3.cn.api.staging.laiwan.shafayouxi.com","https://9.cn.api.staging.laiwan.shafayouxi.com","https://10.us.api.staging.laiwan.shafayouxi.com","https://17.au.api.staging.laiwan.shafayouxi.com","https://18.sg.api.staging.laiwan.shafayouxi.com","https://21.cn.api.staging.laiwan.shafayouxi.com","https://23.hk.api.staging.laiwan.shafayouxi.com","https://25.kr.api.staging.laiwan.shafayouxi.com"],AvatarDomain="https://avatar.staging.laiwan.shafayouxi.com",ApiConfig={ApiDomain:"https://api.shafayouxi.org",MediaDomain:"https://media.shafayouxi.org",Version_1:"v1",Version_2:"v2",Version_5:"v5"},BuyInAction={NewBuyInApplication:"new_buy_in_application",ProcessBuyInApplication:"process_buy_in_application"},CardSuit;!function(e){e[e.Error=-1]="Error",e[e.Spade=0]="Spade",e[e.Heart=1]="Heart",e[e.Club=2]="Club",e[e.Diamond=3]="Diamond"}(CardSuit||(CardSuit={}));var CardType={HIGH_CARD:"high_card",PAIR:"pair",TWO_PAIRS:"two_pairs",THREE_OF_A_KIND:"three_of_a_kind",STRAIGHT:"straight",FLUSH:"flush",FULL_HOUSE:"full_house",FOUR_OF_A_KIND:"four_of_a_kind",STRAIGHT_FLUSH:"straight_flush",ROYAL_FLUSH:"royal_flush"},CardValue;!function(e){e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven",e[e.Eight=8]="Eight",e[e.Nine=9]="Nine",e[e.Ten=10]="Ten",e[e.J=11]="J",e[e.Q=12]="Q",e[e.K=13]="K",e[e.A=14]="A",e[e.Error=15]="Error"}(CardValue||(CardValue={}));var Channel={TEXAS_HOLDEM:"texas_holdem",ROOM_MESSAGE:"room_message",LAIWAN:"laiwan",ROOM:"room",BUY_IN:"buy_in"},ClubAction={NewClubApplication:"new_club_application"},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?i(o):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){},this.top=this.bottom=this.right=this.left=0;var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),Toast.init(this),MessageAlert.init(this),WebViewCenter.sharedInstance().addMessageListener(),this.createScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("loading")];case 3:return i.sent(),e=new LoadingScene,this.stage.addChild(e),t=new eui.Label,[4,RES.loadGroup("preload",0)];case 4:return i.sent(),this.stage.removeChild(e),[3,6];case 5:return n=i.sent(),console.error(n),[3,6];case 6:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createScene=function(){SceneManager.sharedInstance().stageSize={width:this.stage.stageWidth,height:this.stage.stageHeight},SceneManager.sharedInstance().init(this),SceneManager.sharedInstance().pushScene(new LaunchScene)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var GameCommand=function(){function e(){}return e.QUERY_ACCOUNT_INFO="query_account_info",e.QUERY_USER_DATA="query_user_data",e.QUERY_ROOM_ID="query_room_id",e.QUERY_SCREEN_SIZE="query_screen_size",e.QUERY_PLATFORM_NAME="query_platform_name",e.QUERY_APP_VERSION="query_app_version",e.STOP_ANIMATION="stop_animation",e.LEAVE_ROOM="leave_room",e.TIMER_WARNING="timer_warning",e.RECORD_AUDIO="record_audio",e.STOP_RECORD_AUDIO="stop_record_audio",e.PLAY_AUDIO="play_audio",e.CHECK_AUDIO_PERMISSION="check_audio_permission",e.SHOW_CHAT_VIEW="show_chat_view",e.LEAVE_FOR_MALL="leave_for_mall",e.QUERY_MATCHED_DATA="query_matched_data",e.RECEIVED_CHAT_MESSAGE="received_chat_message",e.BARRAGE_STATE_CHANGED="barrage_state_changed",e.SAVE_POKER_TYPE="save_poker_type",e.QUERY_POKER_TYPE="query_poker_type",e.APP_STATE_CHANGE="app_state_changed",e.CHECK_LOCATION_PERMISSION="check_location_permission",e.SEND_CHAT_MESSAGE_FAILED="send_chat_message_failed",e}();__reflect(GameCommand.prototype,"GameCommand");var GameState={Waiting:"waiting",Preflop:"preflop",Flop:"flop",Turn:"turn",River:"river",Finish:"finish"},MessageAction={Text:"text",Sticker:"sticker",Props:"props",Audio:"audio"},Phrases=["我不是针对谁, 我是说在座的各位都是鱼","该配合你演出的我视而不见","没有皇同的命, 得了27的病","少一些套路, 多一些真诚","惊不惊喜, 意不意外","想偷鸡? 不可能的","搏一搏, 单车变摩托","溜了溜了","快点跟呀"],PlayerState={NotInGame:"not_in_game",Betting:"betting",AllIn:"all_in",Folded:"folded"},Props=[{name:"good",price:80},{name:"tomato",price:60},{name:"flower",price:80},{name:"water",price:100},{name:"heart",price:120},{name:"tea",price:50}],RequestName={JoinRoom:"/texas/room/{roomId}/join",QueryHouseNumber:"/house/number/{num}",QueryHouse:"/house/{ownerId}/{gameType}",CreateHouse:"/house/{userId}/{gameType}",CreateRoom:"/house/${userId}/{gameType}/room",BuyIn:"/buy_in/room/{roomId}/application",ProcessBuyIn:"/buy_in/application/{applicationId}",ListBuyIn:"/buy_in/room/{roomId}/application/",SendMessage:"/room_message/{roomId}/",QueryStatistic:"/texas/{playerId}/statistic",SitDown:"/texas/room/{roomId}/sit",CheckBalance:"/buy_in/room/{room_id}/balance",StartTimer:"/room/{roomId}/timer",StartGame:"/texas/room/start",QueryRoom:"/room/{roomId}",QueryGame:"/texas/room/{roomId}",Call:"call",Raise:"raise",Check:"check",AllIn:"all_in",Fold:"fold",CheckTimeout:"check_timeout",StandUp:"/texas/room/{roomId}/stand_up",Leave:"/texas/room/{roomId}/leave",LeaveHall:"/hall/{hallSlug}/leave",TestSpeed:"test_speed",RenewalSeat:"/hall/{hallSlug}/renewal",QueryIPAddress:"/ip_address/user/{userId}",QueryDistance:"/geographic/user/{userId}/distance",ApplyForTreasure:"/mission/treasure_chest/{chestSlug}",OpenTreasureChest:"/mission/treasure_chest/${chestSlug}",Report:"/report",QueryProfile:"query_profile",QueryAvailableProxy:"query available proxy"},RoomAction={AddSeconds:"add_seconds",StartTimer:"start_timer",StopTimer:"stop_timer"},RoomStatus={Waiting:"waiting",Gaming:"gaming"},RoomTimerStatus={WAIT_FOR_TIMING:"wait_for_timing",TIMING:"timing",TIME_OUT:"time_out"},middleBottom={x:246,y:1080,direction:Direction.Bottom,seat:1},leftBottom={x:30,y:726,direction:Direction.Left,seat:2},leftMiddle={x:30,y:482,direction:Direction.Left,seat:3},leftTop={x:30,y:236,direction:Direction.Left,seat:4},topLeft={x:200,y:70,direction:Direction.Left,seat:5},topRight={x:450,y:70,direction:Direction.Right,seat:6},rightTop={x:620,y:236,direction:Direction.Right,seat:7},rightMiddle={x:620,y:482,direction:Direction.Right,seat:8},rightBottom={x:620,y:726,direction:Direction.Right,seat:9},middleTop={x:325,y:70,direction:Direction.Left,seat:10},twoSeats={middleBottom:middleBottom,middleTop:middleTop},threeSeats={middleBottom:middleBottom,leftMiddle:leftMiddle,rightMiddle:rightMiddle},fourSeats={middleBottom:middleBottom,leftMiddle:leftMiddle,middleTop:middleTop,rightMiddle:rightMiddle},fiveSeats={middleBottom:middleBottom,leftMiddle:leftMiddle,topLeft:topLeft,topRight:topRight,rightMiddle:rightMiddle},sixSeats={middleBottom:middleBottom,leftBottom:leftBottom,leftTop:leftTop,middleTop:middleTop,rightTop:rightTop,rightBottom:rightBottom},sevenSeats={middleBottom:middleBottom,leftBottom:leftBottom,leftTop:leftTop,topLeft:topLeft,topRight:topRight,rightTop:rightTop,rightBottom:rightBottom},eightSeats={middleBottom:middleBottom,leftBottom:leftBottom,leftMiddle:leftMiddle,leftTop:leftTop,middleTop:middleTop,rightTop:rightTop,rightMiddle:rightMiddle,rightBottom:rightBottom},nineSeats={middleBottom:middleBottom,leftBottom:leftBottom,leftMiddle:leftMiddle,leftTop:leftTop,topLeft:topLeft,topRight:topRight,rightTop:rightTop,rightMiddle:rightMiddle,rightBottom:rightBottom},SeatConfig=[twoSeats,threeSeats,fourSeats,fiveSeats,sixSeats,sevenSeats,eightSeats,nineSeats],SoundEffectSource=function(){function e(){}return e.CLICK="uiclick_mp3",e.ADD_CHIPS="addchips_96_mp3",e.ALL_IN="allin_96_mp3",e.BET="bet_96_mp3",e.BET_CLICK="bet_click_96_mp3",e.CHECK="check_96_mp3",e.CHIP_TO_PLAYER="chiptoplayers_96_mp3",e.CHIP_TO_POOL="chiptopool_96_mp3",e.DEAL_CARD="fapai_96_mp3",e.DEAL_CARD_2="fapai3_96_mp3",e.FOLD="fold_96_mp3",e.ALARM="g_alarm_96_mp3",e.MOVE_CHIPS="movechips_96_mp3",e.NOTICE="notice_96_mp3",e.PLAYER_JOIN="user_enter_96_mp3",e.THROW_PROPS="throw_props_96_mp3",e.ALL_IN_FIRE="all_in_fire_96_mp3",e.PROPS_FLOWER="props_flower_96_mp3",e.WON_COIN="won_coin_96_mp3",e}();__reflect(SoundEffectSource.prototype,"SoundEffectSource");var ActionMessage={Call:"跟注",Check:"让牌",Raise:"加注",AllIn:"全下",Fold:"弃牌"},Stickers=["drink","puchi","cry","angry","smirk","titter"],BlockEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.BLOCK_STATE_CHANGED="blocked",t}(egret.Event);__reflect(BlockEvent.prototype,"BlockEvent");var CentrifugeServerEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.Connected="server_connected",t.Disconnected="server_disconnected",t.ReceivedMessageFromCentrifuge="centrifuge_received_message",t.ConnectionError="connection_error",t.SubscribeSuccess="subscribe_success",t}(egret.Event);__reflect(CentrifugeServerEvent.prototype,"CentrifugeServerEvent");var EventCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t}(egret.EventDispatcher);__reflect(EventCenter.prototype,"EventCenter");var LaunchEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.LoginSuccess="login_success",t}(egret.Event);__reflect(LaunchEvent.prototype,"LaunchEvent");var SettingEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.CHANGE_POKER_TYPE="change_poker_type",t}(egret.Event);__reflect(SettingEvent.prototype,"SettingEvent");var WebSocketEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.CONNECTED="connected",t.CLOSE="close",t.ERROR="error",t.RECEIVED_MESSAGE_FROM_WS="websocket_received_message",t}(egret.Event);__reflect(WebSocketEvent.prototype,"WebSocketEvent");var GameScene=function(e){function t(t){var n=e.call(this)||this;return n.WAITING_GAME_DURATION=5e3,n.RESET_DURATION=5e3,n.START_GAME_DURATION_BY_DELAER=5e3,n.DEFAULT_START_GAME_DURATION=5500,n.playerViews=[],n.handCards=[],n.seatViews=[],n.isOpenBarrage=!0,n.sentAt=void 0,n.hideTime=0,n.isFirstSubscribed=!0,n.currentActionPlayerId=void 0,n.isReconnectFaild=!1,n.receivedMessageDates=[],n.roomId=t,n.userModel=new UserModel,n.roomModel=new RoomModel,n.playerModel=new PlayerModel,n.gameModel=new GameModel(n.userModel.id),n.chatModel=new ChatModel,n.buyInModel=new BuyInModel,n.clubManagerModel=new ClubManagerModel,n.proxyModel=new ProxyModel,n.pokerTypeModel=new PokerTypeModel,n.blockModel=new BlockModel,n.skinName="GameSkin",n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.queryAppVersion(),this.autoAdjustScreenLayout(),this.adjustiPhoneXScreen(),this.setProxyCode(),this.init(),this.keepAlive()},t.prototype.autoAdjustScreenLayout=function(){this.top=this.bottom=this.left=this.right=0},t.prototype.setProxyCode=function(){this.proxyLabel.text=this.proxyModel.getProxyCode()},t.prototype.adjustiPhoneXScreen=function(){Device.sharedInstance().isIphoneX()&&(this.roomInfoGroup.y+=30,this.menuButton.y+=Constants.iPhoneX_TOP_MARGIN,this.reviewboardButton.y+=Constants.iPhoneX_TOP_MARGIN,this.messageAlarm.y+=Constants.iPhoneX_TOP_MARGIN)},t.prototype.keepAlive=function(){var e=this;this.aliveInterval=setInterval(function(){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.userModel.keepAlive(this.roomId,this.userModel.id,this.userModel.accessToken)];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),egret.log(e.message),[3,3];case 3:return[2]}})})},14e3)},t.prototype.showChipTips=function(){!this.roomModel.isInCoin()&&this.roomModel.isInOfficialClub()&&SceneManager.sharedInstance().pushScene(new ChipTipsView)},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this.buildRoom()];case 1:return o.sent(),this.addEventListeners(),this.buildSeats(),[4,this.buildGame()];case 2:return o.sent(),this.showChipTips(),this.roomModel.isCreator(this.userModel.id)&&this.roomModel.isPermitBuyIn()&&(this.queryApplicationInterval=setInterval(function(){i.queryUnprocessedBuyInApplication()},1e4)),this.messageAlarm.visible=this.roomModel.isCreator(this.userModel.id),e=this.roomModel.getSmallBlind(),this.blindLabel.text=e+"/"+2*e,this.playGameButtonGroup.setBlind(e,2*e),this.roomModel.isInCoin()?this.potsList.itemRenderer=CoinPotItemRenderer:this.potsList.itemRenderer=PotItemRenderer,this.subscribeAllChannels(),this.queryMatchedData(),[3,4];case 3:return t=o.sent(),n=[{name:"离开",action:function(){i.leaveRoom()}},{name:"重试",action:function(){i.init()}}],MessageAlert.show(t.message,"",n),[3,4];case 4:return[2]}})})},t.prototype.subscribeAllChannels=function(){CentrifugeServer.sharedInstance().channelMap.size>0||(this.subscribePersonalChannel(),this.subscribePublicChannel(),this.subscribeBuyInChannel(),this.subscribeRoomChannel(),this.subscribeRoomMessageChannel(),this.subscribeLaiwanChannel())},t.prototype.startWaitingGame=function(){this.gameModel.gameStatus===GameState.Waiting&&this.gameModel.isLocalPlayerOnTable()&&this.gameModel.currentPlayerAmount>1&&(this.cardTypeLabel.text=" ",this.roomModel.hasTimer()?this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.TIMING)&&this.startGameByDuration(this.WAITING_GAME_DURATION):this.startGameByDuration(this.WAITING_GAME_DURATION))},t.prototype.setCountdownTimer=function(){this.roomModel.hasTimer()?(this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.TIMING)?this.showCountdownTimer(this.roomModel.getRemainingSeconds()):this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.WAIT_FOR_TIMING)?this.countdownLabel.text="等待牌局开启":this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.TIME_OUT)&&(this.countdownLabel.text="牌局已结束"),this.startRoomButton.visible=this.roomModel.isCreator(this.userModel.id)&&this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.WAIT_FOR_TIMING)):this.countdownLabel.text="匹配局"},t.prototype.buildRoom=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a,s,c=this;return __generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.roomModel.queryRoomInfo(this.roomId,this.userModel.accessToken)];case 1:switch(e=u.sent(),t=new RoomInfo(e.result),this.roomModel.roomInfo=t,this.roomId=this.roomModel.getRoomId(),n=this.roomModel.isInPeronalHouse(),i="[个人房间]",n||(o=this.roomModel.getClubName(),i=o?"["+o+"]":""),this.creatorLabel.text=i,this.houseNumberLabel.text=n?"("+this.roomModel.getOptions().house_number+")":"("+this.roomModel.getRoomName()+")",r="",this.debugView.updateRoomId(this.roomModel.getRoomId()),this.roomModel.getPropertyName()){case"coin":this.blindImage.source="icon_room_coin_png",r="金币场";break;case"chip":this.blindImage.source="icon_room_chip_png",r="记分牌场"}return this.settlementMethodLabel.text=r,this.setCountdownTimer(),[3,3];case 2:return a=u.sent(),CentrifugeServer.sharedInstance().isConnected?(s=[{name:"离开",action:function(){c.leaveRoom()}},{name:"重试",action:function(){c.buildRoom()}}],MessageAlert.show(a.message,a.status,s)):Toast.show(a.message),[3,3];case 3:return[2]}})})},t.prototype.buildGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a,s,c,u=this;return __generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,this.gameModel.queryGameStatus(this.roomId,this.userModel.accessToken)];case 1:return e=h.sent(),t=new Date,n=this.receivedMessageDates.some(function(e){return t.valueOf()>e.valueOf()}),this.receivedMessageDates=[],n?(this.buildGame(),[2]):(i=new Game(e.result),this.gameModel.gameStatus=i.status,this.gameModel.isLocalPlayerPlaying=!1,this.gameModel.isLocalPlayerAllIn=!1,this.gameModel.initSeatDiff(i.players),o=i.players,this.gameModel.players=o,this.gameModel.currentPlayerAmount=o.length,this.gameModel.gameId=i.id,this.debugView.updateGameId(i.id),this.gameModel.mainPot=i.mainPot,this.gameModel.dealerId=i.dealerId,this.gameModel.communityCards=i.communityCards,r=o.find(function(e){return u.gameModel.isLocalPlayer(e.id)}),r?(this.seatNumber=r.seat,a=r.state,a!==PlayerState.NotInGame&&a!==PlayerState.Folded&&(this.gameModel.isLocalPlayerPlaying=!0),this.gameModel.isLocalPlayerAllIn=a===PlayerState.AllIn):(clearInterval(this.renewalInterval),this.renewalInterval=void 0),this.restoreGame(i),this.startWaitingGame(),[3,3]);case 2:return s=h.sent(),CentrifugeServer.sharedInstance().isConnected?(c=[{name:"离开",action:function(){u.leaveRoom()}},{name:"重试",action:function(){u.buildGame()}}],MessageAlert.show(s.message,s.status,c)):Toast.show(s.message),[3,3];case 3:return[2]}})})},t.prototype.setMessageButton=function(){this.gameModel.isLocalPlayerOnTable()?(this.microphoneButton.visible=this.roomModel.allowPlayerVoiceMessage(),this.chatButton.visible=!0):(this.microphoneButton.visible=this.roomModel.allowAudienceVoiceMessage(),this.chatButton.visible=this.roomModel.allowAudienceTextMessage())},t.prototype.restoreGame=function(e){this.cardTypeLabel.text=" ",this.hidePlayGameButtonGroup();var t=e.players;if(this.restorePlayerView(t),this.adjustSeatPosition(),this.restorePlayerHandCard(t),this.setMessageButton(),this.gameModel.isLocalPlayerOnTable()?this.promptLabel.text=1===t.length?"等待玩家加入":"等待游戏开始":this.enableTouchSeat(),e.isGaming){var n=e.activePlayer;if(n){var i=ActiveUtil.calculatePlayerRemainTime(this.roomModel.getOperationDuration(),n.actionStartAt),o=ActiveUtil.createLegalAction(n.legalActions);this.switchPlayer(n.id,o,i)}e.dealerId&&this.allotMark(e.dealerId,e.smallBlindId,e.bigBlindId),this.communityCardList.dataProvider=new eui.ArrayCollection(e.communityCards),this.updateAllPots(e.pots,e.mainPot),this.gameModel.isLocalPlayerPlaying&&(this.promptLabel.visible=!1)}},t.prototype.startTimer=function(){return __awaiter(this,void 0,void 0,function(){var e;
return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.roomModel.startTimer(this.roomModel.getRoomId(),this.userModel.accessToken)];case 1:return t.sent(),this.startRoomButton.visible=!1,[3,3];case 2:return e=t.sent(),MessageAlert.show(e.message+", 请重试",e.status),[3,3];case 3:return[2]}})})},t.prototype.subscribePersonalChannel=function(){var e=Channel.TEXAS_HOLDEM+"#"+this.userModel.id;CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.subscribePublicChannel=function(){var e=Channel.TEXAS_HOLDEM+"|"+this.roomModel.getRoomId();CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.subscribeBuyInChannel=function(){var e=Channel.BUY_IN+"#"+this.userModel.id;CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.subscribeRoomChannel=function(){var e=Channel.ROOM+"|"+this.roomModel.getRoomId();CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.subscribeRoomMessageChannel=function(){var e=Channel.ROOM_MESSAGE+"|"+this.roomModel.getRoomId();CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.subscribeLaiwanChannel=function(){var e=Channel.LAIWAN+"#"+this.userModel.id;CentrifugeServer.sharedInstance().subscribe(e)},t.prototype.queryUnprocessedBuyInApplication=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.buyInModel.listApplications(this.roomModel.getRoomId(),this.userModel.accessToken,"waiting")];case 1:return e=n.sent(),t=e.result.applications,t.length>0?this.messageAlarm.showDot():this.messageAlarm.hideDot(),[2]}})})},t.prototype.buildSeats=function(){var e=this,t=(this.roomModel.getMaximumPlayerAmount(),SeatUtil.getConfigByAmount(this.roomModel.getMaximumPlayerAmount()));Object.keys(t).forEach(function(n){var i=new SeatView(t[n]);i.addEventListener(SeatTouchEvent.TouchSeat,e.onTouchSeat,e),e.seatViews.push(i),e.group.addChild(i)})},t.prototype.showLeaderboard=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),SceneManager.sharedInstance().pushScene(new LeaderboardScene(this.roomModel.getRoomId()))},t.prototype.playWinnerAnimation=function(e){var t=this,n=RES.getRes(e+"_json"),i=RES.getRes(e+"_png"),o=new egret.MovieClipDataFactory(n,i),r=new egret.MovieClip(o.generateMovieClipData(e));r.x=195,r.y=800,this.group.addChild(r),r.gotoAndPlay(e),r.once(egret.Event.COMPLETE,function(){setTimeout(function(){t.group.removeChild(r),r=void 0},2e3)},this)},t.prototype.showCountdownTimer=function(e){var t=this;this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=void 0);var n=e;this.countdownTimer=setInterval(function(){n-=1,t.countdownLabel.text=t.roomModel.getRoomCountdown(n),0>=n&&(clearInterval(t.countdownTimer),t.countdownTimer=void 0)},1e3)},t.prototype.onRoomTimerStart=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return Toast.show("房间计时已开启, 等待开始游戏..."),[4,this.buildRoom()];case 1:return e.sent(),[4,this.buildGame()];case 2:return e.sent(),[2]}})})},t.prototype.adjustPlayerViewPosition=function(){var e=this,t=this.gameModel.seatDiff;this.playerViews.forEach(function(n){var i=n.getSeatNumber(),o=e.roomModel.getMaximumPlayerAmount(),r=SeatUtil.calculateCoordinate(i,t,o);n.setCoordinate(r)})},t.prototype.adjustSeatPosition=function(){var e=this,t=this.gameModel.seatDiff;this.seatViews.forEach(function(n){var i=n.getSeatNumber(),o=e.roomModel.getMaximumPlayerAmount(),r=SeatUtil.calculateCoordinate(i,t,o);n.updatePosition(r.x,r.y)}),this.gameModel.isLocalPlayerOnTable()?this.disableTouchSeat():this.enableTouchSeat()},t.prototype.adjustHandCardPosition=function(){var e=this,t=this.gameModel.seatDiff;this.handCards.forEach(function(n){var i=n.getSeatNumber(),o=e.roomModel.getMaximumPlayerAmount(),r=SeatUtil.calculateCoordinate(i,t,o);n.setCoordinate(r)})},t.prototype.restorePlayerView=function(e){var t=this,n=this.playerViews.slice();n.forEach(function(n){var i=e.some(function(e){return n.isPlayerIdEqualTo(e.id)&&n.getSeatNumber()===e.seat});i||t.removePlayerView(n)}),e.forEach(function(e){var n=t.playerViews.find(function(t){return t.isPlayerIdEqualTo(e.id)}),i=t.gameModel.seatDiff,o=e.seat,r=t.roomModel.getMaximumPlayerAmount(),a=SeatUtil.calculateCoordinate(o,i,r);n?(n.setPlayer(e),n.setCoordinate(a)):t.createNewPlayerView(e,a)})},t.prototype.restorePlayerHandCard=function(e){var t=this;this.clearHandCards(),e.forEach(function(e){e.id===t.userModel.id&&(t.cardTypeLabel.text=e.strength?PokerAnalyzer.getCardTypeByResult(e.strength):" "),t.playerViews.forEach(function(n){n.isPlayerIdEqualTo(e.id)&&e.state!==PlayerState.NotInGame&&(n.isPlayerIdEqualTo(t.userModel.id)?e.holeCard.forEach(function(e,i){var o=new Card({name:e});0===i?t.createCard(o,n.getSeatNumber(),n.getCoordinate(),1790,0,!1):t.createCard(o,n.getSeatNumber(),n.getCoordinate(),1810,10,!1)}):e.state!==PlayerState.Folded&&(t.createCard(null,n.getSeatNumber(),n.getCoordinate(),1790,0,!1),t.createCard(null,n.getSeatNumber(),n.getCoordinate(),1810,10,!1)))})})},t.prototype.handleGameStart=function(e){this.clearTimer(),this.promptLabel.visible=!1,this.reset();var t=e.playersForStack;this.updatePlayersStack(t),this.updateMainPot(e.mainPot),this.allotMark(e.dealer.id,e.smallBlind.id,e.bigBlind.id),this.betBlinds(e.smallBlind,e.bigBlind),this.debugView.updateGameId(this.gameModel.gameId)},t.prototype.handleDealCards=function(e){var t=this,n=1790;this.playerViews.forEach(function(e){e.isPlayerIdEqualTo(t.userModel.id)||t.createCard(null,e.getSeatNumber(),e.getCoordinate(),n)}),n=1810;var i=10;this.playerViews.forEach(function(e){e.isPlayerIdEqualTo(t.userModel.id)||t.createCard(null,e.getSeatNumber(),e.getCoordinate(),n,i)})},t.prototype.handleHoleCards=function(e){var t=this,n=e.handCards||[],i=1790,o=this.playerViews.find(function(e){return e.isPlayerIdEqualTo(t.userModel.id)});if(o){this.createCard(n[0],o.getSeatNumber(),o.getCoordinate(),i),i=1810;var r=10;this.createCard(n[1],o.getSeatNumber(),o.getCoordinate(),i,r),this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByResult(e.strength)}},t.prototype.updateMainPot=function(e){this.mainPotLabel.text="底池: "+MoneyFormatter.addChineseUnit(e)},t.prototype.allotMark=function(e,t,n){this.playerViews.forEach(function(i){return i.isPlayerIdEqualTo(e)?(i.setMark("D"),!0):i.isPlayerIdEqualTo(t)?(i.setMark("SB"),!0):i.isPlayerIdEqualTo(n)?(i.setMark("BB"),!0):void 0})},t.prototype.betBlinds=function(e,t){this.playerViews.forEach(function(n){return n.isPlayerIdEqualTo(e.id)?(n.updateScoreboard(e.amount),n.updateStack(e.stack),!0):n.isPlayerIdEqualTo(t.id)?(n.updateScoreboard(t.amount),n.updateStack(t.stack),!0):void 0})},t.prototype.createCard=function(e,t,n,i,o,r){void 0===o&&(o=0),void 0===r&&(r=!0);var a=this.pokerTypeModel.getType(),s=new HandCardImage({seatNumber:t,coordinate:n,cardName:e?e.name:"",rotation:i,additionX:o,animate:r,pokerType:a});this.handCards.push(s),this.group.addChild(s)},t.prototype.updateStrength=function(e){this.cardTypeLabel.text=PokerAnalyzer.getCardTypeByResult(e.strength)},t.prototype.handleDraw=function(e){var t=this;setTimeout(function(){t.playerViews.forEach(function(e){e.getCurrentStatus()!==GameAction.Fold&&e.getCurrentStatus()!==GameAction.AllIn&&(e.removeStatusImage(),e.removeScoreboard())})},500);var n=e.communityCards.filter(function(e){return e.value>0}),i=0;if(3===n.length){i=500,SoundManager.sharedInstance().playEffectSound(SoundEffectSource.DEAL_CARD),this.communityCardList.dataProvider=new eui.ArrayCollection(["","","","",""]);var o=new eui.HorizontalLayout;o.gap=-83,this.communityCardList.layout=o,egret.Tween.get(o).to({gap:4},400)}setTimeout(function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.DEAL_CARD),t.communityCardList.dataProvider=new eui.ArrayCollection(e.communityCards)},i)},t.prototype.checkTimeout=function(){this.playerModel.checkTimeout(this.gameModel.gameId)},t.prototype.onPlayerTimerEnd=function(e){this.checkTimeout()},t.prototype.onTimerWarning=function(e){"true"===SoundManager.sharedInstance().getIsVibrate()&&window.postMessage(JSON.stringify({command:GameCommand.TIMER_WARNING,payload:e.time}),"*")},t.prototype.removePlayerView=function(e){var t=this;this.showSeat(e.getSeatNumber()),e.removeEventListener(PlayerViewEvent.TimerEnd,this.onPlayerTimerEnd,this),e.removeEventListener(PlayerViewEvent.Touch,this.onPlayerViewTouch,this),e.removeEventListener(PlayerViewEvent.Warning,this.onTimerWarning,this),this.playerViews.forEach(function(n,i){n.isPlayerIdEqualTo(e.getPlayerId())&&t.playerViews.splice(i,1)}),e.destroy(),e=void 0},t.prototype.showSeat=function(e){var t=this.seatViews.find(function(t){return t.getSeatNumber()===e});t&&(t.visible=!0)},t.prototype.hideSeat=function(e){var t=this.seatViews.find(function(t){return t.getSeatNumber()===e});t&&(t.visible=!1)},t.prototype.createNewPlayerView=function(e,t){this.hideSeat(e.seat);var n=this.roomModel.getPropertyName(),i=new PlayerView(e,t,n);i.addEventListener(PlayerViewEvent.TimerEnd,this.onPlayerTimerEnd,this),i.addEventListener(PlayerViewEvent.Touch,this.onPlayerViewTouch,this),i.isPlayerIdEqualTo(this.userModel.id)&&i.addEventListener(PlayerViewEvent.Warning,this.onTimerWarning,this),this.group.addChild(i),this.playerViews.push(i)},t.prototype.handleNewPlayerJoin=function(e){var t=this;this.receivedMessageDates.push(new Date),this.promptLabel.text="等待游戏开始",SoundManager.sharedInstance().playEffectSound(SoundEffectSource.PLAYER_JOIN);var n=e.newPlayer.seat,i=this.gameModel.seatDiff,o=this.roomModel.getMaximumPlayerAmount(),r=SeatUtil.calculateCoordinate(n,i,o);if(this.createNewPlayerView(e.newPlayer,r),e.newPlayer.id===this.userModel.id&&(this.adjustPlayerViewPosition(),this.adjustHandCardPosition(),this.adjustSeatPosition(),this.seatNumber=e.newPlayer.seat,this.setMessageButton(),this.hallSlug&&this.seatNumber&&(this.renewalSeat(this.hallSlug,this.seatNumber),clearInterval(this.renewalInterval),this.renewalInterval=void 0,this.renewalInterval=setInterval(function(){t.renewalSeat(t.hallSlug,t.seatNumber)},3e4))),this.startWaitingGame(),this.roomModel.hasTimer()){if(this.roomModel.isTimerStatusEqualTo(RoomTimerStatus.TIMING))return;var a=this.roomModel.getAutoStartPlayerAmount();a>0&&a===this.gameModel.currentPlayerAmount&&this.startTimer()}},t.prototype.handlePlayerLeave=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return this.receivedMessageDates.push(new Date),this.playerViews.forEach(function(t,n){if(t.isPlayerIdEqualTo(e.playerId)){var o=t.getCoordinate();i.removeHandCardsByCoordinate(o),i.removePlayerView(t)}}),e.playerId!==this.userModel.id?[3,3]:(this.cardTypeLabel.text=" ",this.promptLabel.visible=!1,this.enableTouchSeat(),this.hidePlayGameButtonGroup(),this.setMessageButton(),this.hallSlug&&this.seatNumber?(t=this.roomModel.getRoomId(),n=this.userModel.accessToken,[4,this.playerModel.releaseSeat(t,this.hallSlug,this.seatNumber,n)]):[3,2]);case 1:o.sent(),o.label=2;case 2:this.seatNumber=void 0,o.label=3;case 3:return this.gameModel.isLocalPlayerOnTable()&&1===this.gameModel.currentPlayerAmount&&(this.promptLabel.text="等待玩家加入",this.promptLabel.visible=!0),[2]}})})},t.prototype.removeHandCardsByCoordinate=function(e){this.handCards.forEach(function(t){t.getCoordinate()===e&&(t.destroy(),t=void 0)})},t.prototype.switchPlayer=function(e,t,n){var i=this;this.currentActionPlayerId=e,this.playerViews.forEach(function(t){t.stopTimer(),t.isPlayerIdEqualTo(e)&&(t.startTimer(i.roomModel.getOperationDuration(),n),t.removeStatusImage(),t.removeScoreboard())}),e===this.userModel.id?(this.updateStatusForPlayGameButtonGroup(t),this.playGameButtonGroup.showSwitchButtons()):this.gameModel.isLocalPlayerPlaying&&this.showAutoButtons()},t.prototype.handleSwitchPlayer=function(e){this.receivedMessageDates.push(new Date);var t=this.handCards.filter(function(e){return e.getCoordinate().direction===Direction.Bottom});this.gameModel.isLocalPlayerPlaying&&t.length<2&&this.buildGame();var n=e.playerId,i=ActiveUtil.createLegalAction(e.legalActions);this.switchPlayer(n,i,this.roomModel.getOperationDuration())},t.prototype.updateStatusForPlayGameButtonGroup=function(e){if(e){if(!e.mustAllIn&&e.couldRaise){var t=e.raiseAmount.min,n=e.raiseAmount.max,i=2*this.roomModel.getSmallBlind();this.raiseSelector.updateSliderValue(t,n,i),this.quickRaiser.updateLimits(t,n)}this.playGameButtonGroup.update(e,this.gameModel.mainPot)}},t.prototype.handlePlayerCall=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ADD_CHIPS),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.Call))})},t.prototype.handlePlayerRaise=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ADD_CHIPS),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.Raise))})},t.prototype.handlePlayerAllIn=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ALL_IN),this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.playerId)&&(t.showFire(),t.updateScoreboard(e.amount),t.updateStack(e.stack),t.updateStatusImage(GameAction.AllIn))})},t.prototype.handlePlayerCheck=function(e){var t=this;SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CHECK),this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(e.playerId)&&(n.updateStatusImage(GameAction.Check),n.isPlayerIdEqualTo(t.userModel.id)&&t.hidePlayGameButtonGroup())})},t.prototype.handlePlayerFold=function(e){var t=this;SoundManager.sharedInstance().playEffectSound(SoundEffectSource.FOLD),this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(e.playerId)&&(n.showCover(),n.updateStatusImage(GameAction.Fold),t.userModel.id!==e.playerId&&t.removeHandCardsByCoordinate(n.getCoordinate()))}),this.userModel.id===e.playerId&&this.hidePlayGameButtonGroup()},t.prototype.updateAllPots=function(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=0),e.length>1){var n=void 0;1===e.length?(n=new eui.VerticalLayout,n.horizontalAlign="center"):(n=new eui.TileLayout,n.columnAlign="justifyUsingWidth",n.rowAlign="top",n.orientation="rows",n.horizontalAlign="contentJustify",n.verticalAlign="contentJustify"),this.potsList.layout=n,this.potsList.dataProvider=new eui.ArrayCollection(e)}this.updateMainPot(t)},t.prototype.handleUpdatePots=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CHIP_TO_POOL),this.updateAllPots(e.pots,e.mainPot)},t.prototype.handleShowdown=function(e){var t=this;this.clearHandCards();var n=e.showdownPlayers;n.forEach(function(e){e.id===t.userModel.id&&(t.cardTypeLabel.text=" "),t.playerViews.forEach(function(n){if(n.isPlayerIdEqualTo(e.id)){var i=PokerAnalyzer.getCardTypeByResult(e.strength);e.isWinner&&(t.winningCardLabel.text=i+"赢",t.winningCardLabel.visible=!0,t.communityCardList.dataProvider=new eui.ArrayCollection(t.gameModel.communityCards)),n.showCardType(i);var o=e.holeCard;n.showCard(o,t.pokerTypeModel.getType())}})})},t.prototype.reset=function(){clearTimeout(this.resetTimer),this.winningCardLabel.visible=!1,this.playerViews.forEach(function(e){e.reset()}),this.clearHandCards(),this.cardTypeLabel.text=" ",this.communityCardList.dataProvider=new eui.ArrayCollection([]),this.potsList.dataProvider=new eui.ArrayCollection([]),this.updateMainPot(0)},t.prototype.handleGameEnd=function(e){var t=this;try{SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CHIP_TO_PLAYER),this.currentActionPlayerId=void 0,this.hidePlayGameButtonGroup(),this.resetTimer=setTimeout(function(){t.reset()},this.RESET_DURATION);var n=this.gameModel.isDealer()?this.START_GAME_DURATION_BY_DELAER:this.DEFAULT_START_GAME_DURATION;this.gameModel.isLocalPlayerOnTable()&&this.startGameByDuration(n);var i=e.winners;this.playerViews.forEach(function(e){e.stopTimer(),e.hideFire();var n=i.find(function(t){return e.isPlayerIdEqualTo(t.id)});n&&(e.isPlayerIdEqualTo(t.userModel.id)&&(i.length>1?t.playWinnerAnimation("tie"):t.playWinnerAnimation("you_win")),e.playWinnerAnimation())}),e.prize.forEach(function(e){var n=t.playerViews.find(function(t){return t.isPlayerIdEqualTo(e.id)});n&&n.showPrizeLabel(e.amount)});var o=e.playersForStack;this.updatePlayersStack(o)}catch(r){MessageAlert.show(r.message)}},t.prototype.updatePlayersStack=function(e){var t=this;void 0===e&&(e=[]),e.forEach(function(e){var n=t.playerViews.find(function(t){return t.isPlayerIdEqualTo(e.id)});n&&n.updateStack(e.stack)})},t.prototype.showReconnectingView=function(){var e=this;if(!this.isReconnectFaild)return CentrifugeServer.sharedInstance().isConnected?void Toast.show("已重新连接"):void(this.connectionTimer||(LoadingCircle.sharedInstance().show(this),this.connectionTimer=setTimeout(function(){e.isReconnectFaild=!0,setTimeout(function(){LoadingCircle.sharedInstance().hide()},500);var t=[{name:"离开",action:function(){e.leaveRoom()}},{name:"重连",action:function(){e.showReconnectingView()}}];MessageAlert.show("连接超时, 请检查您的网络设置",e.proxyModel.getProxyCode(),t),clearTimeout(e.connectionTimer),e.connectionTimer=void 0},1e4)))},t.prototype.onCentrifugeConnected=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){return this.isReconnectFaild=!1,e=new Date,t={action:"on connect",date:e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),message:"centrifuge已重新连接"},this.debugView.updateLog(t),this.connectionTimer&&(clearTimeout(this.connectionTimer),this.connectionTimer=void 0),this.subscribeAllChannels(),LoadingCircle.sharedInstance().hide(),[2]})})},t.prototype.onCentrifugeDisconnected=function(e){this.isReconnectFaild=!1;var t=new Date,n={action:"on disconnect",date:t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),message:"centrifuge的连接已断开"};this.debugView.updateLog(n),CentrifugeServer.sharedInstance().unsubscribeAll(),this.reconnectCentrifuge()},t.prototype.reconnectCentrifuge=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a,s,c=this;return __generator(this,function(u){switch(u.label){case 0:this.showReconnectingView(),u.label=1;case 1:return u.trys.push([1,3,,4]),e=ApiConfig.ApiDomain,t=this.userModel.countryCode,n=this.userModel.carrier,[4,this.proxyModel.getFastestProxyFromServer(ApiProxies,t,n,e)];case 2:return i=u.sent(),ApiConfig.ApiDomain=i.proxy,this.setProxyCode(),o=new Date,r={action:"正在连接到"+i.proxy,date:o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),message:i.serveload+" / "+i.delay},this.debugView.updateLog(r),CentrifugeServer.sharedInstance().reconnect(i.proxy),[3,4];case 3:return a=u.sent(),LoadingCircle.sharedInstance().hide(),this.connectionTimer&&(clearTimeout(this.connectionTimer),this.connectionTimer=void 0),this.isReconnectFaild=!1,s=[{name:"离开",action:function(){c.leaveRoom()}},{name:"重试",action:function(){c.reconnectCentrifuge()}}],MessageAlert.show(a.message,"",s),[3,4];case 4:return[2]}})})},t.prototype.startGameByDuration=function(e){var t=this;this.startGameTimer||(this.startGameTimer=setTimeout(function(){t.playerModel.startGame(t.roomModel.getRoomId()),clearTimeout(t.startGameTimer),t.startGameTimer=void 0},e))},t.prototype.onTouchFold=function(){this.updateLocalPlayerStatus(GameAction.Fold),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.hidePlayGameButtonGroup(),this.playerModel.fold(this.gameModel.gameId)},t.prototype.onTouchCheck=function(){this.updateLocalPlayerStatus(GameAction.Check),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.hidePlayGameButtonGroup(),this.playerModel.check(this.gameModel.gameId)},t.prototype.onTouchCall=function(e){var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.Call),this.stopLocalPlayerTimer(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.hidePlayGameButtonGroup(),this.playerModel.call(this.gameModel.gameId)},t.prototype.onTouchRaise=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.setChildIndex(this.raiseSelector,-1),this.raiseSelector.show()},t.prototype.onTouchQuickRaise=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.setChildIndex(this.quickRaiser,-1),this.quickRaiser.show()},t.prototype.onPlayerRaise=function(e){var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.Raise),this.stopLocalPlayerTimer(),this.hidePlayGameButtonGroup(),this.playerModel.raise(this.gameModel.gameId,t)},t.prototype.onPlayerAllIn=function(e){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var t=e.data;this.updateLocalPlayerScoreboard(t),this.updateLocalPlayerStatus(GameAction.AllIn),this.stopLocalPlayerTimer(),this.hidePlayGameButtonGroup(),this.playerModel.allIn(this.gameModel.gameId,t)},t.prototype.updateLocalPlayerScoreboard=function(e){var t=this;this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(t.userModel.id)&&n.updateScoreboard(e)})},t.prototype.updateLocalPlayerStatus=function(e){var t=this;this.playerViews.forEach(function(n){n.isPlayerIdEqualTo(t.userModel.id)&&n.updateStatusImage(e)})},t.prototype.stopLocalPlayerTimer=function(){var e=this;this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.userModel.id)&&t.stopTimer()})},t.prototype.onPlayerViewTouch=function(e){var t=this.gameModel.isLocalPlayerOnTable(),n=e.player.id!==this.userModel.id,i=t&&n,o=new PlayerDetailScene(e.player,this.gameModel.players,i,this.gameModel.gameId,this.roomModel.getRoomId());SceneManager.sharedInstance().pushScene(o)},t.prototype.onTouchSeat=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.seatNumber=e.seatNumber,this.isAutoSit=!1,this.checkBalance(),[2]})})},t.prototype.showBuyInScene=function(){var e=this.roomModel.getRoomId(),t=this.roomModel.getMinBuyIn(),n=this.roomModel.getMaxBuyIn(),i=this.roomModel.isPermitBuyIn(),o=this.roomModel.isCreator(this.userModel.id),r=this.roomModel.getPropertyName(),a={roomId:e,minBuyIn:t,maxBuyIn:n,isPermitBuyIn:i,isCreator:o,propertyName:r},s=new BuyInScene(a);SceneManager.sharedInstance().pushScene(s)},t.prototype.checkBalance=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a;return __generator(this,function(s){switch(s.label){case 0:LoadingComponent.sharedInstance().show(this,"正在查询带入余额..."),s.label=1;case 1:return s.trys.push([1,3,,4]),e=this.roomModel.getRoomId(),t=this.userModel.id,n=this.userModel.accessToken,[4,this.playerModel.queryBalance(this.roomModel.getRoomId(),t,n)];case 2:return i=s.sent(),o=new BuyInBalance(i.result),r=o.amount-o.subtotal+o.balance,r<2*this.roomModel.getSmallBlind()?this.requestBuyIn():this.sitDown(this.seatNumber),[3,4];case 3:return a=s.sent(),LoadingComponent.sharedInstance().hide(),MessageAlert.show(a.message,a.status),[3,4];case 4:return[2]}})})},t.prototype.requestBuyIn=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a,s=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),this.roomModel.isInCoin()?(LoadingComponent.sharedInstance().show(this,"正在补充金币..."),e=this.roomModel.getRoomId(),t=this.userModel.id,n=this.userModel.accessToken,i=this.roomModel.getMinBuyIn(),o=this.userModel.nickname,[4,this.buyInModel.requestBuyIn(e,i,t,o,n)]):[3,2];case 1:return c.sent(),[3,3];case 2:LoadingComponent.sharedInstance().hide(),this.showBuyInScene(),c.label=3;case 3:return[3,5];case 4:return r=c.sent(),LoadingComponent.sharedInstance().hide(),"insufficient_property"===r.errorType?(a=[{name:"取消"},{name:"前往",action:function(){s.leaveForMall()}}],MessageAlert.show("您的金币余额不足以参与该局游戏, 请前往商城中进行兑换。",r.status,a)):MessageAlert.show(r.message,r.status),[3,5];case 5:return[2]}})})},t.prototype.sitDown=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:LoadingComponent.sharedInstance().show(this,"正在加入游戏..."),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this.playerModel.sitDown(this.roomModel.getRoomId(),e,this.userModel.accessToken)];case 2:return n.sent(),this.disableTouchSeat(),this.promptLabel.visible=!0,[3,5];case 3:return t=n.sent(),"stack_not_enough"===t.errorType?this.showBuyInScene():"seated_by_others"===t.errorType&&this.isAutoSit?Toast.show(""+t.message):MessageAlert.show(""+t.message,t.status),[3,5];case 4:return setTimeout(function(){LoadingComponent.sharedInstance().hide()},300),[7];case 5:return[2]}})})},t.prototype.leaveForMall=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:LoadingComponent.sharedInstance().show(this,"正在离开房间..."),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.playerModel.leave(this.roomModel.getRoomId(),this.userModel.accessToken)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),egret.log(e),[3,5];case 4:return LoadingComponent.sharedInstance().hide(),Device.sharedInstance().isInReactNative()?window.postMessage(JSON.stringify({command:GameCommand.LEAVE_FOR_MALL}),"*"):this.quit(),[7];case 5:return[2]}})})},t.prototype.onMenuButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e=new MenuView;e.once(MenuTouchEvent.TouchItem,this.onMenuItemTouch,this),SceneManager.sharedInstance().pushScene(e)},t.prototype.onReviewboardButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),SceneManager.sharedInstance().pushScene(new ReviewboardScene(this.roomModel.getRoomId()))},t.prototype.showSettingsView=function(){var e=new SettingsView;e.once(egret.Event.CHANGE,this.onPokerTypeChange,this),SceneManager.sharedInstance().pushScene(e)},t.prototype.onPokerTypeChange=function(e){window.postMessage(JSON.stringify({command:GameCommand.SAVE_POKER_TYPE,payload:e.data}),"*")},t.prototype.showCardPattern=function(){SceneManager.sharedInstance().pushScene(new CardPattern)},t.prototype.showSoundSettingView=function(){SceneManager.sharedInstance().pushScene(new SoundSettingView)},t.prototype.onMenuItemTouch=function(e){switch(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),e.itemIndex){case 0:this.showCardPattern();break;case 1:this.showSettingsView();break;case 2:this.showSoundSettingView();break;case 3:this.showBuyInScene();break;case 4:this.touchStandUp();break;case 5:this.leaveRoom()}},t.prototype.touchStandUp=function(){var e=this;if(this.gameModel.isLocalPlayerAllIn)return void Toast.show("请等待该局游戏结束。");var t=this.seatViews[0].touchEnabled;if(t)return void Toast.show("您还没有入座");var n=[{name:"确定",action:function(){e.standUp()}},{name:"取消"}];if(this.gameModel.isLocalPlayerPlaying){var i=this.roomModel.isInCoin()?"金币会在本局结束后结算":"";MessageAlert.show("离开座位会自动帮您弃牌, 确定要离开吗?",i,n)}else this.roomModel.isInCoin()?MessageAlert.show("您确定要离开座位吗?","金币会在本局结束后结算",n):this.standUp()},t.prototype.standUp=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:LoadingComponent.sharedInstance().show(this,"正在离开座位..."),i.label=1;case 1:return i.trys.push([1,5,6,7]),e=this.roomModel.getRoomId(),t=this.userModel.accessToken,[4,this.playerModel.standUp(e,t)];case 2:return i.sent(),this.hallSlug&&this.seatNumber?[4,this.playerModel.releaseSeat(e,this.hallSlug,this.seatNumber,t)]:[3,4];case 3:i.sent(),this.seatNumber=void 0,i.label=4;case 4:return clearInterval(this.renewalInterval),this.hidePlayGameButtonGroup(),[3,7];case 5:return n=i.sent(),MessageAlert.show(n.message,n.status),[3,7];case 6:return setTimeout(function(){LoadingComponent.sharedInstance().hide()},300),[7];case 7:return[2]}})})},t.prototype.quit=function(){EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this),SceneManager.sharedInstance().replaceScene(new LaunchScene)},t.prototype.leaveRoom=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:if(this.gameModel.isLocalPlayerAllIn)return Toast.show("请等待该局游戏结束。"),[2];LoadingComponent.sharedInstance().show(this,"正在离开房间..."),i.label=1;case 1:return i.trys.push([1,5,6,7]),e=this.roomModel.getRoomId(),t=this.userModel.accessToken,[4,this.playerModel.leave(e,t)];case 2:return i.sent(),this.hallSlug&&this.seatNumber?[4,this.playerModel.releaseSeat(e,this.hallSlug,this.seatNumber,t)]:[3,4];case 3:i.sent(),i.label=4;case 4:return[3,7];case 5:return n=i.sent(),MessageAlert.show(n.message,n.status),[3,7];case 6:return LoadingComponent.sharedInstance().hide(),Device.sharedInstance().isInReactNative()?window.postMessage(JSON.stringify({command:GameCommand.LEAVE_ROOM,payload:this.roomModel.getRoomId()}),"*"):this.quit(),[7];case 7:return[2]}})})},t.prototype.onChatButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e={allow_player_text_message:this.roomModel.allowPlayerTextMessage()};window.postMessage(JSON.stringify({command:GameCommand.SHOW_CHAT_VIEW,payload:e}),"*")},t.prototype.onMicrophoneButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),Device.sharedInstance().isInReactNative()?window.postMessage(JSON.stringify({command:GameCommand.CHECK_AUDIO_PERMISSION}),"*"):SceneManager.sharedInstance().pushScene(new AudioScene(this.roomModel.getRoomId()))},t.prototype.showAutoButtons=function(){var e=this;this.gameModel.isLocalPlayerPlaying&&this.playerViews.forEach(function(t){t.isPlayerIdEqualTo(e.userModel.id)&&t.getCurrentStatus()!==GameAction.Fold&&t.getCurrentStatus()!==GameAction.AllIn&&e.playGameButtonGroup.showAutoButtons()})},t.prototype.hidePlayGameButtonGroup=function(){this.playGameButtonGroup.hide(),this.raiseSelector.hide(),this.quickRaiser.hide()},t.prototype.disableTouchSeat=function(){this.seatViews.forEach(function(e){e.disableTouch()})},t.prototype.enableTouchSeat=function(){this.seatViews.forEach(function(e){e.enableTouch()})},t.prototype.clearHandCards=function(){var e=this;this.handCards.forEach(function(t){e.group.removeChild(t),t=void 0}),this.handCards=[]},t.prototype.clearTimer=function(){clearTimeout(this.connectionTimer),this.connectionTimer=void 0},t.prototype.onReceivedGameMessage=function(e){this.debugView.updateLog(e.data)},t.prototype.onMessageAlarmTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.messageAlarm.hideDot();var e=new ApplicationRecordScene(this.roomModel.getRoomId(),this.roomModel.getMinBuyIn());SceneManager.sharedInstance().pushScene(e)},t.prototype.handlePlayerBuyIn=function(e){var t={applicantNickname:e.applicantNickname,amount:e.amount,applicationId:e.applicationId,minBuyIn:this.roomModel.getMinBuyIn(),roomId:this.roomModel.getRoomId()},n=new BuyInApplicationScene(t);SceneManager.sharedInstance().pushScene(n),this.messageAlarm.showDot()},t.prototype.handleProcessedBuyInApplication=function(e){if(e.applicantId===this.userModel.id)if(e.approve){var t=this.roomModel.isCreator(this.userModel.accessToken),n=this.roomModel.isPermitBuyIn(),i=!t&&n?"您的带入申请已通过":"带入已补充";this.roomModel.isInCoin()&&(i="已补充"+e.amount+"金币"),Toast.show(i),!this.gameModel.isLocalPlayerOnTable()&&this.seatNumber&&this.sitDown(this.seatNumber)
}else MessageAlert.show("您的带入申请已被拒绝, 您可以尝试再次申请。")},t.prototype.handleReceivedTextMessage=function(e){var t=e.data.text,n=e.data.id;if(-1!==t.search("/")||-1!==t.search("/debug"))return void(n===this.userModel.id&&(this.debugView.visible=-1!==t.search("open")));var i=this.blockModel.isBlockedPlayer(e.data.id);if(!i){var o=e.data.nickname,r=o+": "+t;this.isOpenBarrage&&Barrage.shoot(this,r);var a=e.data;window.postMessage(JSON.stringify({command:GameCommand.RECEIVED_CHAT_MESSAGE,payload:a}),"*")}},t.prototype.handleReceivedPropsMessage=function(e){var t=e.data.from_user_id,n=e.data.to_user_id,i=this.playerViews.find(function(e){return e.isPlayerIdEqualTo(t)}),o=this.playerViews.find(function(e){return e.isPlayerIdEqualTo(n)});i&&o&&(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.THROW_PROPS),PropsUtil.playAnimation(i,o,this.group,e.data.file))},t.prototype.handleReceivedStickerMessage=function(e){var t=e.data.from_user_id,n=e.data.file;this.playerViews.forEach(function(e){e.isPlayerIdEqualTo(t)&&e.playStickerAnimation(n)})},t.prototype.handleReceivedAudioMessage=function(e){if("true"===SoundManager.sharedInstance().getIsPlayAudio()){var t=e.data.from_user_id;if(!this.blockModel.isBlockedPlayer(t)){var n=(e.data.content,e.data.duration+.5),i=e.data;"aac"===e.data.codec&&window.postMessage(JSON.stringify({command:GameCommand.PLAY_AUDIO,payload:i}),"*"),this.playerViews.forEach(function(e){e.isPlayerIdEqualTo(t)&&(e.showTalkingSign(),setTimeout(function(){e.hideTalkingSign()},1e3*n))})}}},t.prototype.handleReceivedApplication=function(e){var t=new ClubApplicationScene(e.data);SceneManager.sharedInstance().pushScene(t)},t.prototype.onConnected=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return egret.log("重新连接"),[4,this.buildRoom()];case 1:return e.sent(),[4,this.buildGame()];case 2:return e.sent(),[2]}})})},t.prototype.onClose=function(){egret.log("连接断开"),WebSocketRequest.sharedInstance().reconnect(ApiConfig.ApiDomain)},t.prototype.onError=function(){egret.log("连接出错")},t.prototype.onReceivedMessage=function(e){var t=this,n=new Date,i={action:"ws请求("+e.message.requestId+")",delay:WebSocketRequest.sharedInstance().delay,date:n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),message:JSON.stringify(e.message)};this.debugView.updateLog(i),LoadingComponent.sharedInstance().hide();var o=e.message,r=o.response,a=[];return 401===o.httpStatus?(a=[{name:"离开",action:function(){t.leaveRoom()}}],void MessageAlert.show("您的帐号已在其他设备上登陆,请重新登录。如果密码已泄漏,请及时修改。",o.requestId+": "+o.httpStatus,a)):200!==o.httpStatus?void MessageAlert.show("服务器正在开小差, 请稍后再试",o.requestId+": "+o.httpStatus,a):r.ok?void 0:"not_in_room"===r.errorType?void egret.log(r.message):"room_in_gaming"===r.errorType?void egret.log("游戏已经开始了"):"cannot_start_game"===r.errorType?void egret.log("无法开始游戏"):"game_has_ended"===r.errorType?void egret.log("游戏已经结束"):"stack_not_enough"===r.errorType?void this.showBuyInScene():"not_your_turn"===r.errorType?void Toast.show(r.message):("room_timer_expired"===r.errorType&&(a=[{name:"离开",action:function(){t.leaveRoom()}},{name:"取消"}]),void MessageAlert.show(r.message,"",a))},t.prototype.queryMatchedData=function(){window.postMessage(JSON.stringify({command:GameCommand.QUERY_MATCHED_DATA}),"*")},t.prototype.renewalSeat=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,r;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=this.userModel.id,i=this.roomModel.getRoomId(),o=this.userModel.accessToken,[4,this.playerModel.renewalSeat(e,n,i,t,100,o)];case 1:return a.sent(),[3,3];case 2:return r=a.sent(),Toast.show(""+r.message),[3,3];case 3:return[2]}})})},t.prototype.showTreasureChest=function(){var e=new TreasureChestView(this.roomModel.getMinBuyIn());e.left=e.bottom=50,this.addChild(e)},t.prototype.queryAppVersion=function(){window.postMessage(JSON.stringify({command:GameCommand.QUERY_APP_VERSION}),"*")},t.prototype.onAppStateChange=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:return t=new Date,"active"!==e.data?[3,4]:(n=t.valueOf(),i=n-this.hideTime,.001*i>3?[4,this.buildRoom()]:[3,3]);case 1:return r.sent(),[4,this.buildGame()];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:"background"===e.data&&(this.hideTime=(new Date).valueOf()),r.label=5;case 5:return o={action:GameCommand.APP_STATE_CHANGE+" / "+e.data,date:t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),message:"应用状态改变: "+.001*(t.valueOf()-this.hideTime)+"s"},this.debugView.updateLog(o),[2]}})})},t.prototype.onCheckedAudioPermission=function(e){if(e.data===!0){var t=new AudioScene(this.roomModel.getRoomId());SceneManager.sharedInstance().pushScene(t)}},t.prototype.onReceivedMatchedData=function(e){var t=this,n=e.data.seat_number,i=e.data.hall_slug;e.data&&n&&i&&(this.leaderboardButton.visible=!1,this.showTreasureChest(),this.reviewboardButton.visible=!1,this.isAutoSit=!0,this.seatNumber=Number(n),this.hallSlug=i,this.renewalInterval=setInterval(function(){t.hallSlug&&t.seatNumber&&t.renewalSeat(t.hallSlug,t.seatNumber)},3e4))},t.prototype.onSubscribeSuccess=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return e.data===Channel.BUY_IN+"#"+this.userModel.id&&(this.isFirstSubscribed&&this.hallSlug&&setTimeout(function(){t.checkBalance()},300),this.isFirstSubscribed=!1),e.data!==Channel.TEXAS_HOLDEM+"|"+this.roomModel.getRoomId()?[3,3]:[4,this.buildRoom()];case 1:return n.sent(),[4,this.buildGame()];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.onBarrageStateChange=function(e){this.isOpenBarrage=e.data},t.prototype.onReceivedAppVersion=function(e){this.versionLabel.text=e.data},t.prototype.onSendMessageFailed=function(e){this.sendMessageToLocal(e.data)},t.prototype.sendMessageToLocal=function(e){var t={data:{stream:"room_message",payload:{action:MessageAction.Text,content:{from_user_nickname:this.userModel.nickname,text:e,from_user_id:this.userModel.id}}}};CentrifugeServer.sharedInstance().sendCustomMessage(t)},t.prototype.addEventListeners=function(){WebViewCenter.sharedInstance().addEventListener(WebViewEvent.APP_STATE_CHANGE,this.onAppStateChange,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.CHECK_AUDIO_PERMISSION,this.onCheckedAudioPermission,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_MATCHED_DATA,this.onReceivedMatchedData,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.BARRAGE_STATE_CHANGED,this.onBarrageStateChange,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_APP_VERSION,this.onReceivedAppVersion,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.SEND_CHAT_MESSAGE_FAILED,this.onSendMessageFailed,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.SubscribeSuccess,this.onSubscribeSuccess,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.messageAlarm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMessageAlarmTouch,this),this.startRoomButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startTimer,this),this.chatButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatButtonTouch,this),this.leaderboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showLeaderboard,this),this.microphoneButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.menuButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuButtonTouch,this),this.reviewboardButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReviewboardButtonTouch,this),this.raiseSelector.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.addEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.quickRaiser.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.quickRaiser.addEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.addEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.addEventListener(ButtonGroupEvent.TouchQuickRaise,this.onTouchQuickRaise,this),this.gameModel.addEventListener(GameEvent.ReceivedMessage,this.onReceivedGameMessage,this),this.gameModel.addEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.addEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.addEventListener(GameEvent.HoleCards,this.handleHoleCards,this),this.gameModel.addEventListener(GameEvent.UpdateStrength,this.updateStrength,this),this.gameModel.addEventListener(GameEvent.NewPlayer,this.handleNewPlayerJoin,this),this.gameModel.addEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.addEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.addEventListener(GameEvent.Call,this.handlePlayerCall,this),this.gameModel.addEventListener(GameEvent.AllIn,this.handlePlayerAllIn,this),this.gameModel.addEventListener(GameEvent.Raise,this.handlePlayerRaise,this),this.gameModel.addEventListener(GameEvent.Check,this.handlePlayerCheck,this),this.gameModel.addEventListener(GameEvent.Fold,this.handlePlayerFold,this),this.gameModel.addEventListener(GameEvent.UpdatePots,this.handleUpdatePots,this),this.gameModel.addEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.addEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.addEventListener(GameEvent.PlayerLeave,this.handlePlayerLeave,this),this.chatModel.addEventListener(ChatMessageEvent.Received_Text,this.handleReceivedTextMessage,this),this.chatModel.addEventListener(ChatMessageEvent.Received_Props,this.handleReceivedPropsMessage,this),this.chatModel.addEventListener(ChatMessageEvent.Received_Sticker,this.handleReceivedStickerMessage,this),this.chatModel.addEventListener(ChatMessageEvent.Received_Audio,this.handleReceivedAudioMessage,this),this.roomModel.addEventListener(RoomMessageEvent.TimerStart,this.onRoomTimerStart,this),this.clubManagerModel.addEventListener(ApplicationEvent.NewClubApplication,this.handleReceivedApplication,this),this.buyInModel.addEventListener(ApplicationEvent.NewBuyInApplication,this.handlePlayerBuyIn,this),this.buyInModel.addEventListener(ApplicationEvent.ProcessBuyInApplication,this.handleProcessedBuyInApplication,this),this.roomModel.addMessageListener(),this.gameModel.addMessageListener(),this.chatModel.addMessageListener(),this.clubManagerModel.addMessageListener(),this.buyInModel.addMessageListener()},t.prototype.onRemovedFromStage=function(){this.clearTimer(),clearInterval(this.aliveInterval),clearInterval(this.countdownTimer),clearInterval(this.queryApplicationInterval),clearInterval(this.renewalInterval),CentrifugeServer.sharedInstance().unsubscribeAll(),CentrifugeServer.sharedInstance().disconnect(),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.APP_STATE_CHANGE,this.onAppStateChange,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.CHECK_AUDIO_PERMISSION,this.onCheckedAudioPermission,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_MATCHED_DATA,this.onReceivedMatchedData,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.BARRAGE_STATE_CHANGED,this.onBarrageStateChange,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_APP_VERSION,this.onReceivedAppVersion,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.SEND_CHAT_MESSAGE_FAILED,this.onSendMessageFailed,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS,this.onReceivedMessage,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Disconnected,this.onCentrifugeDisconnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.SubscribeSuccess,this.onSubscribeSuccess,this),this.messageAlarm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMessageAlarmTouch,this),this.chatButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChatButtonTouch,this),this.leaderboardButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showLeaderboard,this),this.microphoneButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMicrophoneButtonTouch,this),this.menuButton.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuButtonTouch,this),this.raiseSelector.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.raiseSelector.removeEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.quickRaiser.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.quickRaiser.removeEventListener(RaiseEvent.AllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.removeEventListener(RaiseEvent.Raise,this.onPlayerRaise,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchRaise,this.onTouchRaise,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchFold,this.onTouchFold,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCheck,this.onTouchCheck,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchCall,this.onTouchCall,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchAllIn,this.onPlayerAllIn,this),this.playGameButtonGroup.removeEventListener(ButtonGroupEvent.TouchQuickRaise,this.onTouchQuickRaise,this),this.gameModel.removeEventListener(GameEvent.ReceivedMessage,this.onReceivedGameMessage,this),this.gameModel.removeEventListener(GameEvent.NewPlayer,this.handleNewPlayerJoin,this),this.gameModel.removeEventListener(GameEvent.GameStart,this.handleGameStart,this),this.gameModel.removeEventListener(GameEvent.DealCards,this.handleDealCards,this),this.gameModel.removeEventListener(GameEvent.Draw,this.handleDraw,this),this.gameModel.removeEventListener(GameEvent.SwitchPlayer,this.handleSwitchPlayer,this),this.gameModel.removeEventListener(GameEvent.Call,this.handlePlayerCall,this),this.gameModel.removeEventListener(GameEvent.AllIn,this.handlePlayerAllIn,this),this.gameModel.removeEventListener(GameEvent.Raise,this.handlePlayerRaise,this),this.gameModel.removeEventListener(GameEvent.Check,this.handlePlayerCheck,this),this.gameModel.removeEventListener(GameEvent.Fold,this.handlePlayerFold,this),this.gameModel.removeEventListener(GameEvent.UpdatePots,this.handleUpdatePots,this),this.gameModel.removeEventListener(GameEvent.Showdown,this.handleShowdown,this),this.gameModel.removeEventListener(GameEvent.EndGame,this.handleGameEnd,this),this.gameModel.removeEventListener(GameEvent.PlayerLeave,this.handlePlayerLeave,this),this.chatModel.removeEventListener(ChatMessageEvent.Received_Text,this.handleReceivedTextMessage,this),this.chatModel.removeEventListener(ChatMessageEvent.Received_Props,this.handleReceivedPropsMessage,this),this.chatModel.removeEventListener(ChatMessageEvent.Received_Sticker,this.handleReceivedStickerMessage,this),this.chatModel.removeEventListener(ChatMessageEvent.Received_Audio,this.handleReceivedAudioMessage,this),this.roomModel.removeEventListener(RoomMessageEvent.TimerStart,this.onRoomTimerStart,this),this.clubManagerModel.removeEventListener(ApplicationEvent.NewClubApplication,this.handleReceivedApplication,this),this.buyInModel.removeEventListener(ApplicationEvent.NewBuyInApplication,this.handlePlayerBuyIn,this),this.buyInModel.removeEventListener(ApplicationEvent.ProcessBuyInApplication,this.handleProcessedBuyInApplication,this),this.roomModel.removeMessageListener(),this.gameModel.removeMessageListener(),this.chatModel.removeMessageListener(),this.clubManagerModel.removeMessageListener(),this.buyInModel.removeMessageListener()},t}(eui.Component);__reflect(GameScene.prototype,"GameScene");var LeaderboardScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="LeaderboardSceneSkin",n.roomId=t,n.leaderborderModel=new LeaderboardModel,n.userModel=new UserModel,n.background.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onPressed,n),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.playShowAnimation,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.removeFromStage,n),n}return __extends(t,e),t.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:return e.prototype.createChildren.call(this),this.top=this.bottom=this.left=this.right=0,t=this.leaderborderModel.getCachedPlayersForScore(),null!==t&&this.updatePlayersScore(this.leaderborderModel.createPlayers(JSON.parse(t))),n=this.leaderborderModel.getCachedMembers(),null!==n&&this.updateMembers(this.leaderborderModel.createMembers(JSON.parse(n))),[4,this.fetchPlayersScores()];case 1:return i.sent(),[4,this.fetchMembers()];case 2:return i.sent(),this.startRefreshTimer(),[2]}})})},t.prototype.startRefreshTimer=function(){var e=this;this.refreshTimer=setInterval(function(){e.fetchPlayersScores(),e.fetchPlayersScores()},6e4)},t.prototype.removeFromStage=function(){clearInterval(this.refreshTimer),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.playShowAnimation,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)},t.prototype.updatePlayersScore=function(e){this.leaderboard.setPlayers(e)},t.prototype.updateMembers=function(e){this.leaderboard.setOnLineViewers(this.leaderborderModel.countOnlineMembers(e),e.length),this.leaderboard.setViewPlayers(e)},t.prototype.fetchPlayersScores=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.leaderborderModel.fetchPlayersScores(this.roomId,this.userModel.accessToken)];case 1:return e=n.sent(),this.leaderborderModel.cachePlayersForScoreData(JSON.stringify(e.result)),this.updatePlayersScore(this.leaderborderModel.createPlayers(e.result)),[3,3];case 2:return t=n.sent(),Toast.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.fetchMembers=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.leaderborderModel.fetchMembers(this.roomId,this.userModel.accessToken)];case 1:return e=n.sent(),this.leaderborderModel.cacheMembersData(JSON.stringify(e.result.members)),this.updateMembers(this.leaderborderModel.createMembers(e.result.members)),[3,3];case 2:return t=n.sent(),Toast.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.onPressed=function(){this.hideTweenGroup.addEventListener("complete",this.goBack,this),this.hideTweenGroup.play()},t.prototype.goBack=function(){SceneManager.sharedInstance().popScene()},t.prototype.playShowAnimation=function(){this.showTweenGroup.play()},t}(eui.Component);__reflect(LeaderboardScene.prototype,"LeaderboardScene");var ReviewboardScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="ReviewboardSceneSkin",n.roomId=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressBackground,this),this.reviewboard.fetchGameHistoryRecordsByRoomId(this.roomId),this.showTweenGroup.play()},t.prototype.onPressBackground=function(){this.hideTweenGroup.addEventListener("complete",this.goBack,this),this.hideTweenGroup.play()},t.prototype.goBack=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(ReviewboardScene.prototype,"ReviewboardScene");var ApplicationEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.ApplicationCheck="application_check",t.NewClubApplication="new_application",t.NewBuyInApplication="new_buy_in_application",t.ProcessBuyInApplication="process_buy_in_application",t}(egret.Event);__reflect(ApplicationEvent.prototype,"ApplicationEvent");var ButtonGroupEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.TouchFold="touch_fold",t.TouchCheck="touch_check",t.TouchCall="touch_call",t.TouchRaise="touch_raise",t.TouchAllIn="touch_all_in",t.TouchQuickRaise="touch_quick_raise",t}(egret.Event);__reflect(ButtonGroupEvent.prototype,"ButtonGroupEvent");var BuyInSceneEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchConfirm="touch_confirm",t}(egret.Event);__reflect(BuyInSceneEvent.prototype,"BuyInSceneEvent");var ChatMessageEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.Received_Props="received_props",t.Received_Text="received_text",t.Received_Sticker="received_sticker",t.Received_Audio="received_audio",t}(egret.Event);__reflect(ChatMessageEvent.prototype,"ChatMessageEvent");var GameEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.prototype.setPlayerActionAttribute=function(e){this.amount=e.amount,this.playerId=e.id,this.stack=e.stack},t.BuildGame="build_game",t.NewPlayer="new_player",t.GameStart="game_start",t.DealCards="deal_cards",t.HoleCards="hole_card",t.UpdateStrength="update_strength",t.SwitchPlayer="switch_player",t.Call="call",t.AllIn="all_in",t.Fold="fold",t.UpdatePots="update_pots",t.Check="check",t.Raise="raise",t.Showdown="showdown",t.EndGame="end_game",t.PlayerLeave="player_leave",t.ReceivedMessage="received_message",t.Flop="flop",t.Turn="turn",t.River="river",t.Draw="draw",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var LeaderboardUpdatedEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.PlayersScoreUpdated="leaderboard.players.score.updated.event",t.ViewersUpdated="leaderboard.viewers.updated.event",t}(egret.Event);__reflect(LeaderboardUpdatedEvent.prototype,"LeaderboardUpdatedEvent");var MenuTouchEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchItem="touch_item",t}(egret.Event);__reflect(MenuTouchEvent.prototype,"MenuTouchEvent");var PlayerViewEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.TimerEnd="timer_end",t.Touch="touch_player",t.Warning="timer_warning",t}(egret.Event);__reflect(PlayerViewEvent.prototype,"PlayerViewEvent");var RaiseEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.Raise="raise",t.AllIn="all_in",t}(egret.Event);__reflect(RaiseEvent.prototype,"RaiseEvent");var ReviewboardEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.UPDATE_REVIEWBOARD_HEADER_VALUE="update.reviewboard.header.value.event",t}(egret.Event);__reflect(ReviewboardEvent.prototype,"ReviewboardEvent");var RoomMessageEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.TimerStart="room_timer_start",t.TimerStopped="room_timer_stopped",t.AddSceonds="room_add_seconds",t}(egret.Event);__reflect(RoomMessageEvent.prototype,"RoomMessageEvent");var SeatTouchEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.TouchSeat="touch_seat",t}(egret.Event);__reflect(SeatTouchEvent.prototype,"SeatTouchEvent");var BlockModel=function(){function e(){this.BLOCK_KEY="blocked_player#"}return e.prototype.blockPlayer=function(e){egret.localStorage.setItem(""+this.BLOCK_KEY+e,e)},e.prototype.isBlockedPlayer=function(e){return egret.localStorage.getItem(""+this.BLOCK_KEY+e)===e},e.prototype.removeBlockedPlayer=function(e){egret.localStorage.removeItem(""+this.BLOCK_KEY+e)},e}();__reflect(BlockModel.prototype,"BlockModel");var BuyInModel=function(e){function t(){var t=e.call(this)||this;return t.request=new HttpRequest,t}return __extends(t,e),t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.requestBuyIn=function(e,t,n,i,o){var r=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/buy_in/room/"+e+"/application",a={chip:t,user_id:n,options:{user_nickname:i}},s=this.request.buildHeaderWithToken(o);return this.request.post(r,a,s,RequestName.BuyIn)},t.prototype.processApplication=function(e,t,n,i){var o=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/buy_in/application/"+e,r={action:t,options:{auditor_nickname:n}},a=this.request.buildHeaderWithToken(i);return this.request.patch(o,r,a,RequestName.ProcessBuyIn)},t.prototype.listApplications=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/buy_in/room/"+e+"/application/?sort=waiting";n&&(i+="&status="+n);var o=this.request.buildHeaderWithToken(t);return this.request.get(i,{},o,RequestName.ListBuyIn)},t.prototype.onReceivedMessage=function(e){var t=__assign({},e.context);"buy_in"===t.data.stream&&this.handleBuyInMessage(t)},t.prototype.handleBuyInMessage=function(e){var t=e.data.payload,n=t.action,i=t.content;switch(n){case BuyInAction.NewBuyInApplication:this.handleNewBuyInApplication(i);break;case BuyInAction.ProcessBuyInApplication:this.handleProcessedBuyInApplication(i)}},t.prototype.handleNewBuyInApplication=function(e){var t=new ApplicationEvent(ApplicationEvent.NewBuyInApplication);t.applicantNickname=e.user_nickname,t.applicationId=e.application_id,t.amount=e.chip,this.dispatchEvent(t)},t.prototype.handleProcessedBuyInApplication=function(e){var t=new ApplicationEvent(ApplicationEvent.ProcessBuyInApplication);t.applicantId=e.user_id,t.approve="approve"===e.status,t.amount=e.chip,this.dispatchEvent(t)},t}(egret.EventDispatcher);__reflect(BuyInModel.prototype,"BuyInModel");var ChatModel=function(e){function t(){var t=e.call(this)||this;return t.request=new HttpRequest,t}return __extends(t,e),t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.sendText=function(e,t,n,i){var o=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room_message/"+e+"/text",r=this.request.buildHeaderWithToken(i),a={from_user_nickname:n,text:t};return this.request.post(o,a,r,RequestName.SendMessage)},t.prototype.sendProps=function(e,t,n,i,o,r){var a=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room_message/"+e+"/props",s=this.request.buildHeaderWithToken(r),c={to_user_id:t,file:n,price:i,currency_name:o};return this.request.post(a,c,s,RequestName.SendMessage)},t.prototype.sendSticker=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room_message/"+e+"/sticker",o=this.request.buildHeaderWithToken(n),r={file:t};return this.request.post(i,r,o,RequestName.SendMessage)},t.prototype.onReceivedMessage=function(e){var t=__assign({},e.context);"room_message"===t.data.stream&&this.handleChatMessage(t)},t.prototype.handleChatMessage=function(e){var t=e.data.payload,n=t.action,i=t.content;switch(n){case MessageAction.Text:var o={nickname:i.from_user_nickname,text:i.text,id:i.from_user_id};this.dispatchChatMessageEvent(ChatMessageEvent.Received_Text,o);break;case MessageAction.Props:this.dispatchChatMessageEvent(ChatMessageEvent.Received_Props,i);break;case MessageAction.Sticker:this.dispatchChatMessageEvent(ChatMessageEvent.Received_Sticker,i);break;case MessageAction.Audio:this.dispatchChatMessageEvent(ChatMessageEvent.Received_Audio,i)}},t.prototype.dispatchChatMessageEvent=function(e,t){var n=new ChatMessageEvent(e);n.data=t,this.dispatchEvent(n)},t}(egret.EventDispatcher);__reflect(ChatModel.prototype,"ChatModel");var ClubManagerModel=function(e){function t(){var t=e.call(this)||this;return t.request=new HttpRequest,t}return __extends(t,e),t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.processApplication=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/club/application/"+e,o={action:t},r=this.request.buildHeaderWithToken(n);return this.request.patch(i,o,r)},t.prototype.listApplications=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/club/application/",n=this.request.buildHeaderWithToken(e);return this.request.get(t,{},n)},t.prototype.onReceivedMessage=function(e){var t=__assign({},e.context);"club"===t.data.stream&&this.handleClubMessage(t)},t.prototype.handleClubMessage=function(e){var t=e.data.payload,n=t.action,i=t.content;if(n===ClubAction.NewClubApplication){var o=new ClubApplication(i.application);this.dispatchClubMessageEvent(ApplicationEvent.NewClubApplication,o)}},t.prototype.dispatchClubMessageEvent=function(e,t){var n=new ApplicationEvent(e);n.data=t,this.dispatchEvent(n)},t}(egret.EventDispatcher);__reflect(ClubManagerModel.prototype,"ClubManagerModel");var DetailModel=function(){function e(){this.STATISTIC=[{title:"总场数",data:""},{title:"获胜场数",data:""},{title:"获胜率",data:""},{title:"总手数",data:""},{title:"入池率",subtitle:"VPIP",data:""},{title:"入池胜率",data:""},{title:"翻牌前加注率",subtitle:"PRF",description:"Preflop Raise Rate: 即翻牌前加注率,\n指一个玩家翻牌前加注的频率",data:""},{title:"翻牌前再加注率",subtitle:"3Bet",description:"3Bet: 在翻牌前, 当有玩家加注之后, 自己再次加注的频率",data:""},{title:"翻牌后持续下注率",subtitle:"CBet",description:"Countinue Bet: Flop持续下注率,\n是指在翻牌前最后一名加注的玩家, 在翻牌后再次主动下注的频率",data:""},{title:"场均带入",data:""},{title:"场均战绩",data:""},{title:"激进度",subtitle:"AF",description:"Aggressive Factor: 是用来衡量一个玩家在看到翻牌后打牌激进程度的数值,\n方法计算(下注的次数+加注的次数)除以跟注的次数",data:""},{title:"摊牌率",data:""},{title:"All-In胜率",data:""},{title:"赢过最大的池底",data:""}],this.request=new HttpRequest}return e.prototype.listDefaultStatistic=function(){return this.STATISTIC},e.prototype.listStatistic=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/"+e+"/statistic",i=this.request.buildHeaderWithToken(t);
return this.request.get(n,{},i,RequestName.QueryStatistic)},e.prototype.buildStatisticRecord=function(e){var t=this.STATISTIC.map(function(t,n){var i=t;return 0===n?i.data=e.roundCount:1===n?i.data=e.wonRoundCount:2===n?i.data=e.wonPercentage:4===n?i.data=e.VPIPPercentage:5===n?i.data=e.VPIPWonPercentage:11===n&&(i.data=e.af),i});return t},e}();__reflect(DetailModel.prototype,"DetailModel");var GameModel=function(e){function t(t){var n=e.call(this)||this;return n.currentPlayerAmount=0,n.seatDiff=0,n.isLocalPlayerPlaying=!1,n.isLocalPlayerAllIn=!1,n.communityCards=[],n.players=[],n.markWinnerPrimeCard=function(e){if(e.isWinner){var t=e.primeCard,i=e.holeCard;n.communityCards.map(function(e){return e.isShowdown=!0,e.isShown=!0,t.forEach(function(t){e.isEqualTo(t)&&(e.prime=!0)}),e});i.forEach(function(e){t.forEach(function(t){e.isEqualTo(t)&&(e.prime=!0)})})}return n.communityCards},n.localPlayerId=t,n.request=new HttpRequest,n}return __extends(t,e),t.prototype.queryGameStatus=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e,i=this.request.buildHeaderWithToken(t);return this.request.get(n,{},i,RequestName.QueryGame)},t.prototype.initSeatDiff=function(e){this.seatDiff=this.calculateSeatDiff(e)},t.prototype.isLocalPlayer=function(e){return e===this.localPlayerId},t.prototype.isLocalPlayerOnTable=function(){var e=this,t=this.players.findIndex(function(t){return e.isLocalPlayer(t.id)});return t>=0},t.prototype.isDealer=function(){return this.localPlayerId===this.dealerId},t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.existPlayer=function(e){var t=this.players.find(function(t){return t.id===e.id});return!!t},t.prototype.dispatchMessageEvent=function(e){var t=new GameEvent(GameEvent.ReceivedMessage),n=new Date,i=e.context.data.payload,o=i.action,r=JSON.stringify(e.context);if(o===MessageAction.Audio){var a=i.content;r=a.from_user_id+": "+a.from_user_nickname+", "+a.duration+", "+a.codec}t.data={action:o,date:n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),message:r},this.dispatchEvent(t)},t.prototype.handleGameMessage=function(e){var t=e.data.payload,n=t.action,i=t.content;switch(n){case GameAction.SitDown:this.handlePlayerSitDown(i);break;case GameAction.StartGame:this.handleGameStart(i);break;case GameAction.DealCards:this.handleDealCards(i);break;case GameAction.HoleCard:this.handleHoleCard(i);break;case GameAction.UpdateStrength:this.handleUpdateStrength(i);break;case GameAction.Flop:this.handleFlop(i);break;case GameAction.Turn:this.handleTurn(i);break;case GameAction.River:this.handleRiver(i);break;case GameAction.Call:this.handleCall(i);break;case GameAction.Check:this.handleCheck(i);break;case GameAction.Fold:this.handleFold(i);break;case GameAction.Raise:this.handleRaise(i);break;case GameAction.AllIn:this.handleAllIn(i);break;case GameAction.UpdatePots:this.handleUpdatePots(i);break;case GameAction.SwitchPlayer:this.handleSwitchPlayer(i);break;case GameAction.Showdown:this.handleShowdown(i);break;case GameAction.EndGame:this.handleEndGame(i);break;case GameAction.LeaveRoom:this.handlePlayerLeave(i);break;case GameAction.StandUp:this.handlePlayerLeave(i);break;default:egret.log("handle GameData error ## ",JSON.stringify(event))}},t.prototype.onReceivedMessage=function(e){this.dispatchMessageEvent(e);var t=__assign({},e.context);"texas_holdem"===t.data.stream&&this.handleGameMessage(t)},t.prototype.handleGameStart=function(e){var t=this;this.gameStatus=RoomStatus.Gaming,this.currentPlayerAmount=e.players.length,this.isLocalPlayerPlaying=e.players.some(function(e){return t.isLocalPlayer(e.id)}),this.isLocalPlayerAllIn=!1,this.gameId=e.game_id,this.mainPot=e.main_pot;var n=new GameEvent(GameEvent.GameStart);this.dealerId=e.dealer.id,n.playersForStack=e.players,n.dealer=e.dealer,n.smallBlind=e.small_blind,n.bigBlind=e.big_blind,n.mainPot=e.main_pot,n.players=e.players,this.dispatchEvent(n)},t.prototype.handleDealCards=function(e){var t=new GameEvent(GameEvent.DealCards);this.dispatchEvent(t)},t.prototype.handleHoleCard=function(e){var t=new GameEvent(GameEvent.HoleCards),n=[];e.cards&&(n=e.cards.map(function(e){return new Card({name:e})})),t.handCards=n,t.strength=e.strength,this.dispatchEvent(t)},t.prototype.handleUpdateStrength=function(e){var t=new GameEvent(GameEvent.UpdateStrength);t.strength=e.strength,this.dispatchEvent(t)},t.prototype.handleFlop=function(e){this.handleDraw(e)},t.prototype.handleTurn=function(e){this.handleDraw(e,3)},t.prototype.handleRiver=function(e){this.handleDraw(e,4)},t.prototype.handleDraw=function(e,t){void 0===t&&(t=0);var n=e.shown_community_cards,i=n.map(function(e){return new Card({name:e})});i.forEach(function(e,n){t>n&&(e.isShown=!0)});for(var o=5-n.length,r=0;o>r;r+=1)i.push("");this.communityCards=i;var a=new GameEvent(GameEvent.Draw);a.strength=e.strength,a.communityCards=i,this.dispatchEvent(a)},t.prototype.handleCall=function(e){var t=new GameEvent(GameEvent.Call);t.setPlayerActionAttribute(e.player),this.dispatchEvent(t)},t.prototype.handleRaise=function(e){var t=new GameEvent(GameEvent.Raise);t.setPlayerActionAttribute(e.player),this.dispatchEvent(t)},t.prototype.handleAllIn=function(e){var t=new GameEvent(GameEvent.AllIn);t.setPlayerActionAttribute(e.player),this.isLocalPlayer(e.player.id)&&(this.isLocalPlayerAllIn=!0),this.dispatchEvent(t)},t.prototype.handleFold=function(e){var t=new GameEvent(GameEvent.Fold),n=e.player;this.isLocalPlayer(n.id)&&(this.isLocalPlayerPlaying=!1,this.isLocalPlayerAllIn=!1),t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleCheck=function(e){var t=new GameEvent(GameEvent.Check),n=e.player;t.playerId=n.id,this.dispatchEvent(t)},t.prototype.handleUpdatePots=function(e){this.mainPot=e.main_pot;var t=new GameEvent(GameEvent.UpdatePots);t.mainPot=e.main_pot,t.pots=e.pots,this.dispatchEvent(t)},t.prototype.handleSwitchPlayer=function(e){var t=new GameEvent(GameEvent.SwitchPlayer);t.playerId=e.player_id,t.legalActions=e.legal_actions,this.dispatchEvent(t)},t.prototype.handleShowdown=function(e){var t=new GameEvent(GameEvent.Showdown),n=e.showdown_players.map(function(e){return new ShowdownPlayer(e)});n.forEach(this.markWinnerPrimeCard),t.showdownPlayers=n,this.dispatchEvent(t)},t.prototype.handleEndGame=function(e){this.gameStatus=RoomStatus.Waiting,this.isLocalPlayerPlaying=!1,this.isLocalPlayerAllIn=!1;var t=new GameEvent(GameEvent.EndGame);t.winners=e.winners,t.prize=e.prize,t.playersForStack=e.players,this.dispatchEvent(t),this.communityCards=[]},t.prototype.handlePlayerSitDown=function(e){this.currentPlayerAmount=e.room.players.length;var t=e.player;this.isLocalPlayer(t.id)&&(this.isLocalPlayerPlaying=!1,this.isLocalPlayerAllIn=!1,this.seatDiff=t.seat-1),this.dispatchNewPlayerEvent(t)},t.prototype.dispatchNewPlayerEvent=function(e){var t=new GameEvent(GameEvent.NewPlayer),n=new Player(e);t.newPlayer=n,this.players.push(n),this.dispatchEvent(t)},t.prototype.handlePlayerLeave=function(e){var t=this,n=new GameEvent(GameEvent.PlayerLeave);n.playerId=e.player_id,this.dispatchEvent(n),this.players.forEach(function(n,i){e.player_id===n.id&&t.players.splice(i,1)}),this.currentPlayerAmount=e.room.players.length},t.prototype.calculateSeatDiff=function(e){var t=this,n=e.slice();if(0===n.length)return 0;var i=n.find(function(e){return t.isLocalPlayer(e.id)}),o=0;return i&&(o=i.seat-1),o},t}(egret.EventDispatcher);__reflect(GameModel.prototype,"GameModel");var IPAddressModel=function(){function e(){this.request=new HttpRequest}return e.prototype.queryIPAddress=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/ip_address/user/"+e,o=this.request.buildHeaderWithToken(t);return this.request.get(i,{language:n},o,RequestName.QueryIPAddress)},e}();__reflect(IPAddressModel.prototype,"IPAddressModel");var LeaderboardModel=function(){function e(){this.CACHED_PLAYERS_SCORE_KEY="cached_players_score_key",this.CACHED_MEMBERS_KEY="cached_members_key",this.httpRequest=new HttpRequest}return e.prototype.fetchPlayersScores=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(o){return n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/chip",i=this.httpRequest.buildHeaderWithToken(t),[2,this.httpRequest.get(n,{},i)]})})},e.prototype.fetchMembers=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(o){return n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room/"+e+"/member",i=this.httpRequest.buildHeaderWithToken(t),[2,this.httpRequest.get(n,{},i)]})})},e.prototype.cachePlayersForScoreData=function(e){egret.localStorage.setItem(this.CACHED_PLAYERS_SCORE_KEY,e)},e.prototype.cacheMembersData=function(e){egret.localStorage.setItem(this.CACHED_MEMBERS_KEY,e)},e.prototype.getCachedPlayersForScore=function(){return egret.localStorage.getItem(this.CACHED_PLAYERS_SCORE_KEY)},e.prototype.getCachedMembers=function(){return egret.localStorage.getItem(this.CACHED_MEMBERS_KEY)},e.prototype.countOnlineMembers=function(e){var t=e.filter(function(e){return"left"!==e.status});return t.length},e.prototype.countMembers=function(e){return e.length},e.prototype.createPlayers=function(e){var t=e.map(function(e){return new LeaderboardPlayer(e)}),n=t.sort(function(e,t){return t.score-e.score});return n},e.prototype.createMembers=function(e){var t=e.map(function(e){return new RoomMember(e)}),n=t.filter(function(e){return"left"===e.status}),i=t.filter(function(e){return"left"!==e.status}),o=i.concat(n);return o},e}();__reflect(LeaderboardModel.prototype,"LeaderboardModel");var LeaderboardPlayer=function(){function e(e){this._id=e.id,this._nickname=e.nickname,this._stack=e.stack,this._buyIn=e.buy_in,this._score=this._stack-this._buyIn,this._roundAmount=e.round_amount}return Object.defineProperty(e.prototype,"textColor",{get:function(){return this._score>=0?Color.white:Color.gray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return String(this._stack)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buyIn",{get:function(){return String(this._buyIn)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundAmount",{get:function(){return String(this._roundAmount)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreString",{get:function(){return this._score>0?"+"+this._score:String(this._score)},enumerable:!0,configurable:!0}),e}();__reflect(LeaderboardPlayer.prototype,"LeaderboardPlayer");var RoomMember=function(){function e(e){this._memberId=e.member_id,this._avatarUrl=AvatarURLFactory.makeById(e.member_id),this._roomId=e.room_id,this._userNickname=e.user_nickname,this._status=e.status}return Object.defineProperty(e.prototype,"memberId",{get:function(){return this._memberId},set:function(e){this._memberId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarUrl",{get:function(){return this._avatarUrl},set:function(e){this._avatarUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userNickname",{get:function(){return this._userNickname},set:function(e){this._userNickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},set:function(e){this._roomId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(e){this._status=e},enumerable:!0,configurable:!0}),e}();__reflect(RoomMember.prototype,"RoomMember");var LocationModel=function(){function e(){this.request=new HttpRequest}return e.prototype.queryDistanceFromOthers=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/geographic/user/"+e+"/distance",o=this.request.buildHeaderWithToken(n);return this.request.put(i,{others:t},o,RequestName.QueryDistance)},e.prototype.createOthers=function(e,t){var n=t.filter(function(t){return t.id!==e}),i=n.map(function(e){return e.id});return egret.log("其他玩家"),egret.log(i),i},e.prototype.createPartners=function(e,t){var n=t.find(function(t){return t.id===e.userId}),i=n.nickname,o=[];return e.partner.forEach(function(e){t.forEach(function(t){if(e.userId===t.id){var n={from_user_name:i,to_user_name:t.nickname,distance:e.distance};o.push(new PartnerForDisplay(n))}})}),o},e}();__reflect(LocationModel.prototype,"LocationModel");var PlayerModel=function(){function e(){this.request=new HttpRequest}return e.prototype.queryBalance=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/buy_in/room/"+e+"/balance",o={user_id:t},r=this.request.buildHeaderWithToken(n);return this.request.get(i,o,r,RequestName.CheckBalance)},e.prototype.sitDown=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/sit",o={seat:t},r=this.request.buildHeaderWithToken(n);return this.request.post(i,o,r,RequestName.SitDown)},e.prototype.startGame=function(e){var t="/"+ApiConfig.Version_1+"/texas/room/start",n={room_id:e},i={request_id:RequestName.StartGame,path:t,method:"post",body:n};WebSocketRequest.sharedInstance().sendData(i)},e.prototype.call=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/call",n={request_id:RequestName.Call,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.raise=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/"+e+"/raise",i={amount:t},o={request_id:RequestName.Raise,path:n,method:"post",body:i};WebSocketRequest.sharedInstance().sendData(o)},e.prototype.check=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/check",n={request_id:RequestName.Check,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.allIn=function(e,t){var n="/"+ApiConfig.Version_1+"/texas/"+e+"/all_in",i={amount:t},o={request_id:RequestName.AllIn,path:n,method:"post",body:i};WebSocketRequest.sharedInstance().sendData(o)},e.prototype.fold=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/fold",n={request_id:RequestName.Fold,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.checkTimeout=function(e){var t="/"+ApiConfig.Version_1+"/texas/"+e+"/check_timeout",n={request_id:RequestName.CheckTimeout,path:t,method:"post",body:null};WebSocketRequest.sharedInstance().sendData(n)},e.prototype.renewalSeat=function(e,t,n,i,o,r){var a=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/hall/"+e+"/renewal",s={user_id:t,room_id:n,seat_number:i,renewal_ttl:o},c=this.request.buildHeaderWithToken(r);return this.request.put(a,s,c,RequestName.RenewalSeat)},e.prototype.standUp=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/stand_up",i=this.request.buildHeaderWithToken(t);return this.request.post(n,{},i,RequestName.StandUp)},e.prototype.leave=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/leave",i=this.request.buildHeaderWithToken(t);return this.request.post(n,{},i,RequestName.Leave)},e.prototype.releaseSeat=function(e,t,n,i){var o=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/hall/"+t+"/seat/release",r={room_id:e,seat_number:n},a=this.request.buildHeaderWithToken(i);return this.request.put(o,r,a,RequestName.LeaveHall)},e}();__reflect(PlayerModel.prototype,"PlayerModel");var PokerTypeModel=function(){function e(){}return e.prototype.getType=function(){var t=egret.localStorage.getItem(e.POKER_TYPE_KEY);return t=t||e.SIMPLE},e.prototype.setType=function(t){egret.localStorage.setItem(e.POKER_TYPE_KEY,t)},e.POKER_TYPE_KEY="poker_type_key",e.SIMPLE="simple",e.CLASSIC="classic",e.FOUR_COLOR="four_color",e.FOUR_COLOR_2="four_color_2",e}();__reflect(PokerTypeModel.prototype,"PokerTypeModel");var ReportModel=function(){function e(){this.request=new HttpRequest}return e.prototype.report=function(e,t,n,i,o){void 0===i&&(i="");var r=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/report",a=this.request.buildHeaderWithToken(o),s={reported_user_id:e,user_id:t,tag:n,content:i};return this.request.put(r,s,a,RequestName.Report)},e}();__reflect(ReportModel.prototype,"ReportModel");var TreasureChestModel=function(){function e(){this.request=new HttpRequest}return e.prototype.resetTreasureChest=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/mission/treasure_chest/"+e,i=this.request.buildHeaderWithToken(t);return this.request["delete"](n,{},i,RequestName.ApplyForTreasure)},e.prototype.applyForTreasureChest=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/mission/treasure_chest/"+e,i=this.request.buildHeaderWithToken(t);return this.request.post(n,{},i,RequestName.ApplyForTreasure)},e.prototype.openTreasureChest=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/mission/treasure_chest/"+e,i=this.request.buildHeaderWithToken(t),o=JWTSecret.MISSION_SECRET,r=JWT.create(JSON.stringify({}),o);return i=Object.assign(i,{Payload:r}),this.request.put(n,{},i,RequestName.OpenTreasureChest)},e.CHEST_SLUG="hall_3m_6m_9m",e}();__reflect(TreasureChestModel.prototype,"TreasureChestModel");var BuyInBalance=function(){function e(e){this._subtotal=e.subtotal,this._userId=e.user_id,this._propertyName=e.property_name,this._roomId=e.room_id,this._amount=e.amount,this._balance=e.balance,this._freezingAt=e.freezing_at}return Object.defineProperty(e.prototype,"subtotal",{get:function(){return this._subtotal},set:function(e){this._subtotal=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyName",{get:function(){return this._propertyName},set:function(e){this._propertyName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},set:function(e){this._roomId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"balance",{get:function(){return this._balance},set:function(e){this._balance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freezingAt",{get:function(){return this._freezingAt},set:function(e){this._freezingAt=e},enumerable:!0,configurable:!0}),e}();__reflect(BuyInBalance.prototype,"BuyInBalance");var BuyInApplication=function(){function e(e){this._applicationId=e.application_id,this._status=e.status,this._auditorId=e.auditor_id,this._chip=e.chip,this._auditedAt=e.audited_at,this._createdAt=e.created_at,this._userId=e.user_id,this._roomId=e.room_id,e.options&&(this._userNickname=e.options.user_nickname,this._clubName=e.options.club_name,this._roomName=e.options.room_name)}return Object.defineProperty(e.prototype,"applicationId",{get:function(){return this._applicationId},set:function(e){this._applicationId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auditorId",{get:function(){return this._auditorId},set:function(e){this._auditorId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userNickname",{get:function(){return this._userNickname},set:function(e){this._userNickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(e){this._status=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chip",{get:function(){return this._chip},set:function(e){this._chip=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auditedAt",{get:function(){return this._auditedAt},set:function(e){this._auditedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},set:function(e){this._roomId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clubName",{get:function(){return this._clubName},set:function(e){this._clubName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomName",{get:function(){return this._roomName},set:function(e){this._roomName=e},enumerable:!0,configurable:!0}),e}();__reflect(BuyInApplication.prototype,"BuyInApplication");var Card=function(){function e(e){this._name=e.name,this._isShown=e.isShown,this._prime=e.prime,this._isShowdown=e.isShowdown,this.decodeValue(e.name),this.decodeSuit(e.name)}return e.prototype.isEqualTo=function(e){return e.name===this._name},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShowdown",{get:function(){return this._isShowdown},set:function(e){this._isShowdown=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShown",{get:function(){return this._isShown},set:function(e){this._isShown=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prime",{get:function(){return this._prime},set:function(e){this._prime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suit",{get:function(){return this._suit},set:function(e){this._suit=e},enumerable:!0,configurable:!0}),e.prototype.decodeValue=function(e){var t=e.charAt(0);switch(t){case"2":this._value=CardValue.Two;break;case"3":this._value=CardValue.Three;break;case"4":this._value=CardValue.Four;break;case"5":this._value=CardValue.Five;break;case"6":this._value=CardValue.Six;break;case"7":this._value=CardValue.Seven;break;case"8":this._value=CardValue.Eight;break;case"9":this._value=CardValue.Nine;break;case"t":this._value=CardValue.Ten;break;case"j":this._value=CardValue.J;break;case"q":this._value=CardValue.Q;break;case"k":this._value=CardValue.K;break;case"a":this._value=CardValue.A;break;default:this._value=CardValue.Error}},e.prototype.decodeSuit=function(e){var t=e.slice(-1);switch(t){case"s":this._suit=CardSuit.Spade;break;case"h":this._suit=CardSuit.Heart;break;case"c":this._suit=CardSuit.Club;break;case"d":this._suit=CardSuit.Diamond;break;default:this._suit=CardSuit.Error}},e}();__reflect(Card.prototype,"Card");var ClubApplication=function(){function e(e){this._clubId=e.club_id,this._clubName=e.club_name,this._id=e.id,this._permitted=e.permitted,this._processedAt=e.processed_at,this._requestedAt=e.requested_at,this._applicantId=e.applicant_id,this._userNickname=e.user_nickname}return Object.defineProperty(e.prototype,"clubId",{get:function(){return this._clubId},set:function(e){this._clubId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clubName",{get:function(){return this._clubName},set:function(e){this._clubName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"permitted",{get:function(){return this._permitted},set:function(e){this._permitted=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"processedAt",{get:function(){return this._processedAt},set:function(e){this._processedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestedAt",{get:function(){return this._requestedAt},set:function(e){this._requestedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"applicantId",{get:function(){return this._applicantId},set:function(e){this._applicantId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userNickname",{get:function(){return this._userNickname},set:function(e){this._userNickname=e},enumerable:!0,configurable:!0}),e}();__reflect(ClubApplication.prototype,"ClubApplication");var Game=function(){function e(e){if(this._id=e.game?e.game.id:"",this._status=e.status,this._isGaming=e.status===RoomStatus.Gaming,this._players=e.players.map(function(e){return new Player(e)}),e.game){this._activePlayer=e.game.active_player?new Player(e.game.active_player):void 0,this._mainPot=e.game.main_pot,this._pots=e.game.pots,this._dealerId=e.game.dealer_id,this._smallBlindId=e.game.small_blind_id,this._bigBlindId=e.game.big_blind_id;var t=e.game.current_shown_cards.map(function(e){return new Card({name:e,isShown:!0})}),n=5-e.game.current_shown_cards.length;if(5>n)for(var i=0;n>i;i+=1)t.push("");this._communityCards=t}this._serverNow=new Date(e.server_now)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(e){this._status=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGaming",{get:function(){return this._isGaming},set:function(e){this._isGaming=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"players",{get:function(){return this._players},set:function(e){this._players=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activePlayer",{get:function(){return this._activePlayer},set:function(e){this._activePlayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mainPot",{get:function(){return this._mainPot},set:function(e){this._mainPot=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dealerId",{get:function(){return this._dealerId},set:function(e){this._dealerId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smallBlindId",{get:function(){return this._smallBlindId},set:function(e){this._smallBlindId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bigBlindId",{get:function(){return this._bigBlindId},set:function(e){this._bigBlindId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communityCards",{get:function(){return this._communityCards||[]},set:function(e){this._communityCards=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pots",{get:function(){return this._pots||[]},set:function(e){this._pots=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverNow",{get:function(){return this._serverNow},set:function(e){this._serverNow=e},enumerable:!0,configurable:!0}),e}();__reflect(Game.prototype,"Game");var IPAddress=function(){function e(e){this._updatedAt=e.updated_at,this._userId=e.user_id,this._ipAddress=e.ip_address,this._createdAt=e.created_at,this._city=e.city,this._country=e.country}return Object.defineProperty(e.prototype,"updatedAt",{get:function(){return this._updatedAt},set:function(e){this._updatedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ipAddress",{get:function(){return this._ipAddress},set:function(e){this._ipAddress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"city",{get:function(){return this._city},set:function(e){this._city=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"country",{get:function(){return this._country},set:function(e){this._country=e},enumerable:!0,configurable:!0}),e}();__reflect(IPAddress.prototype,"IPAddress");var LocationDistance=function(){function e(e){this._userId=e.user_id,this._partner=e.partner&&e.partner.map(function(e){return new PartnerForDistance(e)})}return Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"partner",{get:function(){return this._partner},set:function(e){this._partner=e},enumerable:!0,configurable:!0}),e}();__reflect(LocationDistance.prototype,"LocationDistance");var PartnerForDistance=function(){function e(e){this._userId=e.user_id,this._distance=e.distance}return Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(e){this._distance=e},enumerable:!0,configurable:!0}),e}();__reflect(PartnerForDistance.prototype,"PartnerForDistance");var PartnerForDisplay=function(){function e(e){this._fromUserName=e.from_user_name,this._toUserName=e.to_user_name,this._distance="100m"===e.distance?"小于100m":e.distance}return Object.defineProperty(e.prototype,"fromUserName",{get:function(){return this._fromUserName},set:function(e){this._fromUserName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toUserName",{get:function(){return this._toUserName},set:function(e){this._toUserName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(e){this._distance=e},enumerable:!0,configurable:!0}),e}();__reflect(PartnerForDisplay.prototype,"PartnerForDisplay");var Player=function(){function e(e){this._id=e.id,this._seat=e.seat,this._stack=e.stack||0,this._avatarUrl=AvatarURLFactory.makeById(e.id),this._username=e.username,this._nickname=e.nickname,this._amount=e.amount,this._state=e.state,this._roundAction=e.round_action,this._holeCard=e.hole_card||["",""],this._strength=e.strength,this._bio=e.bio||"还没有签名",this._buyIn=e.buy_in,this._legalActions=e.legal_actions,this._actionStartAt=e.action_start_at}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seat",{get:function(){return this._seat},set:function(e){this._seat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stack",{get:function(){return this._stack},set:function(e){this._stack=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){return this._username},set:function(e){this._username=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bio",{get:function(){return this._bio},set:function(e){this._bio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarUrl",{get:function(){return this._avatarUrl},set:function(e){this._avatarUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buyIn",{get:function(){return this._buyIn},set:function(e){this._buyIn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundAction",{get:function(){return this._roundAction},set:function(e){this._roundAction=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holeCard",{get:function(){return this._holeCard},set:function(e){this._holeCard=e
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legalActions",{get:function(){return this._legalActions},set:function(e){this._legalActions=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionStartAt",{get:function(){return this._actionStartAt},set:function(e){this._actionStartAt=e},enumerable:!0,configurable:!0}),e}();__reflect(Player.prototype,"Player");var PlayerProfile=function(){function e(e){this._avatarPath=e.avatar_path,this._gender=e.gender,this._birthday=e.birthday,this._nickname=e.nickname,this._bio=e.bio,this._userId=e.user_id}return Object.defineProperty(e.prototype,"avatarPath",{get:function(){return this._avatarPath},set:function(e){this._avatarPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gender",{get:function(){return this._gender},set:function(e){this._gender=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"birthday",{get:function(){return this._birthday},set:function(e){this._birthday=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bio",{get:function(){return this._bio},set:function(e){this._bio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),e}();__reflect(PlayerProfile.prototype,"PlayerProfile");var ShowdownPlayer=function(){function e(e){this._id=e.id,this._isWinner=e.is_winner,this._holeCard=e.hole_card.map(function(e){return new Card({name:e})}),this._primeCard=e.prime_card.map(function(e){return new Card({name:e})}),this._strength=e.strength}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWinner",{get:function(){return this._isWinner},set:function(e){this._isWinner=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holeCard",{get:function(){return this._holeCard},set:function(e){this._holeCard=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primeCard",{get:function(){return this._primeCard},set:function(e){this._primeCard=e},enumerable:!0,configurable:!0}),e}();__reflect(ShowdownPlayer.prototype,"ShowdownPlayer");var Statistic=function(){function e(e){this._id=e.id,this._af=e.af,this._roundCount=e.round_count,this._VPIPPercentage=e.vpip_percentage,this._VPIPWonPercentage=e.vpip_won_percentage,this._wonPercentage=e.won_percentage,this._wonRoundCount=e.won_round_count}return Object.defineProperty(e.prototype,"af",{get:function(){return this._af},set:function(e){this._af=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundCount",{get:function(){return this._roundCount},set:function(e){this._roundCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VPIPPercentage",{get:function(){return this._VPIPPercentage},set:function(e){this._VPIPPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"VPIPWonPercentage",{get:function(){return this._VPIPWonPercentage},set:function(e){this._VPIPWonPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wonPercentage",{get:function(){return this._wonPercentage},set:function(e){this._wonPercentage=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wonRoundCount",{get:function(){return this._wonRoundCount},set:function(e){this._wonRoundCount=e},enumerable:!0,configurable:!0}),e}();__reflect(Statistic.prototype,"Statistic");var EmptyAction=function(){function e(){this.backgroundColor=0,this.abbreviationSymbol=""}return e}();__reflect(EmptyAction.prototype,"EmptyAction",["IPlayerAction"]);var SmallBlind=function(){function e(){this.backgroundColor=11252402,this.abbreviationSymbol="SB"}return e}();__reflect(SmallBlind.prototype,"SmallBlind",["IPlayerAction"]);var BigBlind=function(){function e(){this.backgroundColor=11252402,this.abbreviationSymbol="BB"}return e}();__reflect(BigBlind.prototype,"BigBlind",["IPlayerAction"]);var AllIn=function(){function e(){this.backgroundColor=16537889,this.abbreviationSymbol="A"}return e}();__reflect(AllIn.prototype,"AllIn",["IPlayerAction"]);var Bet=function(){function e(){this.backgroundColor=16008262,this.abbreviationSymbol="B"}return e}();__reflect(Bet.prototype,"Bet",["IPlayerAction"]);var Call=function(){function e(){this.backgroundColor=2803253,this.abbreviationSymbol="C"}return e}();__reflect(Call.prototype,"Call",["IPlayerAction"]);var Check=function(){function e(){this.backgroundColor=7077885,this.abbreviationSymbol="X"}return e}();__reflect(Check.prototype,"Check",["IPlayerAction"]);var Fold=function(){function e(){this.backgroundColor=8158846,this.abbreviationSymbol="F"}return e}();__reflect(Fold.prototype,"Fold",["IPlayerAction"]);var Raise=function(){function e(){this.backgroundColor=16008262,this.abbreviationSymbol="R"}return e}();__reflect(Raise.prototype,"Raise",["IPlayerAction"]);var PlayerActionFactory=function(){function e(){}return e.makeByTypeName=function(e){switch(e){case GameAction.SB:return new SmallBlind;case GameAction.BB:return new BigBlind;case GameAction.AllIn:return new AllIn;case GameAction.Bet:return new Bet;case GameAction.Call:return new Call;case GameAction.Check:return new Check;case GameAction.Fold:return new Fold;case GameAction.Raise:return new Raise;default:return new EmptyAction}},e}();__reflect(PlayerActionFactory.prototype,"PlayerActionFactory");var ReviewboardAction=function(){function e(e){this._playerPosition=e.player_position,this._playerNickname=e.player_nickname,this._playerAction=PlayerActionFactory.makeByTypeName(e.player_action),this._playerActionValue=e.player_action_value||0,this._playerStack=e.player_stack}return Object.defineProperty(e.prototype,"playerPosition",{get:function(){return this._playerPosition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerNickname",{get:function(){return this._playerNickname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerAction",{get:function(){return this._playerAction},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerActionValue",{get:function(){return this._playerActionValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerStack",{get:function(){return this._playerStack},enumerable:!0,configurable:!0}),e}();__reflect(ReviewboardAction.prototype,"ReviewboardAction");var ReviewboardGameRound=function(){function e(e){this._cnName=e.cn_name,this._enName=e.en_name,this._pot=e.pot||0,this._actions=e.actions.map(function(e){return new ReviewboardAction(e)}),this._communityPokers=e.community_pokers||[]}return Object.defineProperty(e.prototype,"chineseName",{get:function(){return this._cnName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"englishName",{get:function(){return this._enName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pot",{get:function(){return this._pot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communityPokers",{get:function(){return this._communityPokers},enumerable:!0,configurable:!0}),e}();__reflect(ReviewboardGameRound.prototype,"ReviewboardGameRound");var ReviewboardModel=function(){function e(){this.httpRequest=new HttpRequest,this._pages=[]}return Object.defineProperty(e.prototype,"communityPokers",{get:function(){return this._communityPokers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetching",{get:function(){return this._isFetching},enumerable:!0,configurable:!0}),e.prototype.fetchGameHistoryRecordByRoomId=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,r,a;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),this._isFetching=!0,n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/records",i=this.httpRequest.buildHeaderWithToken(t),[4,this.httpRequest.get(n,{},i)];case 1:return o=s.sent(),r=o.result,this.createPages(r),this._isFetching=!1,[3,3];case 2:throw a=s.sent(),console.log("fetchGameHistoryRecord error + "+a.message),this._isFetching=!1,a;case 3:return[2]}})})},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._pages.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pot",{get:function(){return this._pot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startAtString",{get:function(){return this._startAtString},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPageIndex",{get:function(){return this._currentPageIndex},set:function(e){this._currentPageIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageAmount",{get:function(){return this._pageAmount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameRounds",{get:function(){return this._gameRounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settlements",{get:function(){return this._settlements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){if(this._pages&&0!==this._pages.length){var e=this._currentPageIndex-1;return 0>e&&(e=0),this._pages[e]}},enumerable:!0,configurable:!0}),e.prototype.setup=function(e){var t=this;this._pot=e.pot;var n=new Date(Date.parse(e.start_at)),i=n.getMonth()+1,o=n.getDate(),r=n.getHours(),a=n.getMinutes(),s=String(a);10>a&&(s="0"+s),this._startAtString=i+"月"+o+"日 "+r+":"+s,this._communityPokers=e.community_cards,this._gameRounds=[],this._gameRounds.push(this.createDefaultRound(e)),this._gameRounds.push(this.createPreflopRound(e)),0!==e.flop_actions.length&&this._gameRounds.push(this.createFlopRound(e)),0!==e.turn_actions.length&&this._gameRounds.push(this.createTurnRound(e)),0!==e.river_actions.length&&this._gameRounds.push(this.createRiverRound(e));var c=e.players_info;this._settlements=Object.keys(c).map(function(e){var n=c[e],i={player_name:n.nickname,player_id:e,player_seat:n.seat,player_position:n.position,is_folded:n.is_folded,player_hole_poker:n.hole_card,community_pokers:t._communityPokers,player_settlement:n.settlement,showdown_strength:n.showdown_strength};return new Settlement(i)})},e.prototype.createDefaultRound=function(e){var t={cn_name:"押注圈",en_name:"Betting",pot:0,community_pokers:[],actions:this.createActions(e.default_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createPreflopRound=function(e){var t={cn_name:"翻牌前",en_name:"Pre-Flop",pot:e.pot_before_preflop,community_pokers:[],actions:this.createActions(e.preflop_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createFlopRound=function(e){var t={cn_name:"翻牌圈",en_name:"Flop",pot:e.pot_before_flop,community_pokers:e.community_cards.slice(0,3),actions:this.createActions(e.flop_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createTurnRound=function(e){var t={cn_name:"转牌圈",en_name:"Turn",pot:e.pot_before_turn,community_pokers:e.community_cards.slice(0,4),actions:this.createActions(e.turn_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createRiverRound=function(e){var t={cn_name:"河牌圈",en_name:"River",pot:e.pot_before_river,community_pokers:e.community_cards,actions:this.createActions(e.river_actions,e.players_info)};return new ReviewboardGameRound(t)},e.prototype.createActions=function(e,t){for(var n=[],i=0;i<e.length;i+=1){var o=e[i],r=o.player_id,a=t[r];a&&n.push({player_position:a.position,player_nickname:a.nickname,player_action:o.action,player_action_value:o.amount,player_stack:o.stack})}return n},e.prototype.createPages=function(t){this._pages=t.map(function(t){var n=new e;return n.setup(t),n}),this._pageAmount=this._pages.length,this._currentPageIndex=this._pageAmount},e}();__reflect(ReviewboardModel.prototype,"ReviewboardModel",["IPageCounter"]);var Settlement=function(){function e(e){this._playerName=e.player_name,this._playerId=e.player_id,this._playerSeat=e.player_seat,this._playerPosition=e.player_position,this._isFolded=e.is_folded,this._playerAvatar="需要拼接",this._holePokers=e.player_hole_poker||[],this._communityPokers=e.community_pokers,this._playerSettlement=e.player_settlement,this._isShowdowned=!!e.showdown_strength,this._showdownStrength=e.showdown_strength}return Object.defineProperty(e.prototype,"playerName",{get:function(){return this._playerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerAvatar",{get:function(){return this._playerAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFolded",{get:function(){return this._isFolded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"holePokers",{get:function(){return 0===this._holePokers.length?["back","back"]:this._holePokers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"foldInfoText",{get:function(){return this._isFolded?"(弃牌)":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"communityPokers",{get:function(){return[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlement",{get:function(){return this._playerSettlement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlementString",{get:function(){return this._playerSettlement>0?"+"+this._playerSettlement:String(this._playerSettlement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerSettlementTextColor",{get:function(){return this._playerSettlement>0?16008262:0===this._playerSettlement?12108480:5366165},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShowdowned",{get:function(){return this._isShowdowned},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showdownStrength",{get:function(){return this._showdownStrength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerPosition",{get:function(){return this._playerPosition},enumerable:!0,configurable:!0}),e}();__reflect(Settlement.prototype,"Settlement");var terminologySpecificDatas=[{name:GameAction.BB,description:"大盲注"},{name:GameAction.SB,description:"小盲注"},{name:GameAction.AllIn,description:"全押"},{name:GameAction.Bet,description:"下注"},{name:GameAction.Call,description:"跟注"},{name:GameAction.Check,description:"过"},{name:GameAction.Fold,description:"弃牌"},{name:GameAction.Raise,description:"加注"}],TerminologySpecificModel=function(){function e(){}return e.listTerminologySpecifics=function(){return terminologySpecificDatas.map(function(e){return new TexasTermiology(e)})},e}();__reflect(TerminologySpecificModel.prototype,"TerminologySpecificModel");var TexasTermiology=function(){function e(e){this.action=PlayerActionFactory.makeByTypeName(e.name),this.description=e.description}return e}();__reflect(TexasTermiology.prototype,"TexasTermiology");var CardImage=function(e){function t(t){var n=e.call(this)||this;return n.skinName="CardSkin",t?n.cover.visible=!1:n.cover.visible=!0,n}return __extends(t,e),Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e,this.cardImage.source=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(CardImage.prototype,"CardImage");var CardPattern=function(e){function t(){var t=e.call(this)||this;return t.skinName="CardPatternSkin",t.patternImage.x=-620,t}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.patternImage).to({x:0},200),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this)},t}(eui.Component);__reflect(CardPattern.prototype,"CardPattern");var ChatItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.message=new eui.Label,this.message.width=600,this.message.height+=50,this.addChild(this.message)},t.prototype.dataChanged=function(){this.message.text=""+this.data},t}(eui.ItemRenderer);__reflect(ChatItemRenderer.prototype,"ChatItemRenderer");var ChipTipsView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChipTipsViewSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this)},t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(ChipTipsView.prototype,"ChipTipsView");var CommunityCardItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="CardItemSkin",t.pokerTypeModel=new PokerTypeModel,t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this;if(!this.data)return void(this.cover.visible=!1);var t=this.pokerTypeModel.getType();if(this.data.isShowdown?this.data.prime?this.cover.visible=!1:this.cover.visible=!0:this.cover.visible=!1,this.data.isShown)this.cardImage.source="poker_"+this.data.name+"_"+t+"_png";else{var n=this.itemIndex>2?0:this.itemIndex,i=300*n;egret.Tween.get(this.cardImage).wait(i).to({scaleX:0},150).call(function(){e.cardImage.source="poker_"+e.data.name+"_"+t+"_png",egret.Tween.get(e.cardImage).to({scaleX:1},150)})}},t}(eui.ItemRenderer);__reflect(CommunityCardItemRenderer.prototype,"CommunityCardItemRenderer");var HandCardImage=function(e){function t(t){var n=e.call(this)||this;return n.width=65,n.height=97,n.anchorOffsetX=32.5,n.anchorOffsetY=48.5,n.x=375.5,n.y=667.5,n.source="poker_back_png",n.config=t,n.coordinate=t.coordinate,n.seatNumber=t.seatNumber,n.pokerType=t.pokerType,n}return __extends(t,e),t.prototype.getSeatNumber=function(){return this.seatNumber},t.prototype.setCoordinate=function(e){this.coordinate=e,this.createCard()},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.destroy=function(){this.parent&&this.parent.removeChild(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.config.animate?(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.DEAL_CARD_2),this.createCardWithAnimation()):this.createCard(),this.config.cardName&&(this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),EventCenter.sharedInstance().addEventListener(SettingEvent.CHANGE_POKER_TYPE,this.changeSource,this))},t.prototype.changeSource=function(e){var t=this.config.cardName||"back";this.source="poker_"+t+"_"+e.data+"_png"},t.prototype.createCard=function(){var e=this.coordinate.direction;if(e===Direction.Bottom){var t=0===this.config.additionX?395.5:466.5;this.x=t,this.y=1158.5,this.rotation=1800;var n=this.config.cardName||"back";this.source="poker_"+n+"_"+this.pokerType+"_png"}else{var t=this.coordinate.x+this.config.additionX,i=this.coordinate.y+110;e===Direction.Right&&(t=this.coordinate.x+90+this.config.additionX);var o=this.config.rotation;this.x=t,this.y=i,this.rotation=o,this.scaleX=.4,this.scaleY=.4}},t.prototype.createCardWithAnimation=function(){var e=this,t=this.coordinate.direction,n=this.config.additionX?0:100;if(t===Direction.Bottom){var i=0===this.config.additionX?395.5:466.5;egret.Tween.get(this).wait(n).to({x:i,y:1158.5,rotation:1800},400).call(function(){e.config.cardName&&egret.Tween.get(e).to({scaleX:0},100).call(function(){var t=e.config.cardName||"back";e.source="poker_"+t+"_"+e.pokerType+"_png",egret.Tween.get(e).to({scaleX:1},80)})})}else{var i=this.coordinate.x+this.config.additionX,o=this.coordinate.y+110;t===Direction.Right&&(i=this.coordinate.x+90+this.config.additionX);var r=this.config.rotation;egret.Tween.get(this).wait(n).to({x:i,y:o,rotation:r,scaleX:.4,scaleY:.4},400)}},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.config.cardName&&EventCenter.sharedInstance().removeEventListener(SettingEvent.CHANGE_POKER_TYPE,this.changeSource,this)},t}(eui.Image);__reflect(HandCardImage.prototype,"HandCardImage");var MarkView=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="MarkSkin",i.signLabel.text=t,i.setCoordinate(n),i}return __extends(t,e),t.prototype.setCoordinate=function(e){var t=e.direction;t===Direction.Left?this.x=100:t===Direction.Right?this.x=-30:this.x=-30,this.y=120},t}(eui.Component);__reflect(MarkView.prototype,"MarkView");var MenuView=function(e){function t(){var t=e.call(this)||this;return t.skinName="MenuViewSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({x:0},200),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTouch,this)},t.prototype.onItemTouch=function(e){this.remove();var t=new MenuTouchEvent(MenuTouchEvent.TouchItem);t.itemIndex=e.itemIndex,this.dispatchEvent(t)},t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(MenuView.prototype,"MenuView");var PlayerView=function(e){function t(t,n,i){var o=e.call(this)||this;return o.handCards=[],o.angle=0,o.radius=0,o.skinName="PlayerSkin",o.propertyName=i,o.userModel=new UserModel,o.blockModel=new BlockModel,o.setCoordinate(n),o.setPlayer(t),o}return __extends(t,e),t.prototype.setPlayer=function(e){this.reset(),this.player=e,this.setNickname(e.id),this.stack=e.stack,this.scoreLabel.text=""+MoneyFormatter.addChineseUnit(e.stack),this.setAvatar(e),e.roundAction&&this.updateStatusImage(e.roundAction),(e.state===PlayerState.Folded||e.state===PlayerState.NotInGame)&&this.showCover(),e.state===PlayerState.Folded&&this.updateStatusImage(GameAction.Fold),e.state===GameAction.AllIn&&(this.updateStatusImage(GameAction.AllIn),this.showFire()),e.amount>0&&this.updateScoreboard(e.amount)},t.prototype.setCoordinate=function(e){this.coordinate?egret.Tween.get(this).to({x:e.x,y:e.y},500):(this.x=e.x,this.y=e.y),this.coordinate=e,this.scoreboard&&this.scoreboard.setCoordinate(e),this.statusImage&&this.statusImage.setCoordinate(e),this.mark&&this.mark.setCoordinate(e)},t.prototype.getPlayerId=function(){return this.player.id},t.prototype.getSeatNumber=function(){return this.player.seat},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.isPlayerPlaying=function(){var e=this.player.state;return e!==PlayerState.NotInGame},t.prototype.isPlayerIdEqualTo=function(e){return this.player.id===e},t.prototype.showTalkingSign=function(){this.talkingView||(this.talkingView=new TalkingView(this.coordinate),this.talkingView.x=0,this.talkingView.y=-5,this.addChild(this.talkingView))},t.prototype.hideTalkingSign=function(){this.talkingView&&this.contains(this.talkingView)&&(this.removeChild(this.talkingView),this.talkingView=void 0)},t.prototype.setMark=function(e){this.mark=new MarkView(e,this.coordinate),this.group.addChild(this.mark)},t.prototype.updateScoreboard=function(e){void 0===e&&(e=0),this.scoreboard||(this.scoreboard=new ScoreboardView(this.coordinate,this.propertyName),this.group.addChild(this.scoreboard)),this.scoreboard.updateAmount(e)},t.prototype.removeScoreboard=function(){this.scoreboard&&(this.group.removeChild(this.scoreboard),this.scoreboard=void 0)},t.prototype.updateStack=function(e){void 0===e&&(e=0),this.stack=e,this.scoreLabel.text=""+MoneyFormatter.addChineseUnit(e)},t.prototype.getCurrentStatus=function(){return this.currentStatus},t.prototype.updateStatusImage=function(e){this.currentStatus=e,this.statusImage||(this.statusImage=new StatusImage(this.coordinate),this.group.addChild(this.statusImage)),e===GameAction.AllIn&&this.showFire(),ActionUtil.updateSource(this.statusImage,e)},t.prototype.removeStatusImage=function(){this.statusImage&&(this.group.removeChild(this.statusImage),this.statusImage=void 0)},t.prototype.startTimer=function(e,t){var n=this;this.clearProgressTimer(),this.progressTimer=new egret.Timer(100,180),this.progressTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.progressTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this);var i=t+3;this.showCountdownCover(),this.timerLabel.visible=!0,this.timerLabel.text=t.toString(),this.countdown=setInterval(function(){var t=Number(n.timerLabel.text),i=Math.floor(e/2);if((t===i||5>=t)&&t>0){var o=new PlayerViewEvent(PlayerViewEvent.Warning);o.time=t,n.dispatchEvent(o)}t>10?n.timerLabel.textColor=8843792:t>5&&10>=t?n.timerLabel.textColor=15915527:n.timerLabel.textColor=16336135;var r=t-1;n.timerLabel.text=""+(0>r?0:r)},1e3),this.progressBorder.visible=!0;var o=10*i;this.progressTimer.repeatCount=o,this.changedAngle=360/e/10,this.angle=(10*e-10*t)*this.changedAngle,this.progressTimer.start()},t.prototype.pauseTimer=function(){clearInterval(this.countdown),this.clearProgressTimer()},t.prototype.stopTimer=function(){this.hideCountdownCover(),clearInterval(this.countdown),this.countdown=void 0,this.timerLabel.textColor=8843792,this.timerLabel.visible=!1,this.progressBorder.visible=!1,this.angle=0,this.clearProgressTimer()},t.prototype.showCover=function(){this.group.alpha=.4},t.prototype.hideCover=function(){this.group.alpha=1},t.prototype.showFire=function(){this.clearFireParticle(),this.fireSoundHashCode||(this.fireSoundHashCode=SoundManager.sharedInstance().playEffectSound(SoundEffectSource.ALL_IN_FIRE,1));var e=RES.getRes("fire_particle_png"),t=RES.getRes("fire_particle_json");this.fireParticle=new particle.GravityParticleSystem(e,t),this.fireParticle.x=this.width/2,this.fireParticle.y=this.height/2+30,this.fireParticle.scaleY=1.2,this.fireParticle.scaleX=1.5,this.addChild(this.fireParticle),this.fireParticle.start()},t.prototype.hideFire=function(){this.fireSoundHashCode&&(SoundManager.sharedInstance().stopPlayEffectSound(this.fireSoundHashCode),this.fireSoundHashCode=void 0),this.fireParticle&&this.fireParticle.stop(!0)},t.prototype.showCard=function(e,t){var n=this;e.forEach(function(e,i){var o=new CardImage(e.prime);o.y=20,o.x=76*i-24,o.source="poker_back_png",n.addChild(o),n.handCards.push(o),egret.Tween.get(o).to({x:-24},200).call(function(){o.source="poker_"+e.name+"_"+t+"_png",egret.Tween.get(o).to({x:76*i-24},200)})})},t.prototype.showCardType=function(e){this.scoreLabel.visible=!1,this.cardTypeLabel.text=e,this.cardTypeLabel.visible=!0},t.prototype.playWinnerAnimation=function(){this.clearCoinParticle(),SoundManager.sharedInstance().playEffectSound(SoundEffectSource.WON_COIN);var e=RES.getRes("coin_particle_png"),t=RES.getRes("coin_particle_json");this.coinParticle=new particle.GravityParticleSystem(e,t),this.addChild(this.coinParticle),this.coinParticle.start(1e3)},t.prototype.showPrizeLabel=function(e){var t=this,n=new eui.Label;n.y=23,n.size=30,n.width=200,n.horizontalCenter=0,n.bold=!0,n.textColor=15915527,n.textAlign="center",n.text="+"+MoneyFormatter.addChineseUnit(e),this.addChild(n);var i=-30;egret.Tween.get(n).to({y:i},1e3).wait(3e3).call(function(){t.removeChild(n),n=void 0})},t.prototype.playStickerAnimation=function(e){var t=this;this.stickerAnimation&&this.contains(this.stickerAnimation)&&(this.removeChild(this.stickerAnimation),this.stickerAnimation=void 0);var n=RES.getRes("sticker_"+e+"_json"),i=RES.getRes("sticker_"+e+"_png"),o=new egret.MovieClipDataFactory(n,i);this.stickerAnimation=new egret.MovieClip(o.generateMovieClipData(e)),this.stickerAnimation.y=.3*(this.height-this.stickerAnimation.height),this.stickerAnimation.x-=10,this.addChild(this.stickerAnimation),this.stickerAnimation.gotoAndPlay(e,3),this.stickerAnimation.once(egret.Event.COMPLETE,function(){t.removeChild(t.stickerAnimation),t.stickerAnimation=void 0},this)},t.prototype.playPropsAnimation=function(e){var t=this,n=RES.getRes("props_"+e+"_json"),i=RES.getRes("props_"+e+"_png");RES.hasRes("props_"+e+"_mp3")&&SoundManager.sharedInstance().playEffectSound("props_"+e+"_mp3");var o=new egret.MovieClipDataFactory(n,i),r=new egret.MovieClip(o.generateMovieClipData(e));r.y+="water"===e?-50:20,r.x-=20,this.addChild(r),r.gotoAndPlay(e,1),r.once(egret.Event.COMPLETE,function(){t.removeChild(r),r=void 0},this)},t.prototype.reset=function(){this.mark&&(this.group.removeChild(this.mark),this.mark=void 0);for(var e=this.handCards.length-1;e>=0;e-=1)this.removeChild(this.handCards[e]),this.handCards[e]=void 0,this.handCards.splice(e,1);this.clearCoinParticle(),this.clearFireParticle(),this.clearProgressTimer(),this.scoreLabel.visible=!0,this.cardTypeLabel.visible=!1,this.handCards=[],this.currentStatus=void 0,this.removeScoreboard(),this.removeStatusImage(),this.hideCover(),this.hideFire()},t.prototype.destroy=function(){this.parent&&this.parent.removeChild(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),EventCenter.sharedInstance().addEventListener(BlockEvent.BLOCK_STATE_CHANGED,this.onBlockStateChanged,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlayerView,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.initMask()},t.prototype.setNickname=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=this.userModel.getPlayerNickname(e),null!==t?[3,2]:[4,this.userModel.queryProfile(e,this.userModel.accessToken)];case 1:return n=r.sent(),i=new PlayerProfile(n.result),this.nameLabel.text=i.nickname,this.userModel.savePlayerNickname(e,i.nickname),[3,3];case 2:this.nameLabel.text=t,r.label=3;case 3:return[3,5];case 4:return o=r.sent(),this.setNickname(e),Toast.show(o.message),[3,5];case 5:return[2]}})})},t.prototype.setAvatar=function(e){this.blockModel.isBlockedPlayer(e.id)?this.avatarImage.source=ImageUtil.BLOCKED_AVATAR_SOURCE:(ImageUtil.loadUrlSource(this.avatarImage,e.avatarUrl),ImageUtil.renderRoundMask(this.avatarImage,10))},t.prototype.initMask=function(){this.radius=Math.max(this.progressBorder.width,this.progressBorder.height)/2*3,this.maskShape=new egret.Shape,this.maskShape.rotation=-90,this.maskShape.x=this.progressBorder.width/2,this.maskShape.y=this.progressBorder.height/2,this.progressBorder.mask=this.maskShape,this.group.addChild(this.maskShape)},t.prototype.onTouchPlayerView=function(){var e=new PlayerViewEvent(PlayerViewEvent.Touch);e.player=this.player,this.dispatchEvent(e)},t.prototype.onTimer=function(){this.angle+=this.changedAngle,this.angle>360||(this.changeGraphics(this.angle),this.angle=this.angle%360)},t.prototype.onTimerComplete=function(){var e=new PlayerViewEvent(PlayerViewEvent.TimerEnd);e.playerId=this.player.id,this.dispatchEvent(e)},t.prototype.changeGraphics=function(e){this.maskShape.graphics.clear(),this.maskShape.graphics.beginFill(52224,1),this.maskShape.graphics.lineTo(this.radius,0),this.maskShape.graphics.drawArc(0,0,this.radius,0,e*Math.PI/180,!0),this.maskShape.graphics.lineTo(0,0),this.maskShape.graphics.endFill()
},t.prototype.showCountdownCover=function(){this.countdownCover.visible=!0},t.prototype.hideCountdownCover=function(){this.countdownCover.visible=!1},t.prototype.clearCoinParticle=function(){this.coinParticle&&this.contains(this.coinParticle)&&(this.coinParticle.stop(!0),this.removeChild(this.coinParticle),this.coinParticle=void 0)},t.prototype.clearFireParticle=function(){this.fireParticle&&this.contains(this.fireParticle)&&(this.fireParticle.stop(!0),this.removeChild(this.fireParticle),this.fireParticle=void 0)},t.prototype.clearProgressTimer=function(){this.progressTimer&&(this.progressTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.progressTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.progressTimer.reset(),this.progressTimer=void 0)},t.prototype.onBlockStateChanged=function(e){e.playerId===this.player.id&&(e.data?(this.nameLabel.text="****",this.avatarImage.source=ImageUtil.BLOCKED_AVATAR_SOURCE):(this.setNickname(this.player.id),ImageUtil.loadUrlSource(this.avatarImage,this.player.avatarUrl),ImageUtil.renderRoundMask(this.avatarImage,10)))},t.prototype.onRemoveFromStage=function(){clearInterval(this.countdown),this.countdown=void 0,EventCenter.sharedInstance().removeEventListener(BlockEvent.BLOCK_STATE_CHANGED,this.onBlockStateChanged,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlayerView,this)},t}(eui.Component);__reflect(PlayerView.prototype,"PlayerView");var LoadingScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="LoadingSkin",t}return __extends(t,e),t}(eui.Component);__reflect(LoadingScene.prototype,"LoadingScene");var RaiseSlider=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setValue=function(t){e.prototype.setValue.call(this,t),this.setDashboardValue(t),this.setProgressValue(t)},t.prototype.setDashboardValue=function(e){this.dashboardLabel.text=e.toString()},t.prototype.setProgressValue=function(e){this.progressLabel.text=e.toString()},t}(eui.VSlider);__reflect(RaiseSlider.prototype,"RaiseSlider");var ScoreboardView=function(e){function t(t,n){var i=e.call(this)||this;return i.skinName="ScoreboardSkin",i.icon.source="chip"===n?"icon_player_chip_png":"icon_player_coin_png",i.setCoordinate(t),i}return __extends(t,e),t.prototype.updateAmount=function(e){this.chipLabel.text=""+MoneyFormatter.addChineseUnit(e)},t.prototype.setCoordinate=function(e){var t=e.direction;t===Direction.Left?(this.x=70,this.y=81):t===Direction.Right?(this.x=-70,this.y=81,this.icon.x=74,this.chipLabel.x=9):(this.x=136,this.y=0)},t}(eui.Component);__reflect(ScoreboardView.prototype,"ScoreboardView");var SeatView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="SeatViewSkin",n.seatNumber=t.seat,n.coordinate=t,n.initCoordinate(t),n}return __extends(t,e),t.prototype.getSeatNumber=function(){return this.seatNumber},t.prototype.updatePosition=function(e,t){egret.Tween.get(this).to({x:e+10,y:t+51},500)},t.prototype.enableTouch=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.icon.visible=!0,AnimationUtil.loopPlay(this.bounce),this.labelDisplay.text="坐下",this.touchEnabled=!0},t.prototype.disableTouch=function(){this.bounce.stop(),this.icon.visible=!1,this.labelDisplay.text="空位",this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},t.prototype.initCoordinate=function(e){this.x=e.x+10,this.y=e.y+51},t.prototype.onTouch=function(){var e=new SeatTouchEvent(SeatTouchEvent.TouchSeat);e.seatNumber=this.seatNumber,this.dispatchEvent(e)},t}(eui.Component);__reflect(SeatView.prototype,"SeatView");var StatusImage=function(e){function t(t){var n=e.call(this)||this;return n.width=78,n.height=46,n.setCoordinate(t),n}return __extends(t,e),t.prototype.updateSource=function(e){this.source=e},t.prototype.setCoordinate=function(e){var t=e.direction;t===Direction.Left?this.x=60:this.x=-38,this.y=35},t}(eui.Image);__reflect(StatusImage.prototype,"StatusImage");var ApplicationRecordScene=function(e){function t(t,n){var i=e.call(this)||this;return i.roomId=t,i.minBuyIn=n,i.skinName="ApplicationRecordSkin",i.group.scaleX=.7,i.group.scaleY=.7,i.userModel=new UserModel,i.clubManagerModel=new ClubManagerModel,i.buyInModel=new BuyInModel,i}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.buyInList.itemRenderer=BuyInApplicationItemRenerer,this.buyInList.addEventListener(ApplicationEvent.ApplicationCheck,this.onBuyInItemTap,this),this.clubApplicationList.itemRenderer=ClubApplicationitemRenderer,this.clubApplicationList.addEventListener(ApplicationEvent.ApplicationCheck,this.onClubApplicationItemTap,this),this.listBuyInApplication(),this.listClubApplication()},t.prototype.listBuyInApplication=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.buyInModel.listApplications(this.roomId,this.userModel.accessToken)];case 1:return e=o.sent(),e.result.applications.length>0?(t=e.result.applications.map(function(e){var t=new BuyInApplication(e);return Object.assign(t,{minBuyIn:i.minBuyIn}),t}),this.buyInList.dataProvider=new eui.ArrayCollection(t),this.buyInPromptLabel.text=" "):this.buyInPromptLabel.text="还没有收到任何消息",[3,3];case 2:return n=o.sent(),this.buyInPromptLabel.text=n.message,[3,3];case 3:return[2]}})})},t.prototype.listClubApplication=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o=this;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.clubManagerModel.listApplications(this.userModel.accessToken)];case 1:return e=r.sent(),e.result.applications.length>0?(t=e.result.applications.filter(function(e){return e.user_id!==o.userModel.id}),n=t.map(function(e){return new ClubApplication(e)}),this.clubApplicationList.dataProvider=new eui.ArrayCollection(n),this.clubApplicationPromptLabel.text=" "):this.clubApplicationPromptLabel.text="还没有收到任何消息",[3,3];case 2:return i=r.sent(),this.clubApplicationPromptLabel.text=i.message,[3,3];case 3:return[2]}})})},t.prototype.onBuyInItemTap=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:t=e.data.applicationId,n=e.approve?"approve":"reject",i=this.userModel.nickname,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.buyInModel.processApplication(t,n,i,this.userModel.accessToken)];case 2:return r.sent(),[3,5];case 3:return o=r.sent(),Toast.show(o.message),[3,5];case 4:return this.listBuyInApplication(),[7];case 5:return[2]}})})},t.prototype.onClubApplicationItemTap=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:t=e.data.id,n=e.approve?"approve":"reject",o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.clubManagerModel.processApplication(t,n,this.userModel.accessToken)];case 2:return o.sent(),[3,5];case 3:return i=o.sent(),Toast.show(i.message),[3,5];case 4:return this.listClubApplication(),[7];case 5:return[2]}})})},t}(eui.Component);__reflect(ApplicationRecordScene.prototype,"ApplicationRecordScene");var BuyInApplicationItemRenerer=function(e){function t(){var t=e.call(this)||this;return t.skinName="BuyInApplicationItemSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.agreeLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeTouch,this),this.rejectLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectTouch,this)},t.prototype.dataChanged=function(){if(e.prototype.dataChanged.call(this),"waiting"!==this.data.status){this.operationGroup.visible=!1,this.statusLabel.visible=!0;var t="";switch(this.data.status){case"approve":t="已同意";break;case"reject":t="已拒绝";break;case"transferred":t="已补充"}this.statusLabel.text=t}else this.operationGroup.visible=!0,this.statusLabel.visible=!1;this.nicknameLabel.text=this.data.userNickname;var n="申请带入 <font color=0x6bfffd>"+MoneyFormatter.addChineseUnit(this.data.chip)+"</font>";this.scoreLabel.textFlow=(new egret.HtmlTextParser).parse(n),this.minLabel.text="* 该房间最低带入数量为 "+MoneyFormatter.addChineseUnit(this.data.minBuyIn)},t.prototype.onAgreeTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已同意",this.statusLabel.visible=!0,this.dispatchApplicationEvent(this.data,!0)},t.prototype.onRejectTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已拒绝",this.statusLabel.visible=!0,this.dispatchApplicationEvent(this.data,!1)},t.prototype.dispatchApplicationEvent=function(e,t){var n=new ApplicationEvent(ApplicationEvent.ApplicationCheck);n.data=e,n.approve=t,this.parent.dispatchEvent(n)},t}(eui.ItemRenderer);__reflect(BuyInApplicationItemRenerer.prototype,"BuyInApplicationItemRenerer");var BuyInApplicationScene=function(e){function t(t){var n=e.call(this)||this;n.skinName="BuyInApplicationSkin",n.group.scaleX=.7,n.group.scaleY=.7,n.data=t,n.nicknameLabel.text=t.applicantNickname;var i="申请带入 <font color=0x00adf7>"+MoneyFormatter.addChineseUnit(t.amount)+"</font>";return n.scoreLabel.textFlow=(new egret.HtmlTextParser).parse(i),n.minScoreLabel.text="* 该房间最低带入数量为 "+MoneyFormatter.addChineseUnit(t.minBuyIn),n.userModel=new UserModel,n.buyInModel=new BuyInModel,n}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.agreeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeButtonTouch,this),this.rejectButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectButtonTouch,this)},t.prototype.onAgreeButtonTouch=function(){this.checkBuyIn(!0),this.remove()},t.prototype.onRejectButtonTouch=function(){this.checkBuyIn(!1),this.remove()},t.prototype.checkBuyIn=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:t=this.data.applicationId,n=e?"approve":"reject",i=this.userModel.nickname,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.buyInModel.processApplication(t,n,i,this.userModel.accessToken)];case 2:return r.sent(),[3,4];case 3:return o=r.sent(),Toast.show(o.message),[3,4];case 4:return[2]}})})},t}(eui.Component);__reflect(BuyInApplicationScene.prototype,"BuyInApplicationScene");var ClubApplicationScene=function(e){function t(t){var n=e.call(this)||this;n.touchY=0,n.skinName="ClubApplicationSkin",n.data=t,n.group.y=-140,n.nicknameLabel.text=t.userNickname,ImageUtil.loadUrlSource(n.avatar,AvatarURLFactory.makeById(t.userId));var i="申请加入 <font color=0x6bfffd>"+t.clubName+"</font> 俱乐部";return n.clubLabel.textFlow=(new egret.HtmlTextParser).parse(i),n.clubManagerModel=new ClubManagerModel,n.userModel=new UserModel,n}return __extends(t,e),t.prototype.remove=function(){egret.Tween.get(this.group).to({y:-140},200).call(function(){SceneManager.sharedInstance().popScene()})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0;var t=Device.sharedInstance().isIphoneX()?Constants.iPhoneX_TOP_MARGIN+10:10;egret.Tween.get(this.group).to({y:t},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBackgroundTouchBegin,this),this.background.addEventListener(egret.TouchEvent.TOUCH_END,this.onBackgroundTouchEnd,this),this.agreeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeButtonTouch,this),this.rejectButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectButtonTouch,this)},t.prototype.onAgreeButtonTouch=function(){this.checkClubApplication(!0)},t.prototype.onRejectButtonTouch=function(){this.checkClubApplication(!1)},t.prototype.onBackgroundTouchBegin=function(e){this.touchY=e.stageY},t.prototype.onBackgroundTouchEnd=function(e){var t=this.touchY-e.stageY;t>10&&this.remove(),this.touchY=0},t.prototype.checkClubApplication=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:t=this.data.id,n=e?"approve":"reject",o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.clubManagerModel.processApplication(t,n,this.userModel.accessToken)];case 2:return o.sent(),[3,5];case 3:return i=o.sent(),Toast.show(i.message),[3,5];case 4:return this.remove(),[7];case 5:return[2]}})})},t}(eui.Component);__reflect(ClubApplicationScene.prototype,"ClubApplicationScene");var ClubApplicationitemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="ClubApplicationItemSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.agreeLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgreeTouch,this),this.rejectLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRejectTouch,this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data.processedAt?(this.operationGroup.visible=!1,this.statusLabel.visible=!0,this.statusLabel.text=this.data.permitted?"已同意":"已拒绝"):(this.operationGroup.visible=!0,this.statusLabel.visible=!1),this.nicknameLabel.text=this.data.userNickname;var t="申请加入 <font color=0x6bfffd>"+this.data.clubName+"</font> 俱乐部";this.clubLabel.textFlow=(new egret.HtmlTextParser).parse(t)},t.prototype.onAgreeTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已同意",this.statusLabel.visible=!0,this.dispatchApplicationEvent(this.data,!0)},t.prototype.onRejectTouch=function(){this.operationGroup.visible=!1,this.statusLabel.text="已拒绝",this.statusLabel.visible=!0,this.dispatchApplicationEvent(this.data,!1)},t.prototype.dispatchApplicationEvent=function(e,t){var n=new ApplicationEvent(ApplicationEvent.ApplicationCheck);n.data=e,n.approve=t,this.parent.dispatchEvent(n)},t}(eui.ItemRenderer);__reflect(ClubApplicationitemRenderer.prototype,"ClubApplicationitemRenderer");var MessageAlarm=function(e){function t(){var t=e.call(this)||this;return t.skinName="MessageAlarmSkin",t}return __extends(t,e),t.prototype.showDot=function(){this.dot.visible=!0},t.prototype.hideDot=function(){this.dot.visible=!1},t}(eui.Component);__reflect(MessageAlarm.prototype,"MessageAlarm");var AudioScene=function(e){function t(t){var n=e.call(this)||this;return n.isSend=!1,n.duration=10,n.skinName="AudioViewSkin",n.roomId=t,n.group.bottom=-502,n}return __extends(t,e),t.prototype.remove=function(){this&&this.parent&&SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({bottom:0},100),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.recordButton.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRecordButtonTouchBegin,this),this.recordButton.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onRecordButtonTouchMove,this),this.recordButton.addEventListener(egret.TouchEvent.TOUCH_END,this.onRecordButtonTouchEnd,this),this.recordButton.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onRecordButtonTouchEnd,this)},t.prototype.onBackgroundTouch=function(){this.isSend=!1,this.stopRecord(),this.remove()},t.prototype.onRecordButtonTouchBegin=function(e){var t=this;this.isSend=!0,this.recordingGroup.visible=!0,this.cancelLabel.text="手指上滑  取消发送",this.promptLabel.text="松开  结束",this.touchedPointY=e.stageY,this.duration=10,this.timer=setInterval(function(){t.duration-=1,t.timerLabel.text=""+t.duration,0===t.duration&&(Toast.show("超出录制时间, 已发送"),t.isSend=!0,clearInterval(t.timer),t.stopRecord(),t.remove())},1e3),window.postMessage(JSON.stringify({command:GameCommand.RECORD_AUDIO}),"*")},t.prototype.onRecordButtonTouchMove=function(e){var t=e.stageY;this.touchedPointY>t&&(this.cancelLabel.text="松开手指  取消发送",this.promptLabel.text="手指下滑  继续录制",this.cancelableImage.visible=!0,this.timerLabel.visible=!1,this.isSend=!1),this.touchedPointY<=t&&(this.cancelLabel.text="手指上滑  取消发送",this.promptLabel.text="松开  结束",this.cancelableImage.visible=!1,this.timerLabel.visible=!0,this.isSend=!0)},t.prototype.onRecordButtonTouchEnd=function(){this.stopRecord(),this.remove()},t.prototype.stopRecord=function(){clearInterval(this.timer);var e={room_id:this.roomId,is_send:!1};this.isSend&&(this.duration>9?Toast.show("说话时间太短"):e.is_send=!0),window.postMessage(JSON.stringify({command:GameCommand.STOP_RECORD_AUDIO,payload:e}),"*")},t}(eui.Component);__reflect(AudioScene.prototype,"AudioScene");var BuyInScene=function(e){function t(t){var n=e.call(this)||this;return n.skinName="BuyInSkin",n.roomId=t.roomId,n.maxBuyIn=t.maxBuyIn,n.minBuyIn=t.minBuyIn,n.isCreator=t.isCreator,n.isPermitBuyIn=t.isPermitBuyIn,n.propertyName=t.propertyName,n.buyInModel=new BuyInModel,n.userModel=new UserModel,n.playerModel=new PlayerModel,n.group.scaleX=n.group.scaleY=0,n}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.init(),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.scoreSlider.addEventListener(egret.Event.CHANGE,this.onSelectSlider,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.init=function(){this.banalceLabelTitle="本局带入的记分牌:","coin"===this.propertyName&&(this.queryCoinBalance(),this.scoreSlider.skinName="CoinBuyInSliderSkin",this.titleLabel.text="金币带入",this.banalceLabelTitle="本局带入的金币:"),this.queryBuyInBalance(),this.coinGroup.visible="coin"===this.propertyName,this.scoreSlider.minimum=this.minBuyIn,this.scoreSlider.maximum=this.maxBuyIn,this.scoreSlider.value=this.minBuyIn,this.scoreTextInput.text=this.minBuyIn.toString(),this.scoreSlider.snapInterval=this.minBuyIn/10,this.minBuyLabel.text="* 该房间最低带入为 "+MoneyFormatter.addChineseUnit(this.minBuyIn),this.group.scaleX=.7,this.group.scaleY=.7},t.prototype.queryBuyInBalance=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e=this.userModel.id,t=this.userModel.accessToken,[4,this.playerModel.queryBalance(this.roomId,e,t)];case 1:return n=a.sent(),i=new BuyInBalance(n.result),o=i.amount-i.subtotal+i.balance,this.balanceLabel.text=this.banalceLabelTitle+" "+MoneyFormatter.addChineseUnit(o),[3,3];case 2:return r=a.sent(),Toast.show(r.message+" "+r.status),[3,3];case 3:return[2]}})})},t.prototype.queryCoinBalance=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:this.confirmButton.touchEnabled=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.userModel.queryCurrencyBalance(this.userModel.id,"coin",this.userModel.accessToken)];case 2:return e=i.sent(),t=new Currency(e.result),this.coinBalanceLabel.text=t.balance,this.confirmButton.touchEnabled=!0,[3,4];case 3:return n=i.sent(),Toast.show(n.message),[3,4];case 4:return[2]}})})},t.prototype.onSelectSlider=function(){var e=this.scoreSlider.value;this.scoreTextInput.text=this.scoreSlider.value.toString(),e===this.scoreSlider.minimum?(this.minBuyLabel.text="* 该房间最低带入为 "+MoneyFormatter.addChineseUnit(this.minBuyIn),this.minBuyLabel.visible=!0):e===this.scoreSlider.maximum?(this.minBuyLabel.text="* 该房间每次最多只能带入 "+MoneyFormatter.addChineseUnit(this.maxBuyIn),this.minBuyLabel.visible=!0):this.minBuyLabel.visible=!1},t.prototype.onConfirmButtonTouch=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r=this;return __generator(this,function(a){switch(a.label){case 0:if(e=Number(this.scoreTextInput.text),!e||0>=e)return Toast.show("请输入合理的数量"),[2];if(e<this.minBuyIn)return Toast.show("不得低于该房间的最低带入"),[2];if(e>this.maxBuyIn)return Toast.show("不得高于该房间的最高带入"),[2];this.remove(),a.label=1;case 1:return a.trys.push([1,3,,4]),!this.isCreator&&this.isPermitBuyIn&&Toast.show("已向房主发出申请, 请等待房主同意..."),t=this.userModel.id,n=this.userModel.nickname,[4,this.buyInModel.requestBuyIn(this.roomId,e,t,n,this.userModel.accessToken)];case 2:return a.sent(),[3,4];case 3:return i=a.sent(),"insufficient_property"===i.errorType?(o=[{name:"取消"},{name:"前往",action:function(){r.leaveForMall()}}],MessageAlert.show("您的金币余额不足以本次带入的数量, 请前往商城中进行兑换。",i.status,o)):MessageAlert.show(i.message,i.status),[3,4];case 4:return[2]}})})},t.prototype.leaveForMall=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,3,4]),[4,this.playerModel.leave(this.roomId,this.userModel.accessToken)];case 1:return t.sent(),[3,4];case 2:return e=t.sent(),egret.log(e),[3,4];case 3:return window.postMessage(JSON.stringify({command:GameCommand.LEAVE_FOR_MALL}),"*"),[7];case 4:return[2]}})})},t}(eui.Component);__reflect(BuyInScene.prototype,"BuyInScene");var ScoreTextInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="ScoreTextInputSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.deleteButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDeleteButtonTouch,this)},t.prototype.onDeleteButtonTouch=function(){this.textDisplay.text=this.text=""},t}(eui.TextInput);__reflect(ScoreTextInput.prototype,"ScoreTextInput");var ChatHistoryItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.label=new eui.Label,this.label.width=652,this.label.size=26,this.label.textColor=12962790,this.addChild(this.label)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.label.text=this.data},t}(eui.ItemRenderer);__reflect(ChatHistoryItemRenderer.prototype,"ChatHistoryItemRenderer");var ChatHistoryView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatHistorySkin",t}return __extends(t,e),t.prototype.updateHistory=function(e){this.historyList.dataProvider=new eui.ArrayCollection(e)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.historyList.itemRenderer=ChatHistoryItemRenderer},t}(eui.Component);__reflect(ChatHistoryView.prototype,"ChatHistoryView");var ChatScene=function(e){function t(t,n){var i=e.call(this)||this;return i.roomId=t,i.chatHistory=n,i.chatModel=new ChatModel,i.userModel=new UserModel,i.skinName="ChatViewSkin",i.chatGroup.bottom=-764,i}return __extends(t,e),t.prototype.remove=function(){egret.Tween.get(this.chatGroup).to({bottom:-764},150).call(function(){SceneManager.sharedInstance().popScene()})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.chatGroup).to({bottom:0},150,egret.Ease.sineInOut);var t=egret.localStorage.getItem("showBarrage");"false"!==t?(this.barrageCheckBox.selected=!0,this.toggleLabel.text="弹幕开启",this.toggleLabel.textColor=7077885):(this.barrageCheckBox.selected=!1,this.toggleLabel.text="弹幕关闭",this.toggleLabel.textColor=10732483),this.messageInput.maximun=40,this.stickerList.itemRenderer=StickerItemRenderer,this.stickerList.dataProvider=new eui.ArrayCollection(Stickers),this.tabBar.itemRenderer=ChatTabBarItemRenderer,this.phraseList.dataProvider=new eui.ArrayCollection(Phrases),this.chatHistoryView.updateHistory(this.chatHistory),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.barrageCheckBox.addEventListener(egret.Event.CHANGE,this.onBarrageCheckBoxChange,this),this.messageInput.addEventListener(egret.Event.CHANGE,this.onInputChange,this),this.sendButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendButtonTouch,this),this.stickerList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onStickerListItemTouch,this),this.phraseList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onPhraseListItemTouch,this)},t.prototype.onBarrageCheckBoxChange=function(){var e=this.barrageCheckBox.selected;this.toggleLabel.text=e?"弹幕开启":"弹幕关闭",this.toggleLabel.textColor=e?7077885:10732483,egret.localStorage.setItem("showBarrage",e.toString())},t.prototype.onInputChange=function(){var e=this.messageInput.text;this.messageInput.value=e.length,e.length>40&&(e=e.substr(0,40),this.messageInput.text=e,this.messageInput.value=e.length)},t.prototype.onSendButtonTouch=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:if(this.remove(),e=egret.localStorage.getItem("showBarrage"),"false"===e)return Toast.show("请先打开弹幕功能"),[2];if(t=this.messageInput.text,t=t.trim(),!t)return Toast.show("发送内容不能为空"),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.chatModel.sendText(this.roomId,t,this.userModel.nickname,this.userModel.accessToken)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),"user_is_banned"===n.errorType&&this.sendMessageToLocal(t),[3,4];case 4:return[2]}})})},t.prototype.sendMessageToLocal=function(e){var t={data:{stream:"room_message",payload:{action:MessageAction.Text,content:{from_user_nickname:this.userModel.nickname,text:e,from_user_id:this.userModel.id}}}};CentrifugeServer.sharedInstance().sendCustomMessage(t)},t.prototype.onStickerListItemTouch=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:this.remove(),i.label=1;case 1:return i.trys.push([1,3,,4]),t=e.item,[4,this.chatModel.sendSticker(this.roomId,t,this.userModel.accessToken)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),Toast.show(n.message),[3,4];case 4:return[2]}})})},t.prototype.onPhraseListItemTouch=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:this.remove(),i.label=1;case 1:return i.trys.push([1,3,,4]),t=e.item,[4,this.chatModel.sendText(this.roomId,t,this.userModel.nickname,this.userModel.accessToken)];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),Toast.show(n.message),[3,4];case 4:return[2]}})})},t}(eui.Component);__reflect(ChatScene.prototype,"ChatScene");var ChatTabBarItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatTabBarSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t="";switch(this.data){case"表情":t="sticker";break;case"短语":t="phrase";break;case"聊天记录":t="message_record"}this.iconUp.source="icon_"+t+"_tab_unselect_png",this.iconDown.source="icon_"+t+"_tab_selected_png"},t}(eui.ItemRenderer);__reflect(ChatTabBarItemRenderer.prototype,"ChatTabBarItemRenderer");var ChatTextInput=function(e){function t(){var t=e.call(this)||this;return t.skinName="ChatTextInputSkin",t._maximun=0,t._value=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"maximun",{get:function(){return this._maximun},set:function(e){this.amountLabel.text=this._value+"/"+e,this._maximun=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this.amountLabel.text=e+"/"+this._maximun,this._value=e},enumerable:!0,configurable:!0}),t}(eui.TextInput);__reflect(ChatTextInput.prototype,"ChatTextInput");var PhraseItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="PhraseItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.label.text=this.data.toString()},t}(eui.ItemRenderer);__reflect(PhraseItemRenderer.prototype,"PhraseItemRenderer");var StickerItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="StickerItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.sticker.source="icon_sticker_"+this.data+"_png"},t}(eui.ItemRenderer);__reflect(StickerItemRenderer.prototype,"StickerItemRenderer");var TalkingView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="TalkingViewSkin",n.startTalking(t),n}return __extends(t,e),t.prototype.startTalking=function(e){var t=e.direction,n=t===Direction.Right;this.leftTalkingGroup.visible=!n,this.rightTalkingGroup.visible=n;var i=n?this.rightTalkingAnimation:this.leftTalkingAnimation;AnimationUtil.loopPlay(i)},t}(eui.Component);__reflect(TalkingView.prototype,"TalkingView");var DebugLogItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this.data.delay>1e3?16517642:8911889,n=this.data.delay?"<font color="+t+">("+this.data.delay+"ms)</font>":"",i="<font color=0x13f720>"+this.data.action+"</font>"+n+"<font color=0xf73427>("+this.data.date+")</font>: "+this.data.message;this.label.textFlow=(new egret.HtmlTextParser).parse(i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.label=new eui.Label,this.label.width=560,this.addChild(this.label)},t}(eui.ItemRenderer);__reflect(DebugLogItemRenderer.prototype,"DebugLogItemRenderer");var DebugView=function(e){function t(){var t=e.call(this)||this;return t.logs=[],t.touchTimes=0,t.lastTime=0,t.skinName="DebugViewSkin",t}return __extends(t,e),t.prototype.updateRoomId=function(e){this.roomIdLabel.text="房间号: "+e},t.prototype.updateGameId=function(e){this.gameIdLabel.text="游戏Id: "+e},t.prototype.updateLog=function(e){this.logs.length>200&&(this.logs=[]),this.domainLabel.text=""+ApiConfig.ApiDomain,this.logs.unshift(e),this.logList.dataProvider=new eui.ArrayCollection(this.logs);var t=WebSocketRequest.sharedInstance().delay;this.delayLabel.text=t+"ms",t>1e3?this.delayLabel.textColor=16517642:this.delayLabel.textColor=8911889},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.domainLabel.text=""+ApiConfig.ApiDomain,this.logList.itemRenderer=DebugLogItemRenderer,Device.sharedInstance().isIphoneX()&&(this.header.height+=Constants.iPhoneX_TOP_MARGIN+20)},t.prototype.onTouch=function(){var e=(new Date).valueOf();0===this.touchTimes?(this.touchTimes+=1,this.lastTime=e):6===this.touchTimes?(this.touchTimes=0,this.lastTime=0,this.logs=[],this.logList.dataProvider=new eui.ArrayCollection(this.logs)):e-this.lastTime<500?(this.touchTimes+=1,this.lastTime=e):(this.touchTimes=0,this.lastTime=0)},t}(eui.Component);__reflect(DebugView.prototype,"DebugView");var InsuranceView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InsuranceSkin",t.group.scaleX=.7,t.group.scaleY=.7,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut)},t}(eui.Component);__reflect(InsuranceView.prototype,"InsuranceView");var Leaderboard=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardSkin",t}return __extends(t,e),t.prototype.setPlayers=function(e){this.emptyLabel.visible=0===e.length,this.playerList.dataProvider=new eui.ArrayCollection(e)},t.prototype.setViewPlayers=function(e){this.viewerList.dataProvider=new eui.ArrayCollection(e)},t.prototype.setOnLineViewers=function(e,t){this.viewerHeader.setViewPlayersAmount("（"+e+"/"+t+"）")
},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.playerList.itemRenderer=LeaderboardListItem,this.playerList.useVirtualLayout=!0,this.viewerList.itemRenderer=LeaderboardViewer,this.viewerList.useVirtualLayout=!0,this.viewerList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onViewerListItemTapped,this),Device.sharedInstance().isIphoneX()&&(this.headerGroup.height+=Constants.iPhoneX_TOP_MARGIN,this.contentGroup.height-=Constants.iPhoneX_TOP_MARGIN);var t=this.headerGroup.height+this.playerInfoHeader.height+this.viewerHeader.height,n=(SceneManager.sharedInstance().stageSize.height-t)/2;this.playerListScroller.height=n,this.viewerListScroller.height=n},t.prototype.onViewerListItemTapped=function(e){var t=new Player({id:this.viewerList.selectedItem.memberId,nickname:this.viewerList.selectedItem.userNickname});SceneManager.sharedInstance().popScene();var n=new PlayerDetailScene(t,[],!1);SceneManager.sharedInstance().pushScene(n)},t}(eui.Component);__reflect(Leaderboard.prototype,"Leaderboard");var LeaderboardListItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardListItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.nicknameLabel.textColor=this.data.textColor,this.buyInLabel.textColor=this.data.textColor,this.roundAmountLabel.textColor=this.data.textColor,this.scoreLabel.textColor=this.data.textColor},t}(eui.ItemRenderer);__reflect(LeaderboardListItem.prototype,"LeaderboardListItem");var LeaderboardPlayerInfoHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardPlayerInfoHeaderSkin",t}return __extends(t,e),t}(eui.Component);__reflect(LeaderboardPlayerInfoHeader.prototype,"LeaderboardPlayerInfoHeader");var LeaderboardViewer=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardViewerSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.avatar.source="image_default_avatar_png",ImageUtil.loadUrlSource(this.avatar,this.data.avatarUrl),this.leftAvatarCover.visible="left"===this.data.status,this.nameLabel.text=this.data.userNickname},t}(eui.ItemRenderer);__reflect(LeaderboardViewer.prototype,"LeaderboardViewer");var LeaderboardViewerHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="LeaderboardViewerHeaderSkin",t}return __extends(t,e),t.prototype.setViewPlayersAmount=function(e){this.viewPlayersAmountLabel.text=e},t}(eui.Component);__reflect(LeaderboardViewerHeader.prototype,"LeaderboardViewerHeader");var NumericKeyboardScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="NumericKeyboardSkin",t}return __extends(t,e),t.prototype.updateLimits=function(e,t){this.minimum=e,this.maximum=t},t.prototype.show=function(){this.initComponent(),this.visible=!0},t.prototype.hide=function(){this.visible=!1},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,this.number="",this.minimum=2,this.maximum=1e3,this.initComponent(),this.closeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.buttonList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTouch,this),this.deleteButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDeleteButtonTouch,this),this.zeroButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onZeroButtonTouch,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.initComponent=function(){this.number="",this.displayLabel.textColor=16777215,this.displayLabel.text="最小加注额为"+this.minimum,this.confirmButton.background.fillColor=15582515,this.deleteButton.background.fillColor=8421529,this.confirmButton.labelDisplay.textColor=0,this.confirmButton.label="确定"},t.prototype.onItemTouch=function(e){var t=this.number+(""+e.item.number);this.updateNumber(t)},t.prototype.onDeleteButtonTouch=function(){var e=this.number.slice(0,this.number.length-1);this.updateNumber(e)},t.prototype.onZeroButtonTouch=function(){var e=this.number+"0";this.updateNumber(e)},t.prototype.updateNumber=function(e){return this.displayLabel.textColor=16777215,this.confirmButton.background.fillColor=15582515,this.confirmButton.label="确定",parseInt(e)>this.maximum?(this.number=""+this.maximum,this.displayLabel.textColor=16711680,this.confirmButton.background.fillColor=16537889,this.confirmButton.label="全下"):this.number=e,this.number?void(this.displayLabel.text=""+this.number):void(this.displayLabel.text="最小加注额为"+this.minimum)},t.prototype.onConfirmButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e=parseInt(this.number)||0;if(e<this.minimum)return e=this.minimum,this.number="",void(this.displayLabel.text="最小加注额为"+this.minimum);var t;t=new RaiseEvent(e===this.maximum?RaiseEvent.AllIn:RaiseEvent.Raise),t.data=e,this.dispatchEvent(t),this.hide()},t}(eui.Component);__reflect(NumericKeyboardScene.prototype,"NumericKeyboardScene");var PlayGameButtonGroup=function(e){function t(){var t=e.call(this)||this;return t.ANIMATION_DURATION=150,t.couldAuto=!1,t.isAutoCheck=!1,t.isAutoCheckOrFold=!1,t.skinName="PlayGameButtonGroupSkin",t}return __extends(t,e),t.prototype.setBlind=function(e,t){this.smallBlind=e,this.bigBlind=t},t.prototype.reset=function(){this.isAutoCheck=!1,this.isAutoCheckOrFold=!1,this.autoCheckButton.selected=!1,this.autoCheckOrFoldButton.selected=!1},t.prototype.showSwitchButtons=function(){return this.couldAuto?void(this.couldAuto=!1):this.visible&&this.switchGroup.visible?void(this.autoGroup.visible=!1):(this.visible=!0,this.autoGroup.visible=!1,void(this.switchGroup.visible=!0))},t.prototype.showAutoButtons=function(){return this.visible&&this.autoGroup.visible?void(this.switchGroup.visible=!1):(this.visible=!0,this.autoGroup.visible=!0,void(this.switchGroup.visible=!1))},t.prototype.hide=function(){this.couldAuto=!1,this.visible=!1,this.reset()},t.prototype.update=function(e,t){var n=this;this.callButton.visible=e.couldCall,this.checkButton.visible=e.couldCheck,this.allInButton.visible=e.mustAllIn,this.raiseButton.visible=e.couldRaise,this.quickRaiseButton.visible=e.couldRaise,this.raiseAmount=e.raiseAmount,this.shortcutGroup.visible=e.couldRaise;var i=0;e.couldCall&&(i=e.callAmount),e.couldRaise&&this.updateShortcutButtons(t,i,this.raiseAmount.max),e.couldCall&&(this.callButton.label=""+MoneyFormatter.addChineseUnit(e.callAmount),this.callAmount=e.callAmount),e.mustAllIn&&(this.allInButton.label=""+MoneyFormatter.addChineseUnit(e.raiseAmount)),this.isAutoCheck&&e.couldCheck&&(this.couldAuto=!0,setTimeout(function(){n.onCheckButtonTouch()},300)),this.isAutoCheckOrFold&&(this.couldAuto=!0,e.couldCheck?setTimeout(function(){n.onCheckButtonTouch()},300):setTimeout(function(){n.onFoldButtonTouch()},300)),this.reset()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.foldButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFoldButtonTouch,this),this.checkButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCheckButtonTouch,this),this.callButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCallButtonTouch,this),this.raiseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRaiseButtonTouch,this),this.allInButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAllInButtonTouch,this),this.quickRaiseButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuickRaiseButtonTouch,this),this.firstShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFirstShortcutButtonTouch,this),this.secondShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSecondShortcutButtonTouch,this),this.thirdShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onThirdShortcutButtonTouch,this),this.fourthShortcutButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFourthShortcutButtonTouch,this),this.autoCheckButton.addEventListener(egret.Event.CHANGE,this.onAutoCheckButtonTouch,this),this.autoCheckOrFoldButton.addEventListener(egret.Event.CHANGE,this.onAutoCheckOrFoldButtonTouch,this)},t.prototype.updateShortcutButtons=function(e,t,n){var i=this.smallBlind+this.bigBlind,o="",r="",a="",s="",c=0,u=0,h=0,l=0;i===e?(o="2倍大盲",c=Math.ceil(2*this.bigBlind),r="3倍大盲",u=Math.ceil(3*this.bigBlind),a="4倍大盲",h=Math.ceil(4*this.bigBlind),s="5倍大盲",l=Math.ceil(5*this.bigBlind)):(o="1/2底池",c=Math.ceil((e+t)/2)+t,r="2/3底池",u=2*Math.ceil((e+t)/3)+t,a="一倍底池",h=Math.ceil(e+t)+t,s="最低加注",l=Math.ceil(this.raiseAmount.min)),this.firstShortcutButton.label=o,this.firstShortcutButton.score=c,this.firstShortcutButton.amount=""+MoneyFormatter.addChineseUnit(c),this.firstShortcutButton.enabled=n>=c,c<this.raiseAmount.min&&(this.firstShortcutButton.enabled=!1),this.secondShortcutButton.label=r,this.secondShortcutButton.score=u,this.secondShortcutButton.amount=""+MoneyFormatter.addChineseUnit(u),this.secondShortcutButton.enabled=n>=u,this.thirdShortcutButton.label=a,this.thirdShortcutButton.score=h,this.thirdShortcutButton.amount=""+MoneyFormatter.addChineseUnit(h),this.thirdShortcutButton.enabled=n>=h,this.fourthShortcutButton.label=s,this.fourthShortcutButton.score=l,this.fourthShortcutButton.amount=""+MoneyFormatter.addChineseUnit(l),this.fourthShortcutButton.enabled=n>=l},t.prototype.onFoldButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchFold);this.dispatchEvent(e)},t.prototype.onCheckButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCheck);this.dispatchEvent(e)},t.prototype.onCallButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchCall);e.data=this.callAmount,this.dispatchEvent(e)},t.prototype.onRaiseButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchRaise);this.dispatchEvent(e)},t.prototype.onAllInButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchAllIn);e.data=this.raiseAmount,this.dispatchEvent(e)},t.prototype.onQuickRaiseButtonTouch=function(){var e=new ButtonGroupEvent(ButtonGroupEvent.TouchQuickRaise);this.dispatchEvent(e)},t.prototype.onAutoCheckButtonTouch=function(){var e=this.autoCheckButton.selected;this.isAutoCheck=e,e&&(this.isAutoCheckOrFold=!1,this.autoCheckOrFoldButton.selected=!1)},t.prototype.onAutoCheckOrFoldButtonTouch=function(){var e=this.autoCheckOrFoldButton.selected;this.isAutoCheckOrFold=e,e&&(this.isAutoCheck=!1,this.autoCheckButton.selected=!1)},t.prototype.onFirstShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.firstShortcutButton.score,this.dispatchEvent(e)},t.prototype.onSecondShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.secondShortcutButton.score,this.dispatchEvent(e)},t.prototype.onThirdShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.thirdShortcutButton.score,this.dispatchEvent(e)},t.prototype.onFourthShortcutButtonTouch=function(){var e=new RaiseEvent(RaiseEvent.Raise);e.data=this.fourthShortcutButton.score,this.dispatchEvent(e)},t}(eui.Component);__reflect(PlayGameButtonGroup.prototype,"PlayGameButtonGroup");var ShortcutRaiseButton=function(e){function t(){var t=e.call(this)||this;return t.skinName="ShortcutRaiseButtonSkin",t}return __extends(t,e),t}(eui.Button);__reflect(ShortcutRaiseButton.prototype,"ShortcutRaiseButton");var DistanceItemRenderer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.label=new eui.Label,this.label.size=25,this.addChild(this.label)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t="<font color=0xf4fffb>"+this.data.fromUserName+"</font>",n="<font color=0xf4fffb>"+this.data.toUserName+"</font>",i="<font color=0x62ffdd>"+this.data.distance+"</font>",o="<font color=0x9ea0a0>距离</font>",r=t+"  "+o+"  "+n+"  "+i;this.label.textFlow=(new egret.HtmlTextParser).parse(r)},t}(eui.ItemRenderer);__reflect(DistanceItemRenderer.prototype,"DistanceItemRenderer");var PlayerDetailScene=function(e){function t(t,n,i,o,r){void 0===i&&(i=!0);var a=e.call(this)||this;return a.skinName="PlayerDetailSkin",a.player=t,a.players=n,a.roomId=r,a.gameId=o,a.hasProps=i,a.detailModel=new DetailModel,a.chatModel=new ChatModel,a.userModel=new UserModel,a.locationModel=new LocationModel,a.blockModel=new BlockModel,a.group.scaleX=.7,a.group.scaleY=.7,a}return __extends(t,e),t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){if(e.prototype.childrenCreated.call(this),this.initPlayer(this.player),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.player.id===this.userModel.id)this.blockCheckBox.visible=!1,this.reportButton.visible=!1;else{var t=this.blockModel.isBlockedPlayer(this.player.id);this.blockCheckBox.selected=t}this.statisticList.itemRenderer=StatisticItemRenderer,this.statisticList.dataProvider=new eui.ArrayCollection(this.detailModel.listDefaultStatistic()),this.distanceList.itemRenderer=DistanceItemRenderer,this.statisticList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onStatisticItemTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.tabBar.addEventListener(egret.Event.CHANGE,this.onStackChange,this),this.blockCheckBox.addEventListener(egret.Event.CHANGE,this.onBlockCheckBoxTouch,this),this.reportButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showReportView,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.CHECK_LOCATION_PERMISSION,this.onCheckLocationPermission,this),EventCenter.sharedInstance().addEventListener(BlockEvent.BLOCK_STATE_CHANGED,this.onBlockStateChanged,this),this.hasProps?(this.propsList.itemRenderer=PropsItemRenderer,this.propsList.dataProvider=new eui.ArrayCollection(Props),this.propsList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onPropsItemTouch,this)):this.propsList.visible=!1,this.listStatistic(),this.queryCoinBalance()},t.prototype.setNickname=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=this.userModel.getPlayerNickname(e),null!==t?[3,2]:[4,this.userModel.queryProfile(e,this.userModel.accessToken)];case 1:return n=r.sent(),i=new PlayerProfile(n.result),this.userModel.savePlayerNickname(e,i.nickname),this.nicknameLabel.text=i.nickname,[3,3];case 2:this.nicknameLabel.text=t,r.label=3;case 3:return[3,5];case 4:return o=r.sent(),this.setNickname(e),Toast.show(o.message),[3,5];case 5:return[2]}})})},t.prototype.showReportView=function(){this.remove();var e=new ReportView(this.player.id);SceneManager.sharedInstance().pushScene(e)},t.prototype.onBlockCheckBoxTouch=function(e){var t=e.target;t.selected?this.blockModel.blockPlayer(this.player.id):this.blockModel.removeBlockedPlayer(this.player.id);var n=new BlockEvent(BlockEvent.BLOCK_STATE_CHANGED);n.data=t.selected,n.playerId=this.player.id,EventCenter.sharedInstance().dispatchEvent(n)},t.prototype.onStackChange=function(e){var t=e.target;1===t.selectedIndex&&this.queryLocationPermission()},t.prototype.onCheckLocationPermission=function(e){e.data?(this.noLocationLabel.visible=!1,this.queryLocationAddress()):(this.noLocationLabel.visible=!0,this.noLocationLabel.text="您没有开启定位权限")},t.prototype.queryLocationPermission=function(){window.postMessage(JSON.stringify({command:GameCommand.CHECK_LOCATION_PERMISSION}),"*")},t.prototype.queryCoinBalance=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.userModel.queryCurrencyBalance(this.player.id,"coin",this.userModel.accessToken)];case 1:return e=o.sent(),t=new Currency(e.result),n=Number(t.balance),this.coinBalanceLabel.text=""+MoneyFormatter.addChineseUnit(n),[3,3];case 2:return i=o.sent(),Toast.show(i.message),[3,3];case 3:return[2]}})})},t.prototype.listStatistic=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),e=egret.localStorage.getItem("lastGameId"),t=egret.localStorage.getItem("playerData"+this.player.id),n=void 0,e===""+this.gameId&&null!==t?[3,2]:[4,this.detailModel.listStatistic(this.player.id,this.userModel.accessToken)];case 1:return i=a.sent(),egret.localStorage.setItem("playerData"+this.player.id,JSON.stringify(i.result)),n=new Statistic(i.result),[3,3];case 2:n=new Statistic(JSON.parse(t)),a.label=3;case 3:return egret.localStorage.setItem("lastGameId",this.gameId),o=this.detailModel.buildStatisticRecord(n),this.statisticList.dataProvider=new eui.ArrayCollection(o),[3,5];case 4:return r=a.sent(),egret.log(r.message),[3,5];case 5:return[2]}})})},t.prototype.queryLocationAddress=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.locationModel.createOthers(this.player.id,this.players),[4,this.locationModel.queryDistanceFromOthers(this.player.id,e,this.userModel.accessToken)];case 1:return t=r.sent(),n=new LocationDistance(t.result),0===n.partner.length?(this.noLocationLabel.visible=!0,this.noLocationLabel.text="暂无玩家定位信息"):(this.noLocationLabel.visible=!1,i=this.locationModel.createPartners(n,this.players),this.distanceList.dataProvider=new eui.ArrayCollection(i)),[3,3];case 2:return o=r.sent(),Toast.show(o.message),[3,3];case 3:return[2]}})})},t.prototype.setAvatar=function(e){this.blockModel.isBlockedPlayer(e.id)?this.avatarImage.source=ImageUtil.BLOCKED_AVATAR_SOURCE:ImageUtil.loadUrlSource(this.avatarImage,e.avatarUrl)},t.prototype.initPlayer=function(e){this.setNickname(e.id),this.setAvatar(this.player)},t.prototype.onStatisticItemTouch=function(e){e.item.description&&Toast.show(e.item.description,1e3)},t.prototype.onPropsItemTouch=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:this.remove(),o.label=1;case 1:return o.trys.push([1,3,,4]),t=e.item.name,n=e.item.price,[4,this.chatModel.sendProps(this.roomId,this.player.id,t,n,"coin",this.userModel.accessToken)];case 2:return o.sent(),[3,4];case 3:return i=o.sent(),Toast.show(i.message),[3,4];case 4:return[2]}})})},t.prototype.onBlockStateChanged=function(e){e.playerId===this.player.id&&(e.data?(this.nicknameLabel.text="****",this.avatarImage.source=ImageUtil.BLOCKED_AVATAR_SOURCE):(this.setNickname(this.player.id),ImageUtil.loadUrlSource(this.avatarImage,this.player.avatarUrl)))},t.prototype.onRemoved=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.CHECK_LOCATION_PERMISSION,this.onCheckLocationPermission,this),EventCenter.sharedInstance().removeEventListener(BlockEvent.BLOCK_STATE_CHANGED,this.onBlockStateChanged,this)},t}(eui.Component);__reflect(PlayerDetailScene.prototype,"PlayerDetailScene");var PropsItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="PropsItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.props.source="icon_props_price_"+this.data.name+"_png",this.priceLabel.text=""+this.data.price},t}(eui.ItemRenderer);__reflect(PropsItemRenderer.prototype,"PropsItemRenderer");var StatisticItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="StatisticItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data.subtitle?"<font color=0x3bffde>("+this.data.subtitle+")</font>":" ",t=""+this.data.title+e;this.titleLabel.textFlow=(new egret.HtmlTextParser).parser(t);var n=this.data.data||"-";this.dataLabel.text=n},t}(eui.ItemRenderer);__reflect(StatisticItemRenderer.prototype,"StatisticItemRenderer");var CoinPotItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="CoinPotItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.amountLabel.text=""+MoneyFormatter.addChineseUnit(this.data.amount)},t}(eui.ItemRenderer);__reflect(CoinPotItemRenderer.prototype,"CoinPotItemRenderer");var PotItemRenderer=function(e){function t(){var t=e.call(this)||this;return t.skinName="PotItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.amountLabel.text=""+MoneyFormatter.addChineseUnit(this.data.amount)},t}(eui.ItemRenderer);__reflect(PotItemRenderer.prototype,"PotItemRenderer");var ReportView=function(e){function t(t){var n=e.call(this)||this;return n.tags=[],n.skinName="ReportViewSkin",n.reportedUserId=t,n.reportModel=new ReportModel,n.userModel=new UserModel,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.cbx1.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx2.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx3.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx4.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx5.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx0.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx6.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.cbx7.addEventListener(egret.Event.CHANGE,this.onCheckBoxChange,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this)},t.prototype.onCheckBoxChange=function(e){var t=e.target;if(t.selected)this.tags.push(t.label);else{var n=this.tags.findIndex(function(e){return e===t.label});n>=0&&this.tags.splice(n,1)}},t.prototype.onConfirmButtonTouch=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:if(this.tags.length<1)return Toast.show("请选择举报类型"),[2];e=this.contentInput.text,this.remove(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.reportModel.report(this.userModel.id,this.reportedUserId,this.tags,e,this.userModel.accessToken)];case 2:return n.sent(),Toast.show("您的举报我们会尽快处理!"),[3,4];case 3:return t=n.sent(),Toast.show(t.message),[3,4];case 4:return[2]}})})},t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(ReportView.prototype,"ReportView");var Reviewboard=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSkin",t.reviewboardModel=new ReviewboardModel,t.userModel=new UserModel,t}return __extends(t,e),t.prototype.fetchGameHistoryRecordsByRoomId=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.reviewboardModel.fetchGameHistoryRecordByRoomId(e,this.userModel.accessToken)];case 1:return n.sent(),this.updateGameHistoryAndSettlementHistory(),[3,3];case 2:return t=n.sent(),console.log("Reviewboard fetchGameHistoryRecordsByRoomId failed "),console.log(t),console.log("-----------------------\n"),[3,3];case 3:return[2]}})})},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.contentTabbar.itemRenderer=ReviewboardTabbarItem,this.contentTabbar.dataProvider=this.contentViewStack,this.contentTabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onContentTabbarTap,this),this.contentTabbar.selectedIndex=1,this.updateGameHistoryAndSettlementHistory(),this.footer.pagePicker=this.gameHistoryView,Device.sharedInstance().isIphoneX()&&(this.header.height+=Constants.iPhoneX_TOP_MARGIN,this.footer.height+=Constants.iPhoneX_BOTTOM_MARGIN),this.contentGroup.height=this.calculateContentGroupHeight(),this.tabbarGroup.y=this.contentGroup.height},t.prototype.calculateContentGroupHeight=function(){return SceneManager.sharedInstance().stageSize.height-this.footer.height-this.tabbarGroup.height},t.prototype.updateGameHistoryAndSettlementHistory=function(){this.gameHistoryView.setup(this.reviewboardModel),this.settlementHistoryView.setup(this.reviewboardModel),this.footer.setPageCounter(this.reviewboardModel),this.reviewboardModel.isFetching&&this.reviewboardModel.isEmpty?(this.loadingLabel.text="数据加载中...",this.loadingLabel.visible=!0):this.reviewboardModel.isEmpty?(this.loadingLabel.text="房间还未有过牌局",this.loadingLabel.visible=!0):this.loadingLabel.visible=!1},t.prototype.onContentTabbarTap=function(e){this.footer.setPageCounter(this.reviewboardModel),0===e.itemIndex?this.footer.pagePicker=this.settlementHistoryView:this.footer.pagePicker=this.gameHistoryView,this.updateGameHistoryAndSettlementHistory()},t}(eui.Component);__reflect(Reviewboard.prototype,"Reviewboard");var ReviewboardFooter=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardFooterSkin",t.pageSlider.minimum=1,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.pageSlider.addEventListener(eui.UIEvent.CHANGE,this.onPageSliderChanged,this),this.previousButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressPreviousButton,this),this.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPressNextButton,this)},Object.defineProperty(t.prototype,"pagePicker",{set:function(e){this._pagePicker=e},enumerable:!0,configurable:!0}),t.prototype.setPageCounter=function(e){this._pageCounter=e,this.pageSlider.maximum=this._pageCounter.pageAmount,this.setPageSliderValue(this._pageCounter.currentPageIndex)},t.prototype.onPageSliderChanged=function(e){this.setPageSliderValue(this.pageSlider.value),this.pickPage(this.pageSlider.value)},t.prototype.onPressPreviousButton=function(){this.addPageValue(-1)},t.prototype.onPressNextButton=function(){this.addPageValue(1)},t.prototype.addPageValue=function(e){var t=this.pageSlider.value;t+=e,1>t||t>this.pageSlider.maximum||(this.setPageSliderValue(t),this.pickPage(t))},t.prototype.setPageSliderValue=function(e){this.pageSlider.value=e,this.pageLabel.text=this.pageSlider.value+"/"+this.pageSlider.maximum},t.prototype.pickPage=function(e){this._pagePicker.pickPageAtIndex(e),this._pageCounter.currentPageIndex=e},t}(eui.Component);__reflect(ReviewboardFooter.prototype,"ReviewboardFooter");var ReviewboardHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardHeaderSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),EventCenter.sharedInstance().addEventListener(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE,this.updateContent,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeAllListeners,this)},t.prototype.setPotLabelText=function(e){this.potLabel.text=e},t.prototype.updateContent=function(e){this.potLabel.text=e.potValue.toString(),this.dateLabel.text=e.dateString},t.prototype.removeAllListeners=function(){EventCenter.sharedInstance().removeEventListener(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE,this.updateContent,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeAllListeners,this)},t}(eui.Component);__reflect(ReviewboardHeader.prototype,"ReviewboardHeader");var ReviewboardPokerView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPokerSkin",t.pokerTypeModel=new PokerTypeModel,t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.pokerTypeModel.getType();this.image.source="poker_"+this.data+"_"+e+"_png"},t}(eui.ItemRenderer);__reflect(ReviewboardPokerView.prototype,"ReviewboardPokerView");var ReviewboardTabbarItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTabbarItemSkin",t}return __extends(t,e),t}(eui.ItemRenderer);__reflect(ReviewboardTabbarItem.prototype,"ReviewboardTabbarItem");var ReviewboardBlindingBetHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardBlindingBetHeaderSkin",t}return __extends(t,e),t}(eui.Component);__reflect(ReviewboardBlindingBetHeader.prototype,"ReviewboardBlindingBetHeader");var ReviewboardGameHistorySettlementItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardGameHistorySettlementItemSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.handPokersList.itemRenderer=ReviewboardPokerView,this.boardPokersList.itemRenderer=ReviewboardPokerView},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.playerPositionIcon.positionName=this.data.playerPosition,this.playerNameLabel.text=this.data.playerName,this.playerStateLabel.text=this.data.foldInfoText,this.showdownStrengthLabel.text=PokerAnalyzer.getCardTypeByResult(this.data.showdownStrength),this.playerSettlementLabel.text=this.data.playerSettlementString,this.playerSettlementLabel.textColor=this.data.playerSettlementTextColor,this.handPokersList.dataProvider=new eui.ArrayCollection(this.data.holePokers),this.boardPokersList.dataProvider=new eui.ArrayCollection(this.data.communityPokers)},t.HEIGHT=145,t}(eui.ItemRenderer);__reflect(ReviewboardGameHistorySettlementItem.prototype,"ReviewboardGameHistorySettlementItem");var ReviewboardGameHistoryView=function(e){function t(){var t=e.call(this)||this;return t.top=t.bottom=t.right=t.left=0,t.skinName="ReviewboardGameHistorySkin",t}return __extends(t,e),t.prototype.setup=function(e){this.reviewboardModel=e,this.showingPage=e.currentPage,this.updateContent()},t.prototype.pickPageAtIndex=function(e){this.reviewboardModel.currentPageIndex=e,this.showingPage=this.reviewboardModel.currentPage,this.updateContent()},t.prototype.updateContent=function(){if(this.showingPage){this.scrollerGroup.removeChildren(),this.createGameRounds(),this.createSettlementContent(),this.createTerminologySpecificContent(),this.contentScroller.viewport.scrollV=0;var e=new ReviewboardEvent(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE);e.potValue=this.showingPage.pot,e.dateString=this.showingPage.startAtString,EventCenter.sharedInstance().dispatchEvent(e)}},t.prototype.createGameRounds=function(){for(var e=0;e<this.showingPage.gameRounds.length;e+=1){var t=this.showingPage.gameRounds[e];if(e>0){var n=new ReviewboardGameSectionHeader;n.chineseName=t.chineseName,n.englishName=t.englishName,n.pot=t.pot,n.communityPokers=t.communityPokers,this.scrollerGroup.addChild(n)}var i=new eui.List;i.width=this.width,i.height=100,i.itemRenderer=ReviewboardPlayerActionView,i.updateRenderer=this.updatePlayerListCell.bind(this),i.useVirtualLayout=!0,i.dataProvider=new eui.ArrayCollection(t.actions);var o=new eui.Scroller;o.width=this.width,o.height=t.actions.length*ReviewboardPlayerActionView.HEIGHT,o.viewport=i,this.scrollerGroup.addChild(o)}},t.prototype.updatePlayerListCell=function(e,t,n){return e.data=n,e.itemIndex=t,e},t.prototype.createSettlementContent=function(){var e=new ReviewboardGameSectionHeader;e.chineseName="结算",e.englishName="Settlement",e.communityPokers=this.showingPage.communityPokers,e.pot=0,this.scrollerGroup.addChild(e);var t=new eui.List;t.width=this.width,t.height=200,t.itemRenderer=ReviewboardGameHistorySettlementItem,t.useVirtualLayout=!0,t.updateRenderer=this.updateSettlementListCell.bind(this),t.dataProvider=new eui.ArrayCollection(this.showingPage.settlements);var n=new eui.Scroller;n.width=this.width,n.height=this.showingPage.settlements.length*ReviewboardGameHistorySettlementItem.HEIGHT,n.viewport=t,this.scrollerGroup.addChild(n)},t.prototype.updateSettlementListCell=function(e,t,n){return e.data=n,e.itemIndex=t,e},t.prototype.createTerminologySpecificContent=function(){var e=new ReviewboardGameSectionHeader;e.chineseName="符号备注",e.englishName="Symbol Memo",e.pot=0,this.scrollerGroup.addChild(e);var t=new ReviewboardTerminologySpecificView;t.setTerminologySpecifics(TerminologySpecificModel.listTerminologySpecifics()),this.scrollerGroup.addChild(t)
},t}(eui.Component);__reflect(ReviewboardGameHistoryView.prototype,"ReviewboardGameHistoryView",["IPagePicker"]);var ReviewboardGameSectionHeader=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardGameSectionHeaderSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"chineseName",{set:function(e){this.chineseNameLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"englishName",{set:function(e){this.englishNameLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pot",{set:function(e){return 0===e?void(this.potStackLabel.visible=!1):void(this.potStackLabel.text=String(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"communityPokers",{set:function(e){this.boardPokerList.dataProvider=new eui.ArrayCollection(e)},enumerable:!0,configurable:!0}),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.boardPokerList.itemRenderer=ReviewboardPokerView},t}(eui.Component);__reflect(ReviewboardGameSectionHeader.prototype,"ReviewboardGameSectionHeader");var ReviewboardPlayerActionIcon=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerActionIconSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"backgroundColor",{set:function(e){this.background.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionAbbrSymbol",{set:function(e){this.actionAbbrSymbolLabel.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionValue",{set:function(e){return 0===e?void(this.actionValueLabel.visible=!1):void(this.actionValueLabel.text=String(e))},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ReviewboardPlayerActionIcon.prototype,"ReviewboardPlayerActionIcon");var ReviewboardPlayerActionView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerActionViewSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.setup(this.data)},t.prototype.setup=function(e){this.positionIcon.positionName=e.playerPosition,this.nameLabel.text=e.playerNickname,this.actionIcon.backgroundColor=e.playerAction.backgroundColor,this.actionIcon.actionAbbrSymbol=e.playerAction.abbreviationSymbol,this.actionIcon.actionValue=e.playerActionValue,this.stackLabel.text=String(e.playerStack)},t.HEIGHT=66,t}(eui.ItemRenderer);__reflect(ReviewboardPlayerActionView.prototype,"ReviewboardPlayerActionView");var ReviewboardPlayerPositionIcon=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardPlayerPositionIconSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"positionName",{set:function(e){this.positionLabel.text=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(ReviewboardPlayerPositionIcon.prototype,"ReviewboardPlayerPositionIcon");var ReviewboardTerminologySpecificItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTerminologySpecificItemSkin",t}return __extends(t,e),t.prototype.dataChanged=function(){this.actionIcon.backgroundColor=this.data.action.backgroundColor,this.actionIcon.actionAbbrSymbol=this.data.action.abbreviationSymbol,this.actionIcon.actionValue=0,this.descriptionLabel.text=this.data.description},t}(eui.ItemRenderer);__reflect(ReviewboardTerminologySpecificItem.prototype,"ReviewboardTerminologySpecificItem");var ReviewboardTerminologySpecificView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardTerminologySpecificSkin",t}return __extends(t,e),t.prototype.setTerminologySpecifics=function(e){this.terminologySpecificList.itemRenderer=ReviewboardTerminologySpecificItem,this.terminologySpecificList.height=60,this.terminologySpecificList.useVirtualLayout=!0,this.terminologySpecificList.dataProvider=new eui.ArrayCollection(e)},t}(eui.Component);__reflect(ReviewboardTerminologySpecificView.prototype,"ReviewboardTerminologySpecificView");var ReviewboardSettlementHistoryView=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSettlementHistorySkin",t}return __extends(t,e),t.prototype.setup=function(e){this.reviewboardModel=e,this.showingPage=e.currentPage,this.updateContent()},t.prototype.pickPageAtIndex=function(e){this.reviewboardModel.currentPageIndex=e,this.showingPage=this.reviewboardModel.currentPage,this.updateContent()},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.settlementList.itemRenderer=ReviewboardSettlementItem,this.settlementList.useVirtualLayout=!0},t.prototype.updateContent=function(){if(this.showingPage){this.settlementList.dataProvider=new eui.ArrayCollection(this.showingPage.settlements);var e=new ReviewboardEvent(ReviewboardEvent.UPDATE_REVIEWBOARD_HEADER_VALUE);e.potValue=this.showingPage.pot,e.dateString=this.showingPage.startAtString,EventCenter.sharedInstance().dispatchEvent(e)}},t}(eui.Component);__reflect(ReviewboardSettlementHistoryView.prototype,"ReviewboardSettlementHistoryView",["IPagePicker"]);var ReviewboardSettlementItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="ReviewboardSettlementItemSkin",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.holePokerList.itemRenderer=ReviewboardPokerView,this.communityPokerList.itemRenderer=ReviewboardPokerView,this.communityPokerList.useVirtualLayout=!0},t.prototype.dataChanged=function(){this.playerNameLabel.text=this.data.playerName,this.playerFoldLabel.text=this.data.foldInfoText,this.holePokerList.dataProvider=new eui.ArrayCollection(this.data.holePokers),this.communityPokerList.dataProvider=new eui.ArrayCollection(this.data.communityPokers),ImageUtil.loadUrlSource(this.playerAvatarImage,AvatarURLFactory.makeById(this.data.playerId)),this.pokerTypeLabel.text=PokerAnalyzer.getCardTypeByResult(this.data.showdownStrength),this.playerSettlementLabel.text=this.data.playerSettlementString,this.playerSettlementLabel.textColor=this.data.playerSettlementTextColor},t}(eui.ItemRenderer);__reflect(ReviewboardSettlementItem.prototype,"ReviewboardSettlementItem");var SettingsView=function(e){function t(){var t=e.call(this)||this;return t.skinName="SettingsSkin",t.pokerTypeModel=new PokerTypeModel,t.group.scaleX=t.group.scaleY=0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.pokerType=this.pokerTypeModel.getType(),this.pokerType?(this.simpleRadioButton.selected=this.simpleRadioButton.value===this.pokerType,this.classicRadioButton.selected=this.classicRadioButton.value===this.pokerType,this.fourColorRadioButton.selected=this.fourColorRadioButton.value===this.pokerType,this.fourColor2RadioButton.selected=this.fourColor2RadioButton.value===this.pokerType):this.pokerType=PokerTypeModel.SIMPLE,this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.simpleRadioButton.addEventListener(egret.Event.CHANGE,this.onSelectedChange,this),this.classicRadioButton.addEventListener(egret.Event.CHANGE,this.onSelectedChange,this),this.fourColorRadioButton.addEventListener(egret.Event.CHANGE,this.onSelectedChange,this),this.fourColor2RadioButton.addEventListener(egret.Event.CHANGE,this.onSelectedChange,this),this.saveButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.save,this)},t.prototype.onSelectedChange=function(e){var t=e.target;this.selectedValue=t.value},t.prototype.save=function(){if(this.selectedValue&&this.selectedValue!==this.pokerType){this.pokerTypeModel.setType(this.selectedValue);var e=new egret.Event(egret.Event.CHANGE);e.data=this.selectedValue,this.dispatchEvent(e);var t=new SettingEvent(SettingEvent.CHANGE_POKER_TYPE);t.data=this.selectedValue,EventCenter.sharedInstance().dispatchEvent(t)}this.remove()},t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(SettingsView.prototype,"SettingsView");var SoundSettingView=function(e){function t(){var t=e.call(this)||this;return t.skinName="SoundSettingSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=this.bottom=this.left=this.right=0,egret.Tween.get(this.group).to({scaleX:1,scaleY:1},300,egret.Ease.bounceOut),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.remove,this),this.saveButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSave,this),this.effectSwitch.selected="true"===SoundManager.sharedInstance().getIsPlayEffect(),this.vibrateSwitch.selected="true"===SoundManager.sharedInstance().getIsVibrate(),this.audioSwitch.selected="true"===SoundManager.sharedInstance().getIsPlayAudio()},t.prototype.onSave=function(){SoundManager.sharedInstance().setIsPlayEffect(this.effectSwitch.selected),SoundManager.sharedInstance().setIsVibrate(this.vibrateSwitch.selected),SoundManager.sharedInstance().setIsPlayAudio(this.audioSwitch.selected),this.remove()},t.prototype.remove=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(SoundSettingView.prototype,"SoundSettingView");var TreasureChestView=function(e){function t(t){var n=e.call(this)||this;return n.skinName="TreasureChestSkin",n.minBuyIn=t,n.treasureChestModel=new TreasureChestModel,n.userModel=new UserModel,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this),this.treasureButton.enabled=!1,this.enabled=!1,this.applyForTreasureChest()},t.prototype.applyForTreasureChest=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.treasureChestModel.resetTreasureChest("hall_"+this.minBuyIn+"_3m_6m_9m",this.userModel.accessToken)];case 1:return t.sent(),[4,this.treasureChestModel.applyForTreasureChest("hall_"+this.minBuyIn+"_3m_6m_9m",this.userModel.accessToken)];case 2:return t.sent(),this.startTimer(180),[3,4];case 3:return e=t.sent(),Toast.show(e.message),[3,4];case 4:return[2]}})})},t.prototype.openTreasurChest=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.treasureButton.enabled=!1,this.enabled=!1,[4,this.treasureChestModel.openTreasureChest("hall_"+this.minBuyIn+"_3m_6m_9m",this.userModel.accessToken)];case 1:return e=n.sent(),this.showCoin(e.result.reward.coin),this.startTimer(e.result.timer.seconds),[3,3];case 2:return t=n.sent(),this.treasureButton.enabled=!0,this.enabled=!0,Toast.show(t.message),[3,3];case 3:return[2]}})})},t.prototype.showCoin=function(e){var t=this,n=new eui.Group;n.horizontalCenter=0,n.height=20,n.y=0;var i=new eui.HorizontalLayout;i.gap=2,n.layout=i;var o=new eui.Image;o.height=o.width=20,o.source="icon_player_coin_png";var r=new eui.Label;r.size=20,r.bold=!0,r.textColor=15915527,r.textAlign="center",r.text="+"+e,n.addChild(o),n.addChild(r),this.addChild(n);var a=-30;egret.Tween.get(n).to({y:a},500).wait(1500).call(function(){t.removeChild(n),n=void 0})},t.prototype.startTimer=function(e){var t=this;this.countdownTimer&&clearInterval(this.countdownTimer);var n=e;this.countdownTimer=setInterval(function(){if(n-=1,0===n)t.treasureButton.enabled=!0,t.enabled=!0,AnimationUtil.loopPlay(t.shakeAnimation),t.timerLabel.text="点击领取",clearInterval(t.countdownTimer);else{var e=n%60,i=parseInt(String(n/60)),o=e>9?e:"0"+e,r=i>9?i:"0"+i;t.timerLabel.text=r+" : "+o}},1e3)},t.prototype.onTouch=function(){this.shakeAnimation.stop(),this.treasureButton.rotation=0,this.openTreasurChest()},t.prototype.onRemoved=function(){clearInterval(this.countdownTimer)},t}(eui.Component);__reflect(TreasureChestView.prototype,"TreasureChestView");var LaunchScene=function(e){function t(){var t=e.call(this)||this;return t.lastTime=0,t.skinName="LaunchSkin",t.top=t.bottom=t.left=t.right=0,t.userModel=new UserModel,t.houseModel=new HouseModel,t.roomModel=new RoomModel,t.pokerTypeModel=new PokerTypeModel,t.proxyModel=new ProxyModel,t}return __extends(t,e),t.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return e.prototype.childrenCreated.call(this),this.initDevice(),this.initAnimation(),this.loginButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLoginButtonTouch,this),this.visitorButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onVisitorButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_ACCOUNT_INFO,this.setAccountInfo,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_SCREEN_SIZE,this.setScreenSize,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_PLATFORM_NAME,this.setPlatform,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_USER_DATA,this.setUserInfo,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_POKER_TYPE,this.setPokerType,this),WebViewCenter.sharedInstance().addEventListener(WebViewEvent.QUERY_ROOM_ID,this.setRoomId,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().addEventListener(WebSocketEvent.ERROR,this.onError,this),this.proxyModel.setMediaDomain(),this.buttonGroup.visible?this.chooseProxy():setTimeout(function(){t.queryAccountInfo()},500),[2]})})},t.prototype.chooseProxy=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.proxyModel.getFastestProxy(ApiProxies)];case 1:return e=o.sent(),this.proxyModel.setApiDomain(e.proxy),setTimeout(function(){i.queryPokerType()},500),[3,3];case 2:return t=o.sent(),n=[{name:"离开",action:function(){i.leaveRoom()}},{name:"重试",action:function(){i.chooseProxy()}}],MessageAlert.show(t.message,"",n),[3,3];case 3:return[2]}})})},t.prototype.initAnimation=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,RES.getRes("enter_room_json")];case 1:return e=r.sent(),[4,RES.getRes("enter_room_png")];case 2:return t=r.sent(),n=new egret.MovieClipDataFactory(e,t),i=new egret.MovieClip(n.generateMovieClipData("enter_room")),this.loadingGroup.addChild(i),i.gotoAndPlay("jump",-1),[3,4];case 3:return o=r.sent(),egret.log(o),[3,4];case 4:return[2]}})})},t.prototype.connectWebSocket=function(){var e="Authorization="+this.userModel.loginInfo.apiToken.tokenType+" "+this.userModel.accessToken,t={url:""+this.proxyModel.getApiDomain(),version:""+this.proxyModel.getVersion1(),auth:""+e};WebSocketRequest.sharedInstance().connect(t)},t.prototype.queryAccountInfo=function(){window.postMessage(JSON.stringify({command:GameCommand.QUERY_ACCOUNT_INFO}),"*")},t.prototype.setFastestProxyFromServer=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.proxyModel.getFastestProxyFromServer(ApiProxies,this.userModel.countryCode,this.userModel.carrier)];case 1:return e=o.sent(),this.proxyModel.setApiDomain(e.proxy),setTimeout(function(){i.queryPokerType()},500),[3,3];case 2:return t=o.sent(),n=[{name:"离开",action:function(){i.leaveRoom()}},{name:"重试",action:function(){i.setFastestProxyFromServer()}}],MessageAlert.show(t.message,"",n),[3,3];case 3:return[2]}})})},t.prototype.setAccountInfo=function(e){this.userModel.countryCode=""+e.data.country_code,this.userModel.carrier=e.data.carrier,this.setFastestProxyFromServer()},t.prototype.setScreenSize=function(e){Device.sharedInstance().setScreenSize(e.data),window.postMessage(JSON.stringify({command:GameCommand.QUERY_PLATFORM_NAME}),"*")},t.prototype.setPlatform=function(e){Device.sharedInstance().setPlatform(e.data),this.buttonGroup.visible=!1,this.loadingGroup.y=1e3},t.prototype.setUserInfo=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:return t=JSON.parse(e.data),n=new LoginInfo(t),this.userModel.loginInfo=n,[4,this.setNickname()];case 1:return i.sent(),window.postMessage(JSON.stringify({command:GameCommand.QUERY_ROOM_ID}),"*"),[2]}})})},t.prototype.setRoomId=function(e){this.joinRoomById(e.data.room_id)},t.prototype.setPokerType=function(e){window.postMessage(JSON.stringify({command:GameCommand.QUERY_USER_DATA}),"*"),e.data&&this.pokerTypeModel.setType(e.data)},t.prototype.initDevice=function(){window.postMessage(JSON.stringify({command:GameCommand.QUERY_SCREEN_SIZE}),"*")},t.prototype.queryPokerType=function(){window.postMessage(JSON.stringify({command:GameCommand.QUERY_POKER_TYPE}),"*")},t.prototype.onLoginButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e=new InputPhoneNumberView;SceneManager.sharedInstance().pushScene(e),e.once(InputViewEvent.InputComplete,this.onPhoneNumberInputComplete,this)},t.prototype.onVisitorButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.loginByVisitor()},t.prototype.setNickname=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.userModel.queryProfile(this.userModel.id,this.userModel.accessToken)];case 1:return e=i.sent(),t=new PlayerProfile(e.result),this.userModel.nickname=t.nickname,[3,3];case 2:return n=i.sent(),Toast.show(n.message),[3,3];case 3:return[2]}})})},t.prototype.loginByVisitor=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,o,r,a;return __generator(this,function(s){switch(s.label){case 0:LoadingComponent.sharedInstance().show(this,"游客登录中..."),s.label=1;case 1:return s.trys.push([1,7,8,9]),e="65535"+Math.floor(89999*Math.random()+9999),[4,this.userModel.requestVerificationCode(e)];case 2:return t=s.sent(),n=new VerificationCodeInfo(t.result),i={phoneNumber:e,verificationCode:"0123",hashDigest:n.hashDigest,expireISOTime:n.expireISOTime},[4,this.userModel.signUp(i)];case 3:return s.sent(),[4,this.userModel.signIn(i)];case 4:return o=s.sent(),r=new LoginInfo(o.result),this.userModel.loginInfo=r,[4,this.setNickname()];case 5:return s.sent(),[4,this.userModel.buyDiamond(r.userId)];case 6:return s.sent(),this.showInputPinView(),[3,9];case 7:return a=s.sent(),MessageAlert.show(a.message,a.status),[3,9];case 8:return LoadingComponent.sharedInstance().hide(),[7];case 9:return[2]}})})},t.prototype.onPhoneNumberInputComplete=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:this.userModel.phoneNumber=e.data,LoadingComponent.sharedInstance().show(this,"请稍后, 正在发送验证码..."),r.label=1;case 1:return r.trys.push([1,4,5,6]),[4,this.userModel.getUTCFromServer()];case 2:return t=r.sent(),n=new Date(t.result.now).valueOf(),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber,n)];case 3:return i=r.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(i.result),this.showInputVerificationcodeView(e.data),[3,6];case 4:return o=r.sent(),MessageAlert.show(o.message,o.status),[3,6];case 5:return LoadingComponent.sharedInstance().hide(),[7];case 6:return[2]}})})},t.prototype.showInputVerificationcodeView=function(e){var t=new InputVerificationCodeView;t.setPhoneNumber(e),t.once(InputViewEvent.InputComplete,this.onVerficationCodeInputComplete,this),t.once(InputViewEvent.Regain,this.requestVerificationCode,this),SceneManager.sharedInstance().pushScene(t)},t.prototype.onVerficationCodeInputComplete=function(e){var t=e.data;this.login(t)},t.prototype.login=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:LoadingComponent.sharedInstance().show(this,"正在登录中..."),t={phoneNumber:this.userModel.phoneNumber,verificationCode:e,hashDigest:this.userModel.verificationInfo.hashDigest,expireISOTime:this.userModel.verificationInfo.expireISOTime},r.label=1;case 1:return r.trys.push([1,4,5,6]),[4,this.userModel.signIn(t)];case 2:return n=r.sent(),i=new LoginInfo(n.result),this.userModel.loginInfo=i,[4,this.setNickname()];case 3:return r.sent(),this.showInputPinView(),[3,6];case 4:return o=r.sent(),MessageAlert.show(o.message,o.status),[3,6];case 5:return LoadingComponent.sharedInstance().hide(),[7];case 6:return[2]}})})},t.prototype.requestVerificationCode=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.userModel.requestVerificationCode(this.userModel.phoneNumber)];case 1:return e=n.sent(),this.userModel.verificationInfo=new VerificationCodeInfo(e.result),[3,3];case 2:return t=n.sent(),MessageAlert.show(t.message,t.status),[3,3];case 3:return[2]}})})},t.prototype.showInputPinView=function(){var e=new InputPinView;SceneManager.sharedInstance().pushScene(e),e.once(JoinGameEvent.JoinRoom,this.onTouchJoinButton,this),e.once(JoinGameEvent.JoinMyRoom,this.onTouchMine,this)},t.prototype.connectCentrifuge=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this);var e={url:""+this.proxyModel.getApiDomain(),info:this.userModel.loginInfo.websocketToken.info,timestamp:this.userModel.loginInfo.websocketToken.timestamp,token:this.userModel.loginInfo.websocketToken.token,user:this.userModel.loginInfo.websocketToken.user,accessToken:this.userModel.accessToken,version:this.proxyModel.getVersion1()};CentrifugeServer.sharedInstance().connect(e)},t.prototype.onCentrifugeConnected=function(){egret.log("连接centrifuge成功")},t.prototype.onCentrifugeConnectionFailed=function(){MessageAlert.show("与服务器的连接失败")},t.prototype.joinRoomById=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o=this;return __generator(this,function(r){switch(r.label){case 0:this.loadingGroup.visible=!0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.roomModel.joioRoomById(e,this.userModel.accessToken)];case 2:return t=r.sent(),this.connectWebSocket(),this.connectCentrifuge(),this.roomId=e,[3,4];case 3:return n=r.sent(),i=[{name:"确定",action:function(){o.leaveRoom()}}],MessageAlert.show(n.message,n.status,i),[3,4];case 4:return[2]}})})},t.prototype.joinMyRoom=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e="my room",[4,this.houseModel.createHouse(this.userModel.id,"texas_holdem",e,this.userModel.accessToken)];case 1:return o.sent(),t={options:{permit_buy_in:!1,minimum_buy_in:200,maximum_buy_in:2e3,small_blind:1,operation_duration:300,auto_start_player_amount:2,maximum_player_amount:9,property_name:"chip"},booking_seconds:1800,price_currency:"diamond",price_amount:"0"},[4,this.houseModel.createRoom(this.userModel.id,"texas_holdem",t,this.userModel.accessToken)];case 2:return n=o.sent(),this.joinRoomById(n.result.room_id),[3,4];case 3:return i=o.sent(),MessageAlert.show(i.message,i.status),[3,4];case 4:return[2]}})})},t.prototype.joinOtherRoom=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,o;return __generator(this,function(r){switch(r.label){case 0:if(!e)return[2];r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this.houseModel.queryHosuseNumber(e,this.userModel.accessToken)];case 2:return t=r.sent(),n=t.result,[4,this.houseModel.queryHouseInfo(n.owner_id,n.game_type,this.userModel.accessToken)];case 3:return i=r.sent(),this.joinRoomById(i.result.room_id),[3,5];case 4:return o=r.sent(),MessageAlert.show(o.message,o.status),[3,5];case 5:return[2]}})})},t.prototype.onTouchMine=function(){this.joinMyRoom()},t.prototype.onTouchJoinButton=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.joinOtherRoom(e.number),[2]})})},t.prototype.toGameScene=function(e){LoadingComponent.sharedInstance().hide(),window.postMessage(JSON.stringify({command:GameCommand.STOP_ANIMATION}),"*");var t=new GameScene(e);SceneManager.sharedInstance().replaceScene(t)},t.prototype.onConnected=function(){egret.log("websocket连接成功"),this.toGameScene(this.roomId)},t.prototype.onClose=function(){egret.log("连接已关闭")},t.prototype.onError=function(){var e=this,t=(new Date).valueOf();if(t-this.lastTime>1e4){var n=[{name:"确定",action:function(){e.leaveRoom()}}];MessageAlert.show("连接服务器失败, 请稍后重试","",n)}},t.prototype.leaveRoom=function(){Device.sharedInstance().isInReactNative()&&window.postMessage(JSON.stringify({command:GameCommand.LEAVE_ROOM,payload:this.roomId}),"*")},t.prototype.onRemovedFromStage=function(){WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_SCREEN_SIZE,this.setScreenSize,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_PLATFORM_NAME,this.setPlatform,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_USER_DATA,this.setUserInfo,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_POKER_TYPE,this.setPokerType,this),WebViewCenter.sharedInstance().removeEventListener(WebViewEvent.QUERY_ROOM_ID,this.setRoomId,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CONNECTED,this.onConnected,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.CLOSE,this.onClose,this),EventCenter.sharedInstance().removeEventListener(WebSocketEvent.ERROR,this.onError,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.Connected,this.onCentrifugeConnected,this),EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ConnectionError,this.onCentrifugeConnectionFailed,this)},t}(eui.Component);__reflect(LaunchScene.prototype,"LaunchScene");var JoinGameEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.JoinMyRoom="join_my_room",t.JoinRoom="join_room",t}(egret.Event);__reflect(JoinGameEvent.prototype,"JoinGameEvent");var InputPinView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPinSkin",t}return __extends(t,e),t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackgroundTouch,this),this.createButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateButtonTouch,this),this.joinButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJoinButtonTouch,this)},t.prototype.onCreateButtonTouch=function(){var e=new JoinGameEvent(JoinGameEvent.JoinMyRoom);this.dispatchEvent(e),this.close()},t.prototype.onJoinButtonTouch=function(){var e=this.pinInput.text;if(e&&9===e.length){var t=new JoinGameEvent(JoinGameEvent.JoinRoom);t.number=Number(e),this.dispatchEvent(t),this.close()}},t.prototype.onBackgroundTouch=function(){this.close()},t}(eui.Component);__reflect(InputPinView.prototype,"InputPinView");var InputPhoneNumberView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputPhoneNumberSkin",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.nextButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNextButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},t.prototype.onNextButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.phoneNumberInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.phoneNumberInput.text,this.dispatchEvent(e),this.close()}},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t}(eui.Component);__reflect(InputPhoneNumberView.prototype,"InputPhoneNumberView");var InputVerificationCodeView=function(e){function t(){var t=e.call(this)||this;return t.skinName="InputVerificationCodeSkin",t}return __extends(t,e),t.prototype.setPhoneNumber=function(e){this.phoneNumberLabel.text=e},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.times=60,this.timer=new egret.Timer(1e3,60),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.start(),this.regainButton.label="60s",this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirmButtonTouch,this),this.background.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this),this.regainButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegainButtonTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this)},t.prototype.onConfirmButtonTouch=function(){if(SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK),this.codeInput.text){var e=new InputViewEvent(InputViewEvent.InputComplete);e.data=this.codeInput.text,this.dispatchEvent(e),this.close()}},t.prototype.onRegainButtonTouch=function(){SoundManager.sharedInstance().playEffectSound(SoundEffectSource.CLICK);var e=new InputViewEvent(InputViewEvent.Regain);this.dispatchEvent(e),this.timer.start(),this.regainButton.label="60s"},t.prototype.onTimer=function(){this.times-=1,this.regainButton.label=this.times+"s",this.regainButton.touchEnabled=!1},t.prototype.onTimerComplete=function(){this.times=60,this.regainButton.touchEnabled=!0,this.regainButton.label="重新获取",this.timer.reset()},t.prototype.close=function(){SceneManager.sharedInstance().popScene()},t.prototype.onRemovedFromStage=function(){this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer=void 0},t}(eui.Component);__reflect(InputVerificationCodeView.prototype,"InputVerificationCodeView");var InputViewEvent=function(e){function t(t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)||this}return __extends(t,e),t.InputComplete="input_complete",t.Regain="regain",t}(egret.Event);__reflect(InputViewEvent.prototype,"InputViewEvent");var WebViewCenter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.sharedInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.addMessageListener=function(){var e=this;window.document.addEventListener("message",function(t){var n=JSON.parse(t.data),i=e.createEvent(n.command);i.data=n.payload,e.dispatchEvent(i)})},t.prototype.createEvent=function(e){return new WebViewEvent(e)},t}(egret.EventDispatcher);__reflect(WebViewCenter.prototype,"WebViewCenter");var WebViewEvent=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.QUERY_ACCOUNT_INFO="query_account_info",t.QUERY_USER_DATA="query_user_data",t.QUERY_ROOM_ID="query_room_id",t.QUERY_SCREEN_SIZE="query_screen_size",t.QUERY_PLATFORM_NAME="query_platform_name",t.QUERY_APP_VERSION="query_app_version",t.STOP_ANIMATION="stop_animation",t.LEAVE_ROOM="leave_room",t.TIMER_WARNING="timer_warning",t.RECORD_AUDIO="record_audio",t.STOP_RECORD_AUDIO="stop_record_audio",t.PLAY_AUDIO="play_audio",t.CHECK_AUDIO_PERMISSION="check_audio_permission",t.SHOW_CHAT_VIEW="show_chat_view",t.LEAVE_FOR_MALL="leave_for_mall",t.QUERY_MATCHED_DATA="query_matched_data",t.RECEIVED_CHAT_MESSAGE="received_chat_message",t.BARRAGE_STATE_CHANGED="barrage_state_changed",t.SAVE_POKER_TYPE="save_poker_type",t.QUERY_POKER_TYPE="query_poker_type",t.APP_STATE_CHANGE="app_state_changed",t.CHECK_LOCATION_PERMISSION="check_location_permission",t.SEND_CHAT_MESSAGE_FAILED="send_chat_message_failed",t
}(egret.Event);__reflect(WebViewEvent.prototype,"WebViewEvent");var HouseModel=function(){function e(){this.request=new HttpRequest}return e.prototype.queryHosuseNumber=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/house/number/"+e,i=this.request.buildHeaderWithToken(t);return this.request.get(n,{},i,RequestName.QueryHouseNumber)},e.prototype.queryHouseInfo=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/house/"+e+"/"+t,o=this.request.buildHeaderWithToken(n);return this.request.get(i,{},o,RequestName.QueryHouse)},e.prototype.createHouse=function(e,t,n,i){var o=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/house/"+e+"/"+t,r={house_name:n},a=this.request.buildHeaderWithToken(i);return this.request.put(o,r,a,RequestName.CreateHouse)},e.prototype.createRoom=function(e,t,n,i){var o=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/house/"+e+"/"+t+"/room",r=n,a=this.request.buildHeaderWithToken(i);return this.request.post(o,r,a,RequestName.CreateRoom)},e}();__reflect(HouseModel.prototype,"HouseModel");var ProxyModel=function(){function e(){this.request=new HttpRequest}return e.prototype.getProxies=function(){return ApiProxies},e.prototype.setMediaDomain=function(e){void 0===e&&(e=AvatarDomain),ApiConfig.MediaDomain=e},e.prototype.setApiDomain=function(e){ApiConfig.ApiDomain=e},e.prototype.getApiDomain=function(){return ApiConfig.ApiDomain},e.prototype.getVersion1=function(){return ApiConfig.Version_1},e.prototype.getVersion2=function(){return ApiConfig.Version_2},e.prototype.getProxyCode=function(){var e=this.getApiDomain().replace("https://",""),t=e.indexOf(".");return e=e.substring(0,t)},e.prototype.getProxiesFromServer=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/metadata/servers",i={country_code:e,carrier:t};return this.request.post(n,i,{},RequestName.QueryAvailableProxy)},e.prototype.getFastestProxy=function(e,t){var n=this,i=[],o=[];return new Promise(function(r,a){for(var s=function(s){var c=(new Date).valueOf();n.requestDomain(s+"/node/v1/status").then(function(e){var n=e.serverLoad;if(s!==t&&"normal"===n){var a=(new Date).valueOf()-c,u={proxy:s,delay:a,serverLoad:n};egret.log(s+"/"+a+"/"+n),i.push(u),1===i.length&&r(u)}else o.push(s)})["catch"](function(t){o.push({proxy:s}),o.length===e.length&&a(new Error("连接超时, 请检查您的网络"))})},c=0,u=e;c<u.length;c++){var h=u[c];s(h)}})},e.prototype.getFastestProxyFromServer=function(e,t,n,i){return __awaiter(this,void 0,void 0,function(){var o,r,a,s,c;return __generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),[4,this.getFastestProxy(e,i)];case 1:return o=u.sent(),this.setApiDomain(o.proxy),[4,this.getProxiesFromServer(t,n)];case 2:return r=u.sent(),a=r.result.servers.map(function(e){return"https://"+e}),[4,this.getFastestProxy(a,i)];case 3:return s=u.sent(),[2,s];case 4:throw c=u.sent();case 5:return[2]}})})},e.prototype.requestDomain=function(e){return this.request.get(e,{},{},RequestName.TestSpeed,3e3)},e}();__reflect(ProxyModel.prototype,"ProxyModel");var RoomModel=function(e){function t(){var t=e.call(this)||this;return t.MINIMUM_PLAYER_AMOUNT=2,t.MAXIMUM_PLAYER_AMOUNT=9,t.request=new HttpRequest,t}return __extends(t,e),Object.defineProperty(t.prototype,"roomInfo",{get:function(){return this._roomInfo},set:function(e){this._roomInfo=e},enumerable:!0,configurable:!0}),t.prototype.getRoomId=function(){return this._roomInfo.roomId},t.prototype.hasTimer=function(){return this._roomInfo.hasTimer},t.prototype.isInPeronalHouse=function(){return!!this._roomInfo.options.house_number},t.prototype.getTimerStatus=function(){return this._roomInfo.timerStatus},t.prototype.getRemainingSeconds=function(){return this._roomInfo.remainingSeconds},t.prototype.getOperationDuration=function(){return this.getOptions().operation_duration||15},t.prototype.getOptions=function(){return this._roomInfo.options},t.prototype.getRoomName=function(){return this._roomInfo.roomName},t.prototype.isPermitBuyIn=function(){return this.getOptions().permit_buy_in},t.prototype.getPropertyName=function(){return this.getOptions().property_name||"chip"},t.prototype.isInCoin=function(){return"coin"===this.getPropertyName()},t.prototype.allowAudienceTextMessage=function(){return this.getOptions().allow_audience_text_message},t.prototype.allowAudienceVoiceMessage=function(){return this.getOptions().allow_audience_voice_message},t.prototype.allowPlayerTextMessage=function(){var e=this.getOptions().allow_player_text_message;return void 0===e&&(e=!0),e},t.prototype.allowPlayerVoiceMessage=function(){var e=this.getOptions().allow_player_voice_message;return void 0===e&&(e=!0),e},t.prototype.getClubName=function(){return this.getOptions().club_name||""},t.prototype.isInOfficialClub=function(){return this.getClubName()?this.getClubName().includes("来玩德州扑克官方"):!1},t.prototype.getAutoStartPlayerAmount=function(){return this.getOptions().auto_start_player_amount||0},t.prototype.getMaximumPlayerAmount=function(){var e=this.getOptions().maximum_player_amount||this.MAXIMUM_PLAYER_AMOUNT;return e<this.MINIMUM_PLAYER_AMOUNT?this.MAXIMUM_PLAYER_AMOUNT:e},t.prototype.getSmallBlind=function(){return this.getOptions().small_blind},t.prototype.getMinBuyIn=function(){return this.getOptions().minimum_buy_in},t.prototype.getMaxBuyIn=function(){return this.getOptions().maximum_buy_in},t.prototype.addMessageListener=function(){EventCenter.sharedInstance().addEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.removeMessageListener=function(){EventCenter.sharedInstance().removeEventListener(CentrifugeServerEvent.ReceivedMessageFromCentrifuge,this.onReceivedMessage,this)},t.prototype.isCreator=function(e){return this._roomInfo.creatorId===e},t.prototype.isTimerStatusEqualTo=function(e){return this._roomInfo.timerStatus===e},t.prototype.getRoomCountdown=function(e){if(0>=e)return"00:00:00";var t=new Date(1e3*e),n=t.getUTCHours(),i=t.getUTCMinutes(),o=t.getUTCSeconds(),r=10>n?"0"+n:n,a=10>i?"0"+i:i,s=10>o?"0"+o:o;return r+":"+a+":"+s},t.prototype.joioRoomById=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/texas/room/"+e+"/join",i=this.request.buildHeaderWithToken(t);return this.request.post(n,{},i,RequestName.JoinRoom)},t.prototype.queryRoomInfo=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room/"+e,i=this.request.buildHeaderWithToken(t);return this.request.get(n,{},i,RequestName.QueryRoom)},t.prototype.startTimer=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room/"+e+"/timer",i=this.request.buildHeaderWithToken(t);return this.request.put(n,{},i,RequestName.StartTimer)},t.prototype.onReceivedMessage=function(e){var t=__assign({},e.context);"room|timer"===t.data.stream&&this.handleRoomMessage(t)},t.prototype.handleRoomMessage=function(e){var t=e.data.payload,n=t.action,i=t.content;switch(n){case RoomAction.StartTimer:this.dispatchRoomMessageEvent(RoomMessageEvent.TimerStart,i);break;case RoomAction.AddSeconds:this.dispatchRoomMessageEvent(RoomMessageEvent.TimerStopped,i);break;case RoomAction.StopTimer:this.dispatchRoomMessageEvent(RoomMessageEvent.AddSceonds,i)}},t.prototype.dispatchRoomMessageEvent=function(e,t){var n=new RoomMessageEvent(e);n.data=t,this.dispatchEvent(n)},t}(egret.EventDispatcher);__reflect(RoomModel.prototype,"RoomModel");var UserModel=function(){function e(){this.USER_ID_KEY="user_id_key",this.ACCESS_TOKEN_KEY="access_token_key",this.TOKEN_TYPE_KEY="token_type_key",this.PLAYER_NICKNAME_KEY="player_nickname_key",this.WEBSOCKET_TOKEN_KEY="websocket_token_key",this.COUNTRY_CODE_KEY="account_country_code",this.CARRIER_KEY="account_carrier",this.request=new HttpRequest}return e.prototype.queryProfile=function(e,t){var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/profile/"+e,i=this.request.buildHeaderWithToken(t);return this.request.get(n,{},i,RequestName.QueryProfile)},e.prototype.savePlayerNickname=function(e,t){egret.localStorage.setItem(this.PLAYER_NICKNAME_KEY+"#"+e,t)},e.prototype.getPlayerNickname=function(e){return egret.localStorage.getItem(this.PLAYER_NICKNAME_KEY+"#"+e)},e.prototype.getUTCFromServer=function(){var e=ApiConfig.ApiDomain+"/node/v1/utc",t={"App-Id":"laiwan"};return this.request.get(e,{},t)},e.prototype.requestVerificationCode=function(e,t){void 0===t&&(t=0);var n=ApiConfig.ApiDomain+"/"+ApiConfig.Version_2+"/sms/code",i={application:"laiwan",country_code:"86",phone_number:e,exp:t+3e6},o=JWTSecret.SMS_SECRET,r=JWT.create(JSON.stringify(i),o),a={Payload:r,"App-Id":"laiwan"};return this.request.post(n,{},a)},e.prototype.signUp=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_5+"/user/register/phone/sms_code",n={country_code:"86",phone_number:e.phoneNumber,sms_code:e.verificationCode,hash_digest:e.hashDigest,expire_iso_time:e.expireISOTime,device_id:"1",device_name:"web",os_version:"egret",app_version:"testing",password:"12345678",username:"web"+e.phoneNumber,nickname:"web"+e.phoneNumber,birthday:"1980-01-01"},i={"App-Id":"laiwan"};return this.request.post(t,n,i)},e.prototype.signIn=function(e){var t=ApiConfig.ApiDomain+"/"+ApiConfig.Version_5+"/user/login/phone/sms_code",n={country_code:"86",phone_number:e.phoneNumber,sms_code:e.verificationCode,device_id:"1"},i={"App-Id":"laiwan"};return this.request.post(t,n,i)},e.prototype.keepAlive=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/room/"+e+"/member/"+t+"/alive",o=this.request.buildHeaderWithToken(n);return this.request.patch(i,{},o)},e.prototype.queryCurrencyBalance=function(e,t,n){var i=ApiConfig.ApiDomain+"/"+ApiConfig.Version_1+"/wallet/"+e+"/currency/"+t,o=this.request.buildHeaderWithToken(n);return this.request.get(i,{},o)},e.prototype.buyDiamond=function(e){var t=ApiConfig.ApiDomain+"/service/"+ApiConfig.Version_1+"/wallet/"+e+"/deposit",n=UUID.generate(),i={transaction_id:n,currency_name:"diamond",amount:200,memo:"web版客户端测试"};return this.request.post(t,i)},Object.defineProperty(e.prototype,"loginInfo",{get:function(){return this._loginInfo},set:function(e){this._loginInfo=e,this.id=e.userId,this.accessToken=e.apiToken.accessToken,this.tokenType=e.apiToken.tokenType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return egret.localStorage.getItem(this.USER_ID_KEY)},set:function(e){egret.localStorage.setItem(this.USER_ID_KEY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nickname",{get:function(){return this.getPlayerNickname(this.id)},set:function(e){this.savePlayerNickname(this.id,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenType",{get:function(){return egret.localStorage.getItem(this.TOKEN_TYPE_KEY)},set:function(e){egret.localStorage.setItem(this.TOKEN_TYPE_KEY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessToken",{get:function(){return egret.localStorage.getItem(this.ACCESS_TOKEN_KEY)},set:function(e){egret.localStorage.setItem(this.ACCESS_TOKEN_KEY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"websocketToken",{get:function(){return new WebsocketTokenInfo(JSON.parse(egret.localStorage.getItem(this.WEBSOCKET_TOKEN_KEY)))},set:function(e){egret.localStorage.setItem(this.WEBSOCKET_TOKEN_KEY,JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countryCode",{get:function(){var e=egret.localStorage.getItem(this.COUNTRY_CODE_KEY);return e},set:function(e){this._countryCode=e,egret.localStorage.setItem(this.COUNTRY_CODE_KEY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"carrier",{get:function(){var e=egret.localStorage.getItem(this.CARRIER_KEY);return e},set:function(e){this._carrier=e,egret.localStorage.setItem(this.CARRIER_KEY,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verificationInfo",{get:function(){return this._verificationInfo},set:function(e){this._verificationInfo=e},enumerable:!0,configurable:!0}),e}();__reflect(UserModel.prototype,"UserModel");var ApiTokenInfo=function(){function e(e){this._accessToken=e.access_token,this._tokenType=e.token_type}return Object.defineProperty(e.prototype,"accessToken",{get:function(){return this._accessToken},set:function(e){this._accessToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenType",{get:function(){return this._tokenType},set:function(e){this._tokenType=e},enumerable:!0,configurable:!0}),e}();__reflect(ApiTokenInfo.prototype,"ApiTokenInfo");var ClubInfo=function(){function e(e){this._clubName=e.club_name,this._roomName=e.room_name}return Object.defineProperty(e.prototype,"clubName",{get:function(){return this._clubName},set:function(e){this._clubName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomName",{get:function(){return this._roomName},set:function(e){this._roomName=e},enumerable:!0,configurable:!0}),e}();__reflect(ClubInfo.prototype,"ClubInfo");var Currency=function(){function e(e){this._balance=e.balance,this._createdAt=e.created_at,this._lastChangedAt=e.last_changed_at,this._currencyName=e.currency_name,this._walletId=e.wallet_id,this._lastStatementId=e.last_statement_id,this._frozenAmount=e.frozen_amount}return Object.defineProperty(e.prototype,"balance",{get:function(){return this._balance},set:function(e){this._balance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastChangedAt",{get:function(){return this._lastChangedAt},set:function(e){this._lastChangedAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currencyName",{get:function(){return this._currencyName},set:function(e){this._currencyName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walletId",{get:function(){return this._walletId},set:function(e){this._walletId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastStatementId",{get:function(){return this._lastStatementId},set:function(e){this._lastStatementId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frozenAmount",{get:function(){return this._frozenAmount},set:function(e){this._frozenAmount=e},enumerable:!0,configurable:!0}),e}();__reflect(Currency.prototype,"Currency");var LoginInfo=function(){function e(e){this._deviceId=e.device_id,this._userId=e.user_id,this._userName=e.username,this._apiToken=new ApiTokenInfo(e.api_token),this._websocketToken=new WebsocketTokenInfo(e.websocket_token)}return Object.defineProperty(e.prototype,"deviceId",{get:function(){return this._deviceId},set:function(e){this._deviceId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userName",{get:function(){return this._userName},set:function(e){this._userName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apiToken",{get:function(){return this._apiToken},set:function(e){this._apiToken=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"websocketToken",{get:function(){return this._websocketToken},set:function(e){this._websocketToken=e},enumerable:!0,configurable:!0}),e}();__reflect(LoginInfo.prototype,"LoginInfo");var MessageInfo=function(){function e(e){this._requestId=e.request_id,this._httpStatus=e.http_status,this._response=new ResponseInfo(e.response)}return Object.defineProperty(e.prototype,"requestId",{get:function(){return this._requestId},set:function(e){this._requestId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpStatus",{get:function(){return this._httpStatus},set:function(e){this._httpStatus=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._response},set:function(e){this._response=e},enumerable:!0,configurable:!0}),e}();__reflect(MessageInfo.prototype,"MessageInfo");var ResponseInfo=function(){function e(e){this._ok=e.ok,this._message=e.message||e.error_type||e.errors&&e.errors[0].message,this._result=e.result,this._errorType=e.error_type,this._hello=e.hello,this._serverLoad=e.server_load}return Object.defineProperty(e.prototype,"serverLoad",{get:function(){return this._serverLoad},set:function(e){this._serverLoad=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hello",{get:function(){return this._hello},set:function(e){this._hello=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ok",{get:function(){return this._ok},set:function(e){this._ok=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"result",{get:function(){return this._result},set:function(e){this._result=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},set:function(e){this._message=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorType",{get:function(){return this._errorType},set:function(e){this._errorType=e},enumerable:!0,configurable:!0}),e}();__reflect(ResponseInfo.prototype,"ResponseInfo");var RoomInfo=function(){function e(e){this._creatorId=e.creator_id,this._roomId=e.room_id,this._remainingSeconds=e.remaining_seconds,this._bookingSeconds=e.booking_seconds,this._timerStatus=e.timer_status,this._options=e.options,this._timingAt=e.timing_at,this._managers=e.managers,this._createdAt=e.created_at,this._roomName=e.room_name,this._roomStatus=e.room_status,this._hasTimer=e.has_timer}return Object.defineProperty(e.prototype,"creatorId",{get:function(){return this._creatorId},set:function(e){this._creatorId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomId",{get:function(){return this._roomId},set:function(e){this._roomId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTimer",{get:function(){return this._hasTimer},set:function(e){this._hasTimer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainingSeconds",{get:function(){return this._remainingSeconds},set:function(e){this._remainingSeconds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookingSeconds",{get:function(){return this._bookingSeconds},set:function(e){this._bookingSeconds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timerStatus",{get:function(){return this._timerStatus},set:function(e){this._timerStatus=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timingAt",{get:function(){return this._timingAt},set:function(e){this._timingAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"managers",{get:function(){return this._managers},set:function(e){this._managers=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},set:function(e){this._createdAt=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomName",{get:function(){return this._roomName},set:function(e){this._roomName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomStatus",{get:function(){return this._roomStatus},set:function(e){this._roomStatus=e},enumerable:!0,configurable:!0}),e}();__reflect(RoomInfo.prototype,"RoomInfo");var VerificationCodeInfo=function(){function e(e){this._hashDigest=e.hash_digest,this._expireISOTime=e.expire_iso_time}return Object.defineProperty(e.prototype,"hashDigest",{get:function(){return this._hashDigest},set:function(e){this._hashDigest=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expireISOTime",{get:function(){return this._expireISOTime},set:function(e){this._expireISOTime=e},enumerable:!0,configurable:!0}),e}();__reflect(VerificationCodeInfo.prototype,"VerificationCodeInfo");var WebsocketTokenInfo=function(){function e(e){this._user=e.user,this._timestamp=e.timestamp,this._info=e.info,this._token=e.token,this._userChannel=e.user_channel}return Object.defineProperty(e.prototype,"user",{get:function(){return this._user},set:function(e){this._user=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){this._timestamp=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return this._info},set:function(e){this._info=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this._token},set:function(e){this._token=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userChannel",{get:function(){return this._userChannel},set:function(e){this._userChannel=e},enumerable:!0,configurable:!0}),e}();__reflect(WebsocketTokenInfo.prototype,"WebsocketTokenInfo");var CentrifugeServer=function(){function e(){this.isConnected=!1,this.channelMap=null,this.centrifuge=void 0,this.subscriptions=[],this.channelMap=new Map}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connect=function(e){var t=this;this.config=e,this.centrifuge=new Centrifuge({url:e.url,info:e.info,timestamp:e.timestamp,token:e.token,user:e.user,accessToken:e.accessToken,version:e.version}),this.centrifuge.on("connect",function(e){t.isConnected=!0,t.centrifuge._reconnect=!1;var n=new CentrifugeServerEvent(CentrifugeServerEvent.Connected);EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.on("disconnect",function(e){console.log("on disconnect",e),t.isConnected=!1,t.centrifuge._reconnect=!1;var n=new CentrifugeServerEvent(CentrifugeServerEvent.Disconnected);n.data=e,EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.on("error",function(e){console.log("on error",e),t.isConnected=!1,t.centrifuge._reconnect=!1;var n=new CentrifugeServerEvent(CentrifugeServerEvent.ConnectionError);EventCenter.sharedInstance().dispatchEvent(n)}),this.centrifuge.connect()},e.prototype.reconnect=function(e){if(!this.isConnected&&this.config){var t=__assign({},this.config);t.url=e,this.connect(t)}},e.prototype.sendCustomMessage=function(e){var t=new CentrifugeServerEvent(CentrifugeServerEvent.ReceivedMessageFromCentrifuge);t.context=e,EventCenter.sharedInstance().dispatchEvent(t)},e.prototype.subscribe=function(e){var t=this,n={message:function(e){t.isConnected=!0,console.log("centrifuge.message");var n=new CentrifugeServerEvent(CentrifugeServerEvent.ReceivedMessageFromCentrifuge);n.context=e,EventCenter.sharedInstance().dispatchEvent(n)},subscribe:function(t){console.log("centrifuge.subscribe");var n=new CentrifugeServerEvent(CentrifugeServerEvent.SubscribeSuccess);n.data=e,EventCenter.sharedInstance().dispatchEvent(n)},error:function(e){console.log("centrifuge.error")},unsubscribe:function(e){console.log("centrifuge.unsubscribe")}},i=this.centrifuge.subscribe(e,n);this.channelMap.set(e,i)},e.prototype.hasChannel=function(e){return this.channelMap.has(e)},e.prototype.unsubscribe=function(e){var t=this.channelMap.get(e);t&&t.unsubscribe(),this.channelMap["delete"](e)},e.prototype.unsubscribeAll=function(){for(var e=this.channelMap.keys(),t=this.channelMap.size,n=0;t>n;){n+=1;var i=e.next().value;this.unsubscribe(i)}this.channelMap.clear()},e.prototype.disconnect=function(){this.centrifuge&&(this.unsubscribeAll(),this.centrifuge.disconnect(),this.centrifuge=void 0),this.isConnected=!1},e}();__reflect(CentrifugeServer.prototype,"CentrifugeServer");var ActionUtil=function(){function e(){}return e.getActionMessage=function(e){var t="";switch(e){case GameAction.Fold:t=ActionMessage.Fold;break;case GameAction.Check:t=ActionMessage.Check;break;case GameAction.Call:t=ActionMessage.Call;break;case GameAction.Raise:t=ActionMessage.Raise;break;case GameAction.AllIn:t=ActionMessage.AllIn}return t},e.updateSource=function(e,t){var n="icon_player_"+t+"_png";RES.hasRes(n)&&e.updateSource(n)},e}();__reflect(ActionUtil.prototype,"ActionUtil");var ActiveUtil=function(){function e(){}return e.calculatePlayerRemainTime=function(e,t){var n=new Date(t),i=1e3*e,o=n.valueOf()+i-(new Date).valueOf();if(0>o)return 0;var r=o/1e3;return Math.ceil(r)},e.createLegalAction=function(e){var t=void 0;if(!e)return t;var n=!1,i=!1,o=!1,r=!1,a=void 0,s=void 0;return e.forEach(function(e){e.action===GameAction.Check&&(n=!0),e.action===GameAction.Call&&(i=!0,s=e.amount),e.action===GameAction.Raise&&(o=!0,a=e.amount),e.action===GameAction.AllIn&&(r=!0,a=e.amount)}),t={couldCheck:n,couldCall:i,couldRaise:o,mustAllIn:r,raiseAmount:a,callAmount:s}},e}();__reflect(ActiveUtil.prototype,"ActiveUtil");var AnimationUtil=function(){function e(){}return e.loopPlay=function(e,t){if(void 0===t&&(t=!0),t)for(var n in e.items)e.items[n]&&(e.items[n].props={loop:!0});e.play()},e}();__reflect(AnimationUtil.prototype,"AnimationUtil");var ArrayBufferUtil=function(){function e(){}return e.str2ArrayBuffer=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0,o=e.length;o>i;i++)n[i]=e.charCodeAt(i);return t},e.arrayBuffer2String=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},e}();__reflect(ArrayBufferUtil.prototype,"ArrayBufferUtil");var AvatarURLFactory=function(){function e(){}return e.makeById=function(e){return ApiConfig.MediaDomain+"/"+e+"/"+e+".jpg"},e}();__reflect(AvatarURLFactory.prototype,"AvatarURLFactory");var Barrage=function(){function e(){}return e.shoot=function(e,t){var n=new eui.Label;n.text=t,n.size=24,n.textColor=13302004;var i=new eui.Group,o=new eui.Rect;i.width=n.width+30,i.height=48;var r=Math.floor(8*Math.random());i.y=80+80*r,i.left=e.width,o.percentWidth=100,o.percentHeight=100,o.alpha=.8,o.fillColor=74272,o.ellipseWidth=o.ellipseHeight=48,n.verticalCenter=0,n.horizontalCenter=0,i.addChild(o),i.addChild(n),n.textAlign="center",e.addChild(i),egret.Tween.get(i).to({left:-i.width},8e3).call(function(){e.removeChild(i)})},e}();__reflect(Barrage.prototype,"Barrage");var Color=function(){function e(){}return e.white=16777215,e.gray=10663861,e}();__reflect(Color.prototype,"Color");var Constants=function(){function e(){}return e.iPhoneX_TOP_MARGIN=44,e.iPhoneX_BOTTOM_MARGIN=34,e}();__reflect(Constants.prototype,"Constants");var Device=function(){function e(){}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.isInReactNative=function(){return this.platform?"react_native"===this.platform:!1},e.prototype.isIphoneX=function(){return this.screenSize?this.screenSize.height>800:!1},e.prototype.getScreenWidth=function(){return this.screenSize.width},e.prototype.getScreenHeight=function(){return this.screenSize.height},e.prototype.setPlatform=function(e){this._platform=e},e.prototype.setScreenSize=function(e){this._screenSize=e},Object.defineProperty(e.prototype,"platform",{get:function(){return this._platform},set:function(e){this._platform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenSize",{get:function(){return this._screenSize},set:function(e){this._screenSize=e},enumerable:!0,configurable:!0}),e}();__reflect(Device.prototype,"Device");var HttpRequest=function(){function e(){}return e.prototype.request=function(e,t,n,i,o,r){var a=this;return void 0===n&&(n={}),void 0===i&&(i={}),void 0===r&&(r=1e4),new Promise(function(s,c){var u=new XMLHttpRequest;u.timeout=r,u.responseType="text";var h=e,l="{}";if(t===egret.HttpMethod.GET){var d=n?a.buildParams(n):"";h=""+e+d}else l=n?a.buildBody(n):"{}";u.open(t,h),"App-Id"in i?u.setRequestHeader("App-Id",i["App-Id"]):u.setRequestHeader("App-Id","laiwan:texas_holdem"),u.setRequestHeader("Content-Type","application/json");for(var p in i)if("App-Id"!==p){var m=i[p];u.setRequestHeader(p,m)}u.onloadend=function(){if(200===u.status){var t=JSON.parse(u.response),n=new ResponseInfo(t);n.ok||n.hello||n.serverLoad?s(n):c(n)}else if(0!==u.status){if(401===u.status){var i=[{name:"好的",action:function(){a.leaveGame()}}];return void MessageAlert.show("您的帐号已在其他设备上登陆,请重新登录。如果密码已泄漏,请及时修改。","",i)}c({message:"服务错误, 请稍后再试!  "+u.status,status:a.getProxyCode(e)+" "+(o||"")+"("+a.getCurrentTime()+")"})}},u.onerror=function(){c({message:"连接失败了, 请检查一下网络~  "+u.status,status:a.getProxyCode(e)+" "+(o||"")+" error("+a.getCurrentTime()+")"})},u.ontimeout=function(){c({message:"请求超时, 请检查一下网络~",status:a.getProxyCode(e)+" "+(o||"")+" timeout("+a.getCurrentTime()+")"})},u.send(l)})},e.prototype.get=function(e,t,n,i,o){return void 0===o&&(o=3e3),this.request(e,egret.HttpMethod.GET,t,n,i,o)},e.prototype.post=function(e,t,n,i,o){return void 0===o&&(o=1e4),this.request(e,egret.HttpMethod.POST,t,n,i,o)},e.prototype.patch=function(e,t,n,i,o){return void 0===o&&(o=1e4),this.request(e,"PATCH",t,n,i,o)},e.prototype.put=function(e,t,n,i,o){return void 0===o&&(o=3e3),this.request(e,"PUT",t,n,i,o)},e.prototype["delete"]=function(e,t,n,i,o){return void 0===o&&(o=3e3),this.request(e,"DELETE",t,n,i,o)},e.prototype.buildHeaderWithToken=function(e){var t={Authorization:"Bearer "+e};return t},e.prototype.getCurrentTime=function(){var e=new Date;return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()},e.prototype.getProxyCode=function(e){var t=e.replace("https://",""),n=t.indexOf(".");return t=t.substring(0,n)},e.prototype.buildParams=function(e){var t="?";for(var n in e)e[n]&&(t+=n+"="+e[n]+"&");return t.length>0&&(t=t.substring(0,t.length-1)),t},e.prototype.buildBody=function(e){var t=JSON.stringify(e);return t},e.prototype.leaveGame=function(){window.postMessage(JSON.stringify({command:GameCommand.LEAVE_ROOM,payload:""}),"*")},e}();__reflect(HttpRequest.prototype,"HttpRequest");var ImageUtil=function(){function e(){}return e.loadUrlSource=function(e,t){var n=this,i=egret.localStorage.getItem("avatar&"+t);if("error"===i)return void(e.source=this.DEFAULT_AVATAR_SOURCE);if(i){var o=i.split(",");return void egret.BitmapData.create("base64",o[1],function(t){var n=new egret.Texture;n.bitmapData=t,e.source=n})}var r=new egret.ImageLoader;r.crossOrigin="anonymous",r.load(t+"?"+(new Date).valueOf()),r.once(egret.Event.COMPLETE,function(n){if(n.currentTarget.data){var i=new egret.Texture;i.bitmapData=n.currentTarget.data,e.source=i;var o=new egret.RenderTexture;o.drawToTexture(e,new egret.Rectangle(0,0,e.width,e.height));var r=o.toDataURL("image/png");egret.localStorage.setItem("avatar&"+t,r)}},this),r.once(egret.IOErrorEvent.IO_ERROR,function(i){egret.localStorage.setItem("avatar&"+t,"error"),e.source=n.DEFAULT_AVATAR_SOURCE},this)},e.renderRoundMask=function(e,t){var n=new eui.Rect;n.width=e.width,n.height=e.height,n.x=e.x,n.y=e.y,n.ellipseWidth=t,n.ellipseHeight=t,e.parent.addChild(n),e.mask=n},e.addCover=function(e){var t=new eui.Rect;t.width=e.width,t.height=e.height,t.x=e.x,t.y=e.y,t.alpha=.5,e.parent.addChild(t)},e.DEFAULT_AVATAR_SOURCE="image_default_avatar_png",e.BLOCKED_AVATAR_SOURCE="image_blocked_avatar_png",e}();__reflect(ImageUtil.prototype,"ImageUtil");var JWT=function(){function e(){}return e.create=function(e,t){var n={typ:"JWT",alg:"HS256"},i=Base64.encode(JSON.stringify(n)).replace(/\=/g,""),o=Base64.encode(e).replace(/\=/g,""),r=CryptoJS.HmacSHA256(i+"."+o,t).toString(CryptoJS.enc.Base64);return r=r.replace(/\=/g,""),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),i+"."+o+"."+r},e}();__reflect(JWT.prototype,"JWT");var MoneyFormatter=function(){function e(){}return e.addChineseUnit=function(e){var t,n,i="",o=1e4,r=1e6,a=1e8;return o>e?i=""+e:e>=o&&r>e?(t=new Decimal(e),n=t.div(o).toNumber(),i=Math.floor(100*n)/100+"万"):e>=r&&a>e?(t=new Decimal(e),n=t.div(o).toNumber(),i=Math.floor(n)+"万"):e>=a&&(t=new Decimal(e),n=t.div(a).toNumber(),i=Math.floor(100*n)/100+"亿"),i
},e.removeChineseUnit=function(e){var t,n=0,i=1e4,o=1e7,r=1e8,a=e.indexOf("万"),s=e.indexOf("千"),c=e.indexOf("亿");return a>0?(t=new Decimal(e.substring(0,a)),n=t.times(i).toNumber()):s>0?(t=new Decimal(e.substring(0,s)),n=t.times(o).toNumber()):c>0?(t=new Decimal(e.substring(0,c)),n=t.times(r).toNumber()):n=parseInt(e,0),n},e}();__reflect(MoneyFormatter.prototype,"MoneyFormatter");var PokerAnalyzer=function(){function e(){}return e.getCardTypeByResult=function(e){var t=" ";switch(e){case CardType.ROYAL_FLUSH:t="皇家同花顺";break;case CardType.STRAIGHT_FLUSH:t="同花顺";break;case CardType.FOUR_OF_A_KIND:t="四条";break;case CardType.FLUSH:t="同花";break;case CardType.FULL_HOUSE:t="葫芦";break;case CardType.STRAIGHT:t="顺子";break;case CardType.THREE_OF_A_KIND:t="三条";break;case CardType.TWO_PAIRS:t="两对";break;case CardType.PAIR:t="对子";break;case CardType.HIGH_CARD:t="高牌";break;default:t=" "}return t},e.getCardTypeByCard=function(t){var n=e.analyze(t);return this.getCardTypeByResult(n)},e.analyze=function(e){var t=e.sort(function(e,t){return e.value-t.value});return this.isRoyalFlush(t)?CardType.ROYAL_FLUSH:this.isStraightFlush(t)?CardType.STRAIGHT_FLUSH:this.isFourOfAKind(t)?CardType.FOUR_OF_A_KIND:this.isFlush(t)?CardType.FLUSH:this.isFullHouse(t)?CardType.FULL_HOUSE:this.isThreeOfAKind(t)?CardType.THREE_OF_A_KIND:this.isStraight(t)?CardType.STRAIGHT:this.isTwoPair(t)?CardType.TWO_PAIRS:this.isPair(t)?CardType.PAIR:CardType.HIGH_CARD},e.isPair=function(e){for(var t=0;t<e.length-1;t+=1)if(e[t].value===e[t+1].value)return!0;return!1},e.isTwoPair=function(e){for(var t=!1,n=0;n<e.length-1;n+=1)if(e[n].value===e[n+1].value){if(t)return!0;n++,t=!0}},e.isThreeOfAKind=function(e){for(var t=0;t<e.length-2;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value)return!0;return!1},e.isFourOfAKind=function(e){for(var t=0;t<e.length-3;t+=1)if(e[t].value===e[t+1].value&&e[t+1].value===e[t+2].value&&e[t+2].value===e[t+3].value)return!0;return!1},e.isFullHouse=function(e){for(var t=0;t<e.length-2;t++)if(e[t].value==e[t+1].value&&e[t].value==e[t+2].value)for(var n=0;n<e.length-1;n++)if(e[t].value!=e[n].value&&e[n].value==e[n+1].value)return!0;return!1},e.isStraight=function(e){for(var t=0,n=[e[t]];t<e.length&&n.length<5;){for(var i=t+1;i<e.length&&e[t].value===e[i].value;)i+=1;if(i>=e.length)return!1;e[t].value+1===e[i].value?n.push(e[i]):n=[e[i]],t=i}return n.length>=5},e.isFlush=function(e){for(var t=[0,0,0,0],n=0;n<e.length;n+=1)t[e[n].suit]+=1;for(var i=0;i<t.length;i+=1)if(t[i]>=5)return!0;return!1},e.isStraightFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.isRoyalFlush=function(e){var t=this.getFlushCards(e);if(t.length<5)return!1;for(var n=0;n<t.length-4;n+=1)if(t[n].value===CardValue.Ten&&t[n].value+1===t[n+1].value&&t[n+1].value+1===t[n+2].value&&t[n+2].value+1===t[n+3].value&&t[n+3].value+1===t[n+4].value)return!0;return!1},e.getFlushCards=function(e){for(var t=[],n=[0,0,0,0],i=0;i<e.length;i+=1)n[e[i].suit]+=1;for(var o=CardSuit.Error,r=0;r<n.length;r+=1)if(n[r]>=5){o=r;break}if(o===CardSuit.Error)return t;for(var i=0;i<e.length;i+=1)e[i].suit===o&&t.push(e[i]);return t},e}();__reflect(PokerAnalyzer.prototype,"PokerAnalyzer");var PropsUtil=function(){function e(){}return e.playAnimation=function(e,t,n,i){var o=new eui.Image;o.source="icon_props_"+i+"_png",o.width=100,o.height=100,o.anchorOffsetX=50,o.anchorOffsetY=50;var r=.5*(e.width-o.width)+50,a=.5*(e.height-o.height)+50;o.x=e.x+r,o.y=e.y+a,n.addChild(o);var s=this.calculateAddiaional(i),c=this.calculateDistance(e.x,e.y,t.x,t.y),u=c/1.3,h={x:t.x+r,y:t.y+a};Object.assign(h,s),egret.Tween.get(o).to(h,u).call(function(){n.removeChild(o),t.playPropsAnimation(i)})},e.calculateAddiaional=function(e){var t={};switch(e){case"tomato":t={rotation:720};break;case"flower":break;case"tea":t={scaleX:1.3,scaleY:1.3};break;case"water":t={scaleX:.8,scaleY:.8}}return t},e.calculateDistance=function(e,t,n,i){var o=Math.abs(n-e),r=Math.abs(i-t),a=Math.sqrt(Math.pow(o,2)+Math.pow(r,2));return a},e}();__reflect(PropsUtil.prototype,"PropsUtil");var SceneManager=function(){function e(){this.sceneStack=[]}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.init=function(e){this.baseScene||(this.baseScene=e)},Object.defineProperty(e.prototype,"stageSize",{get:function(){return this._stageSize},set:function(e){this._stageSize=e},enumerable:!0,configurable:!0}),e.prototype.replaceScene=function(e){this.baseScene&&(this.baseScene.removeChildren(),this.baseScene.addChild(e))},e.prototype.pushScene=function(e){this.baseScene&&(this.baseScene.addChild(e),this.sceneStack.push(e))},e.prototype.popScene=function(){if(this.baseScene){var e=this.sceneStack.length;if(e>0){var t=this.sceneStack[e-1];t.parent===this.baseScene&&(this.baseScene.removeChild(t),this.sceneStack.splice(e-1,1))}}},e}();__reflect(SceneManager.prototype,"SceneManager");var SeatUtil=function(){function e(){}return e.calculateCoordinate=function(e,t,n){var i=(e-t+n)%n;i=i||n;var o=this.getConfigByAmount(n);return this.findCoordinate(i,o)},e.findCoordinate=function(e,t){void 0===e&&(e=0);var n=e-1,i=Object.keys(t)[n];return t[i]},e.getConfigByAmount=function(e){var t=e-2,n=__assign({},SeatConfig[t]);return Object.keys(n).forEach(function(e,t){n[e].seat=t+1}),n},e}();__reflect(SeatUtil.prototype,"SeatUtil");var SoundManager=function(){function e(){this.IS_VIBRATE_KEY="is_vibrate_key",this.IS_PLAY_AUDIO_KEY="is_play_audio_key",this.IS_PLAY_BACKGROUN_SOUND_KEY="isPlayBackgroundSound",this.IS_PLAY_EFFECT_SOUND_KEY="isPlayEffectSound",this.BACKGROUND_SOUND_VOLUME_KEY="backgroundSoundVolume",this.EFFECT_SOUND_VOLUME_KEY="effectSoundVolume",this.DEFAULT_VOLUME="1",this.MUSIC_START_TIME=0,this.backgroundSounds={},this.backgroundSoundChannels={},this.effectSounds={},this.effectSoundChannels={}}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.setIsPlayBackgroundSound=function(e){egret.localStorage.setItem(this.IS_PLAY_BACKGROUN_SOUND_KEY,e.toString()),e?this.playBackgroundSound(this.currentSoundFileSource):this.stopPlayBackgroundSound()},e.prototype.isPlayBackgroundSound=function(){var e=egret.localStorage.getItem(this.IS_PLAY_BACKGROUN_SOUND_KEY);return e?"true"===e:!0},e.prototype.setIsPlayEffect=function(e){egret.localStorage.setItem(this.IS_PLAY_EFFECT_SOUND_KEY,e.toString())},e.prototype.getIsPlayEffect=function(){var e=egret.localStorage.getItem(this.IS_PLAY_EFFECT_SOUND_KEY);return null===e&&(e="true"),e},e.prototype.setIsVibrate=function(e){egret.localStorage.setItem(this.IS_VIBRATE_KEY,e.toString())},e.prototype.getIsVibrate=function(){var e=egret.localStorage.getItem(this.IS_VIBRATE_KEY);return null===e&&(e="true"),e},e.prototype.setIsPlayAudio=function(e){egret.localStorage.setItem(this.IS_PLAY_AUDIO_KEY,e.toString())},e.prototype.getIsPlayAudio=function(){var e=egret.localStorage.getItem(this.IS_PLAY_AUDIO_KEY);return null===e&&(e="true"),e},e.prototype.setBgSoundVolume=function(e){var t=new Decimal(e).div(100);for(var n in this.backgroundSoundChannels)this.backgroundSoundChannels[n]&&(this.backgroundSoundChannels[n].volume=t);egret.localStorage.setItem(this.BACKGROUND_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedBgSoundVolume=function(){var e=egret.localStorage.getItem(this.BACKGROUND_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return new Decimal(e)},e.prototype.setEffectSoundVolume=function(e){var t=new Decimal(e).div(100);egret.localStorage.setItem(this.EFFECT_SOUND_VOLUME_KEY,t.toString())},e.prototype.getCachedEffectSoundVolume=function(){var e=egret.localStorage.getItem(this.EFFECT_SOUND_VOLUME_KEY)||this.DEFAULT_VOLUME;return Number(e)},e.prototype.playBackgroundSound=function(e,t){void 0===t&&(t=0),this.currentSoundFileSource=e;var n=1===Object.keys(this.backgroundSounds).length;if(this.isPlayBackgroundSound()&&!n){var i=RES.getRes(e);this.backgroundSounds[e]=i;var o=i.play(this.MUSIC_START_TIME,t);o.volume=this.getCachedBgSoundVolume(),this.backgroundSoundChannels[i.hashCode.toString()]=o}},e.prototype.stopPlayBackgroundSound=function(){for(var e in this.backgroundSoundChannels)this.backgroundSoundChannels[e]&&(this.backgroundSoundChannels[e].stop(),delete this.backgroundSoundChannels[e]);for(var t in this.backgroundSounds)this.backgroundSounds[t]&&delete this.backgroundSounds[t]},e.prototype.playEffectSound=function(e,t){void 0===t&&(t=1);var n;if("true"===this.getIsPlayEffect()){var i=RES.getRes(e),o=i.play(this.MUSIC_START_TIME,t);o.volume=this.getCachedEffectSoundVolume(),n=o.hashCode.toString(),this.effectSoundChannels[n]=o}return n},e.prototype.stopPlayEffectSound=function(e){var t=this.effectSoundChannels[e];t&&(t.stop(),delete this.effectSoundChannels[e])},e.prototype.getPlayingSoundFileSource=function(){return this.currentSoundFileSource},e}();__reflect(SoundManager.prototype,"SoundManager");var WebSocketRequest=function(){function e(){}return e.sharedInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.connect=function(e){this.config=e;var t=this.buildUrl(e);this.socket=new egret.WebSocket,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceivedMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connectByUrl(t)},e.prototype.disconnect=function(){this.socket.close()},e.prototype.reconnect=function(e){if(this.config){var t=__assign({},this.config);t.url=e,this.connect(t)}},e.prototype.sendData=function(e){this.sendDate=(new Date).valueOf(),this.socket.writeUTF(JSON.stringify(e))},e.prototype.buildUrl=function(e){var t=e.url+"/"+e.version+"/websocket/?"+e.auth;return t=t.replace("https","wss"),t=t.replace("http","ws")},e.prototype.isDataValid=function(e){return void 0!==e.http_status&&void 0!==e.request_id?!0:!1},e.prototype.onReceivedMessage=function(){var e=(new Date).valueOf();this.delay=e-this.sendDate;var t=this.socket.readUTF(),n=JSON.parse(t);if(this.isDataValid(n)){var i=new MessageInfo(n),o=new WebSocketEvent(WebSocketEvent.RECEIVED_MESSAGE_FROM_WS);o.message=i,EventCenter.sharedInstance().dispatchEvent(o)}},e.prototype.onConnect=function(){egret.log("连接成功");var e=new WebSocketEvent(WebSocketEvent.CONNECTED);EventCenter.sharedInstance().dispatchEvent(e)},e.prototype.onClose=function(){egret.log("连接关闭");var e=new WebSocketEvent(WebSocketEvent.CLOSE);EventCenter.sharedInstance().dispatchEvent(e)},e.prototype.onSocketError=function(){egret.log("连接出错");var e=new WebSocketEvent(WebSocketEvent.ERROR);EventCenter.sharedInstance().dispatchEvent(e)},e}();__reflect(WebSocketRequest.prototype,"WebSocketRequest");